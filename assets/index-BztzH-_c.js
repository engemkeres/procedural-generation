(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();var A0={exports:{}},ph={};var hN;function RF(){if(hN)return ph;hN=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,n,a){var l=null;if(a!==void 0&&(l=""+a),n.key!==void 0&&(l=""+n.key),"key"in n){a={};for(var u in n)u!=="key"&&(a[u]=n[u])}else a=n;return n=a.ref,{$$typeof:i,type:s,key:l,ref:n!==void 0?n:null,props:a}}return ph.Fragment=e,ph.jsx=t,ph.jsxs=t,ph}var dN;function BF(){return dN||(dN=1,A0.exports=RF()),A0.exports}var Kx=BF(),C0={exports:{}},Ve={};var pN;function DF(){if(pN)return Ve;pN=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),b=Symbol.iterator;function x(O){return O===null||typeof O!="object"?null:(O=b&&O[b]||O["@@iterator"],typeof O=="function"?O:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function N(O,ee,de){this.props=O,this.context=ee,this.refs=w,this.updater=de||v}N.prototype.isReactComponent={},N.prototype.setState=function(O,ee){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,ee,"setState")},N.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function C(){}C.prototype=N.prototype;function R(O,ee,de){this.props=O,this.context=ee,this.refs=w,this.updater=de||v}var E=R.prototype=new C;E.constructor=R,T(E,N.prototype),E.isPureReactComponent=!0;var k=Array.isArray;function q(){}var D={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function $(O,ee,de){var we=de.ref;return{$$typeof:i,type:O,key:ee,ref:we!==void 0?we:null,props:de}}function ae(O,ee){return $(O.type,ee,O.props)}function pe(O){return typeof O=="object"&&O!==null&&O.$$typeof===i}function me(O){var ee={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(de){return ee[de]})}var xe=/\/+/g;function Ce(O,ee){return typeof O=="object"&&O!==null&&O.key!=null?me(""+O.key):ee.toString(36)}function ge(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(q,q):(O.status="pending",O.then(function(ee){O.status==="pending"&&(O.status="fulfilled",O.value=ee)},function(ee){O.status==="pending"&&(O.status="rejected",O.reason=ee)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function j(O,ee,de,we,Oe){var We=typeof O;(We==="undefined"||We==="boolean")&&(O=null);var gt=!1;if(O===null)gt=!0;else switch(We){case"bigint":case"string":case"number":gt=!0;break;case"object":switch(O.$$typeof){case i:case e:gt=!0;break;case f:return gt=O._init,j(gt(O._payload),ee,de,we,Oe)}}if(gt)return Oe=Oe(O),gt=we===""?"."+Ce(O,0):we,k(Oe)?(de="",gt!=null&&(de=gt.replace(xe,"$&/")+"/"),j(Oe,ee,de,"",function(_c){return _c})):Oe!=null&&(pe(Oe)&&(Oe=ae(Oe,de+(Oe.key==null||O&&O.key===Oe.key?"":(""+Oe.key).replace(xe,"$&/")+"/")+gt)),ee.push(Oe)),1;gt=0;var qs=we===""?".":we+":";if(k(O))for(var Qt=0;Qt<O.length;Qt++)we=O[Qt],We=qs+Ce(we,Qt),gt+=j(we,ee,de,We,Oe);else if(Qt=x(O),typeof Qt=="function")for(O=Qt.call(O),Qt=0;!(we=O.next()).done;)we=we.value,We=qs+Ce(we,Qt++),gt+=j(we,ee,de,We,Oe);else if(We==="object"){if(typeof O.then=="function")return j(ge(O),ee,de,we,Oe);throw ee=String(O),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return gt}function oe(O,ee,de){if(O==null)return O;var we=[],Oe=0;return j(O,we,"","",function(We){return ee.call(de,We,Oe++)}),we}function fe(O){if(O._status===-1){var ee=O._result;ee=ee(),ee.then(function(de){(O._status===0||O._status===-1)&&(O._status=1,O._result=de)},function(de){(O._status===0||O._status===-1)&&(O._status=2,O._result=de)}),O._status===-1&&(O._status=0,O._result=ee)}if(O._status===1)return O._result.default;throw O._result}var Ne=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},De={map:oe,forEach:function(O,ee,de){oe(O,function(){ee.apply(this,arguments)},de)},count:function(O){var ee=0;return oe(O,function(){ee++}),ee},toArray:function(O){return oe(O,function(ee){return ee})||[]},only:function(O){if(!pe(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return Ve.Activity=m,Ve.Children=De,Ve.Component=N,Ve.Fragment=t,Ve.Profiler=n,Ve.PureComponent=R,Ve.StrictMode=s,Ve.Suspense=h,Ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Ve.__COMPILER_RUNTIME={__proto__:null,c:function(O){return D.H.useMemoCache(O)}},Ve.cache=function(O){return function(){return O.apply(null,arguments)}},Ve.cacheSignal=function(){return null},Ve.cloneElement=function(O,ee,de){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var we=T({},O.props),Oe=O.key;if(ee!=null)for(We in ee.key!==void 0&&(Oe=""+ee.key),ee)!I.call(ee,We)||We==="key"||We==="__self"||We==="__source"||We==="ref"&&ee.ref===void 0||(we[We]=ee[We]);var We=arguments.length-2;if(We===1)we.children=de;else if(1<We){for(var gt=Array(We),qs=0;qs<We;qs++)gt[qs]=arguments[qs+2];we.children=gt}return $(O.type,Oe,we)},Ve.createContext=function(O){return O={$$typeof:l,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:a,_context:O},O},Ve.createElement=function(O,ee,de){var we,Oe={},We=null;if(ee!=null)for(we in ee.key!==void 0&&(We=""+ee.key),ee)I.call(ee,we)&&we!=="key"&&we!=="__self"&&we!=="__source"&&(Oe[we]=ee[we]);var gt=arguments.length-2;if(gt===1)Oe.children=de;else if(1<gt){for(var qs=Array(gt),Qt=0;Qt<gt;Qt++)qs[Qt]=arguments[Qt+2];Oe.children=qs}if(O&&O.defaultProps)for(we in gt=O.defaultProps,gt)Oe[we]===void 0&&(Oe[we]=gt[we]);return $(O,We,Oe)},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(O){return{$$typeof:u,render:O}},Ve.isValidElement=pe,Ve.lazy=function(O){return{$$typeof:f,_payload:{_status:-1,_result:O},_init:fe}},Ve.memo=function(O,ee){return{$$typeof:d,type:O,compare:ee===void 0?null:ee}},Ve.startTransition=function(O){var ee=D.T,de={};D.T=de;try{var we=O(),Oe=D.S;Oe!==null&&Oe(de,we),typeof we=="object"&&we!==null&&typeof we.then=="function"&&we.then(q,Ne)}catch(We){Ne(We)}finally{ee!==null&&de.types!==null&&(ee.types=de.types),D.T=ee}},Ve.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Ve.use=function(O){return D.H.use(O)},Ve.useActionState=function(O,ee,de){return D.H.useActionState(O,ee,de)},Ve.useCallback=function(O,ee){return D.H.useCallback(O,ee)},Ve.useContext=function(O){return D.H.useContext(O)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(O,ee){return D.H.useDeferredValue(O,ee)},Ve.useEffect=function(O,ee){return D.H.useEffect(O,ee)},Ve.useEffectEvent=function(O){return D.H.useEffectEvent(O)},Ve.useId=function(){return D.H.useId()},Ve.useImperativeHandle=function(O,ee,de){return D.H.useImperativeHandle(O,ee,de)},Ve.useInsertionEffect=function(O,ee){return D.H.useInsertionEffect(O,ee)},Ve.useLayoutEffect=function(O,ee){return D.H.useLayoutEffect(O,ee)},Ve.useMemo=function(O,ee){return D.H.useMemo(O,ee)},Ve.useOptimistic=function(O,ee){return D.H.useOptimistic(O,ee)},Ve.useReducer=function(O,ee,de){return D.H.useReducer(O,ee,de)},Ve.useRef=function(O){return D.H.useRef(O)},Ve.useState=function(O){return D.H.useState(O)},Ve.useSyncExternalStore=function(O,ee,de){return D.H.useSyncExternalStore(O,ee,de)},Ve.useTransition=function(){return D.H.useTransition()},Ve.version="19.2.4",Ve}var fN;function I_(){return fN||(fN=1,C0.exports=DF()),C0.exports}var Zx=I_(),E0={exports:{}},fh={},R0={exports:{}},B0={};var mN;function LF(){return mN||(mN=1,(function(i){function e(j,oe){var fe=j.length;j.push(oe);e:for(;0<fe;){var Ne=fe-1>>>1,De=j[Ne];if(0<n(De,oe))j[Ne]=oe,j[fe]=De,fe=Ne;else break e}}function t(j){return j.length===0?null:j[0]}function s(j){if(j.length===0)return null;var oe=j[0],fe=j.pop();if(fe!==oe){j[0]=fe;e:for(var Ne=0,De=j.length,O=De>>>1;Ne<O;){var ee=2*(Ne+1)-1,de=j[ee],we=ee+1,Oe=j[we];if(0>n(de,fe))we<De&&0>n(Oe,de)?(j[Ne]=Oe,j[we]=fe,Ne=we):(j[Ne]=de,j[ee]=fe,Ne=ee);else if(we<De&&0>n(Oe,fe))j[Ne]=Oe,j[we]=fe,Ne=we;else break e}}return oe}function n(j,oe){var fe=j.sortIndex-oe.sortIndex;return fe!==0?fe:j.id-oe.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var h=[],d=[],f=1,m=null,b=3,x=!1,v=!1,T=!1,w=!1,N=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function E(j){for(var oe=t(d);oe!==null;){if(oe.callback===null)s(d);else if(oe.startTime<=j)s(d),oe.sortIndex=oe.expirationTime,e(h,oe);else break;oe=t(d)}}function k(j){if(T=!1,E(j),!v)if(t(h)!==null)v=!0,q||(q=!0,me());else{var oe=t(d);oe!==null&&ge(k,oe.startTime-j)}}var q=!1,D=-1,I=5,$=-1;function ae(){return w?!0:!(i.unstable_now()-$<I)}function pe(){if(w=!1,q){var j=i.unstable_now();$=j;var oe=!0;try{e:{v=!1,T&&(T=!1,C(D),D=-1),x=!0;var fe=b;try{t:{for(E(j),m=t(h);m!==null&&!(m.expirationTime>j&&ae());){var Ne=m.callback;if(typeof Ne=="function"){m.callback=null,b=m.priorityLevel;var De=Ne(m.expirationTime<=j);if(j=i.unstable_now(),typeof De=="function"){m.callback=De,E(j),oe=!0;break t}m===t(h)&&s(h),E(j)}else s(h);m=t(h)}if(m!==null)oe=!0;else{var O=t(d);O!==null&&ge(k,O.startTime-j),oe=!1}}break e}finally{m=null,b=fe,x=!1}oe=void 0}}finally{oe?me():q=!1}}}var me;if(typeof R=="function")me=function(){R(pe)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,Ce=xe.port2;xe.port1.onmessage=pe,me=function(){Ce.postMessage(null)}}else me=function(){N(pe,0)};function ge(j,oe){D=N(function(){j(i.unstable_now())},oe)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(j){j.callback=null},i.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<j?Math.floor(1e3/j):5},i.unstable_getCurrentPriorityLevel=function(){return b},i.unstable_next=function(j){switch(b){case 1:case 2:case 3:var oe=3;break;default:oe=b}var fe=b;b=oe;try{return j()}finally{b=fe}},i.unstable_requestPaint=function(){w=!0},i.unstable_runWithPriority=function(j,oe){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var fe=b;b=j;try{return oe()}finally{b=fe}},i.unstable_scheduleCallback=function(j,oe,fe){var Ne=i.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?Ne+fe:Ne):fe=Ne,j){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=fe+De,j={id:f++,callback:oe,priorityLevel:j,startTime:fe,expirationTime:De,sortIndex:-1},fe>Ne?(j.sortIndex=fe,e(d,j),t(h)===null&&j===t(d)&&(T?(C(D),D=-1):T=!0,ge(k,fe-Ne))):(j.sortIndex=De,e(h,j),v||x||(v=!0,q||(q=!0,me()))),j},i.unstable_shouldYield=ae,i.unstable_wrapCallback=function(j){var oe=b;return function(){var fe=b;b=oe;try{return j.apply(this,arguments)}finally{b=fe}}}})(B0)),B0}var gN;function UF(){return gN||(gN=1,R0.exports=LF()),R0.exports}var D0={exports:{}},Ds={};var yN;function FF(){if(yN)return Ds;yN=1;var i=I_();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function a(h,d,f){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:m==null?null:""+m,children:h,containerInfo:d,implementation:f}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Ds.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ds.createPortal=function(h,d){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,f)},Ds.flushSync=function(h){var d=l.T,f=s.p;try{if(l.T=null,s.p=2,h)return h()}finally{l.T=d,s.p=f,s.d.f()}},Ds.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(h,d))},Ds.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},Ds.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var f=d.as,m=u(f,d.crossOrigin),b=typeof d.integrity=="string"?d.integrity:void 0,x=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;f==="style"?s.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:b,fetchPriority:x}):f==="script"&&s.d.X(h,{crossOrigin:m,integrity:b,fetchPriority:x,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Ds.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var f=u(d.as,d.crossOrigin);s.d.M(h,{crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(h)},Ds.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var f=d.as,m=u(f,d.crossOrigin);s.d.L(h,f,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Ds.preloadModule=function(h,d){if(typeof h=="string")if(d){var f=u(d.as,d.crossOrigin);s.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(h)},Ds.requestFormReset=function(h){s.d.r(h)},Ds.unstable_batchedUpdates=function(h,d){return h(d)},Ds.useFormState=function(h,d,f){return l.H.useFormState(h,d,f)},Ds.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ds.version="19.2.4",Ds}var bN;function PF(){if(bN)return D0.exports;bN=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),D0.exports=FF(),D0.exports}var xN;function OF(){if(xN)return fh;xN=1;var i=UF(),e=I_(),t=PF();function s(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function a(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function l(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function u(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(a(r)!==r)throw Error(s(188))}function d(r){var o=r.alternate;if(!o){if(o=a(r),o===null)throw Error(s(188));return o!==r?null:r}for(var c=r,p=o;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(p=g.return,p!==null){c=p;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return h(g),r;if(y===p)return h(g),o;y=y.sibling}throw Error(s(188))}if(c.return!==p.return)c=g,p=y;else{for(var S=!1,M=g.child;M;){if(M===c){S=!0,c=g,p=y;break}if(M===p){S=!0,p=g,c=y;break}M=M.sibling}if(!S){for(M=y.child;M;){if(M===c){S=!0,c=y,p=g;break}if(M===p){S=!0,p=y,c=g;break}M=M.sibling}if(!S)throw Error(s(189))}}if(c.alternate!==p)throw Error(s(190))}if(c.tag!==3)throw Error(s(188));return c.stateNode.current===c?r:o}function f(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=f(r),o!==null)return o;r=r.sibling}return null}var m=Object.assign,b=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),R=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),ae=Symbol.for("react.memo_cache_sentinel"),pe=Symbol.iterator;function me(r){return r===null||typeof r!="object"?null:(r=pe&&r[pe]||r["@@iterator"],typeof r=="function"?r:null)}var xe=Symbol.for("react.client.reference");function Ce(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===xe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case T:return"Fragment";case N:return"Profiler";case w:return"StrictMode";case k:return"Suspense";case q:return"SuspenseList";case $:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case v:return"Portal";case R:return r.displayName||"Context";case C:return(r._context.displayName||"Context")+".Consumer";case E:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case D:return o=r.displayName||null,o!==null?o:Ce(r.type)||"Memo";case I:o=r._payload,r=r._init;try{return Ce(r(o))}catch{}}return null}var ge=Array.isArray,j=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},Ne=[],De=-1;function O(r){return{current:r}}function ee(r){0>De||(r.current=Ne[De],Ne[De]=null,De--)}function de(r,o){De++,Ne[De]=r.current,r.current=o}var we=O(null),Oe=O(null),We=O(null),gt=O(null);function qs(r,o){switch(de(We,o),de(Oe,r),de(we,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?UM(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=UM(o),r=FM(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ee(we),de(we,r)}function Qt(){ee(we),ee(Oe),ee(We)}function _c(r){r.memoizedState!==null&&de(gt,r);var o=we.current,c=FM(o,r.type);o!==c&&(de(Oe,r),de(we,c))}function zd(r){Oe.current===r&&(ee(we),ee(Oe)),gt.current===r&&(ee(gt),uh._currentValue=fe)}var uy,cS;function No(r){if(uy===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);uy=o&&o[1]||"",cS=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+uy+r+cS}var cy=!1;function hy(r,o){if(!r||cy)return"";cy=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(o){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(K){var Y=K}Reflect.construct(r,[],ne)}else{try{ne.call()}catch(K){Y=K}r.call(ne.prototype)}}else{try{throw Error()}catch(K){Y=K}(ne=r())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(K){if(K&&Y&&typeof K.stack=="string")return[K.stack,Y.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=p.DetermineComponentFrameRoot(),S=y[0],M=y[1];if(S&&M){var U=S.split(`
`),X=M.split(`
`);for(g=p=0;p<U.length&&!U[p].includes("DetermineComponentFrameRoot");)p++;for(;g<X.length&&!X[g].includes("DetermineComponentFrameRoot");)g++;if(p===U.length||g===X.length)for(p=U.length-1,g=X.length-1;1<=p&&0<=g&&U[p]!==X[g];)g--;for(;1<=p&&0<=g;p--,g--)if(U[p]!==X[g]){if(p!==1||g!==1)do if(p--,g--,0>g||U[p]!==X[g]){var J=`
`+U[p].replace(" at new "," at ");return r.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",r.displayName)),J}while(1<=p&&0<=g);break}}}finally{cy=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?No(c):""}function oL(r,o){switch(r.tag){case 26:case 27:case 5:return No(r.type);case 16:return No("Lazy");case 13:return r.child!==o&&o!==null?No("Suspense Fallback"):No("Suspense");case 19:return No("SuspenseList");case 0:case 15:return hy(r.type,!1);case 11:return hy(r.type.render,!1);case 1:return hy(r.type,!0);case 31:return No("Activity");default:return""}}function hS(r){try{var o="",c=null;do o+=oL(r,c),c=r,r=r.return;while(r);return o}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var dy=Object.prototype.hasOwnProperty,py=i.unstable_scheduleCallback,fy=i.unstable_cancelCallback,lL=i.unstable_shouldYield,uL=i.unstable_requestPaint,xn=i.unstable_now,cL=i.unstable_getCurrentPriorityLevel,dS=i.unstable_ImmediatePriority,pS=i.unstable_UserBlockingPriority,Id=i.unstable_NormalPriority,hL=i.unstable_LowPriority,fS=i.unstable_IdlePriority,dL=i.log,pL=i.unstable_setDisableYieldValue,vc=null,_n=null;function pa(r){if(typeof dL=="function"&&pL(r),_n&&typeof _n.setStrictMode=="function")try{_n.setStrictMode(vc,r)}catch{}}var vn=Math.clz32?Math.clz32:gL,fL=Math.log,mL=Math.LN2;function gL(r){return r>>>=0,r===0?32:31-(fL(r)/mL|0)|0}var kd=256,Gd=262144,qd=4194304;function Ao(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Hd(r,o,c){var p=r.pendingLanes;if(p===0)return 0;var g=0,y=r.suspendedLanes,S=r.pingedLanes;r=r.warmLanes;var M=p&134217727;return M!==0?(p=M&~y,p!==0?g=Ao(p):(S&=M,S!==0?g=Ao(S):c||(c=M&~r,c!==0&&(g=Ao(c))))):(M=p&~y,M!==0?g=Ao(M):S!==0?g=Ao(S):c||(c=p&~r,c!==0&&(g=Ao(c)))),g===0?0:o!==0&&o!==g&&(o&y)===0&&(y=g&-g,c=o&-o,y>=c||y===32&&(c&4194048)!==0)?o:g}function Tc(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function yL(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mS(){var r=qd;return qd<<=1,(qd&62914560)===0&&(qd=4194304),r}function my(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function Sc(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function bL(r,o,c,p,g,y){var S=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var M=r.entanglements,U=r.expirationTimes,X=r.hiddenUpdates;for(c=S&~c;0<c;){var J=31-vn(c),ne=1<<J;M[J]=0,U[J]=-1;var Y=X[J];if(Y!==null)for(X[J]=null,J=0;J<Y.length;J++){var K=Y[J];K!==null&&(K.lane&=-536870913)}c&=~ne}p!==0&&gS(r,p,0),y!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=y&~(S&~o))}function gS(r,o,c){r.pendingLanes|=o,r.suspendedLanes&=~o;var p=31-vn(o);r.entangledLanes|=o,r.entanglements[p]=r.entanglements[p]|1073741824|c&261930}function yS(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var p=31-vn(c),g=1<<p;g&o|r[p]&o&&(r[p]|=o),c&=~g}}function bS(r,o){var c=o&-o;return c=(c&42)!==0?1:gy(c),(c&(r.suspendedLanes|o))!==0?0:c}function gy(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function yy(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function xS(){var r=oe.p;return r!==0?r:(r=window.event,r===void 0?32:iN(r.type))}function _S(r,o){var c=oe.p;try{return oe.p=r,o()}finally{oe.p=c}}var fa=Math.random().toString(36).slice(2),Ts="__reactFiber$"+fa,en="__reactProps$"+fa,Nl="__reactContainer$"+fa,by="__reactEvents$"+fa,xL="__reactListeners$"+fa,_L="__reactHandles$"+fa,vS="__reactResources$"+fa,wc="__reactMarker$"+fa;function xy(r){delete r[Ts],delete r[en],delete r[by],delete r[xL],delete r[_L]}function Al(r){var o=r[Ts];if(o)return o;for(var c=r.parentNode;c;){if(o=c[Nl]||c[Ts]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=GM(r);r!==null;){if(c=r[Ts])return c;r=GM(r)}return o}r=c,c=r.parentNode}return null}function Cl(r){if(r=r[Ts]||r[Nl]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function Mc(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(s(33))}function El(r){var o=r[vS];return o||(o=r[vS]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function ys(r){r[wc]=!0}var TS=new Set,SS={};function Co(r,o){Rl(r,o),Rl(r+"Capture",o)}function Rl(r,o){for(SS[r]=o,r=0;r<o.length;r++)TS.add(o[r])}var vL=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wS={},MS={};function TL(r){return dy.call(MS,r)?!0:dy.call(wS,r)?!1:vL.test(r)?MS[r]=!0:(wS[r]=!0,!1)}function jd(r,o,c){if(TL(o))if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var p=o.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+c)}}function $d(r,o,c){if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+c)}}function mr(r,o,c,p){if(p===null)r.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(o,c,""+p)}}function Hn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function NS(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function SL(r,o,c){var p=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var g=p.get,y=p.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return g.call(this)},set:function(S){c=""+S,y.call(this,S)}}),Object.defineProperty(r,o,{enumerable:p.enumerable}),{getValue:function(){return c},setValue:function(S){c=""+S},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function _y(r){if(!r._valueTracker){var o=NS(r)?"checked":"value";r._valueTracker=SL(r,o,""+r[o])}}function AS(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),p="";return r&&(p=NS(r)?r.checked?"true":"false":r.value),r=p,r!==c?(o.setValue(r),!0):!1}function Wd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var wL=/[\n"\\]/g;function jn(r){return r.replace(wL,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function vy(r,o,c,p,g,y,S,M){r.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?r.type=S:r.removeAttribute("type"),o!=null?S==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+Hn(o)):r.value!==""+Hn(o)&&(r.value=""+Hn(o)):S!=="submit"&&S!=="reset"||r.removeAttribute("value"),o!=null?Ty(r,S,Hn(o)):c!=null?Ty(r,S,Hn(c)):p!=null&&r.removeAttribute("value"),g==null&&y!=null&&(r.defaultChecked=!!y),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?r.name=""+Hn(M):r.removeAttribute("name")}function CS(r,o,c,p,g,y,S,M){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(r.type=y),o!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||o!=null)){_y(r);return}c=c!=null?""+Hn(c):"",o=o!=null?""+Hn(o):c,M||o===r.value||(r.value=o),r.defaultValue=o}p=p??g,p=typeof p!="function"&&typeof p!="symbol"&&!!p,r.checked=M?r.checked:!!p,r.defaultChecked=!!p,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(r.name=S),_y(r)}function Ty(r,o,c){o==="number"&&Wd(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Bl(r,o,c,p){if(r=r.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=o.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&p&&(r[c].defaultSelected=!0)}else{for(c=""+Hn(c),o=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,p&&(r[g].defaultSelected=!0);return}o!==null||r[g].disabled||(o=r[g])}o!==null&&(o.selected=!0)}}function ES(r,o,c){if(o!=null&&(o=""+Hn(o),o!==r.value&&(r.value=o),c==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=c!=null?""+Hn(c):""}function RS(r,o,c,p){if(o==null){if(p!=null){if(c!=null)throw Error(s(92));if(ge(p)){if(1<p.length)throw Error(s(93));p=p[0]}c=p}c==null&&(c=""),o=c}c=Hn(o),r.defaultValue=c,p=r.textContent,p===c&&p!==""&&p!==null&&(r.value=p),_y(r)}function Dl(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var ML=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function BS(r,o,c){var p=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?p?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":p?r.setProperty(o,c):typeof c!="number"||c===0||ML.has(o)?o==="float"?r.cssFloat=c:r[o]=(""+c).trim():r[o]=c+"px"}function DS(r,o,c){if(o!=null&&typeof o!="object")throw Error(s(62));if(r=r.style,c!=null){for(var p in c)!c.hasOwnProperty(p)||o!=null&&o.hasOwnProperty(p)||(p.indexOf("--")===0?r.setProperty(p,""):p==="float"?r.cssFloat="":r[p]="");for(var g in o)p=o[g],o.hasOwnProperty(g)&&c[g]!==p&&BS(r,g,p)}else for(var y in o)o.hasOwnProperty(y)&&BS(r,y,o[y])}function Sy(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var NL=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),AL=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xd(r){return AL.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function gr(){}var wy=null;function My(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Ll=null,Ul=null;function LS(r){var o=Cl(r);if(o&&(r=o.stateNode)){var c=r[en]||null;e:switch(r=o.stateNode,o.type){case"input":if(vy(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+jn(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var p=c[o];if(p!==r&&p.form===r.form){var g=p[en]||null;if(!g)throw Error(s(90));vy(p,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)p=c[o],p.form===r.form&&AS(p)}break e;case"textarea":ES(r,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&Bl(r,!!c.multiple,o,!1)}}}var Ny=!1;function US(r,o,c){if(Ny)return r(o,c);Ny=!0;try{var p=r(o);return p}finally{if(Ny=!1,(Ll!==null||Ul!==null)&&(Fp(),Ll&&(o=Ll,r=Ul,Ul=Ll=null,LS(o),r)))for(o=0;o<r.length;o++)LS(r[o])}}function Nc(r,o){var c=r.stateNode;if(c===null)return null;var p=c[en]||null;if(p===null)return null;c=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(s(231,o,typeof c));return c}var yr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ay=!1;if(yr)try{var Ac={};Object.defineProperty(Ac,"passive",{get:function(){Ay=!0}}),window.addEventListener("test",Ac,Ac),window.removeEventListener("test",Ac,Ac)}catch{Ay=!1}var ma=null,Cy=null,Yd=null;function FS(){if(Yd)return Yd;var r,o=Cy,c=o.length,p,g="value"in ma?ma.value:ma.textContent,y=g.length;for(r=0;r<c&&o[r]===g[r];r++);var S=c-r;for(p=1;p<=S&&o[c-p]===g[y-p];p++);return Yd=g.slice(r,1<p?1-p:void 0)}function Kd(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Zd(){return!0}function PS(){return!1}function tn(r){function o(c,p,g,y,S){this._reactName=c,this._targetInst=g,this.type=p,this.nativeEvent=y,this.target=S,this.currentTarget=null;for(var M in r)r.hasOwnProperty(M)&&(c=r[M],this[M]=c?c(y):y[M]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Zd:PS,this.isPropagationStopped=PS,this}return m(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Zd)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Zd)},persist:function(){},isPersistent:Zd}),o}var Eo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qd=tn(Eo),Cc=m({},Eo,{view:0,detail:0}),CL=tn(Cc),Ey,Ry,Ec,Jd=m({},Cc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Dy,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ec&&(Ec&&r.type==="mousemove"?(Ey=r.screenX-Ec.screenX,Ry=r.screenY-Ec.screenY):Ry=Ey=0,Ec=r),Ey)},movementY:function(r){return"movementY"in r?r.movementY:Ry}}),OS=tn(Jd),EL=m({},Jd,{dataTransfer:0}),RL=tn(EL),BL=m({},Cc,{relatedTarget:0}),By=tn(BL),DL=m({},Eo,{animationName:0,elapsedTime:0,pseudoElement:0}),LL=tn(DL),UL=m({},Eo,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),FL=tn(UL),PL=m({},Eo,{data:0}),VS=tn(PL),OL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IL(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=zL[r])?!!o[r]:!1}function Dy(){return IL}var kL=m({},Cc,{key:function(r){if(r.key){var o=OL[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Kd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?VL[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Dy,charCode:function(r){return r.type==="keypress"?Kd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Kd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),GL=tn(kL),qL=m({},Jd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zS=tn(qL),HL=m({},Cc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Dy}),jL=tn(HL),$L=m({},Eo,{propertyName:0,elapsedTime:0,pseudoElement:0}),WL=tn($L),XL=m({},Jd,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),YL=tn(XL),KL=m({},Eo,{newState:0,oldState:0}),ZL=tn(KL),QL=[9,13,27,32],Ly=yr&&"CompositionEvent"in window,Rc=null;yr&&"documentMode"in document&&(Rc=document.documentMode);var JL=yr&&"TextEvent"in window&&!Rc,IS=yr&&(!Ly||Rc&&8<Rc&&11>=Rc),kS=" ",GS=!1;function qS(r,o){switch(r){case"keyup":return QL.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function HS(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Fl=!1;function eU(r,o){switch(r){case"compositionend":return HS(o);case"keypress":return o.which!==32?null:(GS=!0,kS);case"textInput":return r=o.data,r===kS&&GS?null:r;default:return null}}function tU(r,o){if(Fl)return r==="compositionend"||!Ly&&qS(r,o)?(r=FS(),Yd=Cy=ma=null,Fl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return IS&&o.locale!=="ko"?null:o.data;default:return null}}var sU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jS(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!sU[r.type]:o==="textarea"}function $S(r,o,c,p){Ll?Ul?Ul.push(p):Ul=[p]:Ll=p,o=Gp(o,"onChange"),0<o.length&&(c=new Qd("onChange","change",null,c,p),r.push({event:c,listeners:o}))}var Bc=null,Dc=null;function nU(r){CM(r,0)}function ep(r){var o=Mc(r);if(AS(o))return r}function WS(r,o){if(r==="change")return o}var XS=!1;if(yr){var Uy;if(yr){var Fy="oninput"in document;if(!Fy){var YS=document.createElement("div");YS.setAttribute("oninput","return;"),Fy=typeof YS.oninput=="function"}Uy=Fy}else Uy=!1;XS=Uy&&(!document.documentMode||9<document.documentMode)}function KS(){Bc&&(Bc.detachEvent("onpropertychange",ZS),Dc=Bc=null)}function ZS(r){if(r.propertyName==="value"&&ep(Dc)){var o=[];$S(o,Dc,r,My(r)),US(nU,o)}}function iU(r,o,c){r==="focusin"?(KS(),Bc=o,Dc=c,Bc.attachEvent("onpropertychange",ZS)):r==="focusout"&&KS()}function rU(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return ep(Dc)}function aU(r,o){if(r==="click")return ep(o)}function oU(r,o){if(r==="input"||r==="change")return ep(o)}function lU(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Tn=typeof Object.is=="function"?Object.is:lU;function Lc(r,o){if(Tn(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),p=Object.keys(o);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var g=c[p];if(!dy.call(o,g)||!Tn(r[g],o[g]))return!1}return!0}function QS(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function JS(r,o){var c=QS(r);r=0;for(var p;c;){if(c.nodeType===3){if(p=r+c.textContent.length,r<=o&&p>=o)return{node:c,offset:o-r};r=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=QS(c)}}function ew(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?ew(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function tw(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=Wd(r.document);o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=Wd(r.document)}return o}function Py(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var uU=yr&&"documentMode"in document&&11>=document.documentMode,Pl=null,Oy=null,Uc=null,Vy=!1;function sw(r,o,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Vy||Pl==null||Pl!==Wd(p)||(p=Pl,"selectionStart"in p&&Py(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Uc&&Lc(Uc,p)||(Uc=p,p=Gp(Oy,"onSelect"),0<p.length&&(o=new Qd("onSelect","select",null,o,c),r.push({event:o,listeners:p}),o.target=Pl)))}function Ro(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var Ol={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},zy={},nw={};yr&&(nw=document.createElement("div").style,"AnimationEvent"in window||(delete Ol.animationend.animation,delete Ol.animationiteration.animation,delete Ol.animationstart.animation),"TransitionEvent"in window||delete Ol.transitionend.transition);function Bo(r){if(zy[r])return zy[r];if(!Ol[r])return r;var o=Ol[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in nw)return zy[r]=o[c];return r}var iw=Bo("animationend"),rw=Bo("animationiteration"),aw=Bo("animationstart"),cU=Bo("transitionrun"),hU=Bo("transitionstart"),dU=Bo("transitioncancel"),ow=Bo("transitionend"),lw=new Map,Iy="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Iy.push("scrollEnd");function _i(r,o){lw.set(r,o),Co(o,[r])}var tp=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},$n=[],Vl=0,ky=0;function sp(){for(var r=Vl,o=ky=Vl=0;o<r;){var c=$n[o];$n[o++]=null;var p=$n[o];$n[o++]=null;var g=$n[o];$n[o++]=null;var y=$n[o];if($n[o++]=null,p!==null&&g!==null){var S=p.pending;S===null?g.next=g:(g.next=S.next,S.next=g),p.pending=g}y!==0&&uw(c,g,y)}}function np(r,o,c,p){$n[Vl++]=r,$n[Vl++]=o,$n[Vl++]=c,$n[Vl++]=p,ky|=p,r.lanes|=p,r=r.alternate,r!==null&&(r.lanes|=p)}function Gy(r,o,c,p){return np(r,o,c,p),ip(r)}function Do(r,o){return np(r,null,null,o),ip(r)}function uw(r,o,c){r.lanes|=c;var p=r.alternate;p!==null&&(p.lanes|=c);for(var g=!1,y=r.return;y!==null;)y.childLanes|=c,p=y.alternate,p!==null&&(p.childLanes|=c),y.tag===22&&(r=y.stateNode,r===null||r._visibility&1||(g=!0)),r=y,y=y.return;return r.tag===3?(y=r.stateNode,g&&o!==null&&(g=31-vn(c),r=y.hiddenUpdates,p=r[g],p===null?r[g]=[o]:p.push(o),o.lane=c|536870912),y):null}function ip(r){if(50<sh)throw sh=0,Zb=null,Error(s(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var zl={};function pU(r,o,c,p){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(r,o,c,p){return new pU(r,o,c,p)}function qy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function br(r,o){var c=r.alternate;return c===null?(c=Sn(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function cw(r,o){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,o=c.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function rp(r,o,c,p,g,y){var S=0;if(p=r,typeof r=="function")qy(r)&&(S=1);else if(typeof r=="string")S=bF(r,c,we.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case $:return r=Sn(31,c,o,g),r.elementType=$,r.lanes=y,r;case T:return Lo(c.children,g,y,o);case w:S=8,g|=24;break;case N:return r=Sn(12,c,o,g|2),r.elementType=N,r.lanes=y,r;case k:return r=Sn(13,c,o,g),r.elementType=k,r.lanes=y,r;case q:return r=Sn(19,c,o,g),r.elementType=q,r.lanes=y,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case R:S=10;break e;case C:S=9;break e;case E:S=11;break e;case D:S=14;break e;case I:S=16,p=null;break e}S=29,c=Error(s(130,r===null?"null":typeof r,"")),p=null}return o=Sn(S,c,o,g),o.elementType=r,o.type=p,o.lanes=y,o}function Lo(r,o,c,p){return r=Sn(7,r,p,o),r.lanes=c,r}function Hy(r,o,c){return r=Sn(6,r,null,o),r.lanes=c,r}function hw(r){var o=Sn(18,null,null,0);return o.stateNode=r,o}function jy(r,o,c){return o=Sn(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var dw=new WeakMap;function Wn(r,o){if(typeof r=="object"&&r!==null){var c=dw.get(r);return c!==void 0?c:(o={value:r,source:o,stack:hS(o)},dw.set(r,o),o)}return{value:r,source:o,stack:hS(o)}}var Il=[],kl=0,ap=null,Fc=0,Xn=[],Yn=0,ga=null,Fi=1,Pi="";function xr(r,o){Il[kl++]=Fc,Il[kl++]=ap,ap=r,Fc=o}function pw(r,o,c){Xn[Yn++]=Fi,Xn[Yn++]=Pi,Xn[Yn++]=ga,ga=r;var p=Fi;r=Pi;var g=32-vn(p)-1;p&=~(1<<g),c+=1;var y=32-vn(o)+g;if(30<y){var S=g-g%5;y=(p&(1<<S)-1).toString(32),p>>=S,g-=S,Fi=1<<32-vn(o)+g|c<<g|p,Pi=y+r}else Fi=1<<y|c<<g|p,Pi=r}function $y(r){r.return!==null&&(xr(r,1),pw(r,1,0))}function Wy(r){for(;r===ap;)ap=Il[--kl],Il[kl]=null,Fc=Il[--kl],Il[kl]=null;for(;r===ga;)ga=Xn[--Yn],Xn[Yn]=null,Pi=Xn[--Yn],Xn[Yn]=null,Fi=Xn[--Yn],Xn[Yn]=null}function fw(r,o){Xn[Yn++]=Fi,Xn[Yn++]=Pi,Xn[Yn++]=ga,Fi=o.id,Pi=o.overflow,ga=r}var Ss=null,Dt=null,tt=!1,ya=null,Kn=!1,Xy=Error(s(519));function ba(r){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Pc(Wn(o,r)),Xy}function mw(r){var o=r.stateNode,c=r.type,p=r.memoizedProps;switch(o[Ts]=r,o[en]=p,c){case"dialog":Ye("cancel",o),Ye("close",o);break;case"iframe":case"object":case"embed":Ye("load",o);break;case"video":case"audio":for(c=0;c<ih.length;c++)Ye(ih[c],o);break;case"source":Ye("error",o);break;case"img":case"image":case"link":Ye("error",o),Ye("load",o);break;case"details":Ye("toggle",o);break;case"input":Ye("invalid",o),CS(o,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":Ye("invalid",o);break;case"textarea":Ye("invalid",o),RS(o,p.value,p.defaultValue,p.children)}c=p.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||p.suppressHydrationWarning===!0||DM(o.textContent,c)?(p.popover!=null&&(Ye("beforetoggle",o),Ye("toggle",o)),p.onScroll!=null&&Ye("scroll",o),p.onScrollEnd!=null&&Ye("scrollend",o),p.onClick!=null&&(o.onclick=gr),o=!0):o=!1,o||ba(r,!0)}function gw(r){for(Ss=r.return;Ss;)switch(Ss.tag){case 5:case 31:case 13:Kn=!1;return;case 27:case 3:Kn=!0;return;default:Ss=Ss.return}}function Gl(r){if(r!==Ss)return!1;if(!tt)return gw(r),tt=!0,!1;var o=r.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||d0(r.type,r.memoizedProps)),c=!c),c&&Dt&&ba(r),gw(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));Dt=kM(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));Dt=kM(r)}else o===27?(o=Dt,Da(r.type)?(r=y0,y0=null,Dt=r):Dt=o):Dt=Ss?Qn(r.stateNode.nextSibling):null;return!0}function Uo(){Dt=Ss=null,tt=!1}function Yy(){var r=ya;return r!==null&&(an===null?an=r:an.push.apply(an,r),ya=null),r}function Pc(r){ya===null?ya=[r]:ya.push(r)}var Ky=O(null),Fo=null,_r=null;function xa(r,o,c){de(Ky,o._currentValue),o._currentValue=c}function vr(r){r._currentValue=Ky.current,ee(Ky)}function Zy(r,o,c){for(;r!==null;){var p=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),r===c)break;r=r.return}}function Qy(r,o,c,p){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var y=g.dependencies;if(y!==null){var S=g.child;y=y.firstContext;e:for(;y!==null;){var M=y;y=g;for(var U=0;U<o.length;U++)if(M.context===o[U]){y.lanes|=c,M=y.alternate,M!==null&&(M.lanes|=c),Zy(y.return,c,r),p||(S=null);break e}y=M.next}}else if(g.tag===18){if(S=g.return,S===null)throw Error(s(341));S.lanes|=c,y=S.alternate,y!==null&&(y.lanes|=c),Zy(S,c,r),S=null}else S=g.child;if(S!==null)S.return=g;else for(S=g;S!==null;){if(S===r){S=null;break}if(g=S.sibling,g!==null){g.return=S.return,S=g;break}S=S.return}g=S}}function ql(r,o,c,p){r=null;for(var g=o,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var S=g.alternate;if(S===null)throw Error(s(387));if(S=S.memoizedProps,S!==null){var M=g.type;Tn(g.pendingProps.value,S.value)||(r!==null?r.push(M):r=[M])}}else if(g===gt.current){if(S=g.alternate,S===null)throw Error(s(387));S.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(uh):r=[uh])}g=g.return}r!==null&&Qy(o,r,c,p),o.flags|=262144}function op(r){for(r=r.firstContext;r!==null;){if(!Tn(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Po(r){Fo=r,_r=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ws(r){return yw(Fo,r)}function lp(r,o){return Fo===null&&Po(r),yw(r,o)}function yw(r,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},_r===null){if(r===null)throw Error(s(308));_r=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else _r=_r.next=o;return c}var fU=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(c,p){r.push(p)}};this.abort=function(){o.aborted=!0,r.forEach(function(c){return c()})}},mU=i.unstable_scheduleCallback,gU=i.unstable_NormalPriority,ns={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jy(){return{controller:new fU,data:new Map,refCount:0}}function Oc(r){r.refCount--,r.refCount===0&&mU(gU,function(){r.controller.abort()})}var Vc=null,eb=0,Hl=0,jl=null;function yU(r,o){if(Vc===null){var c=Vc=[];eb=0,Hl=n0(),jl={status:"pending",value:void 0,then:function(p){c.push(p)}}}return eb++,o.then(bw,bw),o}function bw(){if(--eb===0&&Vc!==null){jl!==null&&(jl.status="fulfilled");var r=Vc;Vc=null,Hl=0,jl=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function bU(r,o){var c=[],p={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){p.status="fulfilled",p.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(p.status="rejected",p.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),p}var xw=j.S;j.S=function(r,o){sM=xn(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&yU(r,o),xw!==null&&xw(r,o)};var Oo=O(null);function tb(){var r=Oo.current;return r!==null?r:Ct.pooledCache}function up(r,o){o===null?de(Oo,Oo.current):de(Oo,o.pool)}function _w(){var r=tb();return r===null?null:{parent:ns._currentValue,pool:r}}var $l=Error(s(460)),sb=Error(s(474)),cp=Error(s(542)),hp={then:function(){}};function vw(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Tw(r,o,c){switch(c=r[c],c===void 0?r.push(o):c!==o&&(o.then(gr,gr),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,ww(r),r;default:if(typeof o.status=="string")o.then(gr,gr);else{if(r=Ct,r!==null&&100<r.shellSuspendCounter)throw Error(s(482));r=o,r.status="pending",r.then(function(p){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=p}},function(p){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=p}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,ww(r),r}throw zo=o,$l}}function Vo(r){try{var o=r._init;return o(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(zo=c,$l):c}}var zo=null;function Sw(){if(zo===null)throw Error(s(459));var r=zo;return zo=null,r}function ww(r){if(r===$l||r===cp)throw Error(s(483))}var Wl=null,zc=0;function dp(r){var o=zc;return zc+=1,Wl===null&&(Wl=[]),Tw(Wl,r,o)}function Ic(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function pp(r,o){throw o.$$typeof===b?Error(s(525)):(r=Object.prototype.toString.call(o),Error(s(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function Mw(r){function o(G,V){if(r){var W=G.deletions;W===null?(G.deletions=[V],G.flags|=16):W.push(V)}}function c(G,V){if(!r)return null;for(;V!==null;)o(G,V),V=V.sibling;return null}function p(G){for(var V=new Map;G!==null;)G.key!==null?V.set(G.key,G):V.set(G.index,G),G=G.sibling;return V}function g(G,V){return G=br(G,V),G.index=0,G.sibling=null,G}function y(G,V,W){return G.index=W,r?(W=G.alternate,W!==null?(W=W.index,W<V?(G.flags|=67108866,V):W):(G.flags|=67108866,V)):(G.flags|=1048576,V)}function S(G){return r&&G.alternate===null&&(G.flags|=67108866),G}function M(G,V,W,te){return V===null||V.tag!==6?(V=Hy(W,G.mode,te),V.return=G,V):(V=g(V,W),V.return=G,V)}function U(G,V,W,te){var Ee=W.type;return Ee===T?J(G,V,W.props.children,te,W.key):V!==null&&(V.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===I&&Vo(Ee)===V.type)?(V=g(V,W.props),Ic(V,W),V.return=G,V):(V=rp(W.type,W.key,W.props,null,G.mode,te),Ic(V,W),V.return=G,V)}function X(G,V,W,te){return V===null||V.tag!==4||V.stateNode.containerInfo!==W.containerInfo||V.stateNode.implementation!==W.implementation?(V=jy(W,G.mode,te),V.return=G,V):(V=g(V,W.children||[]),V.return=G,V)}function J(G,V,W,te,Ee){return V===null||V.tag!==7?(V=Lo(W,G.mode,te,Ee),V.return=G,V):(V=g(V,W),V.return=G,V)}function ne(G,V,W){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return V=Hy(""+V,G.mode,W),V.return=G,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case x:return W=rp(V.type,V.key,V.props,null,G.mode,W),Ic(W,V),W.return=G,W;case v:return V=jy(V,G.mode,W),V.return=G,V;case I:return V=Vo(V),ne(G,V,W)}if(ge(V)||me(V))return V=Lo(V,G.mode,W,null),V.return=G,V;if(typeof V.then=="function")return ne(G,dp(V),W);if(V.$$typeof===R)return ne(G,lp(G,V),W);pp(G,V)}return null}function Y(G,V,W,te){var Ee=V!==null?V.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return Ee!==null?null:M(G,V,""+W,te);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case x:return W.key===Ee?U(G,V,W,te):null;case v:return W.key===Ee?X(G,V,W,te):null;case I:return W=Vo(W),Y(G,V,W,te)}if(ge(W)||me(W))return Ee!==null?null:J(G,V,W,te,null);if(typeof W.then=="function")return Y(G,V,dp(W),te);if(W.$$typeof===R)return Y(G,V,lp(G,W),te);pp(G,W)}return null}function K(G,V,W,te,Ee){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return G=G.get(W)||null,M(V,G,""+te,Ee);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case x:return G=G.get(te.key===null?W:te.key)||null,U(V,G,te,Ee);case v:return G=G.get(te.key===null?W:te.key)||null,X(V,G,te,Ee);case I:return te=Vo(te),K(G,V,W,te,Ee)}if(ge(te)||me(te))return G=G.get(W)||null,J(V,G,te,Ee,null);if(typeof te.then=="function")return K(G,V,W,dp(te),Ee);if(te.$$typeof===R)return K(G,V,W,lp(V,te),Ee);pp(V,te)}return null}function Te(G,V,W,te){for(var Ee=null,lt=null,Ae=V,ke=V=0,Je=null;Ae!==null&&ke<W.length;ke++){Ae.index>ke?(Je=Ae,Ae=null):Je=Ae.sibling;var ut=Y(G,Ae,W[ke],te);if(ut===null){Ae===null&&(Ae=Je);break}r&&Ae&&ut.alternate===null&&o(G,Ae),V=y(ut,V,ke),lt===null?Ee=ut:lt.sibling=ut,lt=ut,Ae=Je}if(ke===W.length)return c(G,Ae),tt&&xr(G,ke),Ee;if(Ae===null){for(;ke<W.length;ke++)Ae=ne(G,W[ke],te),Ae!==null&&(V=y(Ae,V,ke),lt===null?Ee=Ae:lt.sibling=Ae,lt=Ae);return tt&&xr(G,ke),Ee}for(Ae=p(Ae);ke<W.length;ke++)Je=K(Ae,G,ke,W[ke],te),Je!==null&&(r&&Je.alternate!==null&&Ae.delete(Je.key===null?ke:Je.key),V=y(Je,V,ke),lt===null?Ee=Je:lt.sibling=Je,lt=Je);return r&&Ae.forEach(function(Oa){return o(G,Oa)}),tt&&xr(G,ke),Ee}function Le(G,V,W,te){if(W==null)throw Error(s(151));for(var Ee=null,lt=null,Ae=V,ke=V=0,Je=null,ut=W.next();Ae!==null&&!ut.done;ke++,ut=W.next()){Ae.index>ke?(Je=Ae,Ae=null):Je=Ae.sibling;var Oa=Y(G,Ae,ut.value,te);if(Oa===null){Ae===null&&(Ae=Je);break}r&&Ae&&Oa.alternate===null&&o(G,Ae),V=y(Oa,V,ke),lt===null?Ee=Oa:lt.sibling=Oa,lt=Oa,Ae=Je}if(ut.done)return c(G,Ae),tt&&xr(G,ke),Ee;if(Ae===null){for(;!ut.done;ke++,ut=W.next())ut=ne(G,ut.value,te),ut!==null&&(V=y(ut,V,ke),lt===null?Ee=ut:lt.sibling=ut,lt=ut);return tt&&xr(G,ke),Ee}for(Ae=p(Ae);!ut.done;ke++,ut=W.next())ut=K(Ae,G,ke,ut.value,te),ut!==null&&(r&&ut.alternate!==null&&Ae.delete(ut.key===null?ke:ut.key),V=y(ut,V,ke),lt===null?Ee=ut:lt.sibling=ut,lt=ut);return r&&Ae.forEach(function(EF){return o(G,EF)}),tt&&xr(G,ke),Ee}function Mt(G,V,W,te){if(typeof W=="object"&&W!==null&&W.type===T&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case x:e:{for(var Ee=W.key;V!==null;){if(V.key===Ee){if(Ee=W.type,Ee===T){if(V.tag===7){c(G,V.sibling),te=g(V,W.props.children),te.return=G,G=te;break e}}else if(V.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===I&&Vo(Ee)===V.type){c(G,V.sibling),te=g(V,W.props),Ic(te,W),te.return=G,G=te;break e}c(G,V);break}else o(G,V);V=V.sibling}W.type===T?(te=Lo(W.props.children,G.mode,te,W.key),te.return=G,G=te):(te=rp(W.type,W.key,W.props,null,G.mode,te),Ic(te,W),te.return=G,G=te)}return S(G);case v:e:{for(Ee=W.key;V!==null;){if(V.key===Ee)if(V.tag===4&&V.stateNode.containerInfo===W.containerInfo&&V.stateNode.implementation===W.implementation){c(G,V.sibling),te=g(V,W.children||[]),te.return=G,G=te;break e}else{c(G,V);break}else o(G,V);V=V.sibling}te=jy(W,G.mode,te),te.return=G,G=te}return S(G);case I:return W=Vo(W),Mt(G,V,W,te)}if(ge(W))return Te(G,V,W,te);if(me(W)){if(Ee=me(W),typeof Ee!="function")throw Error(s(150));return W=Ee.call(W),Le(G,V,W,te)}if(typeof W.then=="function")return Mt(G,V,dp(W),te);if(W.$$typeof===R)return Mt(G,V,lp(G,W),te);pp(G,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,V!==null&&V.tag===6?(c(G,V.sibling),te=g(V,W),te.return=G,G=te):(c(G,V),te=Hy(W,G.mode,te),te.return=G,G=te),S(G)):c(G,V)}return function(G,V,W,te){try{zc=0;var Ee=Mt(G,V,W,te);return Wl=null,Ee}catch(Ae){if(Ae===$l||Ae===cp)throw Ae;var lt=Sn(29,Ae,null,G.mode);return lt.lanes=te,lt.return=G,lt}}}var Io=Mw(!0),Nw=Mw(!1),_a=!1;function nb(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ib(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function va(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ta(r,o,c){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,(ht&2)!==0){var g=p.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),p.pending=o,o=ip(r),uw(r,null,c),o}return np(r,p,o,c),ip(r)}function kc(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var p=o.lanes;p&=r.pendingLanes,c|=p,o.lanes=c,yS(r,c)}}function rb(r,o){var c=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var S={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=S:y=y.next=S,c=c.next}while(c!==null);y===null?g=y=o:y=y.next=o}else g=y=o;c={baseState:p.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:p.shared,callbacks:p.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}var ab=!1;function Gc(){if(ab){var r=jl;if(r!==null)throw r}}function qc(r,o,c,p){ab=!1;var g=r.updateQueue;_a=!1;var y=g.firstBaseUpdate,S=g.lastBaseUpdate,M=g.shared.pending;if(M!==null){g.shared.pending=null;var U=M,X=U.next;U.next=null,S===null?y=X:S.next=X,S=U;var J=r.alternate;J!==null&&(J=J.updateQueue,M=J.lastBaseUpdate,M!==S&&(M===null?J.firstBaseUpdate=X:M.next=X,J.lastBaseUpdate=U))}if(y!==null){var ne=g.baseState;S=0,J=X=U=null,M=y;do{var Y=M.lane&-536870913,K=Y!==M.lane;if(K?(Qe&Y)===Y:(p&Y)===Y){Y!==0&&Y===Hl&&(ab=!0),J!==null&&(J=J.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var Te=r,Le=M;Y=o;var Mt=c;switch(Le.tag){case 1:if(Te=Le.payload,typeof Te=="function"){ne=Te.call(Mt,ne,Y);break e}ne=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=Le.payload,Y=typeof Te=="function"?Te.call(Mt,ne,Y):Te,Y==null)break e;ne=m({},ne,Y);break e;case 2:_a=!0}}Y=M.callback,Y!==null&&(r.flags|=64,K&&(r.flags|=8192),K=g.callbacks,K===null?g.callbacks=[Y]:K.push(Y))}else K={lane:Y,tag:M.tag,payload:M.payload,callback:M.callback,next:null},J===null?(X=J=K,U=ne):J=J.next=K,S|=Y;if(M=M.next,M===null){if(M=g.shared.pending,M===null)break;K=M,M=K.next,K.next=null,g.lastBaseUpdate=K,g.shared.pending=null}}while(!0);J===null&&(U=ne),g.baseState=U,g.firstBaseUpdate=X,g.lastBaseUpdate=J,y===null&&(g.shared.lanes=0),Aa|=S,r.lanes=S,r.memoizedState=ne}}function Aw(r,o){if(typeof r!="function")throw Error(s(191,r));r.call(o)}function Cw(r,o){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Aw(c[r],o)}var Xl=O(null),fp=O(0);function Ew(r,o){r=Rr,de(fp,r),de(Xl,o),Rr=r|o.baseLanes}function ob(){de(fp,Rr),de(Xl,Xl.current)}function lb(){Rr=fp.current,ee(Xl),ee(fp)}var wn=O(null),Zn=null;function Sa(r){var o=r.alternate;de(Jt,Jt.current&1),de(wn,r),Zn===null&&(o===null||Xl.current!==null||o.memoizedState!==null)&&(Zn=r)}function ub(r){de(Jt,Jt.current),de(wn,r),Zn===null&&(Zn=r)}function Rw(r){r.tag===22?(de(Jt,Jt.current),de(wn,r),Zn===null&&(Zn=r)):wa()}function wa(){de(Jt,Jt.current),de(wn,wn.current)}function Mn(r){ee(wn),Zn===r&&(Zn=null),ee(Jt)}var Jt=O(0);function mp(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||m0(c)||g0(c)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Tr=0,ze=null,St=null,is=null,gp=!1,Yl=!1,ko=!1,yp=0,Hc=0,Kl=null,xU=0;function Wt(){throw Error(s(321))}function cb(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!Tn(r[c],o[c]))return!1;return!0}function hb(r,o,c,p,g,y){return Tr=y,ze=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,j.H=r===null||r.memoizedState===null?p1:Nb,ko=!1,y=c(p,g),ko=!1,Yl&&(y=Dw(o,c,p,g)),Bw(r),y}function Bw(r){j.H=Wc;var o=St!==null&&St.next!==null;if(Tr=0,is=St=ze=null,gp=!1,Hc=0,Kl=null,o)throw Error(s(300));r===null||rs||(r=r.dependencies,r!==null&&op(r)&&(rs=!0))}function Dw(r,o,c,p){ze=r;var g=0;do{if(Yl&&(Kl=null),Hc=0,Yl=!1,25<=g)throw Error(s(301));if(g+=1,is=St=null,r.updateQueue!=null){var y=r.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}j.H=f1,y=o(c,p)}while(Yl);return y}function _U(){var r=j.H,o=r.useState()[0];return o=typeof o.then=="function"?jc(o):o,r=r.useState()[0],(St!==null?St.memoizedState:null)!==r&&(ze.flags|=1024),o}function db(){var r=yp!==0;return yp=0,r}function pb(r,o,c){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~c}function fb(r){if(gp){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}gp=!1}Tr=0,is=St=ze=null,Yl=!1,Hc=yp=0,Kl=null}function Hs(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return is===null?ze.memoizedState=is=r:is=is.next=r,is}function es(){if(St===null){var r=ze.alternate;r=r!==null?r.memoizedState:null}else r=St.next;var o=is===null?ze.memoizedState:is.next;if(o!==null)is=o,St=r;else{if(r===null)throw ze.alternate===null?Error(s(467)):Error(s(310));St=r,r={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},is===null?ze.memoizedState=is=r:is=is.next=r}return is}function bp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function jc(r){var o=Hc;return Hc+=1,Kl===null&&(Kl=[]),r=Tw(Kl,r,o),o=ze,(is===null?o.memoizedState:is.next)===null&&(o=o.alternate,j.H=o===null||o.memoizedState===null?p1:Nb),r}function xp(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return jc(r);if(r.$$typeof===R)return ws(r)}throw Error(s(438,String(r)))}function mb(r){var o=null,c=ze.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var p=ze.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(o={data:p.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=bp(),ze.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(r),p=0;p<r;p++)c[p]=ae;return o.index++,c}function Sr(r,o){return typeof o=="function"?o(r):o}function _p(r){var o=es();return gb(o,St,r)}function gb(r,o,c){var p=r.queue;if(p===null)throw Error(s(311));p.lastRenderedReducer=c;var g=r.baseQueue,y=p.pending;if(y!==null){if(g!==null){var S=g.next;g.next=y.next,y.next=S}o.baseQueue=g=y,p.pending=null}if(y=r.baseState,g===null)r.memoizedState=y;else{o=g.next;var M=S=null,U=null,X=o,J=!1;do{var ne=X.lane&-536870913;if(ne!==X.lane?(Qe&ne)===ne:(Tr&ne)===ne){var Y=X.revertLane;if(Y===0)U!==null&&(U=U.next={lane:0,revertLane:0,gesture:null,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),ne===Hl&&(J=!0);else if((Tr&Y)===Y){X=X.next,Y===Hl&&(J=!0);continue}else ne={lane:0,revertLane:X.revertLane,gesture:null,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},U===null?(M=U=ne,S=y):U=U.next=ne,ze.lanes|=Y,Aa|=Y;ne=X.action,ko&&c(y,ne),y=X.hasEagerState?X.eagerState:c(y,ne)}else Y={lane:ne,revertLane:X.revertLane,gesture:X.gesture,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},U===null?(M=U=Y,S=y):U=U.next=Y,ze.lanes|=ne,Aa|=ne;X=X.next}while(X!==null&&X!==o);if(U===null?S=y:U.next=M,!Tn(y,r.memoizedState)&&(rs=!0,J&&(c=jl,c!==null)))throw c;r.memoizedState=y,r.baseState=S,r.baseQueue=U,p.lastRenderedState=y}return g===null&&(p.lanes=0),[r.memoizedState,p.dispatch]}function yb(r){var o=es(),c=o.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=r;var p=c.dispatch,g=c.pending,y=o.memoizedState;if(g!==null){c.pending=null;var S=g=g.next;do y=r(y,S.action),S=S.next;while(S!==g);Tn(y,o.memoizedState)||(rs=!0),o.memoizedState=y,o.baseQueue===null&&(o.baseState=y),c.lastRenderedState=y}return[y,p]}function Lw(r,o,c){var p=ze,g=es(),y=tt;if(y){if(c===void 0)throw Error(s(407));c=c()}else c=o();var S=!Tn((St||g).memoizedState,c);if(S&&(g.memoizedState=c,rs=!0),g=g.queue,_b(Pw.bind(null,p,g,r),[r]),g.getSnapshot!==o||S||is!==null&&is.memoizedState.tag&1){if(p.flags|=2048,Zl(9,{destroy:void 0},Fw.bind(null,p,g,c,o),null),Ct===null)throw Error(s(349));y||(Tr&127)!==0||Uw(p,o,c)}return c}function Uw(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=ze.updateQueue,o===null?(o=bp(),ze.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function Fw(r,o,c,p){o.value=c,o.getSnapshot=p,Ow(o)&&Vw(r)}function Pw(r,o,c){return c(function(){Ow(o)&&Vw(r)})}function Ow(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!Tn(r,c)}catch{return!0}}function Vw(r){var o=Do(r,2);o!==null&&on(o,r,2)}function bb(r){var o=Hs();if(typeof r=="function"){var c=r;if(r=c(),ko){pa(!0);try{c()}finally{pa(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sr,lastRenderedState:r},o}function zw(r,o,c,p){return r.baseState=c,gb(r,St,typeof p=="function"?p:Sr)}function vU(r,o,c,p,g){if(Sp(r))throw Error(s(485));if(r=o.action,r!==null){var y={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){y.listeners.push(S)}};j.T!==null?c(!0):y.isTransition=!1,p(y),c=o.pending,c===null?(y.next=o.pending=y,Iw(o,y)):(y.next=c.next,o.pending=c.next=y)}}function Iw(r,o){var c=o.action,p=o.payload,g=r.state;if(o.isTransition){var y=j.T,S={};j.T=S;try{var M=c(g,p),U=j.S;U!==null&&U(S,M),kw(r,o,M)}catch(X){xb(r,o,X)}finally{y!==null&&S.types!==null&&(y.types=S.types),j.T=y}}else try{y=c(g,p),kw(r,o,y)}catch(X){xb(r,o,X)}}function kw(r,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(p){Gw(r,o,p)},function(p){return xb(r,o,p)}):Gw(r,o,c)}function Gw(r,o,c){o.status="fulfilled",o.value=c,qw(o),r.state=c,o=r.pending,o!==null&&(c=o.next,c===o?r.pending=null:(c=c.next,o.next=c,Iw(r,c)))}function xb(r,o,c){var p=r.pending;if(r.pending=null,p!==null){p=p.next;do o.status="rejected",o.reason=c,qw(o),o=o.next;while(o!==p)}r.action=null}function qw(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Hw(r,o){return o}function jw(r,o){if(tt){var c=Ct.formState;if(c!==null){e:{var p=ze;if(tt){if(Dt){t:{for(var g=Dt,y=Kn;g.nodeType!==8;){if(!y){g=null;break t}if(g=Qn(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){Dt=Qn(g.nextSibling),p=g.data==="F!";break e}}ba(p)}p=!1}p&&(o=c[0])}}return c=Hs(),c.memoizedState=c.baseState=o,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hw,lastRenderedState:o},c.queue=p,c=c1.bind(null,ze,p),p.dispatch=c,p=bb(!1),y=Mb.bind(null,ze,!1,p.queue),p=Hs(),g={state:o,dispatch:null,action:r,pending:null},p.queue=g,c=vU.bind(null,ze,g,y,c),g.dispatch=c,p.memoizedState=r,[o,c,!1]}function $w(r){var o=es();return Ww(o,St,r)}function Ww(r,o,c){if(o=gb(r,o,Hw)[0],r=_p(Sr)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var p=jc(o)}catch(S){throw S===$l?cp:S}else p=o;o=es();var g=o.queue,y=g.dispatch;return c!==o.memoizedState&&(ze.flags|=2048,Zl(9,{destroy:void 0},TU.bind(null,g,c),null)),[p,y,r]}function TU(r,o){r.action=o}function Xw(r){var o=es(),c=St;if(c!==null)return Ww(o,c,r);es(),o=o.memoizedState,c=es();var p=c.queue.dispatch;return c.memoizedState=r,[o,p,!1]}function Zl(r,o,c,p){return r={tag:r,create:c,deps:p,inst:o,next:null},o=ze.updateQueue,o===null&&(o=bp(),ze.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=r.next=r:(p=c.next,c.next=r,r.next=p,o.lastEffect=r),r}function Yw(){return es().memoizedState}function vp(r,o,c,p){var g=Hs();ze.flags|=r,g.memoizedState=Zl(1|o,{destroy:void 0},c,p===void 0?null:p)}function Tp(r,o,c,p){var g=es();p=p===void 0?null:p;var y=g.memoizedState.inst;St!==null&&p!==null&&cb(p,St.memoizedState.deps)?g.memoizedState=Zl(o,y,c,p):(ze.flags|=r,g.memoizedState=Zl(1|o,y,c,p))}function Kw(r,o){vp(8390656,8,r,o)}function _b(r,o){Tp(2048,8,r,o)}function SU(r){ze.flags|=4;var o=ze.updateQueue;if(o===null)o=bp(),ze.updateQueue=o,o.events=[r];else{var c=o.events;c===null?o.events=[r]:c.push(r)}}function Zw(r){var o=es().memoizedState;return SU({ref:o,nextImpl:r}),function(){if((ht&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function Qw(r,o){return Tp(4,2,r,o)}function Jw(r,o){return Tp(4,4,r,o)}function e1(r,o){if(typeof o=="function"){r=r();var c=o(r);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function t1(r,o,c){c=c!=null?c.concat([r]):null,Tp(4,4,e1.bind(null,o,r),c)}function vb(){}function s1(r,o){var c=es();o=o===void 0?null:o;var p=c.memoizedState;return o!==null&&cb(o,p[1])?p[0]:(c.memoizedState=[r,o],r)}function n1(r,o){var c=es();o=o===void 0?null:o;var p=c.memoizedState;if(o!==null&&cb(o,p[1]))return p[0];if(p=r(),ko){pa(!0);try{r()}finally{pa(!1)}}return c.memoizedState=[p,o],p}function Tb(r,o,c){return c===void 0||(Tr&1073741824)!==0&&(Qe&261930)===0?r.memoizedState=o:(r.memoizedState=c,r=iM(),ze.lanes|=r,Aa|=r,c)}function i1(r,o,c,p){return Tn(c,o)?c:Xl.current!==null?(r=Tb(r,c,p),Tn(r,o)||(rs=!0),r):(Tr&42)===0||(Tr&1073741824)!==0&&(Qe&261930)===0?(rs=!0,r.memoizedState=c):(r=iM(),ze.lanes|=r,Aa|=r,o)}function r1(r,o,c,p,g){var y=oe.p;oe.p=y!==0&&8>y?y:8;var S=j.T,M={};j.T=M,Mb(r,!1,o,c);try{var U=g(),X=j.S;if(X!==null&&X(M,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var J=bU(U,p);$c(r,o,J,Cn(r))}else $c(r,o,p,Cn(r))}catch(ne){$c(r,o,{then:function(){},status:"rejected",reason:ne},Cn())}finally{oe.p=y,S!==null&&M.types!==null&&(S.types=M.types),j.T=S}}function wU(){}function Sb(r,o,c,p){if(r.tag!==5)throw Error(s(476));var g=a1(r).queue;r1(r,g,o,fe,c===null?wU:function(){return o1(r),c(p)})}function a1(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sr,lastRenderedState:fe},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sr,lastRenderedState:c},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function o1(r){var o=a1(r);o.next===null&&(o=r.alternate.memoizedState),$c(r,o.next.queue,{},Cn())}function wb(){return ws(uh)}function l1(){return es().memoizedState}function u1(){return es().memoizedState}function MU(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var c=Cn();r=va(c);var p=Ta(o,r,c);p!==null&&(on(p,o,c),kc(p,o,c)),o={cache:Jy()},r.payload=o;return}o=o.return}}function NU(r,o,c){var p=Cn();c={lane:p,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Sp(r)?h1(o,c):(c=Gy(r,o,c,p),c!==null&&(on(c,r,p),d1(c,o,p)))}function c1(r,o,c){var p=Cn();$c(r,o,c,p)}function $c(r,o,c,p){var g={lane:p,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Sp(r))h1(o,g);else{var y=r.alternate;if(r.lanes===0&&(y===null||y.lanes===0)&&(y=o.lastRenderedReducer,y!==null))try{var S=o.lastRenderedState,M=y(S,c);if(g.hasEagerState=!0,g.eagerState=M,Tn(M,S))return np(r,o,g,0),Ct===null&&sp(),!1}catch{}if(c=Gy(r,o,g,p),c!==null)return on(c,r,p),d1(c,o,p),!0}return!1}function Mb(r,o,c,p){if(p={lane:2,revertLane:n0(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Sp(r)){if(o)throw Error(s(479))}else o=Gy(r,c,p,2),o!==null&&on(o,r,2)}function Sp(r){var o=r.alternate;return r===ze||o!==null&&o===ze}function h1(r,o){Yl=gp=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function d1(r,o,c){if((c&4194048)!==0){var p=o.lanes;p&=r.pendingLanes,c|=p,o.lanes=c,yS(r,c)}}var Wc={readContext:ws,use:xp,useCallback:Wt,useContext:Wt,useEffect:Wt,useImperativeHandle:Wt,useLayoutEffect:Wt,useInsertionEffect:Wt,useMemo:Wt,useReducer:Wt,useRef:Wt,useState:Wt,useDebugValue:Wt,useDeferredValue:Wt,useTransition:Wt,useSyncExternalStore:Wt,useId:Wt,useHostTransitionStatus:Wt,useFormState:Wt,useActionState:Wt,useOptimistic:Wt,useMemoCache:Wt,useCacheRefresh:Wt};Wc.useEffectEvent=Wt;var p1={readContext:ws,use:xp,useCallback:function(r,o){return Hs().memoizedState=[r,o===void 0?null:o],r},useContext:ws,useEffect:Kw,useImperativeHandle:function(r,o,c){c=c!=null?c.concat([r]):null,vp(4194308,4,e1.bind(null,o,r),c)},useLayoutEffect:function(r,o){return vp(4194308,4,r,o)},useInsertionEffect:function(r,o){vp(4,2,r,o)},useMemo:function(r,o){var c=Hs();o=o===void 0?null:o;var p=r();if(ko){pa(!0);try{r()}finally{pa(!1)}}return c.memoizedState=[p,o],p},useReducer:function(r,o,c){var p=Hs();if(c!==void 0){var g=c(o);if(ko){pa(!0);try{c(o)}finally{pa(!1)}}}else g=o;return p.memoizedState=p.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},p.queue=r,r=r.dispatch=NU.bind(null,ze,r),[p.memoizedState,r]},useRef:function(r){var o=Hs();return r={current:r},o.memoizedState=r},useState:function(r){r=bb(r);var o=r.queue,c=c1.bind(null,ze,o);return o.dispatch=c,[r.memoizedState,c]},useDebugValue:vb,useDeferredValue:function(r,o){var c=Hs();return Tb(c,r,o)},useTransition:function(){var r=bb(!1);return r=r1.bind(null,ze,r.queue,!0,!1),Hs().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,c){var p=ze,g=Hs();if(tt){if(c===void 0)throw Error(s(407));c=c()}else{if(c=o(),Ct===null)throw Error(s(349));(Qe&127)!==0||Uw(p,o,c)}g.memoizedState=c;var y={value:c,getSnapshot:o};return g.queue=y,Kw(Pw.bind(null,p,y,r),[r]),p.flags|=2048,Zl(9,{destroy:void 0},Fw.bind(null,p,y,c,o),null),c},useId:function(){var r=Hs(),o=Ct.identifierPrefix;if(tt){var c=Pi,p=Fi;c=(p&~(1<<32-vn(p)-1)).toString(32)+c,o="_"+o+"R_"+c,c=yp++,0<c&&(o+="H"+c.toString(32)),o+="_"}else c=xU++,o="_"+o+"r_"+c.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:wb,useFormState:jw,useActionState:jw,useOptimistic:function(r){var o=Hs();o.memoizedState=o.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=Mb.bind(null,ze,!0,c),c.dispatch=o,[r,o]},useMemoCache:mb,useCacheRefresh:function(){return Hs().memoizedState=MU.bind(null,ze)},useEffectEvent:function(r){var o=Hs(),c={impl:r};return o.memoizedState=c,function(){if((ht&2)!==0)throw Error(s(440));return c.impl.apply(void 0,arguments)}}},Nb={readContext:ws,use:xp,useCallback:s1,useContext:ws,useEffect:_b,useImperativeHandle:t1,useInsertionEffect:Qw,useLayoutEffect:Jw,useMemo:n1,useReducer:_p,useRef:Yw,useState:function(){return _p(Sr)},useDebugValue:vb,useDeferredValue:function(r,o){var c=es();return i1(c,St.memoizedState,r,o)},useTransition:function(){var r=_p(Sr)[0],o=es().memoizedState;return[typeof r=="boolean"?r:jc(r),o]},useSyncExternalStore:Lw,useId:l1,useHostTransitionStatus:wb,useFormState:$w,useActionState:$w,useOptimistic:function(r,o){var c=es();return zw(c,St,r,o)},useMemoCache:mb,useCacheRefresh:u1};Nb.useEffectEvent=Zw;var f1={readContext:ws,use:xp,useCallback:s1,useContext:ws,useEffect:_b,useImperativeHandle:t1,useInsertionEffect:Qw,useLayoutEffect:Jw,useMemo:n1,useReducer:yb,useRef:Yw,useState:function(){return yb(Sr)},useDebugValue:vb,useDeferredValue:function(r,o){var c=es();return St===null?Tb(c,r,o):i1(c,St.memoizedState,r,o)},useTransition:function(){var r=yb(Sr)[0],o=es().memoizedState;return[typeof r=="boolean"?r:jc(r),o]},useSyncExternalStore:Lw,useId:l1,useHostTransitionStatus:wb,useFormState:Xw,useActionState:Xw,useOptimistic:function(r,o){var c=es();return St!==null?zw(c,St,r,o):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:mb,useCacheRefresh:u1};f1.useEffectEvent=Zw;function Ab(r,o,c,p){o=r.memoizedState,c=c(p,o),c=c==null?o:m({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Cb={enqueueSetState:function(r,o,c){r=r._reactInternals;var p=Cn(),g=va(p);g.payload=o,c!=null&&(g.callback=c),o=Ta(r,g,p),o!==null&&(on(o,r,p),kc(o,r,p))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var p=Cn(),g=va(p);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=Ta(r,g,p),o!==null&&(on(o,r,p),kc(o,r,p))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=Cn(),p=va(c);p.tag=2,o!=null&&(p.callback=o),o=Ta(r,p,c),o!==null&&(on(o,r,c),kc(o,r,c))}};function m1(r,o,c,p,g,y,S){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,y,S):o.prototype&&o.prototype.isPureReactComponent?!Lc(c,p)||!Lc(g,y):!0}function g1(r,o,c,p){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,p),o.state!==r&&Cb.enqueueReplaceState(o,o.state,null)}function Go(r,o){var c=o;if("ref"in o){c={};for(var p in o)p!=="ref"&&(c[p]=o[p])}if(r=r.defaultProps){c===o&&(c=m({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}function y1(r){tp(r)}function b1(r){console.error(r)}function x1(r){tp(r)}function wp(r,o){try{var c=r.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(p){setTimeout(function(){throw p})}}function _1(r,o,c){try{var p=r.onCaughtError;p(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Eb(r,o,c){return c=va(c),c.tag=3,c.payload={element:null},c.callback=function(){wp(r,o)},c}function v1(r){return r=va(r),r.tag=3,r}function T1(r,o,c,p){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=p.value;r.payload=function(){return g(y)},r.callback=function(){_1(o,c,p)}}var S=c.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(r.callback=function(){_1(o,c,p),typeof g!="function"&&(Ca===null?Ca=new Set([this]):Ca.add(this));var M=p.stack;this.componentDidCatch(p.value,{componentStack:M!==null?M:""})})}function AU(r,o,c,p,g){if(c.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(o=c.alternate,o!==null&&ql(o,c,g,!0),c=wn.current,c!==null){switch(c.tag){case 31:case 13:return Zn===null?Pp():c.alternate===null&&Xt===0&&(Xt=3),c.flags&=-257,c.flags|=65536,c.lanes=g,p===hp?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([p]):o.add(p),e0(r,p,g)),!1;case 22:return c.flags|=65536,p===hp?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([p])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([p]):c.add(p)),e0(r,p,g)),!1}throw Error(s(435,c.tag))}return e0(r,p,g),Pp(),!1}if(tt)return o=wn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,p!==Xy&&(r=Error(s(422),{cause:p}),Pc(Wn(r,c)))):(p!==Xy&&(o=Error(s(423),{cause:p}),Pc(Wn(o,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,p=Wn(p,c),g=Eb(r.stateNode,p,g),rb(r,g),Xt!==4&&(Xt=2)),!1;var y=Error(s(520),{cause:p});if(y=Wn(y,c),th===null?th=[y]:th.push(y),Xt!==4&&(Xt=2),o===null)return!0;p=Wn(p,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=Eb(c.stateNode,p,r),rb(c,r),!1;case 1:if(o=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ca===null||!Ca.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=v1(g),T1(g,r,c,p),rb(c,g),!1}c=c.return}while(c!==null);return!1}var Rb=Error(s(461)),rs=!1;function Ms(r,o,c,p){o.child=r===null?Nw(o,null,c,p):Io(o,r.child,c,p)}function S1(r,o,c,p,g){c=c.render;var y=o.ref;if("ref"in p){var S={};for(var M in p)M!=="ref"&&(S[M]=p[M])}else S=p;return Po(o),p=hb(r,o,c,S,y,g),M=db(),r!==null&&!rs?(pb(r,o,g),wr(r,o,g)):(tt&&M&&$y(o),o.flags|=1,Ms(r,o,p,g),o.child)}function w1(r,o,c,p,g){if(r===null){var y=c.type;return typeof y=="function"&&!qy(y)&&y.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=y,M1(r,o,y,p,g)):(r=rp(c.type,null,p,o,o.mode,g),r.ref=o.ref,r.return=o,o.child=r)}if(y=r.child,!Vb(r,g)){var S=y.memoizedProps;if(c=c.compare,c=c!==null?c:Lc,c(S,p)&&r.ref===o.ref)return wr(r,o,g)}return o.flags|=1,r=br(y,p),r.ref=o.ref,r.return=o,o.child=r}function M1(r,o,c,p,g){if(r!==null){var y=r.memoizedProps;if(Lc(y,p)&&r.ref===o.ref)if(rs=!1,o.pendingProps=p=y,Vb(r,g))(r.flags&131072)!==0&&(rs=!0);else return o.lanes=r.lanes,wr(r,o,g)}return Bb(r,o,c,p,g)}function N1(r,o,c,p){var g=p.children,y=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((o.flags&128)!==0){if(y=y!==null?y.baseLanes|c:c,r!==null){for(p=o.child=r.child,g=0;p!==null;)g=g|p.lanes|p.childLanes,p=p.sibling;p=g&~y}else p=0,o.child=null;return A1(r,o,y,c,p)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&up(o,y!==null?y.cachePool:null),y!==null?Ew(o,y):ob(),Rw(o);else return p=o.lanes=536870912,A1(r,o,y!==null?y.baseLanes|c:c,c,p)}else y!==null?(up(o,y.cachePool),Ew(o,y),wa(),o.memoizedState=null):(r!==null&&up(o,null),ob(),wa());return Ms(r,o,g,c),o.child}function Xc(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function A1(r,o,c,p,g){var y=tb();return y=y===null?null:{parent:ns._currentValue,pool:y},o.memoizedState={baseLanes:c,cachePool:y},r!==null&&up(o,null),ob(),Rw(o),r!==null&&ql(r,o,p,!0),o.childLanes=g,null}function Mp(r,o){return o=Ap({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function C1(r,o,c){return Io(o,r.child,null,c),r=Mp(o,o.pendingProps),r.flags|=2,Mn(o),o.memoizedState=null,r}function CU(r,o,c){var p=o.pendingProps,g=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(tt){if(p.mode==="hidden")return r=Mp(o,p),o.lanes=536870912,Xc(null,r);if(ub(o),(r=Dt)?(r=IM(r,Kn),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:ga!==null?{id:Fi,overflow:Pi}:null,retryLane:536870912,hydrationErrors:null},c=hw(r),c.return=o,o.child=c,Ss=o,Dt=null)):r=null,r===null)throw ba(o);return o.lanes=536870912,null}return Mp(o,p)}var y=r.memoizedState;if(y!==null){var S=y.dehydrated;if(ub(o),g)if(o.flags&256)o.flags&=-257,o=C1(r,o,c);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(s(558));else if(rs||ql(r,o,c,!1),g=(c&r.childLanes)!==0,rs||g){if(p=Ct,p!==null&&(S=bS(p,c),S!==0&&S!==y.retryLane))throw y.retryLane=S,Do(r,S),on(p,r,S),Rb;Pp(),o=C1(r,o,c)}else r=y.treeContext,Dt=Qn(S.nextSibling),Ss=o,tt=!0,ya=null,Kn=!1,r!==null&&fw(o,r),o=Mp(o,p),o.flags|=4096;return o}return r=br(r.child,{mode:p.mode,children:p.children}),r.ref=o.ref,o.child=r,r.return=o,r}function Np(r,o){var c=o.ref;if(c===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(s(284));(r===null||r.ref!==c)&&(o.flags|=4194816)}}function Bb(r,o,c,p,g){return Po(o),c=hb(r,o,c,p,void 0,g),p=db(),r!==null&&!rs?(pb(r,o,g),wr(r,o,g)):(tt&&p&&$y(o),o.flags|=1,Ms(r,o,c,g),o.child)}function E1(r,o,c,p,g,y){return Po(o),o.updateQueue=null,c=Dw(o,p,c,g),Bw(r),p=db(),r!==null&&!rs?(pb(r,o,y),wr(r,o,y)):(tt&&p&&$y(o),o.flags|=1,Ms(r,o,c,y),o.child)}function R1(r,o,c,p,g){if(Po(o),o.stateNode===null){var y=zl,S=c.contextType;typeof S=="object"&&S!==null&&(y=ws(S)),y=new c(p,y),o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Cb,o.stateNode=y,y._reactInternals=o,y=o.stateNode,y.props=p,y.state=o.memoizedState,y.refs={},nb(o),S=c.contextType,y.context=typeof S=="object"&&S!==null?ws(S):zl,y.state=o.memoizedState,S=c.getDerivedStateFromProps,typeof S=="function"&&(Ab(o,c,S,p),y.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(S=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),S!==y.state&&Cb.enqueueReplaceState(y,y.state,null),qc(o,p,y,g),Gc(),y.state=o.memoizedState),typeof y.componentDidMount=="function"&&(o.flags|=4194308),p=!0}else if(r===null){y=o.stateNode;var M=o.memoizedProps,U=Go(c,M);y.props=U;var X=y.context,J=c.contextType;S=zl,typeof J=="object"&&J!==null&&(S=ws(J));var ne=c.getDerivedStateFromProps;J=typeof ne=="function"||typeof y.getSnapshotBeforeUpdate=="function",M=o.pendingProps!==M,J||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(M||X!==S)&&g1(o,y,p,S),_a=!1;var Y=o.memoizedState;y.state=Y,qc(o,p,y,g),Gc(),X=o.memoizedState,M||Y!==X||_a?(typeof ne=="function"&&(Ab(o,c,ne,p),X=o.memoizedState),(U=_a||m1(o,c,U,p,Y,X,S))?(J||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(o.flags|=4194308)):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=X),y.props=p,y.state=X,y.context=S,p=U):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{y=o.stateNode,ib(r,o),S=o.memoizedProps,J=Go(c,S),y.props=J,ne=o.pendingProps,Y=y.context,X=c.contextType,U=zl,typeof X=="object"&&X!==null&&(U=ws(X)),M=c.getDerivedStateFromProps,(X=typeof M=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(S!==ne||Y!==U)&&g1(o,y,p,U),_a=!1,Y=o.memoizedState,y.state=Y,qc(o,p,y,g),Gc();var K=o.memoizedState;S!==ne||Y!==K||_a||r!==null&&r.dependencies!==null&&op(r.dependencies)?(typeof M=="function"&&(Ab(o,c,M,p),K=o.memoizedState),(J=_a||m1(o,c,J,p,Y,K,U)||r!==null&&r.dependencies!==null&&op(r.dependencies))?(X||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(p,K,U),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(p,K,U)),typeof y.componentDidUpdate=="function"&&(o.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof y.componentDidUpdate!="function"||S===r.memoizedProps&&Y===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||S===r.memoizedProps&&Y===r.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=K),y.props=p,y.state=K,y.context=U,p=J):(typeof y.componentDidUpdate!="function"||S===r.memoizedProps&&Y===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||S===r.memoizedProps&&Y===r.memoizedState||(o.flags|=1024),p=!1)}return y=p,Np(r,o),p=(o.flags&128)!==0,y||p?(y=o.stateNode,c=p&&typeof c.getDerivedStateFromError!="function"?null:y.render(),o.flags|=1,r!==null&&p?(o.child=Io(o,r.child,null,g),o.child=Io(o,null,c,g)):Ms(r,o,c,g),o.memoizedState=y.state,r=o.child):r=wr(r,o,g),r}function B1(r,o,c,p){return Uo(),o.flags|=256,Ms(r,o,c,p),o.child}var Db={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Lb(r){return{baseLanes:r,cachePool:_w()}}function Ub(r,o,c){return r=r!==null?r.childLanes&~c:0,o&&(r|=An),r}function D1(r,o,c){var p=o.pendingProps,g=!1,y=(o.flags&128)!==0,S;if((S=y)||(S=r!==null&&r.memoizedState===null?!1:(Jt.current&2)!==0),S&&(g=!0,o.flags&=-129),S=(o.flags&32)!==0,o.flags&=-33,r===null){if(tt){if(g?Sa(o):wa(),(r=Dt)?(r=IM(r,Kn),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:ga!==null?{id:Fi,overflow:Pi}:null,retryLane:536870912,hydrationErrors:null},c=hw(r),c.return=o,o.child=c,Ss=o,Dt=null)):r=null,r===null)throw ba(o);return g0(r)?o.lanes=32:o.lanes=536870912,null}var M=p.children;return p=p.fallback,g?(wa(),g=o.mode,M=Ap({mode:"hidden",children:M},g),p=Lo(p,g,c,null),M.return=o,p.return=o,M.sibling=p,o.child=M,p=o.child,p.memoizedState=Lb(c),p.childLanes=Ub(r,S,c),o.memoizedState=Db,Xc(null,p)):(Sa(o),Fb(o,M))}var U=r.memoizedState;if(U!==null&&(M=U.dehydrated,M!==null)){if(y)o.flags&256?(Sa(o),o.flags&=-257,o=Pb(r,o,c)):o.memoizedState!==null?(wa(),o.child=r.child,o.flags|=128,o=null):(wa(),M=p.fallback,g=o.mode,p=Ap({mode:"visible",children:p.children},g),M=Lo(M,g,c,null),M.flags|=2,p.return=o,M.return=o,p.sibling=M,o.child=p,Io(o,r.child,null,c),p=o.child,p.memoizedState=Lb(c),p.childLanes=Ub(r,S,c),o.memoizedState=Db,o=Xc(null,p));else if(Sa(o),g0(M)){if(S=M.nextSibling&&M.nextSibling.dataset,S)var X=S.dgst;S=X,p=Error(s(419)),p.stack="",p.digest=S,Pc({value:p,source:null,stack:null}),o=Pb(r,o,c)}else if(rs||ql(r,o,c,!1),S=(c&r.childLanes)!==0,rs||S){if(S=Ct,S!==null&&(p=bS(S,c),p!==0&&p!==U.retryLane))throw U.retryLane=p,Do(r,p),on(S,r,p),Rb;m0(M)||Pp(),o=Pb(r,o,c)}else m0(M)?(o.flags|=192,o.child=r.child,o=null):(r=U.treeContext,Dt=Qn(M.nextSibling),Ss=o,tt=!0,ya=null,Kn=!1,r!==null&&fw(o,r),o=Fb(o,p.children),o.flags|=4096);return o}return g?(wa(),M=p.fallback,g=o.mode,U=r.child,X=U.sibling,p=br(U,{mode:"hidden",children:p.children}),p.subtreeFlags=U.subtreeFlags&65011712,X!==null?M=br(X,M):(M=Lo(M,g,c,null),M.flags|=2),M.return=o,p.return=o,p.sibling=M,o.child=p,Xc(null,p),p=o.child,M=r.child.memoizedState,M===null?M=Lb(c):(g=M.cachePool,g!==null?(U=ns._currentValue,g=g.parent!==U?{parent:U,pool:U}:g):g=_w(),M={baseLanes:M.baseLanes|c,cachePool:g}),p.memoizedState=M,p.childLanes=Ub(r,S,c),o.memoizedState=Db,Xc(r.child,p)):(Sa(o),c=r.child,r=c.sibling,c=br(c,{mode:"visible",children:p.children}),c.return=o,c.sibling=null,r!==null&&(S=o.deletions,S===null?(o.deletions=[r],o.flags|=16):S.push(r)),o.child=c,o.memoizedState=null,c)}function Fb(r,o){return o=Ap({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function Ap(r,o){return r=Sn(22,r,null,o),r.lanes=0,r}function Pb(r,o,c){return Io(o,r.child,null,c),r=Fb(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function L1(r,o,c){r.lanes|=o;var p=r.alternate;p!==null&&(p.lanes|=o),Zy(r.return,o,c)}function Ob(r,o,c,p,g,y){var S=r.memoizedState;S===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:g,treeForkCount:y}:(S.isBackwards=o,S.rendering=null,S.renderingStartTime=0,S.last=p,S.tail=c,S.tailMode=g,S.treeForkCount=y)}function U1(r,o,c){var p=o.pendingProps,g=p.revealOrder,y=p.tail;p=p.children;var S=Jt.current,M=(S&2)!==0;if(M?(S=S&1|2,o.flags|=128):S&=1,de(Jt,S),Ms(r,o,p,c),p=tt?Fc:0,!M&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&L1(r,c,o);else if(r.tag===19)L1(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(g){case"forwards":for(c=o.child,g=null;c!==null;)r=c.alternate,r!==null&&mp(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),Ob(o,!1,g,c,y,p);break;case"backwards":case"unstable_legacy-backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(r=g.alternate,r!==null&&mp(r)===null){o.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}Ob(o,!0,c,null,y,p);break;case"together":Ob(o,!1,null,null,void 0,p);break;default:o.memoizedState=null}return o.child}function wr(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),Aa|=o.lanes,(c&o.childLanes)===0)if(r!==null){if(ql(r,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(s(153));if(o.child!==null){for(r=o.child,c=br(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=br(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function Vb(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&op(r)))}function EU(r,o,c){switch(o.tag){case 3:qs(o,o.stateNode.containerInfo),xa(o,ns,r.memoizedState.cache),Uo();break;case 27:case 5:_c(o);break;case 4:qs(o,o.stateNode.containerInfo);break;case 10:xa(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,ub(o),null;break;case 13:var p=o.memoizedState;if(p!==null)return p.dehydrated!==null?(Sa(o),o.flags|=128,null):(c&o.child.childLanes)!==0?D1(r,o,c):(Sa(o),r=wr(r,o,c),r!==null?r.sibling:null);Sa(o);break;case 19:var g=(r.flags&128)!==0;if(p=(c&o.childLanes)!==0,p||(ql(r,o,c,!1),p=(c&o.childLanes)!==0),g){if(p)return U1(r,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),de(Jt,Jt.current),p)break;return null;case 22:return o.lanes=0,N1(r,o,c,o.pendingProps);case 24:xa(o,ns,r.memoizedState.cache)}return wr(r,o,c)}function F1(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps)rs=!0;else{if(!Vb(r,c)&&(o.flags&128)===0)return rs=!1,EU(r,o,c);rs=(r.flags&131072)!==0}else rs=!1,tt&&(o.flags&1048576)!==0&&pw(o,Fc,o.index);switch(o.lanes=0,o.tag){case 16:e:{var p=o.pendingProps;if(r=Vo(o.elementType),o.type=r,typeof r=="function")qy(r)?(p=Go(r,p),o.tag=1,o=R1(null,o,r,p,c)):(o.tag=0,o=Bb(null,o,r,p,c));else{if(r!=null){var g=r.$$typeof;if(g===E){o.tag=11,o=S1(null,o,r,p,c);break e}else if(g===D){o.tag=14,o=w1(null,o,r,p,c);break e}}throw o=Ce(r)||r,Error(s(306,o,""))}}return o;case 0:return Bb(r,o,o.type,o.pendingProps,c);case 1:return p=o.type,g=Go(p,o.pendingProps),R1(r,o,p,g,c);case 3:e:{if(qs(o,o.stateNode.containerInfo),r===null)throw Error(s(387));p=o.pendingProps;var y=o.memoizedState;g=y.element,ib(r,o),qc(o,p,null,c);var S=o.memoizedState;if(p=S.cache,xa(o,ns,p),p!==y.cache&&Qy(o,[ns],c,!0),Gc(),p=S.element,y.isDehydrated)if(y={element:p,isDehydrated:!1,cache:S.cache},o.updateQueue.baseState=y,o.memoizedState=y,o.flags&256){o=B1(r,o,p,c);break e}else if(p!==g){g=Wn(Error(s(424)),o),Pc(g),o=B1(r,o,p,c);break e}else for(r=o.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Dt=Qn(r.firstChild),Ss=o,tt=!0,ya=null,Kn=!0,c=Nw(o,null,p,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Uo(),p===g){o=wr(r,o,c);break e}Ms(r,o,p,c)}o=o.child}return o;case 26:return Np(r,o),r===null?(c=$M(o.type,null,o.pendingProps,null))?o.memoizedState=c:tt||(c=o.type,r=o.pendingProps,p=qp(We.current).createElement(c),p[Ts]=o,p[en]=r,Ns(p,c,r),ys(p),o.stateNode=p):o.memoizedState=$M(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return _c(o),r===null&&tt&&(p=o.stateNode=qM(o.type,o.pendingProps,We.current),Ss=o,Kn=!0,g=Dt,Da(o.type)?(y0=g,Dt=Qn(p.firstChild)):Dt=g),Ms(r,o,o.pendingProps.children,c),Np(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&tt&&((g=p=Dt)&&(p=rF(p,o.type,o.pendingProps,Kn),p!==null?(o.stateNode=p,Ss=o,Dt=Qn(p.firstChild),Kn=!1,g=!0):g=!1),g||ba(o)),_c(o),g=o.type,y=o.pendingProps,S=r!==null?r.memoizedProps:null,p=y.children,d0(g,y)?p=null:S!==null&&d0(g,S)&&(o.flags|=32),o.memoizedState!==null&&(g=hb(r,o,_U,null,null,c),uh._currentValue=g),Np(r,o),Ms(r,o,p,c),o.child;case 6:return r===null&&tt&&((r=c=Dt)&&(c=aF(c,o.pendingProps,Kn),c!==null?(o.stateNode=c,Ss=o,Dt=null,r=!0):r=!1),r||ba(o)),null;case 13:return D1(r,o,c);case 4:return qs(o,o.stateNode.containerInfo),p=o.pendingProps,r===null?o.child=Io(o,null,p,c):Ms(r,o,p,c),o.child;case 11:return S1(r,o,o.type,o.pendingProps,c);case 7:return Ms(r,o,o.pendingProps,c),o.child;case 8:return Ms(r,o,o.pendingProps.children,c),o.child;case 12:return Ms(r,o,o.pendingProps.children,c),o.child;case 10:return p=o.pendingProps,xa(o,o.type,p.value),Ms(r,o,p.children,c),o.child;case 9:return g=o.type._context,p=o.pendingProps.children,Po(o),g=ws(g),p=p(g),o.flags|=1,Ms(r,o,p,c),o.child;case 14:return w1(r,o,o.type,o.pendingProps,c);case 15:return M1(r,o,o.type,o.pendingProps,c);case 19:return U1(r,o,c);case 31:return CU(r,o,c);case 22:return N1(r,o,c,o.pendingProps);case 24:return Po(o),p=ws(ns),r===null?(g=tb(),g===null&&(g=Ct,y=Jy(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),o.memoizedState={parent:p,cache:g},nb(o),xa(o,ns,g)):((r.lanes&c)!==0&&(ib(r,o),qc(o,null,null,c),Gc()),g=r.memoizedState,y=o.memoizedState,g.parent!==p?(g={parent:p,cache:p},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),xa(o,ns,p)):(p=y.cache,xa(o,ns,p),p!==g.cache&&Qy(o,[ns],c,!0))),Ms(r,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Mr(r){r.flags|=4}function zb(r,o,c,p,g){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(g&335544128)===g)if(r.stateNode.complete)r.flags|=8192;else if(lM())r.flags|=8192;else throw zo=hp,sb}else r.flags&=-16777217}function P1(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!ZM(o))if(lM())r.flags|=8192;else throw zo=hp,sb}function Cp(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?mS():536870912,r.lanes|=o,tu|=o)}function Yc(r,o){if(!tt)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function Lt(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,p=0;if(o)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,p|=g.subtreeFlags&65011712,p|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,p|=g.subtreeFlags,p|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=p,r.childLanes=c,o}function RU(r,o,c){var p=o.pendingProps;switch(Wy(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lt(o),null;case 1:return Lt(o),null;case 3:return c=o.stateNode,p=null,r!==null&&(p=r.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),vr(ns),Qt(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Gl(o)?Mr(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Yy())),Lt(o),null;case 26:var g=o.type,y=o.memoizedState;return r===null?(Mr(o),y!==null?(Lt(o),P1(o,y)):(Lt(o),zb(o,g,null,p,c))):y?y!==r.memoizedState?(Mr(o),Lt(o),P1(o,y)):(Lt(o),o.flags&=-16777217):(r=r.memoizedProps,r!==p&&Mr(o),Lt(o),zb(o,g,r,p,c)),null;case 27:if(zd(o),c=We.current,g=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==p&&Mr(o);else{if(!p){if(o.stateNode===null)throw Error(s(166));return Lt(o),null}r=we.current,Gl(o)?mw(o):(r=qM(g,p,c),o.stateNode=r,Mr(o))}return Lt(o),null;case 5:if(zd(o),g=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==p&&Mr(o);else{if(!p){if(o.stateNode===null)throw Error(s(166));return Lt(o),null}if(y=we.current,Gl(o))mw(o);else{var S=qp(We.current);switch(y){case 1:y=S.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:y=S.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":y=S.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":y=S.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":y=S.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof p.is=="string"?S.createElement("select",{is:p.is}):S.createElement("select"),p.multiple?y.multiple=!0:p.size&&(y.size=p.size);break;default:y=typeof p.is=="string"?S.createElement(g,{is:p.is}):S.createElement(g)}}y[Ts]=o,y[en]=p;e:for(S=o.child;S!==null;){if(S.tag===5||S.tag===6)y.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===o)break e;for(;S.sibling===null;){if(S.return===null||S.return===o)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}o.stateNode=y;e:switch(Ns(y,g,p),g){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Mr(o)}}return Lt(o),zb(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,c),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==p&&Mr(o);else{if(typeof p!="string"&&o.stateNode===null)throw Error(s(166));if(r=We.current,Gl(o)){if(r=o.stateNode,c=o.memoizedProps,p=null,g=Ss,g!==null)switch(g.tag){case 27:case 5:p=g.memoizedProps}r[Ts]=o,r=!!(r.nodeValue===c||p!==null&&p.suppressHydrationWarning===!0||DM(r.nodeValue,c)),r||ba(o,!0)}else r=qp(r).createTextNode(p),r[Ts]=o,o.stateNode=r}return Lt(o),null;case 31:if(c=o.memoizedState,r===null||r.memoizedState!==null){if(p=Gl(o),c!==null){if(r===null){if(!p)throw Error(s(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(557));r[Ts]=o}else Uo(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Lt(o),r=!1}else c=Yy(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return o.flags&256?(Mn(o),o):(Mn(o),null);if((o.flags&128)!==0)throw Error(s(558))}return Lt(o),null;case 13:if(p=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Gl(o),p!==null&&p.dehydrated!==null){if(r===null){if(!g)throw Error(s(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(s(317));g[Ts]=o}else Uo(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Lt(o),g=!1}else g=Yy(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Mn(o),o):(Mn(o),null)}return Mn(o),(o.flags&128)!==0?(o.lanes=c,o):(c=p!==null,r=r!==null&&r.memoizedState!==null,c&&(p=o.child,g=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(g=p.alternate.memoizedState.cachePool.pool),y=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(y=p.memoizedState.cachePool.pool),y!==g&&(p.flags|=2048)),c!==r&&c&&(o.child.flags|=8192),Cp(o,o.updateQueue),Lt(o),null);case 4:return Qt(),r===null&&o0(o.stateNode.containerInfo),Lt(o),null;case 10:return vr(o.type),Lt(o),null;case 19:if(ee(Jt),p=o.memoizedState,p===null)return Lt(o),null;if(g=(o.flags&128)!==0,y=p.rendering,y===null)if(g)Yc(p,!1);else{if(Xt!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(y=mp(r),y!==null){for(o.flags|=128,Yc(p,!1),r=y.updateQueue,o.updateQueue=r,Cp(o,r),o.subtreeFlags=0,r=c,c=o.child;c!==null;)cw(c,r),c=c.sibling;return de(Jt,Jt.current&1|2),tt&&xr(o,p.treeForkCount),o.child}r=r.sibling}p.tail!==null&&xn()>Lp&&(o.flags|=128,g=!0,Yc(p,!1),o.lanes=4194304)}else{if(!g)if(r=mp(y),r!==null){if(o.flags|=128,g=!0,r=r.updateQueue,o.updateQueue=r,Cp(o,r),Yc(p,!0),p.tail===null&&p.tailMode==="hidden"&&!y.alternate&&!tt)return Lt(o),null}else 2*xn()-p.renderingStartTime>Lp&&c!==536870912&&(o.flags|=128,g=!0,Yc(p,!1),o.lanes=4194304);p.isBackwards?(y.sibling=o.child,o.child=y):(r=p.last,r!==null?r.sibling=y:o.child=y,p.last=y)}return p.tail!==null?(r=p.tail,p.rendering=r,p.tail=r.sibling,p.renderingStartTime=xn(),r.sibling=null,c=Jt.current,de(Jt,g?c&1|2:c&1),tt&&xr(o,p.treeForkCount),r):(Lt(o),null);case 22:case 23:return Mn(o),lb(),p=o.memoizedState!==null,r!==null?r.memoizedState!==null!==p&&(o.flags|=8192):p&&(o.flags|=8192),p?(c&536870912)!==0&&(o.flags&128)===0&&(Lt(o),o.subtreeFlags&6&&(o.flags|=8192)):Lt(o),c=o.updateQueue,c!==null&&Cp(o,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==c&&(o.flags|=2048),r!==null&&ee(Oo),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),vr(ns),Lt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function BU(r,o){switch(Wy(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return vr(ns),Qt(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return zd(o),null;case 31:if(o.memoizedState!==null){if(Mn(o),o.alternate===null)throw Error(s(340));Uo()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(Mn(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Uo()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return ee(Jt),null;case 4:return Qt(),null;case 10:return vr(o.type),null;case 22:case 23:return Mn(o),lb(),r!==null&&ee(Oo),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return vr(ns),null;case 25:return null;default:return null}}function O1(r,o){switch(Wy(o),o.tag){case 3:vr(ns),Qt();break;case 26:case 27:case 5:zd(o);break;case 4:Qt();break;case 31:o.memoizedState!==null&&Mn(o);break;case 13:Mn(o);break;case 19:ee(Jt);break;case 10:vr(o.type);break;case 22:case 23:Mn(o),lb(),r!==null&&ee(Oo);break;case 24:vr(ns)}}function Kc(r,o){try{var c=o.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var g=p.next;c=g;do{if((c.tag&r)===r){p=void 0;var y=c.create,S=c.inst;p=y(),S.destroy=p}c=c.next}while(c!==g)}}catch(M){vt(o,o.return,M)}}function Ma(r,o,c){try{var p=o.updateQueue,g=p!==null?p.lastEffect:null;if(g!==null){var y=g.next;p=y;do{if((p.tag&r)===r){var S=p.inst,M=S.destroy;if(M!==void 0){S.destroy=void 0,g=o;var U=c,X=M;try{X()}catch(J){vt(g,U,J)}}}p=p.next}while(p!==y)}}catch(J){vt(o,o.return,J)}}function V1(r){var o=r.updateQueue;if(o!==null){var c=r.stateNode;try{Cw(o,c)}catch(p){vt(r,r.return,p)}}}function z1(r,o,c){c.props=Go(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(p){vt(r,o,p)}}function Zc(r,o){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var p=r.stateNode;break;case 30:p=r.stateNode;break;default:p=r.stateNode}typeof c=="function"?r.refCleanup=c(p):c.current=p}}catch(g){vt(r,o,g)}}function Oi(r,o){var c=r.ref,p=r.refCleanup;if(c!==null)if(typeof p=="function")try{p()}catch(g){vt(r,o,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){vt(r,o,g)}else c.current=null}function I1(r){var o=r.type,c=r.memoizedProps,p=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&p.focus();break e;case"img":c.src?p.src=c.src:c.srcSet&&(p.srcset=c.srcSet)}}catch(g){vt(r,r.return,g)}}function Ib(r,o,c){try{var p=r.stateNode;JU(p,r.type,c,o),p[en]=o}catch(g){vt(r,r.return,g)}}function k1(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Da(r.type)||r.tag===4}function kb(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||k1(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Da(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Gb(r,o,c){var p=r.tag;if(p===5||p===6)r=r.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(r),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=gr));else if(p!==4&&(p===27&&Da(r.type)&&(c=r.stateNode,o=null),r=r.child,r!==null))for(Gb(r,o,c),r=r.sibling;r!==null;)Gb(r,o,c),r=r.sibling}function Ep(r,o,c){var p=r.tag;if(p===5||p===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(p!==4&&(p===27&&Da(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Ep(r,o,c),r=r.sibling;r!==null;)Ep(r,o,c),r=r.sibling}function G1(r){var o=r.stateNode,c=r.memoizedProps;try{for(var p=r.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);Ns(o,p,c),o[Ts]=r,o[en]=c}catch(y){vt(r,r.return,y)}}var Nr=!1,as=!1,qb=!1,q1=typeof WeakSet=="function"?WeakSet:Set,bs=null;function DU(r,o){if(r=r.containerInfo,c0=Kp,r=tw(r),Py(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var g=p.anchorOffset,y=p.focusNode;p=p.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var S=0,M=-1,U=-1,X=0,J=0,ne=r,Y=null;t:for(;;){for(var K;ne!==c||g!==0&&ne.nodeType!==3||(M=S+g),ne!==y||p!==0&&ne.nodeType!==3||(U=S+p),ne.nodeType===3&&(S+=ne.nodeValue.length),(K=ne.firstChild)!==null;)Y=ne,ne=K;for(;;){if(ne===r)break t;if(Y===c&&++X===g&&(M=S),Y===y&&++J===p&&(U=S),(K=ne.nextSibling)!==null)break;ne=Y,Y=ne.parentNode}ne=K}c=M===-1||U===-1?null:{start:M,end:U}}else c=null}c=c||{start:0,end:0}}else c=null;for(h0={focusedElem:r,selectionRange:c},Kp=!1,bs=o;bs!==null;)if(o=bs,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,bs=r;else for(;bs!==null;){switch(o=bs,y=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)g=r[c],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&y!==null){r=void 0,c=o,g=y.memoizedProps,y=y.memoizedState,p=c.stateNode;try{var Te=Go(c.type,g);r=p.getSnapshotBeforeUpdate(Te,y),p.__reactInternalSnapshotBeforeUpdate=r}catch(Le){vt(c,c.return,Le)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,c=r.nodeType,c===9)f0(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":f0(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(s(163))}if(r=o.sibling,r!==null){r.return=o.return,bs=r;break}bs=o.return}}function H1(r,o,c){var p=c.flags;switch(c.tag){case 0:case 11:case 15:Cr(r,c),p&4&&Kc(5,c);break;case 1:if(Cr(r,c),p&4)if(r=c.stateNode,o===null)try{r.componentDidMount()}catch(S){vt(c,c.return,S)}else{var g=Go(c.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(g,o,r.__reactInternalSnapshotBeforeUpdate)}catch(S){vt(c,c.return,S)}}p&64&&V1(c),p&512&&Zc(c,c.return);break;case 3:if(Cr(r,c),p&64&&(r=c.updateQueue,r!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Cw(r,o)}catch(S){vt(c,c.return,S)}}break;case 27:o===null&&p&4&&G1(c);case 26:case 5:Cr(r,c),o===null&&p&4&&I1(c),p&512&&Zc(c,c.return);break;case 12:Cr(r,c);break;case 31:Cr(r,c),p&4&&W1(r,c);break;case 13:Cr(r,c),p&4&&X1(r,c),p&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=kU.bind(null,c),oF(r,c))));break;case 22:if(p=c.memoizedState!==null||Nr,!p){o=o!==null&&o.memoizedState!==null||as,g=Nr;var y=as;Nr=p,(as=o)&&!y?Er(r,c,(c.subtreeFlags&8772)!==0):Cr(r,c),Nr=g,as=y}break;case 30:break;default:Cr(r,c)}}function j1(r){var o=r.alternate;o!==null&&(r.alternate=null,j1(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&xy(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Pt=null,sn=!1;function Ar(r,o,c){for(c=c.child;c!==null;)$1(r,o,c),c=c.sibling}function $1(r,o,c){if(_n&&typeof _n.onCommitFiberUnmount=="function")try{_n.onCommitFiberUnmount(vc,c)}catch{}switch(c.tag){case 26:as||Oi(c,o),Ar(r,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:as||Oi(c,o);var p=Pt,g=sn;Da(c.type)&&(Pt=c.stateNode,sn=!1),Ar(r,o,c),ah(c.stateNode),Pt=p,sn=g;break;case 5:as||Oi(c,o);case 6:if(p=Pt,g=sn,Pt=null,Ar(r,o,c),Pt=p,sn=g,Pt!==null)if(sn)try{(Pt.nodeType===9?Pt.body:Pt.nodeName==="HTML"?Pt.ownerDocument.body:Pt).removeChild(c.stateNode)}catch(y){vt(c,o,y)}else try{Pt.removeChild(c.stateNode)}catch(y){vt(c,o,y)}break;case 18:Pt!==null&&(sn?(r=Pt,VM(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),uu(r)):VM(Pt,c.stateNode));break;case 4:p=Pt,g=sn,Pt=c.stateNode.containerInfo,sn=!0,Ar(r,o,c),Pt=p,sn=g;break;case 0:case 11:case 14:case 15:Ma(2,c,o),as||Ma(4,c,o),Ar(r,o,c);break;case 1:as||(Oi(c,o),p=c.stateNode,typeof p.componentWillUnmount=="function"&&z1(c,o,p)),Ar(r,o,c);break;case 21:Ar(r,o,c);break;case 22:as=(p=as)||c.memoizedState!==null,Ar(r,o,c),as=p;break;default:Ar(r,o,c)}}function W1(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{uu(r)}catch(c){vt(o,o.return,c)}}}function X1(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{uu(r)}catch(c){vt(o,o.return,c)}}function LU(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new q1),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new q1),o;default:throw Error(s(435,r.tag))}}function Rp(r,o){var c=LU(r);o.forEach(function(p){if(!c.has(p)){c.add(p);var g=GU.bind(null,r,p);p.then(g,g)}})}function nn(r,o){var c=o.deletions;if(c!==null)for(var p=0;p<c.length;p++){var g=c[p],y=r,S=o,M=S;e:for(;M!==null;){switch(M.tag){case 27:if(Da(M.type)){Pt=M.stateNode,sn=!1;break e}break;case 5:Pt=M.stateNode,sn=!1;break e;case 3:case 4:Pt=M.stateNode.containerInfo,sn=!0;break e}M=M.return}if(Pt===null)throw Error(s(160));$1(y,S,g),Pt=null,sn=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Y1(o,r),o=o.sibling}var vi=null;function Y1(r,o){var c=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:nn(o,r),rn(r),p&4&&(Ma(3,r,r.return),Kc(3,r),Ma(5,r,r.return));break;case 1:nn(o,r),rn(r),p&512&&(as||c===null||Oi(c,c.return)),p&64&&Nr&&(r=r.updateQueue,r!==null&&(p=r.callbacks,p!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?p:c.concat(p))));break;case 26:var g=vi;if(nn(o,r),rn(r),p&512&&(as||c===null||Oi(c,c.return)),p&4){var y=c!==null?c.memoizedState:null;if(p=r.memoizedState,c===null)if(p===null)if(r.stateNode===null){e:{p=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(p){case"title":y=g.getElementsByTagName("title")[0],(!y||y[wc]||y[Ts]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(p),g.head.insertBefore(y,g.querySelector("head > title"))),Ns(y,p,c),y[Ts]=r,ys(y),p=y;break e;case"link":var S=YM("link","href",g).get(p+(c.href||""));if(S){for(var M=0;M<S.length;M++)if(y=S[M],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){S.splice(M,1);break t}}y=g.createElement(p),Ns(y,p,c),g.head.appendChild(y);break;case"meta":if(S=YM("meta","content",g).get(p+(c.content||""))){for(M=0;M<S.length;M++)if(y=S[M],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){S.splice(M,1);break t}}y=g.createElement(p),Ns(y,p,c),g.head.appendChild(y);break;default:throw Error(s(468,p))}y[Ts]=r,ys(y),p=y}r.stateNode=p}else KM(g,r.type,r.stateNode);else r.stateNode=XM(g,p,r.memoizedProps);else y!==p?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,p===null?KM(g,r.type,r.stateNode):XM(g,p,r.memoizedProps)):p===null&&r.stateNode!==null&&Ib(r,r.memoizedProps,c.memoizedProps)}break;case 27:nn(o,r),rn(r),p&512&&(as||c===null||Oi(c,c.return)),c!==null&&p&4&&Ib(r,r.memoizedProps,c.memoizedProps);break;case 5:if(nn(o,r),rn(r),p&512&&(as||c===null||Oi(c,c.return)),r.flags&32){g=r.stateNode;try{Dl(g,"")}catch(Te){vt(r,r.return,Te)}}p&4&&r.stateNode!=null&&(g=r.memoizedProps,Ib(r,g,c!==null?c.memoizedProps:g)),p&1024&&(qb=!0);break;case 6:if(nn(o,r),rn(r),p&4){if(r.stateNode===null)throw Error(s(162));p=r.memoizedProps,c=r.stateNode;try{c.nodeValue=p}catch(Te){vt(r,r.return,Te)}}break;case 3:if($p=null,g=vi,vi=Hp(o.containerInfo),nn(o,r),vi=g,rn(r),p&4&&c!==null&&c.memoizedState.isDehydrated)try{uu(o.containerInfo)}catch(Te){vt(r,r.return,Te)}qb&&(qb=!1,K1(r));break;case 4:p=vi,vi=Hp(r.stateNode.containerInfo),nn(o,r),rn(r),vi=p;break;case 12:nn(o,r),rn(r);break;case 31:nn(o,r),rn(r),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,Rp(r,p)));break;case 13:nn(o,r),rn(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Dp=xn()),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,Rp(r,p)));break;case 22:g=r.memoizedState!==null;var U=c!==null&&c.memoizedState!==null,X=Nr,J=as;if(Nr=X||g,as=J||U,nn(o,r),as=J,Nr=X,rn(r),p&8192)e:for(o=r.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||U||Nr||as||qo(r)),c=null,o=r;;){if(o.tag===5||o.tag===26){if(c===null){U=c=o;try{if(y=U.stateNode,g)S=y.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{M=U.stateNode;var ne=U.memoizedProps.style,Y=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;M.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(Te){vt(U,U.return,Te)}}}else if(o.tag===6){if(c===null){U=o;try{U.stateNode.nodeValue=g?"":U.memoizedProps}catch(Te){vt(U,U.return,Te)}}}else if(o.tag===18){if(c===null){U=o;try{var K=U.stateNode;g?zM(K,!0):zM(U.stateNode,!1)}catch(Te){vt(U,U.return,Te)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}p&4&&(p=r.updateQueue,p!==null&&(c=p.retryQueue,c!==null&&(p.retryQueue=null,Rp(r,c))));break;case 19:nn(o,r),rn(r),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,Rp(r,p)));break;case 30:break;case 21:break;default:nn(o,r),rn(r)}}function rn(r){var o=r.flags;if(o&2){try{for(var c,p=r.return;p!==null;){if(k1(p)){c=p;break}p=p.return}if(c==null)throw Error(s(160));switch(c.tag){case 27:var g=c.stateNode,y=kb(r);Ep(r,y,g);break;case 5:var S=c.stateNode;c.flags&32&&(Dl(S,""),c.flags&=-33);var M=kb(r);Ep(r,M,S);break;case 3:case 4:var U=c.stateNode.containerInfo,X=kb(r);Gb(r,X,U);break;default:throw Error(s(161))}}catch(J){vt(r,r.return,J)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function K1(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;K1(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function Cr(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)H1(r,o.alternate,o),o=o.sibling}function qo(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:Ma(4,o,o.return),qo(o);break;case 1:Oi(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&z1(o,o.return,c),qo(o);break;case 27:ah(o.stateNode);case 26:case 5:Oi(o,o.return),qo(o);break;case 22:o.memoizedState===null&&qo(o);break;case 30:qo(o);break;default:qo(o)}r=r.sibling}}function Er(r,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var p=o.alternate,g=r,y=o,S=y.flags;switch(y.tag){case 0:case 11:case 15:Er(g,y,c),Kc(4,y);break;case 1:if(Er(g,y,c),p=y,g=p.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(X){vt(p,p.return,X)}if(p=y,g=p.updateQueue,g!==null){var M=p.stateNode;try{var U=g.shared.hiddenCallbacks;if(U!==null)for(g.shared.hiddenCallbacks=null,g=0;g<U.length;g++)Aw(U[g],M)}catch(X){vt(p,p.return,X)}}c&&S&64&&V1(y),Zc(y,y.return);break;case 27:G1(y);case 26:case 5:Er(g,y,c),c&&p===null&&S&4&&I1(y),Zc(y,y.return);break;case 12:Er(g,y,c);break;case 31:Er(g,y,c),c&&S&4&&W1(g,y);break;case 13:Er(g,y,c),c&&S&4&&X1(g,y);break;case 22:y.memoizedState===null&&Er(g,y,c),Zc(y,y.return);break;case 30:break;default:Er(g,y,c)}o=o.sibling}}function Hb(r,o){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&Oc(c))}function jb(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Oc(r))}function Ti(r,o,c,p){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Z1(r,o,c,p),o=o.sibling}function Z1(r,o,c,p){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Ti(r,o,c,p),g&2048&&Kc(9,o);break;case 1:Ti(r,o,c,p);break;case 3:Ti(r,o,c,p),g&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Oc(r)));break;case 12:if(g&2048){Ti(r,o,c,p),r=o.stateNode;try{var y=o.memoizedProps,S=y.id,M=y.onPostCommit;typeof M=="function"&&M(S,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(U){vt(o,o.return,U)}}else Ti(r,o,c,p);break;case 31:Ti(r,o,c,p);break;case 13:Ti(r,o,c,p);break;case 23:break;case 22:y=o.stateNode,S=o.alternate,o.memoizedState!==null?y._visibility&2?Ti(r,o,c,p):Qc(r,o):y._visibility&2?Ti(r,o,c,p):(y._visibility|=2,Ql(r,o,c,p,(o.subtreeFlags&10256)!==0||!1)),g&2048&&Hb(S,o);break;case 24:Ti(r,o,c,p),g&2048&&jb(o.alternate,o);break;default:Ti(r,o,c,p)}}function Ql(r,o,c,p,g){for(g=g&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var y=r,S=o,M=c,U=p,X=S.flags;switch(S.tag){case 0:case 11:case 15:Ql(y,S,M,U,g),Kc(8,S);break;case 23:break;case 22:var J=S.stateNode;S.memoizedState!==null?J._visibility&2?Ql(y,S,M,U,g):Qc(y,S):(J._visibility|=2,Ql(y,S,M,U,g)),g&&X&2048&&Hb(S.alternate,S);break;case 24:Ql(y,S,M,U,g),g&&X&2048&&jb(S.alternate,S);break;default:Ql(y,S,M,U,g)}o=o.sibling}}function Qc(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=r,p=o,g=p.flags;switch(p.tag){case 22:Qc(c,p),g&2048&&Hb(p.alternate,p);break;case 24:Qc(c,p),g&2048&&jb(p.alternate,p);break;default:Qc(c,p)}o=o.sibling}}var Jc=8192;function Jl(r,o,c){if(r.subtreeFlags&Jc)for(r=r.child;r!==null;)Q1(r,o,c),r=r.sibling}function Q1(r,o,c){switch(r.tag){case 26:Jl(r,o,c),r.flags&Jc&&r.memoizedState!==null&&xF(c,vi,r.memoizedState,r.memoizedProps);break;case 5:Jl(r,o,c);break;case 3:case 4:var p=vi;vi=Hp(r.stateNode.containerInfo),Jl(r,o,c),vi=p;break;case 22:r.memoizedState===null&&(p=r.alternate,p!==null&&p.memoizedState!==null?(p=Jc,Jc=16777216,Jl(r,o,c),Jc=p):Jl(r,o,c));break;default:Jl(r,o,c)}}function J1(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function eh(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var p=o[c];bs=p,tM(p,r)}J1(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)eM(r),r=r.sibling}function eM(r){switch(r.tag){case 0:case 11:case 15:eh(r),r.flags&2048&&Ma(9,r,r.return);break;case 3:eh(r);break;case 12:eh(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,Bp(r)):eh(r);break;default:eh(r)}}function Bp(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var p=o[c];bs=p,tM(p,r)}J1(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:Ma(8,o,o.return),Bp(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,Bp(o));break;default:Bp(o)}r=r.sibling}}function tM(r,o){for(;bs!==null;){var c=bs;switch(c.tag){case 0:case 11:case 15:Ma(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var p=c.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Oc(c.memoizedState.cache)}if(p=c.child,p!==null)p.return=c,bs=p;else e:for(c=r;bs!==null;){p=bs;var g=p.sibling,y=p.return;if(j1(p),p===c){bs=null;break e}if(g!==null){g.return=y,bs=g;break e}bs=y}}}var UU={getCacheForType:function(r){var o=ws(ns),c=o.data.get(r);return c===void 0&&(c=r(),o.data.set(r,c)),c},cacheSignal:function(){return ws(ns).controller.signal}},FU=typeof WeakMap=="function"?WeakMap:Map,ht=0,Ct=null,Xe=null,Qe=0,_t=0,Nn=null,Na=!1,eu=!1,$b=!1,Rr=0,Xt=0,Aa=0,Ho=0,Wb=0,An=0,tu=0,th=null,an=null,Xb=!1,Dp=0,sM=0,Lp=1/0,Up=null,Ca=null,ds=0,Ea=null,su=null,Br=0,Yb=0,Kb=null,nM=null,sh=0,Zb=null;function Cn(){return(ht&2)!==0&&Qe!==0?Qe&-Qe:j.T!==null?n0():xS()}function iM(){if(An===0)if((Qe&536870912)===0||tt){var r=Gd;Gd<<=1,(Gd&3932160)===0&&(Gd=262144),An=r}else An=536870912;return r=wn.current,r!==null&&(r.flags|=32),An}function on(r,o,c){(r===Ct&&(_t===2||_t===9)||r.cancelPendingCommit!==null)&&(nu(r,0),Ra(r,Qe,An,!1)),Sc(r,c),((ht&2)===0||r!==Ct)&&(r===Ct&&((ht&2)===0&&(Ho|=c),Xt===4&&Ra(r,Qe,An,!1)),Vi(r))}function rM(r,o,c){if((ht&6)!==0)throw Error(s(327));var p=!c&&(o&127)===0&&(o&r.expiredLanes)===0||Tc(r,o),g=p?VU(r,o):Jb(r,o,!0),y=p;do{if(g===0){eu&&!p&&Ra(r,o,0,!1);break}else{if(c=r.current.alternate,y&&!PU(c)){g=Jb(r,o,!1),y=!1;continue}if(g===2){if(y=o,r.errorRecoveryDisabledLanes&y)var S=0;else S=r.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){o=S;e:{var M=r;g=th;var U=M.current.memoizedState.isDehydrated;if(U&&(nu(M,S).flags|=256),S=Jb(M,S,!1),S!==2){if($b&&!U){M.errorRecoveryDisabledLanes|=y,Ho|=y,g=4;break e}y=an,an=g,y!==null&&(an===null?an=y:an.push.apply(an,y))}g=S}if(y=!1,g!==2)continue}}if(g===1){nu(r,0),Ra(r,o,0,!0);break}e:{switch(p=r,y=g,y){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:Ra(p,o,An,!Na);break e;case 2:an=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(g=Dp+300-xn(),10<g)){if(Ra(p,o,An,!Na),Hd(p,0,!0)!==0)break e;Br=o,p.timeoutHandle=PM(aM.bind(null,p,c,an,Up,Xb,o,An,Ho,tu,Na,y,"Throttled",-0,0),g);break e}aM(p,c,an,Up,Xb,o,An,Ho,tu,Na,y,null,-0,0)}}break}while(!0);Vi(r)}function aM(r,o,c,p,g,y,S,M,U,X,J,ne,Y,K){if(r.timeoutHandle=-1,ne=o.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:gr},Q1(o,y,ne);var Te=(y&62914560)===y?Dp-xn():(y&4194048)===y?sM-xn():0;if(Te=_F(ne,Te),Te!==null){Br=y,r.cancelPendingCommit=Te(fM.bind(null,r,o,y,c,p,g,S,M,U,J,ne,null,Y,K)),Ra(r,y,S,!X);return}}fM(r,o,y,c,p,g,S,M,U)}function PU(r){for(var o=r;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var p=0;p<c.length;p++){var g=c[p],y=g.getSnapshot;g=g.value;try{if(!Tn(y(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ra(r,o,c,p){o&=~Wb,o&=~Ho,r.suspendedLanes|=o,r.pingedLanes&=~o,p&&(r.warmLanes|=o),p=r.expirationTimes;for(var g=o;0<g;){var y=31-vn(g),S=1<<y;p[y]=-1,g&=~S}c!==0&&gS(r,c,o)}function Fp(){return(ht&6)===0?(nh(0),!1):!0}function Qb(){if(Xe!==null){if(_t===0)var r=Xe.return;else r=Xe,_r=Fo=null,fb(r),Wl=null,zc=0,r=Xe;for(;r!==null;)O1(r.alternate,r),r=r.return;Xe=null}}function nu(r,o){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,sF(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),Br=0,Qb(),Ct=r,Xe=c=br(r.current,null),Qe=o,_t=0,Nn=null,Na=!1,eu=Tc(r,o),$b=!1,tu=An=Wb=Ho=Aa=Xt=0,an=th=null,Xb=!1,(o&8)!==0&&(o|=o&32);var p=r.entangledLanes;if(p!==0)for(r=r.entanglements,p&=o;0<p;){var g=31-vn(p),y=1<<g;o|=r[g],p&=~y}return Rr=o,sp(),c}function oM(r,o){ze=null,j.H=Wc,o===$l||o===cp?(o=Sw(),_t=3):o===sb?(o=Sw(),_t=4):_t=o===Rb?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Nn=o,Xe===null&&(Xt=1,wp(r,Wn(o,r.current)))}function lM(){var r=wn.current;return r===null?!0:(Qe&4194048)===Qe?Zn===null:(Qe&62914560)===Qe||(Qe&536870912)!==0?r===Zn:!1}function uM(){var r=j.H;return j.H=Wc,r===null?Wc:r}function cM(){var r=j.A;return j.A=UU,r}function Pp(){Xt=4,Na||(Qe&4194048)!==Qe&&wn.current!==null||(eu=!0),(Aa&134217727)===0&&(Ho&134217727)===0||Ct===null||Ra(Ct,Qe,An,!1)}function Jb(r,o,c){var p=ht;ht|=2;var g=uM(),y=cM();(Ct!==r||Qe!==o)&&(Up=null,nu(r,o)),o=!1;var S=Xt;e:do try{if(_t!==0&&Xe!==null){var M=Xe,U=Nn;switch(_t){case 8:Qb(),S=6;break e;case 3:case 2:case 9:case 6:wn.current===null&&(o=!0);var X=_t;if(_t=0,Nn=null,iu(r,M,U,X),c&&eu){S=0;break e}break;default:X=_t,_t=0,Nn=null,iu(r,M,U,X)}}OU(),S=Xt;break}catch(J){oM(r,J)}while(!0);return o&&r.shellSuspendCounter++,_r=Fo=null,ht=p,j.H=g,j.A=y,Xe===null&&(Ct=null,Qe=0,sp()),S}function OU(){for(;Xe!==null;)hM(Xe)}function VU(r,o){var c=ht;ht|=2;var p=uM(),g=cM();Ct!==r||Qe!==o?(Up=null,Lp=xn()+500,nu(r,o)):eu=Tc(r,o);e:do try{if(_t!==0&&Xe!==null){o=Xe;var y=Nn;t:switch(_t){case 1:_t=0,Nn=null,iu(r,o,y,1);break;case 2:case 9:if(vw(y)){_t=0,Nn=null,dM(o);break}o=function(){_t!==2&&_t!==9||Ct!==r||(_t=7),Vi(r)},y.then(o,o);break e;case 3:_t=7;break e;case 4:_t=5;break e;case 7:vw(y)?(_t=0,Nn=null,dM(o)):(_t=0,Nn=null,iu(r,o,y,7));break;case 5:var S=null;switch(Xe.tag){case 26:S=Xe.memoizedState;case 5:case 27:var M=Xe;if(S?ZM(S):M.stateNode.complete){_t=0,Nn=null;var U=M.sibling;if(U!==null)Xe=U;else{var X=M.return;X!==null?(Xe=X,Op(X)):Xe=null}break t}}_t=0,Nn=null,iu(r,o,y,5);break;case 6:_t=0,Nn=null,iu(r,o,y,6);break;case 8:Qb(),Xt=6;break e;default:throw Error(s(462))}}zU();break}catch(J){oM(r,J)}while(!0);return _r=Fo=null,j.H=p,j.A=g,ht=c,Xe!==null?0:(Ct=null,Qe=0,sp(),Xt)}function zU(){for(;Xe!==null&&!lL();)hM(Xe)}function hM(r){var o=F1(r.alternate,r,Rr);r.memoizedProps=r.pendingProps,o===null?Op(r):Xe=o}function dM(r){var o=r,c=o.alternate;switch(o.tag){case 15:case 0:o=E1(c,o,o.pendingProps,o.type,void 0,Qe);break;case 11:o=E1(c,o,o.pendingProps,o.type.render,o.ref,Qe);break;case 5:fb(o);default:O1(c,o),o=Xe=cw(o,Rr),o=F1(c,o,Rr)}r.memoizedProps=r.pendingProps,o===null?Op(r):Xe=o}function iu(r,o,c,p){_r=Fo=null,fb(o),Wl=null,zc=0;var g=o.return;try{if(AU(r,g,o,c,Qe)){Xt=1,wp(r,Wn(c,r.current)),Xe=null;return}}catch(y){if(g!==null)throw Xe=g,y;Xt=1,wp(r,Wn(c,r.current)),Xe=null;return}o.flags&32768?(tt||p===1?r=!0:eu||(Qe&536870912)!==0?r=!1:(Na=r=!0,(p===2||p===9||p===3||p===6)&&(p=wn.current,p!==null&&p.tag===13&&(p.flags|=16384))),pM(o,r)):Op(o)}function Op(r){var o=r;do{if((o.flags&32768)!==0){pM(o,Na);return}r=o.return;var c=RU(o.alternate,o,Rr);if(c!==null){Xe=c;return}if(o=o.sibling,o!==null){Xe=o;return}Xe=o=r}while(o!==null);Xt===0&&(Xt=5)}function pM(r,o){do{var c=BU(r.alternate,r);if(c!==null){c.flags&=32767,Xe=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(r=r.sibling,r!==null)){Xe=r;return}Xe=r=c}while(r!==null);Xt=6,Xe=null}function fM(r,o,c,p,g,y,S,M,U){r.cancelPendingCommit=null;do Vp();while(ds!==0);if((ht&6)!==0)throw Error(s(327));if(o!==null){if(o===r.current)throw Error(s(177));if(y=o.lanes|o.childLanes,y|=ky,bL(r,c,y,S,M,U),r===Ct&&(Xe=Ct=null,Qe=0),su=o,Ea=r,Br=c,Yb=y,Kb=g,nM=p,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,qU(Id,function(){return xM(),null})):(r.callbackNode=null,r.callbackPriority=0),p=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||p){p=j.T,j.T=null,g=oe.p,oe.p=2,S=ht,ht|=4;try{DU(r,o,c)}finally{ht=S,oe.p=g,j.T=p}}ds=1,mM(),gM(),yM()}}function mM(){if(ds===1){ds=0;var r=Ea,o=su,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=j.T,j.T=null;var p=oe.p;oe.p=2;var g=ht;ht|=4;try{Y1(o,r);var y=h0,S=tw(r.containerInfo),M=y.focusedElem,U=y.selectionRange;if(S!==M&&M&&M.ownerDocument&&ew(M.ownerDocument.documentElement,M)){if(U!==null&&Py(M)){var X=U.start,J=U.end;if(J===void 0&&(J=X),"selectionStart"in M)M.selectionStart=X,M.selectionEnd=Math.min(J,M.value.length);else{var ne=M.ownerDocument||document,Y=ne&&ne.defaultView||window;if(Y.getSelection){var K=Y.getSelection(),Te=M.textContent.length,Le=Math.min(U.start,Te),Mt=U.end===void 0?Le:Math.min(U.end,Te);!K.extend&&Le>Mt&&(S=Mt,Mt=Le,Le=S);var G=JS(M,Le),V=JS(M,Mt);if(G&&V&&(K.rangeCount!==1||K.anchorNode!==G.node||K.anchorOffset!==G.offset||K.focusNode!==V.node||K.focusOffset!==V.offset)){var W=ne.createRange();W.setStart(G.node,G.offset),K.removeAllRanges(),Le>Mt?(K.addRange(W),K.extend(V.node,V.offset)):(W.setEnd(V.node,V.offset),K.addRange(W))}}}}for(ne=[],K=M;K=K.parentNode;)K.nodeType===1&&ne.push({element:K,left:K.scrollLeft,top:K.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<ne.length;M++){var te=ne[M];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}Kp=!!c0,h0=c0=null}finally{ht=g,oe.p=p,j.T=c}}r.current=o,ds=2}}function gM(){if(ds===2){ds=0;var r=Ea,o=su,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=j.T,j.T=null;var p=oe.p;oe.p=2;var g=ht;ht|=4;try{H1(r,o.alternate,o)}finally{ht=g,oe.p=p,j.T=c}}ds=3}}function yM(){if(ds===4||ds===3){ds=0,uL();var r=Ea,o=su,c=Br,p=nM;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?ds=5:(ds=0,su=Ea=null,bM(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Ca=null),yy(c),o=o.stateNode,_n&&typeof _n.onCommitFiberRoot=="function")try{_n.onCommitFiberRoot(vc,o,void 0,(o.current.flags&128)===128)}catch{}if(p!==null){o=j.T,g=oe.p,oe.p=2,j.T=null;try{for(var y=r.onRecoverableError,S=0;S<p.length;S++){var M=p[S];y(M.value,{componentStack:M.stack})}}finally{j.T=o,oe.p=g}}(Br&3)!==0&&Vp(),Vi(r),g=r.pendingLanes,(c&261930)!==0&&(g&42)!==0?r===Zb?sh++:(sh=0,Zb=r):sh=0,nh(0)}}function bM(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Oc(o)))}function Vp(){return mM(),gM(),yM(),xM()}function xM(){if(ds!==5)return!1;var r=Ea,o=Yb;Yb=0;var c=yy(Br),p=j.T,g=oe.p;try{oe.p=32>c?32:c,j.T=null,c=Kb,Kb=null;var y=Ea,S=Br;if(ds=0,su=Ea=null,Br=0,(ht&6)!==0)throw Error(s(331));var M=ht;if(ht|=4,eM(y.current),Z1(y,y.current,S,c),ht=M,nh(0,!1),_n&&typeof _n.onPostCommitFiberRoot=="function")try{_n.onPostCommitFiberRoot(vc,y)}catch{}return!0}finally{oe.p=g,j.T=p,bM(r,o)}}function _M(r,o,c){o=Wn(c,o),o=Eb(r.stateNode,o,2),r=Ta(r,o,2),r!==null&&(Sc(r,2),Vi(r))}function vt(r,o,c){if(r.tag===3)_M(r,r,c);else for(;o!==null;){if(o.tag===3){_M(o,r,c);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Ca===null||!Ca.has(p))){r=Wn(c,r),c=v1(2),p=Ta(o,c,2),p!==null&&(T1(c,p,o,r),Sc(p,2),Vi(p));break}}o=o.return}}function e0(r,o,c){var p=r.pingCache;if(p===null){p=r.pingCache=new FU;var g=new Set;p.set(o,g)}else g=p.get(o),g===void 0&&(g=new Set,p.set(o,g));g.has(c)||($b=!0,g.add(c),r=IU.bind(null,r,o,c),o.then(r,r))}function IU(r,o,c){var p=r.pingCache;p!==null&&p.delete(o),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Ct===r&&(Qe&c)===c&&(Xt===4||Xt===3&&(Qe&62914560)===Qe&&300>xn()-Dp?(ht&2)===0&&nu(r,0):Wb|=c,tu===Qe&&(tu=0)),Vi(r)}function vM(r,o){o===0&&(o=mS()),r=Do(r,o),r!==null&&(Sc(r,o),Vi(r))}function kU(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),vM(r,c)}function GU(r,o){var c=0;switch(r.tag){case 31:case 13:var p=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:p=r.stateNode;break;case 22:p=r.stateNode._retryCache;break;default:throw Error(s(314))}p!==null&&p.delete(o),vM(r,c)}function qU(r,o){return py(r,o)}var zp=null,ru=null,t0=!1,Ip=!1,s0=!1,Ba=0;function Vi(r){r!==ru&&r.next===null&&(ru===null?zp=ru=r:ru=ru.next=r),Ip=!0,t0||(t0=!0,jU())}function nh(r,o){if(!s0&&Ip){s0=!0;do for(var c=!1,p=zp;p!==null;){if(r!==0){var g=p.pendingLanes;if(g===0)var y=0;else{var S=p.suspendedLanes,M=p.pingedLanes;y=(1<<31-vn(42|r)+1)-1,y&=g&~(S&~M),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,MM(p,y))}else y=Qe,y=Hd(p,p===Ct?y:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(y&3)===0||Tc(p,y)||(c=!0,MM(p,y));p=p.next}while(c);s0=!1}}function HU(){TM()}function TM(){Ip=t0=!1;var r=0;Ba!==0&&tF()&&(r=Ba);for(var o=xn(),c=null,p=zp;p!==null;){var g=p.next,y=SM(p,o);y===0?(p.next=null,c===null?zp=g:c.next=g,g===null&&(ru=c)):(c=p,(r!==0||(y&3)!==0)&&(Ip=!0)),p=g}ds!==0&&ds!==5||nh(r),Ba!==0&&(Ba=0)}function SM(r,o){for(var c=r.suspendedLanes,p=r.pingedLanes,g=r.expirationTimes,y=r.pendingLanes&-62914561;0<y;){var S=31-vn(y),M=1<<S,U=g[S];U===-1?((M&c)===0||(M&p)!==0)&&(g[S]=yL(M,o)):U<=o&&(r.expiredLanes|=M),y&=~M}if(o=Ct,c=Qe,c=Hd(r,r===o?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),p=r.callbackNode,c===0||r===o&&(_t===2||_t===9)||r.cancelPendingCommit!==null)return p!==null&&p!==null&&fy(p),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Tc(r,c)){if(o=c&-c,o===r.callbackPriority)return o;switch(p!==null&&fy(p),yy(c)){case 2:case 8:c=pS;break;case 32:c=Id;break;case 268435456:c=fS;break;default:c=Id}return p=wM.bind(null,r),c=py(c,p),r.callbackPriority=o,r.callbackNode=c,o}return p!==null&&p!==null&&fy(p),r.callbackPriority=2,r.callbackNode=null,2}function wM(r,o){if(ds!==0&&ds!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Vp()&&r.callbackNode!==c)return null;var p=Qe;return p=Hd(r,r===Ct?p:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),p===0?null:(rM(r,p,o),SM(r,xn()),r.callbackNode!=null&&r.callbackNode===c?wM.bind(null,r):null)}function MM(r,o){if(Vp())return null;rM(r,o,!0)}function jU(){nF(function(){(ht&6)!==0?py(dS,HU):TM()})}function n0(){if(Ba===0){var r=Hl;r===0&&(r=kd,kd<<=1,(kd&261888)===0&&(kd=256)),Ba=r}return Ba}function NM(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Xd(""+r)}function AM(r,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,r.id&&c.setAttribute("form",r.id),o.parentNode.insertBefore(c,o),r=new FormData(r),c.parentNode.removeChild(c),r}function $U(r,o,c,p,g){if(o==="submit"&&c&&c.stateNode===g){var y=NM((g[en]||null).action),S=p.submitter;S&&(o=(o=S[en]||null)?NM(o.formAction):S.getAttribute("formAction"),o!==null&&(y=o,S=null));var M=new Qd("action","action",null,p,g);r.push({event:M,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ba!==0){var U=S?AM(g,S):new FormData(g);Sb(c,{pending:!0,data:U,method:g.method,action:y},null,U)}}else typeof y=="function"&&(M.preventDefault(),U=S?AM(g,S):new FormData(g),Sb(c,{pending:!0,data:U,method:g.method,action:y},y,U))},currentTarget:g}]})}}for(var i0=0;i0<Iy.length;i0++){var r0=Iy[i0],WU=r0.toLowerCase(),XU=r0[0].toUpperCase()+r0.slice(1);_i(WU,"on"+XU)}_i(iw,"onAnimationEnd"),_i(rw,"onAnimationIteration"),_i(aw,"onAnimationStart"),_i("dblclick","onDoubleClick"),_i("focusin","onFocus"),_i("focusout","onBlur"),_i(cU,"onTransitionRun"),_i(hU,"onTransitionStart"),_i(dU,"onTransitionCancel"),_i(ow,"onTransitionEnd"),Rl("onMouseEnter",["mouseout","mouseover"]),Rl("onMouseLeave",["mouseout","mouseover"]),Rl("onPointerEnter",["pointerout","pointerover"]),Rl("onPointerLeave",["pointerout","pointerover"]),Co("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Co("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Co("onBeforeInput",["compositionend","keypress","textInput","paste"]),Co("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Co("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Co("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YU=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ih));function CM(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var p=r[c],g=p.event;p=p.listeners;e:{var y=void 0;if(o)for(var S=p.length-1;0<=S;S--){var M=p[S],U=M.instance,X=M.currentTarget;if(M=M.listener,U!==y&&g.isPropagationStopped())break e;y=M,g.currentTarget=X;try{y(g)}catch(J){tp(J)}g.currentTarget=null,y=U}else for(S=0;S<p.length;S++){if(M=p[S],U=M.instance,X=M.currentTarget,M=M.listener,U!==y&&g.isPropagationStopped())break e;y=M,g.currentTarget=X;try{y(g)}catch(J){tp(J)}g.currentTarget=null,y=U}}}}function Ye(r,o){var c=o[by];c===void 0&&(c=o[by]=new Set);var p=r+"__bubble";c.has(p)||(EM(o,r,2,!1),c.add(p))}function a0(r,o,c){var p=0;o&&(p|=4),EM(c,r,p,o)}var kp="_reactListening"+Math.random().toString(36).slice(2);function o0(r){if(!r[kp]){r[kp]=!0,TS.forEach(function(c){c!=="selectionchange"&&(YU.has(c)||a0(c,!1,r),a0(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[kp]||(o[kp]=!0,a0("selectionchange",!1,o))}}function EM(r,o,c,p){switch(iN(o)){case 2:var g=SF;break;case 8:g=wF;break;default:g=T0}c=g.bind(null,o,c,r),g=void 0,!Ay||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),p?g!==void 0?r.addEventListener(o,c,{capture:!0,passive:g}):r.addEventListener(o,c,!0):g!==void 0?r.addEventListener(o,c,{passive:g}):r.addEventListener(o,c,!1)}function l0(r,o,c,p,g){var y=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var S=p.tag;if(S===3||S===4){var M=p.stateNode.containerInfo;if(M===g)break;if(S===4)for(S=p.return;S!==null;){var U=S.tag;if((U===3||U===4)&&S.stateNode.containerInfo===g)return;S=S.return}for(;M!==null;){if(S=Al(M),S===null)return;if(U=S.tag,U===5||U===6||U===26||U===27){p=y=S;continue e}M=M.parentNode}}p=p.return}US(function(){var X=y,J=My(c),ne=[];e:{var Y=lw.get(r);if(Y!==void 0){var K=Qd,Te=r;switch(r){case"keypress":if(Kd(c)===0)break e;case"keydown":case"keyup":K=GL;break;case"focusin":Te="focus",K=By;break;case"focusout":Te="blur",K=By;break;case"beforeblur":case"afterblur":K=By;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":K=OS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":K=RL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":K=jL;break;case iw:case rw:case aw:K=LL;break;case ow:K=WL;break;case"scroll":case"scrollend":K=CL;break;case"wheel":K=YL;break;case"copy":case"cut":case"paste":K=FL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":K=zS;break;case"toggle":case"beforetoggle":K=ZL}var Le=(o&4)!==0,Mt=!Le&&(r==="scroll"||r==="scrollend"),G=Le?Y!==null?Y+"Capture":null:Y;Le=[];for(var V=X,W;V!==null;){var te=V;if(W=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||W===null||G===null||(te=Nc(V,G),te!=null&&Le.push(rh(V,te,W))),Mt)break;V=V.return}0<Le.length&&(Y=new K(Y,Te,null,c,J),ne.push({event:Y,listeners:Le}))}}if((o&7)===0){e:{if(Y=r==="mouseover"||r==="pointerover",K=r==="mouseout"||r==="pointerout",Y&&c!==wy&&(Te=c.relatedTarget||c.fromElement)&&(Al(Te)||Te[Nl]))break e;if((K||Y)&&(Y=J.window===J?J:(Y=J.ownerDocument)?Y.defaultView||Y.parentWindow:window,K?(Te=c.relatedTarget||c.toElement,K=X,Te=Te?Al(Te):null,Te!==null&&(Mt=a(Te),Le=Te.tag,Te!==Mt||Le!==5&&Le!==27&&Le!==6)&&(Te=null)):(K=null,Te=X),K!==Te)){if(Le=OS,te="onMouseLeave",G="onMouseEnter",V="mouse",(r==="pointerout"||r==="pointerover")&&(Le=zS,te="onPointerLeave",G="onPointerEnter",V="pointer"),Mt=K==null?Y:Mc(K),W=Te==null?Y:Mc(Te),Y=new Le(te,V+"leave",K,c,J),Y.target=Mt,Y.relatedTarget=W,te=null,Al(J)===X&&(Le=new Le(G,V+"enter",Te,c,J),Le.target=W,Le.relatedTarget=Mt,te=Le),Mt=te,K&&Te)t:{for(Le=KU,G=K,V=Te,W=0,te=G;te;te=Le(te))W++;te=0;for(var Ee=V;Ee;Ee=Le(Ee))te++;for(;0<W-te;)G=Le(G),W--;for(;0<te-W;)V=Le(V),te--;for(;W--;){if(G===V||V!==null&&G===V.alternate){Le=G;break t}G=Le(G),V=Le(V)}Le=null}else Le=null;K!==null&&RM(ne,Y,K,Le,!1),Te!==null&&Mt!==null&&RM(ne,Mt,Te,Le,!0)}}e:{if(Y=X?Mc(X):window,K=Y.nodeName&&Y.nodeName.toLowerCase(),K==="select"||K==="input"&&Y.type==="file")var lt=WS;else if(jS(Y))if(XS)lt=oU;else{lt=rU;var Ae=iU}else K=Y.nodeName,!K||K.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?X&&Sy(X.elementType)&&(lt=WS):lt=aU;if(lt&&(lt=lt(r,X))){$S(ne,lt,c,J);break e}Ae&&Ae(r,Y,X),r==="focusout"&&X&&Y.type==="number"&&X.memoizedProps.value!=null&&Ty(Y,"number",Y.value)}switch(Ae=X?Mc(X):window,r){case"focusin":(jS(Ae)||Ae.contentEditable==="true")&&(Pl=Ae,Oy=X,Uc=null);break;case"focusout":Uc=Oy=Pl=null;break;case"mousedown":Vy=!0;break;case"contextmenu":case"mouseup":case"dragend":Vy=!1,sw(ne,c,J);break;case"selectionchange":if(uU)break;case"keydown":case"keyup":sw(ne,c,J)}var ke;if(Ly)e:{switch(r){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Fl?qS(r,c)&&(Je="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Je="onCompositionStart");Je&&(IS&&c.locale!=="ko"&&(Fl||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Fl&&(ke=FS()):(ma=J,Cy="value"in ma?ma.value:ma.textContent,Fl=!0)),Ae=Gp(X,Je),0<Ae.length&&(Je=new VS(Je,r,null,c,J),ne.push({event:Je,listeners:Ae}),ke?Je.data=ke:(ke=HS(c),ke!==null&&(Je.data=ke)))),(ke=JL?eU(r,c):tU(r,c))&&(Je=Gp(X,"onBeforeInput"),0<Je.length&&(Ae=new VS("onBeforeInput","beforeinput",null,c,J),ne.push({event:Ae,listeners:Je}),Ae.data=ke)),$U(ne,r,X,c,J)}CM(ne,o)})}function rh(r,o,c){return{instance:r,listener:o,currentTarget:c}}function Gp(r,o){for(var c=o+"Capture",p=[];r!==null;){var g=r,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=Nc(r,c),g!=null&&p.unshift(rh(r,g,y)),g=Nc(r,o),g!=null&&p.push(rh(r,g,y))),r.tag===3)return p;r=r.return}return[]}function KU(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function RM(r,o,c,p,g){for(var y=o._reactName,S=[];c!==null&&c!==p;){var M=c,U=M.alternate,X=M.stateNode;if(M=M.tag,U!==null&&U===p)break;M!==5&&M!==26&&M!==27||X===null||(U=X,g?(X=Nc(c,y),X!=null&&S.unshift(rh(c,X,U))):g||(X=Nc(c,y),X!=null&&S.push(rh(c,X,U)))),c=c.return}S.length!==0&&r.push({event:o,listeners:S})}var ZU=/\r\n?/g,QU=/\u0000|\uFFFD/g;function BM(r){return(typeof r=="string"?r:""+r).replace(ZU,`
`).replace(QU,"")}function DM(r,o){return o=BM(o),BM(r)===o}function wt(r,o,c,p,g,y){switch(c){case"children":typeof p=="string"?o==="body"||o==="textarea"&&p===""||Dl(r,p):(typeof p=="number"||typeof p=="bigint")&&o!=="body"&&Dl(r,""+p);break;case"className":$d(r,"class",p);break;case"tabIndex":$d(r,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":$d(r,c,p);break;case"style":DS(r,p,y);break;case"data":if(o!=="object"){$d(r,"data",p);break}case"src":case"href":if(p===""&&(o!=="a"||c!=="href")){r.removeAttribute(c);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){r.removeAttribute(c);break}p=Xd(""+p),r.setAttribute(c,p);break;case"action":case"formAction":if(typeof p=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(o!=="input"&&wt(r,o,"name",g.name,g,null),wt(r,o,"formEncType",g.formEncType,g,null),wt(r,o,"formMethod",g.formMethod,g,null),wt(r,o,"formTarget",g.formTarget,g,null)):(wt(r,o,"encType",g.encType,g,null),wt(r,o,"method",g.method,g,null),wt(r,o,"target",g.target,g,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){r.removeAttribute(c);break}p=Xd(""+p),r.setAttribute(c,p);break;case"onClick":p!=null&&(r.onclick=gr);break;case"onScroll":p!=null&&Ye("scroll",r);break;case"onScrollEnd":p!=null&&Ye("scrollend",r);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(c=p.__html,c!=null){if(g.children!=null)throw Error(s(60));r.innerHTML=c}}break;case"multiple":r.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":r.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){r.removeAttribute("xlink:href");break}c=Xd(""+p),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(c,""+p):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":p===!0?r.setAttribute(c,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(c,p):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?r.setAttribute(c,p):r.removeAttribute(c);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?r.removeAttribute(c):r.setAttribute(c,p);break;case"popover":Ye("beforetoggle",r),Ye("toggle",r),jd(r,"popover",p);break;case"xlinkActuate":mr(r,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":mr(r,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":mr(r,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":mr(r,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":mr(r,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":mr(r,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":mr(r,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":mr(r,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":mr(r,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":jd(r,"is",p);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=NL.get(c)||c,jd(r,c,p))}}function u0(r,o,c,p,g,y){switch(c){case"style":DS(r,p,y);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(c=p.__html,c!=null){if(g.children!=null)throw Error(s(60));r.innerHTML=c}}break;case"children":typeof p=="string"?Dl(r,p):(typeof p=="number"||typeof p=="bigint")&&Dl(r,""+p);break;case"onScroll":p!=null&&Ye("scroll",r);break;case"onScrollEnd":p!=null&&Ye("scrollend",r);break;case"onClick":p!=null&&(r.onclick=gr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!SS.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),y=r[en]||null,y=y!=null?y[c]:null,typeof y=="function"&&r.removeEventListener(o,y,g),typeof p=="function")){typeof y!="function"&&y!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(o,p,g);break e}c in r?r[c]=p:p===!0?r.setAttribute(c,""):jd(r,c,p)}}}function Ns(r,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ye("error",r),Ye("load",r);var p=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var S=c[y];if(S!=null)switch(y){case"src":p=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:wt(r,o,y,S,c,null)}}g&&wt(r,o,"srcSet",c.srcSet,c,null),p&&wt(r,o,"src",c.src,c,null);return;case"input":Ye("invalid",r);var M=y=S=g=null,U=null,X=null;for(p in c)if(c.hasOwnProperty(p)){var J=c[p];if(J!=null)switch(p){case"name":g=J;break;case"type":S=J;break;case"checked":U=J;break;case"defaultChecked":X=J;break;case"value":y=J;break;case"defaultValue":M=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(s(137,o));break;default:wt(r,o,p,J,c,null)}}CS(r,y,M,U,X,S,g,!1);return;case"select":Ye("invalid",r),p=S=y=null;for(g in c)if(c.hasOwnProperty(g)&&(M=c[g],M!=null))switch(g){case"value":y=M;break;case"defaultValue":S=M;break;case"multiple":p=M;default:wt(r,o,g,M,c,null)}o=y,c=S,r.multiple=!!p,o!=null?Bl(r,!!p,o,!1):c!=null&&Bl(r,!!p,c,!0);return;case"textarea":Ye("invalid",r),y=g=p=null;for(S in c)if(c.hasOwnProperty(S)&&(M=c[S],M!=null))switch(S){case"value":p=M;break;case"defaultValue":g=M;break;case"children":y=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(s(91));break;default:wt(r,o,S,M,c,null)}RS(r,p,g,y);return;case"option":for(U in c)c.hasOwnProperty(U)&&(p=c[U],p!=null)&&(U==="selected"?r.selected=p&&typeof p!="function"&&typeof p!="symbol":wt(r,o,U,p,c,null));return;case"dialog":Ye("beforetoggle",r),Ye("toggle",r),Ye("cancel",r),Ye("close",r);break;case"iframe":case"object":Ye("load",r);break;case"video":case"audio":for(p=0;p<ih.length;p++)Ye(ih[p],r);break;case"image":Ye("error",r),Ye("load",r);break;case"details":Ye("toggle",r);break;case"embed":case"source":case"link":Ye("error",r),Ye("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(X in c)if(c.hasOwnProperty(X)&&(p=c[X],p!=null))switch(X){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:wt(r,o,X,p,c,null)}return;default:if(Sy(o)){for(J in c)c.hasOwnProperty(J)&&(p=c[J],p!==void 0&&u0(r,o,J,p,c,void 0));return}}for(M in c)c.hasOwnProperty(M)&&(p=c[M],p!=null&&wt(r,o,M,p,c,null))}function JU(r,o,c,p){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,S=null,M=null,U=null,X=null,J=null;for(K in c){var ne=c[K];if(c.hasOwnProperty(K)&&ne!=null)switch(K){case"checked":break;case"value":break;case"defaultValue":U=ne;default:p.hasOwnProperty(K)||wt(r,o,K,null,p,ne)}}for(var Y in p){var K=p[Y];if(ne=c[Y],p.hasOwnProperty(Y)&&(K!=null||ne!=null))switch(Y){case"type":y=K;break;case"name":g=K;break;case"checked":X=K;break;case"defaultChecked":J=K;break;case"value":S=K;break;case"defaultValue":M=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(s(137,o));break;default:K!==ne&&wt(r,o,Y,K,p,ne)}}vy(r,S,M,U,X,J,y,g);return;case"select":K=S=M=Y=null;for(y in c)if(U=c[y],c.hasOwnProperty(y)&&U!=null)switch(y){case"value":break;case"multiple":K=U;default:p.hasOwnProperty(y)||wt(r,o,y,null,p,U)}for(g in p)if(y=p[g],U=c[g],p.hasOwnProperty(g)&&(y!=null||U!=null))switch(g){case"value":Y=y;break;case"defaultValue":M=y;break;case"multiple":S=y;default:y!==U&&wt(r,o,g,y,p,U)}o=M,c=S,p=K,Y!=null?Bl(r,!!c,Y,!1):!!p!=!!c&&(o!=null?Bl(r,!!c,o,!0):Bl(r,!!c,c?[]:"",!1));return;case"textarea":K=Y=null;for(M in c)if(g=c[M],c.hasOwnProperty(M)&&g!=null&&!p.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:wt(r,o,M,null,p,g)}for(S in p)if(g=p[S],y=c[S],p.hasOwnProperty(S)&&(g!=null||y!=null))switch(S){case"value":Y=g;break;case"defaultValue":K=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(s(91));break;default:g!==y&&wt(r,o,S,g,p,y)}ES(r,Y,K);return;case"option":for(var Te in c)Y=c[Te],c.hasOwnProperty(Te)&&Y!=null&&!p.hasOwnProperty(Te)&&(Te==="selected"?r.selected=!1:wt(r,o,Te,null,p,Y));for(U in p)Y=p[U],K=c[U],p.hasOwnProperty(U)&&Y!==K&&(Y!=null||K!=null)&&(U==="selected"?r.selected=Y&&typeof Y!="function"&&typeof Y!="symbol":wt(r,o,U,Y,p,K));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Le in c)Y=c[Le],c.hasOwnProperty(Le)&&Y!=null&&!p.hasOwnProperty(Le)&&wt(r,o,Le,null,p,Y);for(X in p)if(Y=p[X],K=c[X],p.hasOwnProperty(X)&&Y!==K&&(Y!=null||K!=null))switch(X){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,o));break;default:wt(r,o,X,Y,p,K)}return;default:if(Sy(o)){for(var Mt in c)Y=c[Mt],c.hasOwnProperty(Mt)&&Y!==void 0&&!p.hasOwnProperty(Mt)&&u0(r,o,Mt,void 0,p,Y);for(J in p)Y=p[J],K=c[J],!p.hasOwnProperty(J)||Y===K||Y===void 0&&K===void 0||u0(r,o,J,Y,p,K);return}}for(var G in c)Y=c[G],c.hasOwnProperty(G)&&Y!=null&&!p.hasOwnProperty(G)&&wt(r,o,G,null,p,Y);for(ne in p)Y=p[ne],K=c[ne],!p.hasOwnProperty(ne)||Y===K||Y==null&&K==null||wt(r,o,ne,Y,p,K)}function LM(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function eF(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,c=performance.getEntriesByType("resource"),p=0;p<c.length;p++){var g=c[p],y=g.transferSize,S=g.initiatorType,M=g.duration;if(y&&M&&LM(S)){for(S=0,M=g.responseEnd,p+=1;p<c.length;p++){var U=c[p],X=U.startTime;if(X>M)break;var J=U.transferSize,ne=U.initiatorType;J&&LM(ne)&&(U=U.responseEnd,S+=J*(U<M?1:(M-X)/(U-X)))}if(--p,o+=8*(y+S)/(g.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var c0=null,h0=null;function qp(r){return r.nodeType===9?r:r.ownerDocument}function UM(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function FM(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function d0(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var p0=null;function tF(){var r=window.event;return r&&r.type==="popstate"?r===p0?!1:(p0=r,!0):(p0=null,!1)}var PM=typeof setTimeout=="function"?setTimeout:void 0,sF=typeof clearTimeout=="function"?clearTimeout:void 0,OM=typeof Promise=="function"?Promise:void 0,nF=typeof queueMicrotask=="function"?queueMicrotask:typeof OM<"u"?function(r){return OM.resolve(null).then(r).catch(iF)}:PM;function iF(r){setTimeout(function(){throw r})}function Da(r){return r==="head"}function VM(r,o){var c=o,p=0;do{var g=c.nextSibling;if(r.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"||c==="/&"){if(p===0){r.removeChild(g),uu(o);return}p--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")p++;else if(c==="html")ah(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,ah(c);for(var y=c.firstChild;y;){var S=y.nextSibling,M=y.nodeName;y[wc]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&y.rel.toLowerCase()==="stylesheet"||c.removeChild(y),y=S}}else c==="body"&&ah(r.ownerDocument.body);c=g}while(c);uu(o)}function zM(r,o){var c=r;r=0;do{var p=c.nextSibling;if(c.nodeType===1?o?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(o?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),p&&p.nodeType===8)if(c=p.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=p}while(c)}function f0(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":f0(c),xy(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function rF(r,o,c,p){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!p&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(p){if(!r[wc])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(y=r.getAttribute("rel"),y==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(y!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(y=r.getAttribute("src"),(y!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===y)return r}else return r;if(r=Qn(r.nextSibling),r===null)break}return null}function aF(r,o,c){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=Qn(r.nextSibling),r===null))return null;return r}function IM(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=Qn(r.nextSibling),r===null))return null;return r}function m0(r){return r.data==="$?"||r.data==="$~"}function g0(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function oF(r,o){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||c.readyState!=="loading")o();else{var p=function(){o(),c.removeEventListener("DOMContentLoaded",p)};c.addEventListener("DOMContentLoaded",p),r._reactRetry=p}}function Qn(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var y0=null;function kM(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(o===0)return Qn(r.nextSibling);o--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||o++}r=r.nextSibling}return null}function GM(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(o===0)return r;o--}else c!=="/$"&&c!=="/&"||o++}r=r.previousSibling}return null}function qM(r,o,c){switch(o=qp(c),r){case"html":if(r=o.documentElement,!r)throw Error(s(452));return r;case"head":if(r=o.head,!r)throw Error(s(453));return r;case"body":if(r=o.body,!r)throw Error(s(454));return r;default:throw Error(s(451))}}function ah(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);xy(r)}var Jn=new Map,HM=new Set;function Hp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Dr=oe.d;oe.d={f:lF,r:uF,D:cF,C:hF,L:dF,m:pF,X:mF,S:fF,M:gF};function lF(){var r=Dr.f(),o=Fp();return r||o}function uF(r){var o=Cl(r);o!==null&&o.tag===5&&o.type==="form"?o1(o):Dr.r(r)}var au=typeof document>"u"?null:document;function jM(r,o,c){var p=au;if(p&&typeof o=="string"&&o){var g=jn(o);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),HM.has(g)||(HM.add(g),r={rel:r,crossOrigin:c,href:o},p.querySelector(g)===null&&(o=p.createElement("link"),Ns(o,"link",r),ys(o),p.head.appendChild(o)))}}function cF(r){Dr.D(r),jM("dns-prefetch",r,null)}function hF(r,o){Dr.C(r,o),jM("preconnect",r,o)}function dF(r,o,c){Dr.L(r,o,c);var p=au;if(p&&r&&o){var g='link[rel="preload"][as="'+jn(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+jn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+jn(c.imageSizes)+'"]')):g+='[href="'+jn(r)+'"]';var y=g;switch(o){case"style":y=ou(r);break;case"script":y=lu(r)}Jn.has(y)||(r=m({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:r,as:o},c),Jn.set(y,r),p.querySelector(g)!==null||o==="style"&&p.querySelector(oh(y))||o==="script"&&p.querySelector(lh(y))||(o=p.createElement("link"),Ns(o,"link",r),ys(o),p.head.appendChild(o)))}}function pF(r,o){Dr.m(r,o);var c=au;if(c&&r){var p=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+jn(p)+'"][href="'+jn(r)+'"]',y=g;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=lu(r)}if(!Jn.has(y)&&(r=m({rel:"modulepreload",href:r},o),Jn.set(y,r),c.querySelector(g)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(lh(y)))return}p=c.createElement("link"),Ns(p,"link",r),ys(p),c.head.appendChild(p)}}}function fF(r,o,c){Dr.S(r,o,c);var p=au;if(p&&r){var g=El(p).hoistableStyles,y=ou(r);o=o||"default";var S=g.get(y);if(!S){var M={loading:0,preload:null};if(S=p.querySelector(oh(y)))M.loading=5;else{r=m({rel:"stylesheet",href:r,"data-precedence":o},c),(c=Jn.get(y))&&b0(r,c);var U=S=p.createElement("link");ys(U),Ns(U,"link",r),U._p=new Promise(function(X,J){U.onload=X,U.onerror=J}),U.addEventListener("load",function(){M.loading|=1}),U.addEventListener("error",function(){M.loading|=2}),M.loading|=4,jp(S,o,p)}S={type:"stylesheet",instance:S,count:1,state:M},g.set(y,S)}}}function mF(r,o){Dr.X(r,o);var c=au;if(c&&r){var p=El(c).hoistableScripts,g=lu(r),y=p.get(g);y||(y=c.querySelector(lh(g)),y||(r=m({src:r,async:!0},o),(o=Jn.get(g))&&x0(r,o),y=c.createElement("script"),ys(y),Ns(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},p.set(g,y))}}function gF(r,o){Dr.M(r,o);var c=au;if(c&&r){var p=El(c).hoistableScripts,g=lu(r),y=p.get(g);y||(y=c.querySelector(lh(g)),y||(r=m({src:r,async:!0,type:"module"},o),(o=Jn.get(g))&&x0(r,o),y=c.createElement("script"),ys(y),Ns(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},p.set(g,y))}}function $M(r,o,c,p){var g=(g=We.current)?Hp(g):null;if(!g)throw Error(s(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=ou(c.href),c=El(g).hoistableStyles,p=c.get(o),p||(p={type:"style",instance:null,count:0,state:null},c.set(o,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=ou(c.href);var y=El(g).hoistableStyles,S=y.get(r);if(S||(g=g.ownerDocument||g,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(r,S),(y=g.querySelector(oh(r)))&&!y._p&&(S.instance=y,S.state.loading=5),Jn.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Jn.set(r,c),y||yF(g,r,c,S.state))),o&&p===null)throw Error(s(528,""));return S}if(o&&p!==null)throw Error(s(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=lu(c),c=El(g).hoistableScripts,p=c.get(o),p||(p={type:"script",instance:null,count:0,state:null},c.set(o,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,r))}}function ou(r){return'href="'+jn(r)+'"'}function oh(r){return'link[rel="stylesheet"]['+r+"]"}function WM(r){return m({},r,{"data-precedence":r.precedence,precedence:null})}function yF(r,o,c,p){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?p.loading=1:(o=r.createElement("link"),p.preload=o,o.addEventListener("load",function(){return p.loading|=1}),o.addEventListener("error",function(){return p.loading|=2}),Ns(o,"link",c),ys(o),r.head.appendChild(o))}function lu(r){return'[src="'+jn(r)+'"]'}function lh(r){return"script[async]"+r}function XM(r,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var p=r.querySelector('style[data-href~="'+jn(c.href)+'"]');if(p)return o.instance=p,ys(p),p;var g=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return p=(r.ownerDocument||r).createElement("style"),ys(p),Ns(p,"style",g),jp(p,c.precedence,r),o.instance=p;case"stylesheet":g=ou(c.href);var y=r.querySelector(oh(g));if(y)return o.state.loading|=4,o.instance=y,ys(y),y;p=WM(c),(g=Jn.get(g))&&b0(p,g),y=(r.ownerDocument||r).createElement("link"),ys(y);var S=y;return S._p=new Promise(function(M,U){S.onload=M,S.onerror=U}),Ns(y,"link",p),o.state.loading|=4,jp(y,c.precedence,r),o.instance=y;case"script":return y=lu(c.src),(g=r.querySelector(lh(y)))?(o.instance=g,ys(g),g):(p=c,(g=Jn.get(y))&&(p=m({},c),x0(p,g)),r=r.ownerDocument||r,g=r.createElement("script"),ys(g),Ns(g,"link",p),r.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(p=o.instance,o.state.loading|=4,jp(p,c.precedence,r));return o.instance}function jp(r,o,c){for(var p=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=p.length?p[p.length-1]:null,y=g,S=0;S<p.length;S++){var M=p[S];if(M.dataset.precedence===o)y=M;else if(y!==g)break}y?y.parentNode.insertBefore(r,y.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(r,o.firstChild))}function b0(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function x0(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var $p=null;function YM(r,o,c){if($p===null){var p=new Map,g=$p=new Map;g.set(c,p)}else g=$p,p=g.get(c),p||(p=new Map,g.set(c,p));if(p.has(r))return p;for(p.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var y=c[g];if(!(y[wc]||y[Ts]||r==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var S=y.getAttribute(o)||"";S=r+S;var M=p.get(S);M?M.push(y):p.set(S,[y])}}return p}function KM(r,o,c){r=r.ownerDocument||r,r.head.insertBefore(c,o==="title"?r.querySelector("head > title"):null)}function bF(r,o,c){if(c===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(r=o.disabled,typeof o.precedence=="string"&&r==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function ZM(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function xF(r,o,c,p){if(c.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var g=ou(p.href),y=o.querySelector(oh(g));if(y){o=y._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=Wp.bind(r),o.then(r,r)),c.state.loading|=4,c.instance=y,ys(y);return}y=o.ownerDocument||o,p=WM(p),(g=Jn.get(g))&&b0(p,g),y=y.createElement("link"),ys(y);var S=y;S._p=new Promise(function(M,U){S.onload=M,S.onerror=U}),Ns(y,"link",p),c.instance=y}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,o),(o=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=Wp.bind(r),o.addEventListener("load",c),o.addEventListener("error",c))}}var _0=0;function _F(r,o){return r.stylesheets&&r.count===0&&Yp(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var p=setTimeout(function(){if(r.stylesheets&&Yp(r,r.stylesheets),r.unsuspend){var y=r.unsuspend;r.unsuspend=null,y()}},6e4+o);0<r.imgBytes&&_0===0&&(_0=62500*eF());var g=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Yp(r,r.stylesheets),r.unsuspend)){var y=r.unsuspend;r.unsuspend=null,y()}},(r.imgBytes>_0?50:800)+o);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(p),clearTimeout(g)}}:null}function Wp(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yp(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Xp=null;function Yp(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Xp=new Map,o.forEach(vF,r),Xp=null,Wp.call(r))}function vF(r,o){if(!(o.state.loading&4)){var c=Xp.get(r);if(c)var p=c.get(null);else{c=new Map,Xp.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var S=g[y];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(c.set(S.dataset.precedence,S),p=S)}p&&c.set(null,p)}g=o.instance,S=g.getAttribute("data-precedence"),y=c.get(S)||p,y===p&&c.set(null,g),c.set(S,g),this.count++,p=Wp.bind(this),g.addEventListener("load",p),g.addEventListener("error",p),y?y.parentNode.insertBefore(g,y.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),o.state.loading|=4}}var uh={$$typeof:R,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function TF(r,o,c,p,g,y,S,M,U){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=my(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=my(0),this.hiddenUpdates=my(null),this.identifierPrefix=p,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function QM(r,o,c,p,g,y,S,M,U,X,J,ne){return r=new TF(r,o,c,S,U,X,J,ne,M),o=1,y===!0&&(o|=24),y=Sn(3,null,null,o),r.current=y,y.stateNode=r,o=Jy(),o.refCount++,r.pooledCache=o,o.refCount++,y.memoizedState={element:p,isDehydrated:c,cache:o},nb(y),r}function JM(r){return r?(r=zl,r):zl}function eN(r,o,c,p,g,y){g=JM(g),p.context===null?p.context=g:p.pendingContext=g,p=va(o),p.payload={element:c},y=y===void 0?null:y,y!==null&&(p.callback=y),c=Ta(r,p,o),c!==null&&(on(c,r,o),kc(c,r,o))}function tN(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function v0(r,o){tN(r,o),(r=r.alternate)&&tN(r,o)}function sN(r){if(r.tag===13||r.tag===31){var o=Do(r,67108864);o!==null&&on(o,r,67108864),v0(r,67108864)}}function nN(r){if(r.tag===13||r.tag===31){var o=Cn();o=gy(o);var c=Do(r,o);c!==null&&on(c,r,o),v0(r,o)}}var Kp=!0;function SF(r,o,c,p){var g=j.T;j.T=null;var y=oe.p;try{oe.p=2,T0(r,o,c,p)}finally{oe.p=y,j.T=g}}function wF(r,o,c,p){var g=j.T;j.T=null;var y=oe.p;try{oe.p=8,T0(r,o,c,p)}finally{oe.p=y,j.T=g}}function T0(r,o,c,p){if(Kp){var g=S0(p);if(g===null)l0(r,o,p,Zp,c),rN(r,p);else if(NF(g,r,o,c,p))p.stopPropagation();else if(rN(r,p),o&4&&-1<MF.indexOf(r)){for(;g!==null;){var y=Cl(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var S=Ao(y.pendingLanes);if(S!==0){var M=y;for(M.pendingLanes|=2,M.entangledLanes|=2;S;){var U=1<<31-vn(S);M.entanglements[1]|=U,S&=~U}Vi(y),(ht&6)===0&&(Lp=xn()+500,nh(0))}}break;case 31:case 13:M=Do(y,2),M!==null&&on(M,y,2),Fp(),v0(y,2)}if(y=S0(p),y===null&&l0(r,o,p,Zp,c),y===g)break;g=y}g!==null&&p.stopPropagation()}else l0(r,o,p,null,c)}}function S0(r){return r=My(r),w0(r)}var Zp=null;function w0(r){if(Zp=null,r=Al(r),r!==null){var o=a(r);if(o===null)r=null;else{var c=o.tag;if(c===13){if(r=l(o),r!==null)return r;r=null}else if(c===31){if(r=u(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Zp=r,null}function iN(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cL()){case dS:return 2;case pS:return 8;case Id:case hL:return 32;case fS:return 268435456;default:return 32}default:return 32}}var M0=!1,La=null,Ua=null,Fa=null,ch=new Map,hh=new Map,Pa=[],MF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function rN(r,o){switch(r){case"focusin":case"focusout":La=null;break;case"dragenter":case"dragleave":Ua=null;break;case"mouseover":case"mouseout":Fa=null;break;case"pointerover":case"pointerout":ch.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":hh.delete(o.pointerId)}}function dh(r,o,c,p,g,y){return r===null||r.nativeEvent!==y?(r={blockedOn:o,domEventName:c,eventSystemFlags:p,nativeEvent:y,targetContainers:[g]},o!==null&&(o=Cl(o),o!==null&&sN(o)),r):(r.eventSystemFlags|=p,o=r.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),r)}function NF(r,o,c,p,g){switch(o){case"focusin":return La=dh(La,r,o,c,p,g),!0;case"dragenter":return Ua=dh(Ua,r,o,c,p,g),!0;case"mouseover":return Fa=dh(Fa,r,o,c,p,g),!0;case"pointerover":var y=g.pointerId;return ch.set(y,dh(ch.get(y)||null,r,o,c,p,g)),!0;case"gotpointercapture":return y=g.pointerId,hh.set(y,dh(hh.get(y)||null,r,o,c,p,g)),!0}return!1}function aN(r){var o=Al(r.target);if(o!==null){var c=a(o);if(c!==null){if(o=c.tag,o===13){if(o=l(c),o!==null){r.blockedOn=o,_S(r.priority,function(){nN(c)});return}}else if(o===31){if(o=u(c),o!==null){r.blockedOn=o,_S(r.priority,function(){nN(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Qp(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=S0(r.nativeEvent);if(c===null){c=r.nativeEvent;var p=new c.constructor(c.type,c);wy=p,c.target.dispatchEvent(p),wy=null}else return o=Cl(c),o!==null&&sN(o),r.blockedOn=c,!1;o.shift()}return!0}function oN(r,o,c){Qp(r)&&c.delete(o)}function AF(){M0=!1,La!==null&&Qp(La)&&(La=null),Ua!==null&&Qp(Ua)&&(Ua=null),Fa!==null&&Qp(Fa)&&(Fa=null),ch.forEach(oN),hh.forEach(oN)}function Jp(r,o){r.blockedOn===o&&(r.blockedOn=null,M0||(M0=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,AF)))}var ef=null;function lN(r){ef!==r&&(ef=r,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){ef===r&&(ef=null);for(var o=0;o<r.length;o+=3){var c=r[o],p=r[o+1],g=r[o+2];if(typeof p!="function"){if(w0(p||c)===null)continue;break}var y=Cl(c);y!==null&&(r.splice(o,3),o-=3,Sb(y,{pending:!0,data:g,method:c.method,action:p},p,g))}}))}function uu(r){function o(U){return Jp(U,r)}La!==null&&Jp(La,r),Ua!==null&&Jp(Ua,r),Fa!==null&&Jp(Fa,r),ch.forEach(o),hh.forEach(o);for(var c=0;c<Pa.length;c++){var p=Pa[c];p.blockedOn===r&&(p.blockedOn=null)}for(;0<Pa.length&&(c=Pa[0],c.blockedOn===null);)aN(c),c.blockedOn===null&&Pa.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(p=0;p<c.length;p+=3){var g=c[p],y=c[p+1],S=g[en]||null;if(typeof y=="function")S||lN(c);else if(S){var M=null;if(y&&y.hasAttribute("formAction")){if(g=y,S=y[en]||null)M=S.formAction;else if(w0(g)!==null)continue}else M=S.action;typeof M=="function"?c[p+1]=M:(c.splice(p,3),p-=3),lN(c)}}}function uN(){function r(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(S){return g=S})},focusReset:"manual",scroll:"manual"})}function o(){g!==null&&(g(),g=null),p||setTimeout(c,20)}function c(){if(!p&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,g=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(c,100),function(){p=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),g!==null&&(g(),g=null)}}}function N0(r){this._internalRoot=r}tf.prototype.render=N0.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(s(409));var c=o.current,p=Cn();eN(c,p,r,o,null,null)},tf.prototype.unmount=N0.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;eN(r.current,2,null,r,null,null),Fp(),o[Nl]=null}};function tf(r){this._internalRoot=r}tf.prototype.unstable_scheduleHydration=function(r){if(r){var o=xS();r={blockedOn:null,target:r,priority:o};for(var c=0;c<Pa.length&&o!==0&&o<Pa[c].priority;c++);Pa.splice(c,0,r),c===0&&aN(r)}};var cN=e.version;if(cN!=="19.2.4")throw Error(s(527,cN,"19.2.4"));oe.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(s(188)):(r=Object.keys(r).join(","),Error(s(268,r)));return r=d(o),r=r!==null?f(r):null,r=r===null?null:r.stateNode,r};var CF={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:j,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sf.isDisabled&&sf.supportsFiber)try{vc=sf.inject(CF),_n=sf}catch{}}return fh.createRoot=function(r,o){if(!n(r))throw Error(s(299));var c=!1,p="",g=y1,y=b1,S=x1;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(S=o.onRecoverableError)),o=QM(r,1,!1,null,null,c,p,null,g,y,S,uN),r[Nl]=o.current,o0(r),new N0(o)},fh.hydrateRoot=function(r,o,c){if(!n(r))throw Error(s(299));var p=!1,g="",y=y1,S=b1,M=x1,U=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(S=c.onCaughtError),c.onRecoverableError!==void 0&&(M=c.onRecoverableError),c.formState!==void 0&&(U=c.formState)),o=QM(r,1,!0,o,c??null,p,g,U,y,S,M,uN),o.context=JM(null),c=o.current,p=Cn(),p=gy(p),g=va(p),g.callback=null,Ta(c,g,p),c=p,o.current.lanes=c,Sc(o,c),Vi(o),r[Nl]=o.current,o0(r),new tf(o)},fh.version="19.2.4",fh}var _N;function VF(){if(_N)return E0.exports;_N=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),E0.exports=OF(),E0.exports}var zF=VF();const yd="183",Iu={ROTATE:0,DOLLY:1,PAN:2},Fu={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},IF=0,kF=1,GF=2,qF=0,kC=1,HF=2,Ih=3,tr=0,Rs=1,Wr=2,Xr=0,ri=1,Pu=2,Ou=3,Vu=4,ku=5,k_=6,ai=100,GC=101,qC=102,jF=103,$F=104,Ka=200,HC=201,jC=202,$C=203,ed=204,td=205,WC=206,XC=207,YC=208,KC=209,ZC=210,dm=0,pm=1,fm=2,Qu=3,mm=4,gm=5,ym=6,bm=7,mg=0,WF=1,XF=2,il=0,YF=1,KF=2,ZF=3,QF=4,JF=6,eP=7,G_=300,Ju=301,xm=302,q_=303,H_=304,Qx=306,ec=1e3,Ki=1001,tc=1002,qt=1003,QC=1004,sd=1005,Gs=1006,Jx=1007,oo=1008,tP=1008,Vs=1009,Gu=1010,qu=1011,rl=1012,Ps=1013,Gt=1014,cn=1015,Cs=1016,JC=1017,eE=1018,lo=1020,j_=35902,$_=35899,tE=1021,gg=1022,Pn=1023,Ri=1026,Yr=1027,yg=1028,bg=1029,Zi=1030,xg=1031,sP=1032,_g=1033,kh=33776,Gh=33777,qh=33778,Hh=33779,e_=35840,t_=35841,s_=35842,n_=35843,_m=36196,vm=37492,Tm=37496,Sm=37488,wm=37489,nd=37490,Mm=37491,Nm=37808,Am=37809,Cm=37810,Em=37811,Rm=37812,Bm=37813,Dm=37814,Lm=37815,Um=37816,Fm=37817,Pm=37818,Om=37819,Vm=37820,zm=37821,Im=36492,nP=36494,iP=36495,km=36283,Gm=36284,id=36285,qm=36286,Kr=0,rP=1,mo="",Un="srgb",Hm="srgb-linear",jm="linear",Fe="srgb",L0="",sE="rg",aP="ga",oP=0,tl=7680,lP=7681,uP=7682,cP=7683,hP=34055,dP=34056,pP=5386,fP=512,mP=513,gP=514,yP=515,bP=516,xP=517,_P=518,i_=519,nE=512,W_=513,iE=514,vg=515,rE=516,aE=517,Tg=518,oE=519,sc=35044,rd=35048,On=2e3,pi=2001,Qi={COMPUTE:"compute",RENDER:"render"},uo={TEXTURE_COMPARE:"depthTextureCompare"};function vP(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function $m(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function r_(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function TP(){const i=r_("canvas");return i.style.display="block",i}const vN={};function a_(...i){const e="THREE."+i.shift();console.log(e,...i)}function lE(i){const e=i[0];if(typeof e=="string"&&e.startsWith("TSL:")){const t=i[1];t&&t.isStackTrace?i[0]+=" "+t.getLocation():i[1]='Stack trace not available. Enable "THREE.Node.captureStackTrace" to capture stack traces.'}return i}function ue(...i){i=lE(i);const e="THREE."+i.shift();{const t=i[0];t&&t.isStackTrace?console.warn(t.getError(e)):console.warn(e,...i)}}function le(...i){i=lE(i);const e="THREE."+i.shift();{const t=i[0];t&&t.isStackTrace?console.error(t.getError(e)):console.error(e,...i)}}function ft(...i){const e=i.join(" ");e in vN||(vN[e]=!0,ue(...i))}const uE={[dm]:pm,[fm]:ym,[mm]:bm,[Qu]:gm,[pm]:dm,[ym]:fm,[bm]:mm,[gm]:Qu};class la{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s===void 0?!1:s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners;if(s===void 0)return;const n=s[e];if(n!==void 0){const a=n.indexOf(t);a!==-1&&n.splice(a,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const s=t[e.type];if(s!==void 0){e.target=this;const n=s.slice(0);for(let a=0,l=n.length;a<l;a++)n[a].call(this,e);e.target=null}}}const Ls=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let TN=1234567;const jh=Math.PI/180,nc=180/Math.PI;function Zr(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Ls[i&255]+Ls[i>>8&255]+Ls[i>>16&255]+Ls[i>>24&255]+"-"+Ls[e&255]+Ls[e>>8&255]+"-"+Ls[e>>16&15|64]+Ls[e>>24&255]+"-"+Ls[t&63|128]+Ls[t>>8&255]+"-"+Ls[t>>16&255]+Ls[t>>24&255]+Ls[s&255]+Ls[s>>8&255]+Ls[s>>16&255]+Ls[s>>24&255]).toLowerCase()}function Ge(i,e,t){return Math.max(e,Math.min(t,i))}function X_(i,e){return(i%e+e)%e}function SP(i,e,t,s,n){return s+(i-e)*(n-s)/(t-e)}function wP(i,e,t){return i!==e?(t-i)/(e-i):0}function $h(i,e,t){return(1-t)*i+t*e}function MP(i,e,t,s){return $h(i,e,1-Math.exp(-t*s))}function NP(i,e=1){return e-Math.abs(X_(i,e*2)-e)}function AP(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function CP(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function EP(i,e){return i+Math.floor(Math.random()*(e-i+1))}function RP(i,e){return i+Math.random()*(e-i)}function BP(i){return i*(.5-Math.random())}function DP(i){i!==void 0&&(TN=i);let e=TN+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function LP(i){return i*jh}function UP(i){return i*nc}function FP(i){return(i&i-1)===0&&i!==0}function PP(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function OP(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function VP(i,e,t,s,n){const a=Math.cos,l=Math.sin,u=a(t/2),h=l(t/2),d=a((e+s)/2),f=l((e+s)/2),m=a((e-s)/2),b=l((e-s)/2),x=a((s-e)/2),v=l((s-e)/2);switch(n){case"XYX":i.set(u*f,h*m,h*b,u*d);break;case"YZY":i.set(h*b,u*f,h*m,u*d);break;case"ZXZ":i.set(h*m,h*b,u*f,u*d);break;case"XZX":i.set(u*f,h*v,h*x,u*d);break;case"YXY":i.set(h*x,u*f,h*v,u*d);break;case"ZYZ":i.set(h*v,h*x,u*f,u*d);break;default:ue("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Xs(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Ie(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const Y_={DEG2RAD:jh,RAD2DEG:nc,generateUUID:Zr,clamp:Ge,euclideanModulo:X_,mapLinear:SP,inverseLerp:wP,lerp:$h,damp:MP,pingpong:NP,smoothstep:AP,smootherstep:CP,randInt:EP,randFloat:RP,randFloatSpread:BP,seededRandom:DP,degToRad:LP,radToDeg:UP,isPowerOfTwo:FP,ceilPowerOfTwo:PP,floorPowerOfTwo:OP,setQuaternionFromProperEuler:VP,normalize:Ie,denormalize:Xs};class Ue{constructor(e=0,t=0){Ue.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,s=this.y,n=e.elements;return this.x=n[0]*t+n[3]*s+n[6],this.y=n[1]*t+n[4]*s+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ge(this.x,e.x,t.x),this.y=Ge(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ge(this.x,e,t),this.y=Ge(this.y,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Ge(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(Ge(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const s=Math.cos(t),n=Math.sin(t),a=this.x-e.x,l=this.y-e.y;return this.x=a*s-l*n+e.x,this.y=a*n+l*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class sa{constructor(e=0,t=0,s=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=n}static slerpFlat(e,t,s,n,a,l,u){let h=s[n+0],d=s[n+1],f=s[n+2],m=s[n+3],b=a[l+0],x=a[l+1],v=a[l+2],T=a[l+3];if(m!==T||h!==b||d!==x||f!==v){let w=h*b+d*x+f*v+m*T;w<0&&(b=-b,x=-x,v=-v,T=-T,w=-w);let N=1-u;if(w<.9995){const C=Math.acos(w),R=Math.sin(C);N=Math.sin(N*C)/R,u=Math.sin(u*C)/R,h=h*N+b*u,d=d*N+x*u,f=f*N+v*u,m=m*N+T*u}else{h=h*N+b*u,d=d*N+x*u,f=f*N+v*u,m=m*N+T*u;const C=1/Math.sqrt(h*h+d*d+f*f+m*m);h*=C,d*=C,f*=C,m*=C}}e[t]=h,e[t+1]=d,e[t+2]=f,e[t+3]=m}static multiplyQuaternionsFlat(e,t,s,n,a,l){const u=s[n],h=s[n+1],d=s[n+2],f=s[n+3],m=a[l],b=a[l+1],x=a[l+2],v=a[l+3];return e[t]=u*v+f*m+h*x-d*b,e[t+1]=h*v+f*b+d*m-u*x,e[t+2]=d*v+f*x+u*b-h*m,e[t+3]=f*v-u*m-h*b-d*x,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,n){return this._x=e,this._y=t,this._z=s,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const s=e._x,n=e._y,a=e._z,l=e._order,u=Math.cos,h=Math.sin,d=u(s/2),f=u(n/2),m=u(a/2),b=h(s/2),x=h(n/2),v=h(a/2);switch(l){case"XYZ":this._x=b*f*m+d*x*v,this._y=d*x*m-b*f*v,this._z=d*f*v+b*x*m,this._w=d*f*m-b*x*v;break;case"YXZ":this._x=b*f*m+d*x*v,this._y=d*x*m-b*f*v,this._z=d*f*v-b*x*m,this._w=d*f*m+b*x*v;break;case"ZXY":this._x=b*f*m-d*x*v,this._y=d*x*m+b*f*v,this._z=d*f*v+b*x*m,this._w=d*f*m-b*x*v;break;case"ZYX":this._x=b*f*m-d*x*v,this._y=d*x*m+b*f*v,this._z=d*f*v-b*x*m,this._w=d*f*m+b*x*v;break;case"YZX":this._x=b*f*m+d*x*v,this._y=d*x*m+b*f*v,this._z=d*f*v-b*x*m,this._w=d*f*m-b*x*v;break;case"XZY":this._x=b*f*m-d*x*v,this._y=d*x*m-b*f*v,this._z=d*f*v+b*x*m,this._w=d*f*m+b*x*v;break;default:ue("Quaternion: .setFromEuler() encountered an unknown order: "+l)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,n=Math.sin(s);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],n=t[4],a=t[8],l=t[1],u=t[5],h=t[9],d=t[2],f=t[6],m=t[10],b=s+u+m;if(b>0){const x=.5/Math.sqrt(b+1);this._w=.25/x,this._x=(f-h)*x,this._y=(a-d)*x,this._z=(l-n)*x}else if(s>u&&s>m){const x=2*Math.sqrt(1+s-u-m);this._w=(f-h)/x,this._x=.25*x,this._y=(n+l)/x,this._z=(a+d)/x}else if(u>m){const x=2*Math.sqrt(1+u-s-m);this._w=(a-d)/x,this._x=(n+l)/x,this._y=.25*x,this._z=(h+f)/x}else{const x=2*Math.sqrt(1+m-s-u);this._w=(l-n)/x,this._x=(a+d)/x,this._y=(h+f)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<1e-8?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ge(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(s===0)return this;const n=Math.min(1,t/s);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,n=e._y,a=e._z,l=e._w,u=t._x,h=t._y,d=t._z,f=t._w;return this._x=s*f+l*u+n*d-a*h,this._y=n*f+l*h+a*u-s*d,this._z=a*f+l*d+s*h-n*u,this._w=l*f-s*u-n*h-a*d,this._onChangeCallback(),this}slerp(e,t){let s=e._x,n=e._y,a=e._z,l=e._w,u=this.dot(e);u<0&&(s=-s,n=-n,a=-a,l=-l,u=-u);let h=1-t;if(u<.9995){const d=Math.acos(u),f=Math.sin(d);h=Math.sin(h*d)/f,t=Math.sin(t*d)/f,this._x=this._x*h+s*t,this._y=this._y*h+n*t,this._z=this._z*h+a*t,this._w=this._w*h+l*t,this._onChangeCallback()}else this._x=this._x*h+s*t,this._y=this._y*h+n*t,this._z=this._z*h+a*t,this._w=this._w*h+l*t,this.normalize();return this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),s=Math.random(),n=Math.sqrt(1-s),a=Math.sqrt(s);return this.set(n*Math.sin(e),n*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class z{constructor(e=0,t=0,s=0){z.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(SN.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(SN.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,n=this.z,a=e.elements;return this.x=a[0]*t+a[3]*s+a[6]*n,this.y=a[1]*t+a[4]*s+a[7]*n,this.z=a[2]*t+a[5]*s+a[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,n=this.z,a=e.elements,l=1/(a[3]*t+a[7]*s+a[11]*n+a[15]);return this.x=(a[0]*t+a[4]*s+a[8]*n+a[12])*l,this.y=(a[1]*t+a[5]*s+a[9]*n+a[13])*l,this.z=(a[2]*t+a[6]*s+a[10]*n+a[14])*l,this}applyQuaternion(e){const t=this.x,s=this.y,n=this.z,a=e.x,l=e.y,u=e.z,h=e.w,d=2*(l*n-u*s),f=2*(u*t-a*n),m=2*(a*s-l*t);return this.x=t+h*d+l*m-u*f,this.y=s+h*f+u*d-a*m,this.z=n+h*m+a*f-l*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,n=this.z,a=e.elements;return this.x=a[0]*t+a[4]*s+a[8]*n,this.y=a[1]*t+a[5]*s+a[9]*n,this.z=a[2]*t+a[6]*s+a[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ge(this.x,e.x,t.x),this.y=Ge(this.y,e.y,t.y),this.z=Ge(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ge(this.x,e,t),this.y=Ge(this.y,e,t),this.z=Ge(this.z,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Ge(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,n=e.y,a=e.z,l=t.x,u=t.y,h=t.z;return this.x=n*h-a*u,this.y=a*l-s*h,this.z=s*u-n*l,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return U0.copy(this).projectOnVector(e),this.sub(U0)}reflect(e){return this.sub(U0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(Ge(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,n=this.z-e.z;return t*t+s*s+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const n=Math.sin(t)*e;return this.x=n*Math.sin(s),this.y=Math.cos(t)*e,this.z=n*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,s=Math.sqrt(1-t*t);return this.x=s*Math.cos(e),this.y=t,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const U0=new z,SN=new sa;class bn{constructor(e,t,s,n,a,l,u,h,d){bn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,s,n,a,l,u,h,d)}set(e,t,s,n,a,l,u,h,d){const f=this.elements;return f[0]=e,f[1]=n,f[2]=u,f[3]=t,f[4]=a,f[5]=h,f[6]=s,f[7]=l,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,n=t.elements,a=this.elements,l=s[0],u=s[3],h=s[6],d=s[1],f=s[4],m=s[7],b=s[2],x=s[5],v=s[8],T=n[0],w=n[3],N=n[6],C=n[1],R=n[4],E=n[7],k=n[2],q=n[5],D=n[8];return a[0]=l*T+u*C+h*k,a[3]=l*w+u*R+h*q,a[6]=l*N+u*E+h*D,a[1]=d*T+f*C+m*k,a[4]=d*w+f*R+m*q,a[7]=d*N+f*E+m*D,a[2]=b*T+x*C+v*k,a[5]=b*w+x*R+v*q,a[8]=b*N+x*E+v*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],n=e[2],a=e[3],l=e[4],u=e[5],h=e[6],d=e[7],f=e[8];return t*l*f-t*u*d-s*a*f+s*u*h+n*a*d-n*l*h}invert(){const e=this.elements,t=e[0],s=e[1],n=e[2],a=e[3],l=e[4],u=e[5],h=e[6],d=e[7],f=e[8],m=f*l-u*d,b=u*h-f*a,x=d*a-l*h,v=t*m+s*b+n*x;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const T=1/v;return e[0]=m*T,e[1]=(n*d-f*s)*T,e[2]=(u*s-n*l)*T,e[3]=b*T,e[4]=(f*t-n*h)*T,e[5]=(n*a-u*t)*T,e[6]=x*T,e[7]=(s*h-d*t)*T,e[8]=(l*t-s*a)*T,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,n,a,l,u){const h=Math.cos(a),d=Math.sin(a);return this.set(s*h,s*d,-s*(h*l+d*u)+l+e,-n*d,n*h,-n*(-d*l+h*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(F0.makeScale(e,t)),this}rotate(e){return this.premultiply(F0.makeRotation(-e)),this}translate(e,t){return this.premultiply(F0.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,s=e.elements;for(let n=0;n<9;n++)if(t[n]!==s[n])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const F0=new bn,wN=new bn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),MN=new bn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function zP(){const i={enabled:!0,workingColorSpace:Hm,spaces:{},convert:function(n,a,l){return this.enabled===!1||a===l||!a||!l||(this.spaces[a].transfer===Fe&&(n.r=Qr(n.r),n.g=Qr(n.g),n.b=Qr(n.b)),this.spaces[a].primaries!==this.spaces[l].primaries&&(n.applyMatrix3(this.spaces[a].toXYZ),n.applyMatrix3(this.spaces[l].fromXYZ)),this.spaces[l].transfer===Fe&&(n.r=Hu(n.r),n.g=Hu(n.g),n.b=Hu(n.b))),n},workingToColorSpace:function(n,a){return this.convert(n,this.workingColorSpace,a)},colorSpaceToWorking:function(n,a){return this.convert(n,a,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===mo?jm:this.spaces[n].transfer},getToneMappingMode:function(n){return this.spaces[n].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(n,a=this.workingColorSpace){return n.fromArray(this.spaces[a].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,a,l){return n.copy(this.spaces[a].toXYZ).multiply(this.spaces[l].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(n,a){return ft("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(n,a)},toWorkingColorSpace:function(n,a){return ft("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(n,a)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],s=[.3127,.329];return i.define({[Hm]:{primaries:e,whitePoint:s,transfer:jm,toXYZ:wN,fromXYZ:MN,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Un},outputColorSpaceConfig:{drawingBufferColorSpace:Un}},[Un]:{primaries:e,whitePoint:s,transfer:Fe,toXYZ:wN,fromXYZ:MN,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Un}}}),i}const nt=zP();function Qr(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Hu(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let cu;class IP{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{cu===void 0&&(cu=r_("canvas")),cu.width=e.width,cu.height=e.height;const n=cu.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),s=cu}return s.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=r_("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const n=s.getImageData(0,0,e.width,e.height),a=n.data;for(let l=0;l<a.length;l++)a[l]=Qr(a[l]/255)*255;return s.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let s=0;s<t.length;s++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[s]=Math.floor(Qr(t[s]/255)*255):t[s]=Qr(t[s]);return{data:t,width:e.width,height:e.height}}else return ue("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let kP=0;class K_{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:kP++}),this.uuid=Zr(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},n=this.data;if(n!==null){let a;if(Array.isArray(n)){a=[];for(let l=0,u=n.length;l<u;l++)n[l].isDataTexture?a.push(P0(n[l].image)):a.push(P0(n[l]))}else a=P0(n);s.url=a}return t||(e.images[this.uuid]=s),s}}function P0(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?IP.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(ue("Texture: Unable to serialize Texture."),{})}let GP=0;const O0=new z;class Is extends la{constructor(e=Is.DEFAULT_IMAGE,t=Is.DEFAULT_MAPPING,s=Ki,n=Ki,a=Gs,l=oo,u=Pn,h=Vs,d=Is.DEFAULT_ANISOTROPY,f=mo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:GP++}),this.uuid=Zr(),this.name="",this.source=new K_(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=s,this.wrapT=n,this.magFilter=a,this.minFilter=l,this.anisotropy=d,this.format=u,this.internalFormat=null,this.type=h,this.offset=new Ue(0,0),this.repeat=new Ue(1,1),this.center=new Ue(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(O0).x}get height(){return this.source.getSize(O0).y}get depth(){return this.source.getSize(O0).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const s=e[t];if(s===void 0){ue(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){ue(`Texture.setValues(): property '${t}' does not exist.`);continue}n&&s&&n.isVector2&&s.isVector2||n&&s&&n.isVector3&&s.isVector3||n&&s&&n.isMatrix3&&s.isMatrix3?n.copy(s):this[t]=s}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),t||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==G_)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ec:e.x=e.x-Math.floor(e.x);break;case Ki:e.x=e.x<0?0:1;break;case tc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ec:e.y=e.y-Math.floor(e.y);break;case Ki:e.y=e.y<0?0:1;break;case tc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Is.DEFAULT_IMAGE=null;Is.DEFAULT_MAPPING=G_;Is.DEFAULT_ANISOTROPY=1;class rt{constructor(e=0,t=0,s=0,n=1){rt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=s,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,s,n){return this.x=e,this.y=t,this.z=s,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,s=this.y,n=this.z,a=this.w,l=e.elements;return this.x=l[0]*t+l[4]*s+l[8]*n+l[12]*a,this.y=l[1]*t+l[5]*s+l[9]*n+l[13]*a,this.z=l[2]*t+l[6]*s+l[10]*n+l[14]*a,this.w=l[3]*t+l[7]*s+l[11]*n+l[15]*a,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,s,n,a;const h=e.elements,d=h[0],f=h[4],m=h[8],b=h[1],x=h[5],v=h[9],T=h[2],w=h[6],N=h[10];if(Math.abs(f-b)<.01&&Math.abs(m-T)<.01&&Math.abs(v-w)<.01){if(Math.abs(f+b)<.1&&Math.abs(m+T)<.1&&Math.abs(v+w)<.1&&Math.abs(d+x+N-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const R=(d+1)/2,E=(x+1)/2,k=(N+1)/2,q=(f+b)/4,D=(m+T)/4,I=(v+w)/4;return R>E&&R>k?R<.01?(s=0,n=.707106781,a=.707106781):(s=Math.sqrt(R),n=q/s,a=D/s):E>k?E<.01?(s=.707106781,n=0,a=.707106781):(n=Math.sqrt(E),s=q/n,a=I/n):k<.01?(s=.707106781,n=.707106781,a=0):(a=Math.sqrt(k),s=D/a,n=I/a),this.set(s,n,a,t),this}let C=Math.sqrt((w-v)*(w-v)+(m-T)*(m-T)+(b-f)*(b-f));return Math.abs(C)<.001&&(C=1),this.x=(w-v)/C,this.y=(m-T)/C,this.z=(b-f)/C,this.w=Math.acos((d+x+N-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ge(this.x,e.x,t.x),this.y=Ge(this.y,e.y,t.y),this.z=Ge(this.z,e.z,t.z),this.w=Ge(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ge(this.x,e,t),this.y=Ge(this.y,e,t),this.z=Ge(this.z,e,t),this.w=Ge(this.w,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Ge(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this.w=e.w+(t.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ua extends la{constructor(e=1,t=1,s={}){super(),s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Gs,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},s),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=s.depth,this.scissor=new rt(0,0,e,t),this.scissorTest=!1,this.viewport=new rt(0,0,e,t),this.textures=[];const n={width:e,height:t,depth:s.depth},a=new Is(n),l=s.count;for(let u=0;u<l;u++)this.textures[u]=a.clone(),this.textures[u].isRenderTargetTexture=!0,this.textures[u].renderTarget=this;this._setTextureOptions(s),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=s.depthTexture,this.samples=s.samples,this.multiview=s.multiview}_setTextureOptions(e={}){const t={minFilter:Gs,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let s=0;s<this.textures.length;s++)this.textures[s].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,s=1){if(this.width!==e||this.height!==t||this.depth!==s){this.width=e,this.height=t,this.depth=s;for(let n=0,a=this.textures.length;n<a;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=s,this.textures[n].isData3DTexture!==!0&&(this.textures[n].isArrayTexture=this.textures[n].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,s=e.textures.length;t<s;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new K_(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class qP extends Is{constructor(e=null,t=1,s=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:s,depth:n},this.magFilter=qt,this.minFilter=qt,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Ze{constructor(e,t,s,n,a,l,u,h,d,f,m,b,x,v,T,w){Ze.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,n,a,l,u,h,d,f,m,b,x,v,T,w)}set(e,t,s,n,a,l,u,h,d,f,m,b,x,v,T,w){const N=this.elements;return N[0]=e,N[4]=t,N[8]=s,N[12]=n,N[1]=a,N[5]=l,N[9]=u,N[13]=h,N[2]=d,N[6]=f,N[10]=m,N[14]=b,N[3]=x,N[7]=v,N[11]=T,N[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ze().fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),s.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this)}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,s=e.elements,n=1/hu.setFromMatrixColumn(e,0).length(),a=1/hu.setFromMatrixColumn(e,1).length(),l=1/hu.setFromMatrixColumn(e,2).length();return t[0]=s[0]*n,t[1]=s[1]*n,t[2]=s[2]*n,t[3]=0,t[4]=s[4]*a,t[5]=s[5]*a,t[6]=s[6]*a,t[7]=0,t[8]=s[8]*l,t[9]=s[9]*l,t[10]=s[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,n=e.y,a=e.z,l=Math.cos(s),u=Math.sin(s),h=Math.cos(n),d=Math.sin(n),f=Math.cos(a),m=Math.sin(a);if(e.order==="XYZ"){const b=l*f,x=l*m,v=u*f,T=u*m;t[0]=h*f,t[4]=-h*m,t[8]=d,t[1]=x+v*d,t[5]=b-T*d,t[9]=-u*h,t[2]=T-b*d,t[6]=v+x*d,t[10]=l*h}else if(e.order==="YXZ"){const b=h*f,x=h*m,v=d*f,T=d*m;t[0]=b+T*u,t[4]=v*u-x,t[8]=l*d,t[1]=l*m,t[5]=l*f,t[9]=-u,t[2]=x*u-v,t[6]=T+b*u,t[10]=l*h}else if(e.order==="ZXY"){const b=h*f,x=h*m,v=d*f,T=d*m;t[0]=b-T*u,t[4]=-l*m,t[8]=v+x*u,t[1]=x+v*u,t[5]=l*f,t[9]=T-b*u,t[2]=-l*d,t[6]=u,t[10]=l*h}else if(e.order==="ZYX"){const b=l*f,x=l*m,v=u*f,T=u*m;t[0]=h*f,t[4]=v*d-x,t[8]=b*d+T,t[1]=h*m,t[5]=T*d+b,t[9]=x*d-v,t[2]=-d,t[6]=u*h,t[10]=l*h}else if(e.order==="YZX"){const b=l*h,x=l*d,v=u*h,T=u*d;t[0]=h*f,t[4]=T-b*m,t[8]=v*m+x,t[1]=m,t[5]=l*f,t[9]=-u*f,t[2]=-d*f,t[6]=x*m+v,t[10]=b-T*m}else if(e.order==="XZY"){const b=l*h,x=l*d,v=u*h,T=u*d;t[0]=h*f,t[4]=-m,t[8]=d*f,t[1]=b*m+T,t[5]=l*f,t[9]=x*m-v,t[2]=v*m-x,t[6]=u*f,t[10]=T*m+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(HP,e,jP)}lookAt(e,t,s){const n=this.elements;return En.subVectors(e,t),En.lengthSq()===0&&(En.z=1),En.normalize(),Va.crossVectors(s,En),Va.lengthSq()===0&&(Math.abs(s.z)===1?En.x+=1e-4:En.z+=1e-4,En.normalize(),Va.crossVectors(s,En)),Va.normalize(),nf.crossVectors(En,Va),n[0]=Va.x,n[4]=nf.x,n[8]=En.x,n[1]=Va.y,n[5]=nf.y,n[9]=En.y,n[2]=Va.z,n[6]=nf.z,n[10]=En.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,n=t.elements,a=this.elements,l=s[0],u=s[4],h=s[8],d=s[12],f=s[1],m=s[5],b=s[9],x=s[13],v=s[2],T=s[6],w=s[10],N=s[14],C=s[3],R=s[7],E=s[11],k=s[15],q=n[0],D=n[4],I=n[8],$=n[12],ae=n[1],pe=n[5],me=n[9],xe=n[13],Ce=n[2],ge=n[6],j=n[10],oe=n[14],fe=n[3],Ne=n[7],De=n[11],O=n[15];return a[0]=l*q+u*ae+h*Ce+d*fe,a[4]=l*D+u*pe+h*ge+d*Ne,a[8]=l*I+u*me+h*j+d*De,a[12]=l*$+u*xe+h*oe+d*O,a[1]=f*q+m*ae+b*Ce+x*fe,a[5]=f*D+m*pe+b*ge+x*Ne,a[9]=f*I+m*me+b*j+x*De,a[13]=f*$+m*xe+b*oe+x*O,a[2]=v*q+T*ae+w*Ce+N*fe,a[6]=v*D+T*pe+w*ge+N*Ne,a[10]=v*I+T*me+w*j+N*De,a[14]=v*$+T*xe+w*oe+N*O,a[3]=C*q+R*ae+E*Ce+k*fe,a[7]=C*D+R*pe+E*ge+k*Ne,a[11]=C*I+R*me+E*j+k*De,a[15]=C*$+R*xe+E*oe+k*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],n=e[8],a=e[12],l=e[1],u=e[5],h=e[9],d=e[13],f=e[2],m=e[6],b=e[10],x=e[14],v=e[3],T=e[7],w=e[11],N=e[15],C=h*x-d*b,R=u*x-d*m,E=u*b-h*m,k=l*x-d*f,q=l*b-h*f,D=l*m-u*f;return t*(T*C-w*R+N*E)-s*(v*C-w*k+N*q)+n*(v*R-T*k+N*D)-a*(v*E-T*q+w*D)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],n=e[2],a=e[3],l=e[4],u=e[5],h=e[6],d=e[7],f=e[8],m=e[9],b=e[10],x=e[11],v=e[12],T=e[13],w=e[14],N=e[15],C=t*u-s*l,R=t*h-n*l,E=t*d-a*l,k=s*h-n*u,q=s*d-a*u,D=n*d-a*h,I=f*T-m*v,$=f*w-b*v,ae=f*N-x*v,pe=m*w-b*T,me=m*N-x*T,xe=b*N-x*w,Ce=C*xe-R*me+E*pe+k*ae-q*$+D*I;if(Ce===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ge=1/Ce;return e[0]=(u*xe-h*me+d*pe)*ge,e[1]=(n*me-s*xe-a*pe)*ge,e[2]=(T*D-w*q+N*k)*ge,e[3]=(b*q-m*D-x*k)*ge,e[4]=(h*ae-l*xe-d*$)*ge,e[5]=(t*xe-n*ae+a*$)*ge,e[6]=(w*E-v*D-N*R)*ge,e[7]=(f*D-b*E+x*R)*ge,e[8]=(l*me-u*ae+d*I)*ge,e[9]=(s*ae-t*me-a*I)*ge,e[10]=(v*q-T*E+N*C)*ge,e[11]=(m*E-f*q-x*C)*ge,e[12]=(u*$-l*pe-h*I)*ge,e[13]=(t*pe-s*$+n*I)*ge,e[14]=(T*R-v*k-w*C)*ge,e[15]=(f*k-m*R+b*C)*ge,this}scale(e){const t=this.elements,s=e.x,n=e.y,a=e.z;return t[0]*=s,t[4]*=n,t[8]*=a,t[1]*=s,t[5]*=n,t[9]*=a,t[2]*=s,t[6]*=n,t[10]*=a,t[3]*=s,t[7]*=n,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,n))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),n=Math.sin(t),a=1-s,l=e.x,u=e.y,h=e.z,d=a*l,f=a*u;return this.set(d*l+s,d*u-n*h,d*h+n*u,0,d*u+n*h,f*u+s,f*h-n*l,0,d*h-n*u,f*h+n*l,a*h*h+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,n,a,l){return this.set(1,s,a,0,e,1,l,0,t,n,1,0,0,0,0,1),this}compose(e,t,s){const n=this.elements,a=t._x,l=t._y,u=t._z,h=t._w,d=a+a,f=l+l,m=u+u,b=a*d,x=a*f,v=a*m,T=l*f,w=l*m,N=u*m,C=h*d,R=h*f,E=h*m,k=s.x,q=s.y,D=s.z;return n[0]=(1-(T+N))*k,n[1]=(x+E)*k,n[2]=(v-R)*k,n[3]=0,n[4]=(x-E)*q,n[5]=(1-(b+N))*q,n[6]=(w+C)*q,n[7]=0,n[8]=(v+R)*D,n[9]=(w-C)*D,n[10]=(1-(b+T))*D,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,s){const n=this.elements;e.x=n[12],e.y=n[13],e.z=n[14];const a=this.determinant();if(a===0)return s.set(1,1,1),t.identity(),this;let l=hu.set(n[0],n[1],n[2]).length();const u=hu.set(n[4],n[5],n[6]).length(),h=hu.set(n[8],n[9],n[10]).length();a<0&&(l=-l),Si.copy(this);const d=1/l,f=1/u,m=1/h;return Si.elements[0]*=d,Si.elements[1]*=d,Si.elements[2]*=d,Si.elements[4]*=f,Si.elements[5]*=f,Si.elements[6]*=f,Si.elements[8]*=m,Si.elements[9]*=m,Si.elements[10]*=m,t.setFromRotationMatrix(Si),s.x=l,s.y=u,s.z=h,this}makePerspective(e,t,s,n,a,l,u=On,h=!1){const d=this.elements,f=2*a/(t-e),m=2*a/(s-n),b=(t+e)/(t-e),x=(s+n)/(s-n);let v,T;if(h)v=a/(l-a),T=l*a/(l-a);else if(u===On)v=-(l+a)/(l-a),T=-2*l*a/(l-a);else if(u===pi)v=-l/(l-a),T=-l*a/(l-a);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return d[0]=f,d[4]=0,d[8]=b,d[12]=0,d[1]=0,d[5]=m,d[9]=x,d[13]=0,d[2]=0,d[6]=0,d[10]=v,d[14]=T,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,t,s,n,a,l,u=On,h=!1){const d=this.elements,f=2/(t-e),m=2/(s-n),b=-(t+e)/(t-e),x=-(s+n)/(s-n);let v,T;if(h)v=1/(l-a),T=l/(l-a);else if(u===On)v=-2/(l-a),T=-(l+a)/(l-a);else if(u===pi)v=-1/(l-a),T=-a/(l-a);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return d[0]=f,d[4]=0,d[8]=0,d[12]=b,d[1]=0,d[5]=m,d[9]=0,d[13]=x,d[2]=0,d[6]=0,d[10]=v,d[14]=T,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let n=0;n<16;n++)if(t[n]!==s[n])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}const hu=new z,Si=new Ze,HP=new z(0,0,0),jP=new z(1,1,1),Va=new z,nf=new z,En=new z,NN=new Ze,AN=new sa;class fi{constructor(e=0,t=0,s=0,n=fi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=s,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,n=this._order){return this._x=e,this._y=t,this._z=s,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,s=!0){const n=e.elements,a=n[0],l=n[4],u=n[8],h=n[1],d=n[5],f=n[9],m=n[2],b=n[6],x=n[10];switch(t){case"XYZ":this._y=Math.asin(Ge(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,x),this._z=Math.atan2(-l,a)):(this._x=Math.atan2(b,d),this._z=0);break;case"YXZ":this._x=Math.asin(-Ge(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(u,x),this._z=Math.atan2(h,d)):(this._y=Math.atan2(-m,a),this._z=0);break;case"ZXY":this._x=Math.asin(Ge(b,-1,1)),Math.abs(b)<.9999999?(this._y=Math.atan2(-m,x),this._z=Math.atan2(-l,d)):(this._y=0,this._z=Math.atan2(h,a));break;case"ZYX":this._y=Math.asin(-Ge(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(b,x),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-l,d));break;case"YZX":this._z=Math.asin(Ge(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(u,x));break;case"XZY":this._z=Math.asin(-Ge(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(b,d),this._y=Math.atan2(u,a)):(this._x=Math.atan2(-f,x),this._y=0);break;default:ue("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return NN.makeRotationFromQuaternion(e),this.setFromRotationMatrix(NN,t,s)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return AN.setFromEuler(this),this.setFromQuaternion(AN,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}fi.DEFAULT_ORDER="XYZ";class $P{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let WP=0;const CN=new z,du=new sa,Lr=new Ze,rf=new z,mh=new z,XP=new z,YP=new sa,EN=new z(1,0,0),RN=new z(0,1,0),BN=new z(0,0,1),DN={type:"added"},KP={type:"removed"},pu={type:"childadded",child:null},V0={type:"childremoved",child:null};class us extends la{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:WP++}),this.uuid=Zr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=us.DEFAULT_UP.clone();const e=new z,t=new fi,s=new sa,n=new z(1,1,1);function a(){s.setFromEuler(t,!1)}function l(){t.setFromQuaternion(s,void 0,!1)}t._onChange(a),s._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ze},normalMatrix:{value:new bn}}),this.matrix=new Ze,this.matrixWorld=new Ze,this.matrixAutoUpdate=us.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=us.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $P,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.static=!1,this.userData={},this.pivot=null}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return du.setFromAxisAngle(e,t),this.quaternion.multiply(du),this}rotateOnWorldAxis(e,t){return du.setFromAxisAngle(e,t),this.quaternion.premultiply(du),this}rotateX(e){return this.rotateOnAxis(EN,e)}rotateY(e){return this.rotateOnAxis(RN,e)}rotateZ(e){return this.rotateOnAxis(BN,e)}translateOnAxis(e,t){return CN.copy(e).applyQuaternion(this.quaternion),this.position.add(CN.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(EN,e)}translateY(e){return this.translateOnAxis(RN,e)}translateZ(e){return this.translateOnAxis(BN,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Lr.copy(this.matrixWorld).invert())}lookAt(e,t,s){e.isVector3?rf.copy(e):rf.set(e,t,s);const n=this.parent;this.updateWorldMatrix(!0,!1),mh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lr.lookAt(mh,rf,this.up):Lr.lookAt(rf,mh,this.up),this.quaternion.setFromRotationMatrix(Lr),n&&(Lr.extractRotation(n.matrixWorld),du.setFromRotationMatrix(Lr),this.quaternion.premultiply(du.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(le("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(DN),pu.child=e,this.dispatchEvent(pu),pu.child=null):le("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(KP),V0.child=e,this.dispatchEvent(V0),V0.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Lr.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Lr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Lr),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(DN),pu.child=e,this.dispatchEvent(pu),pu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let s=0,n=this.children.length;s<n;s++){const l=this.children[s].getObjectByProperty(e,t);if(l!==void 0)return l}}getObjectsByProperty(e,t,s=[]){this[e]===t&&s.push(this);const n=this.children;for(let a=0,l=n.length;a<l;a++)n[a].getObjectsByProperty(e,t,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mh,e,XP),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mh,YP,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let s=0,n=t.length;s<n;s++)t[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let s=0,n=t.length;s<n;s++)t[s].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const e=this.pivot;if(e!==null){const t=e.x,s=e.y,n=e.z,a=this.matrix.elements;a[12]+=t-a[0]*t-a[4]*s-a[8]*n,a[13]+=s-a[1]*t-a[5]*s-a[9]*n,a[14]+=n-a[2]*t-a[6]*s-a[10]*n}this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let s=0,n=t.length;s<n;s++)t[s].updateMatrixWorld(e)}updateWorldMatrix(e,t){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const n=this.children;for(let a=0,l=n.length;a<l;a++)n[a].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",s={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),this.static!==!1&&(n.static=this.static),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.pivot!==null&&(n.pivot=this.pivot.toArray()),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.morphTargetDictionary!==void 0&&(n.morphTargetDictionary=Object.assign({},this.morphTargetDictionary)),this.morphTargetInfluences!==void 0&&(n.morphTargetInfluences=this.morphTargetInfluences.slice()),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.geometryInfo=this._geometryInfo.map(u=>({...u,boundingBox:u.boundingBox?u.boundingBox.toJSON():void 0,boundingSphere:u.boundingSphere?u.boundingSphere.toJSON():void 0})),n.instanceInfo=this._instanceInfo.map(u=>({...u})),n.availableInstanceIds=this._availableInstanceIds.slice(),n.availableGeometryIds=this._availableGeometryIds.slice(),n.nextIndexStart=this._nextIndexStart,n.nextVertexStart=this._nextVertexStart,n.geometryCount=this._geometryCount,n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.matricesTexture=this._matricesTexture.toJSON(e),n.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(n.boundingBox=this.boundingBox.toJSON()));function a(u,h){return u[h.uuid]===void 0&&(u[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=a(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const h=u.shapes;if(Array.isArray(h))for(let d=0,f=h.length;d<f;d++){const m=h[d];a(e.shapes,m)}else a(e.shapes,h)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let h=0,d=this.material.length;h<d;h++)u.push(a(e.materials,this.material[h]));n.material=u}else n.material=a(e.materials,this.material);if(this.children.length>0){n.children=[];for(let u=0;u<this.children.length;u++)n.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let u=0;u<this.animations.length;u++){const h=this.animations[u];n.animations.push(a(e.animations,h))}}if(t){const u=l(e.geometries),h=l(e.materials),d=l(e.textures),f=l(e.images),m=l(e.shapes),b=l(e.skeletons),x=l(e.animations),v=l(e.nodes);u.length>0&&(s.geometries=u),h.length>0&&(s.materials=h),d.length>0&&(s.textures=d),f.length>0&&(s.images=f),m.length>0&&(s.shapes=m),b.length>0&&(s.skeletons=b),x.length>0&&(s.animations=x),v.length>0&&(s.nodes=v)}return s.object=n,s;function l(u){const h=[];for(const d in u){const f=u[d];delete f.metadata,h.push(f)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),e.pivot!==null&&(this.pivot=e.pivot.clone()),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.static=e.static,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let s=0;s<e.children.length;s++){const n=e.children[s];this.add(n.clone())}return this}}us.DEFAULT_UP=new z(0,1,0);us.DEFAULT_MATRIX_AUTO_UPDATE=!0;us.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class af extends us{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ZP={type:"move"};class QP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new af,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new af,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new z,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new z),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new af,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new z,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new z),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const s of e.hand.values())this._getHandJoint(t,s)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,s){let n=null,a=null,l=null;const u=this._targetRay,h=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){l=!0;for(const T of e.hand.values()){const w=t.getJointPose(T,s),N=this._getHandJoint(d,T);w!==null&&(N.matrix.fromArray(w.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),N.matrixWorldNeedsUpdate=!0,N.jointRadius=w.radius),N.visible=w!==null}const f=d.joints["index-finger-tip"],m=d.joints["thumb-tip"],b=f.position.distanceTo(m.position),x=.02,v=.005;d.inputState.pinching&&b>x+v?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&b<=x-v&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,s),a!==null&&(h.matrix.fromArray(a.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,a.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(a.linearVelocity)):h.hasLinearVelocity=!1,a.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(a.angularVelocity)):h.hasAngularVelocity=!1));u!==null&&(n=t.getPose(e.targetRaySpace,s),n===null&&a!==null&&(n=a),n!==null&&(u.matrix.fromArray(n.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,n.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(n.linearVelocity)):u.hasLinearVelocity=!1,n.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(n.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(ZP)))}return u!==null&&(u.visible=n!==null),h!==null&&(h.visible=a!==null),d!==null&&(d.visible=l!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const s=new af;s.matrixAutoUpdate=!1,s.visible=!1,e.joints[t.jointName]=s,e.add(s)}return e.joints[t.jointName]}}const cE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},za={h:0,s:0,l:0},of={h:0,s:0,l:0};function z0(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class it{constructor(e,t,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,s)}set(e,t,s){if(t===void 0&&s===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Un){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,nt.colorSpaceToWorking(this,t),this}setRGB(e,t,s,n=nt.workingColorSpace){return this.r=e,this.g=t,this.b=s,nt.colorSpaceToWorking(this,n),this}setHSL(e,t,s,n=nt.workingColorSpace){if(e=X_(e,1),t=Ge(t,0,1),s=Ge(s,0,1),t===0)this.r=this.g=this.b=s;else{const a=s<=.5?s*(1+t):s+t-s*t,l=2*s-a;this.r=z0(l,a,e+1/3),this.g=z0(l,a,e),this.b=z0(l,a,e-1/3)}return nt.colorSpaceToWorking(this,n),this}setStyle(e,t=Un){function s(a){a!==void 0&&parseFloat(a)<1&&ue("Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const l=n[1],u=n[2];switch(l){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return s(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,t);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return s(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,t);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return s(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,t);break;default:ue("Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=n[1],l=a.length;if(l===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,t);if(l===6)return this.setHex(parseInt(a,16),t);ue("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Un){const s=cE[e.toLowerCase()];return s!==void 0?this.setHex(s,t):ue("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Qr(e.r),this.g=Qr(e.g),this.b=Qr(e.b),this}copyLinearToSRGB(e){return this.r=Hu(e.r),this.g=Hu(e.g),this.b=Hu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Un){return nt.workingToColorSpace(Us.copy(this),e),Math.round(Ge(Us.r*255,0,255))*65536+Math.round(Ge(Us.g*255,0,255))*256+Math.round(Ge(Us.b*255,0,255))}getHexString(e=Un){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=nt.workingColorSpace){nt.workingToColorSpace(Us.copy(this),t);const s=Us.r,n=Us.g,a=Us.b,l=Math.max(s,n,a),u=Math.min(s,n,a);let h,d;const f=(u+l)/2;if(u===l)h=0,d=0;else{const m=l-u;switch(d=f<=.5?m/(l+u):m/(2-l-u),l){case s:h=(n-a)/m+(n<a?6:0);break;case n:h=(a-s)/m+2;break;case a:h=(s-n)/m+4;break}h/=6}return e.h=h,e.s=d,e.l=f,e}getRGB(e,t=nt.workingColorSpace){return nt.workingToColorSpace(Us.copy(this),t),e.r=Us.r,e.g=Us.g,e.b=Us.b,e}getStyle(e=Un){nt.workingToColorSpace(Us.copy(this),e);const t=Us.r,s=Us.g,n=Us.b;return e!==Un?`color(${e} ${t.toFixed(3)} ${s.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(s*255)},${Math.round(n*255)})`}offsetHSL(e,t,s){return this.getHSL(za),this.setHSL(za.h+e,za.s+t,za.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(za),e.getHSL(of);const s=$h(za.h,of.h,t),n=$h(za.s,of.s,t),a=$h(za.l,of.l,t);return this.setHSL(s,n,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,s=this.g,n=this.b,a=e.elements;return this.r=a[0]*t+a[3]*s+a[6]*n,this.g=a[1]*t+a[4]*s+a[7]*n,this.b=a[2]*t+a[5]*s+a[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Us=new it;it.NAMES=cE;class Z_ extends us{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new fi,this.environmentIntensity=1,this.environmentRotation=new fi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const wi=new z,Ur=new z,I0=new z,Fr=new z,fu=new z,mu=new z,LN=new z,k0=new z,G0=new z,q0=new z,H0=new rt,j0=new rt,$0=new rt;class Ci{constructor(e=new z,t=new z,s=new z){this.a=e,this.b=t,this.c=s}static getNormal(e,t,s,n){n.subVectors(s,t),wi.subVectors(e,t),n.cross(wi);const a=n.lengthSq();return a>0?n.multiplyScalar(1/Math.sqrt(a)):n.set(0,0,0)}static getBarycoord(e,t,s,n,a){wi.subVectors(n,t),Ur.subVectors(s,t),I0.subVectors(e,t);const l=wi.dot(wi),u=wi.dot(Ur),h=wi.dot(I0),d=Ur.dot(Ur),f=Ur.dot(I0),m=l*d-u*u;if(m===0)return a.set(0,0,0),null;const b=1/m,x=(d*h-u*f)*b,v=(l*f-u*h)*b;return a.set(1-x-v,v,x)}static containsPoint(e,t,s,n){return this.getBarycoord(e,t,s,n,Fr)===null?!1:Fr.x>=0&&Fr.y>=0&&Fr.x+Fr.y<=1}static getInterpolation(e,t,s,n,a,l,u,h){return this.getBarycoord(e,t,s,n,Fr)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(a,Fr.x),h.addScaledVector(l,Fr.y),h.addScaledVector(u,Fr.z),h)}static getInterpolatedAttribute(e,t,s,n,a,l){return H0.setScalar(0),j0.setScalar(0),$0.setScalar(0),H0.fromBufferAttribute(e,t),j0.fromBufferAttribute(e,s),$0.fromBufferAttribute(e,n),l.setScalar(0),l.addScaledVector(H0,a.x),l.addScaledVector(j0,a.y),l.addScaledVector($0,a.z),l}static isFrontFacing(e,t,s,n){return wi.subVectors(s,t),Ur.subVectors(e,t),wi.cross(Ur).dot(n)<0}set(e,t,s){return this.a.copy(e),this.b.copy(t),this.c.copy(s),this}setFromPointsAndIndices(e,t,s,n){return this.a.copy(e[t]),this.b.copy(e[s]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,s,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return wi.subVectors(this.c,this.b),Ur.subVectors(this.a,this.b),wi.cross(Ur).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ci.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ci.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,s,n,a){return Ci.getInterpolation(e,this.a,this.b,this.c,t,s,n,a)}containsPoint(e){return Ci.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ci.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const s=this.a,n=this.b,a=this.c;let l,u;fu.subVectors(n,s),mu.subVectors(a,s),k0.subVectors(e,s);const h=fu.dot(k0),d=mu.dot(k0);if(h<=0&&d<=0)return t.copy(s);G0.subVectors(e,n);const f=fu.dot(G0),m=mu.dot(G0);if(f>=0&&m<=f)return t.copy(n);const b=h*m-f*d;if(b<=0&&h>=0&&f<=0)return l=h/(h-f),t.copy(s).addScaledVector(fu,l);q0.subVectors(e,a);const x=fu.dot(q0),v=mu.dot(q0);if(v>=0&&x<=v)return t.copy(a);const T=x*d-h*v;if(T<=0&&d>=0&&v<=0)return u=d/(d-v),t.copy(s).addScaledVector(mu,u);const w=f*v-x*m;if(w<=0&&m-f>=0&&x-v>=0)return LN.subVectors(a,n),u=(m-f)/(m-f+(x-v)),t.copy(n).addScaledVector(LN,u);const N=1/(w+T+b);return l=T*N,u=b*N,t.copy(s).addScaledVector(fu,l).addScaledVector(mu,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}class bd{constructor(e=new z(1/0,1/0,1/0),t=new z(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t+=3)this.expandByPoint(Mi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,s=e.count;t<s;t++)this.expandByPoint(Mi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const s=Mi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0){const a=s.getAttribute("position");if(t===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let l=0,u=a.count;l<u;l++)e.isMesh===!0?e.getVertexPosition(l,Mi):Mi.fromBufferAttribute(a,l),Mi.applyMatrix4(e.matrixWorld),this.expandByPoint(Mi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),lf.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),lf.copy(s.boundingBox)),lf.applyMatrix4(e.matrixWorld),this.union(lf)}const n=e.children;for(let a=0,l=n.length;a<l;a++)this.expandByObject(n[a],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Mi),Mi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,s;return e.normal.x>0?(t=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),t<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(gh),uf.subVectors(this.max,gh),gu.subVectors(e.a,gh),yu.subVectors(e.b,gh),bu.subVectors(e.c,gh),Ia.subVectors(yu,gu),ka.subVectors(bu,yu),jo.subVectors(gu,bu);let t=[0,-Ia.z,Ia.y,0,-ka.z,ka.y,0,-jo.z,jo.y,Ia.z,0,-Ia.x,ka.z,0,-ka.x,jo.z,0,-jo.x,-Ia.y,Ia.x,0,-ka.y,ka.x,0,-jo.y,jo.x,0];return!W0(t,gu,yu,bu,uf)||(t=[1,0,0,0,1,0,0,0,1],!W0(t,gu,yu,bu,uf))?!1:(cf.crossVectors(Ia,ka),t=[cf.x,cf.y,cf.z],W0(t,gu,yu,bu,uf))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Mi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Mi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Pr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Pr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Pr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Pr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Pr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Pr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Pr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Pr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Pr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Pr=[new z,new z,new z,new z,new z,new z,new z,new z],Mi=new z,lf=new bd,gu=new z,yu=new z,bu=new z,Ia=new z,ka=new z,jo=new z,gh=new z,uf=new z,cf=new z,$o=new z;function W0(i,e,t,s,n){for(let a=0,l=i.length-3;a<=l;a+=3){$o.fromArray(i,a);const u=n.x*Math.abs($o.x)+n.y*Math.abs($o.y)+n.z*Math.abs($o.z),h=e.dot($o),d=t.dot($o),f=s.dot($o);if(Math.max(-Math.max(h,d,f),Math.min(h,d,f))>u)return!1}return!0}const qr=JP();function JP(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),s=new Uint32Array(512),n=new Uint32Array(512);for(let h=0;h<256;++h){const d=h-127;d<-27?(s[h]=0,s[h|256]=32768,n[h]=24,n[h|256]=24):d<-14?(s[h]=1024>>-d-14,s[h|256]=1024>>-d-14|32768,n[h]=-d-1,n[h|256]=-d-1):d<=15?(s[h]=d+15<<10,s[h|256]=d+15<<10|32768,n[h]=13,n[h|256]=13):d<128?(s[h]=31744,s[h|256]=64512,n[h]=24,n[h|256]=24):(s[h]=31744,s[h|256]=64512,n[h]=13,n[h|256]=13)}const a=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64);for(let h=1;h<1024;++h){let d=h<<13,f=0;for(;(d&8388608)===0;)d<<=1,f-=8388608;d&=-8388609,f+=947912704,a[h]=d|f}for(let h=1024;h<2048;++h)a[h]=939524096+(h-1024<<13);for(let h=1;h<31;++h)l[h]=h<<23;l[31]=1199570944,l[32]=2147483648;for(let h=33;h<63;++h)l[h]=2147483648+(h-32<<23);l[63]=3347054592;for(let h=1;h<64;++h)h!==32&&(u[h]=1024);return{floatView:e,uint32View:t,baseTable:s,shiftTable:n,mantissaTable:a,exponentTable:l,offsetTable:u}}function Rn(i){Math.abs(i)>65504&&ue("DataUtils.toHalfFloat(): Value out of range."),i=Ge(i,-65504,65504),qr.floatView[0]=i;const e=qr.uint32View[0],t=e>>23&511;return qr.baseTable[t]+((e&8388607)>>qr.shiftTable[t])}function hf(i){const e=i>>10;return qr.uint32View[0]=qr.mantissaTable[qr.offsetTable[e]+(i&1023)]+qr.exponentTable[e],qr.floatView[0]}const os=new z,df=new Ue;let eO=0;class Vn{constructor(e,t,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:eO++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=s,this.usage=sc,this.updateRanges=[],this.gpuType=cn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,s){e*=this.itemSize,s*=t.itemSize;for(let n=0,a=this.itemSize;n<a;n++)this.array[e+n]=t.array[s+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,s=this.count;t<s;t++)df.fromBufferAttribute(this,t),df.applyMatrix3(e),this.setXY(t,df.x,df.y);else if(this.itemSize===3)for(let t=0,s=this.count;t<s;t++)os.fromBufferAttribute(this,t),os.applyMatrix3(e),this.setXYZ(t,os.x,os.y,os.z);return this}applyMatrix4(e){for(let t=0,s=this.count;t<s;t++)os.fromBufferAttribute(this,t),os.applyMatrix4(e),this.setXYZ(t,os.x,os.y,os.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)os.fromBufferAttribute(this,t),os.applyNormalMatrix(e),this.setXYZ(t,os.x,os.y,os.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)os.fromBufferAttribute(this,t),os.transformDirection(e),this.setXYZ(t,os.x,os.y,os.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let s=this.array[e*this.itemSize+t];return this.normalized&&(s=Xs(s,this.array)),s}setComponent(e,t,s){return this.normalized&&(s=Ie(s,this.array)),this.array[e*this.itemSize+t]=s,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Xs(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Xs(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Xs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Xs(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,s){return e*=this.itemSize,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array)),this.array[e+0]=t,this.array[e+1]=s,this}setXYZ(e,t,s,n){return e*=this.itemSize,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array),n=Ie(n,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=n,this}setXYZW(e,t,s,n,a){return e*=this.itemSize,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array),n=Ie(n,this.array),a=Ie(a,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=n,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==sc&&(e.usage=this.usage),e}}class hE extends Vn{constructor(e,t,s){super(new Uint16Array(e),t,s)}}class dE extends Vn{constructor(e,t,s){super(new Uint32Array(e),t,s)}}class pE extends Vn{constructor(e,t,s){super(new Uint16Array(e),t,s),this.isFloat16BufferAttribute=!0}getX(e){let t=hf(this.array[e*this.itemSize]);return this.normalized&&(t=Xs(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize]=Rn(t),this}getY(e){let t=hf(this.array[e*this.itemSize+1]);return this.normalized&&(t=Xs(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize+1]=Rn(t),this}getZ(e){let t=hf(this.array[e*this.itemSize+2]);return this.normalized&&(t=Xs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize+2]=Rn(t),this}getW(e){let t=hf(this.array[e*this.itemSize+3]);return this.normalized&&(t=Xs(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ie(t,this.array)),this.array[e*this.itemSize+3]=Rn(t),this}setXY(e,t,s){return e*=this.itemSize,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array)),this.array[e+0]=Rn(t),this.array[e+1]=Rn(s),this}setXYZ(e,t,s,n){return e*=this.itemSize,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array),n=Ie(n,this.array)),this.array[e+0]=Rn(t),this.array[e+1]=Rn(s),this.array[e+2]=Rn(n),this}setXYZW(e,t,s,n,a){return e*=this.itemSize,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array),n=Ie(n,this.array),a=Ie(a,this.array)),this.array[e+0]=Rn(t),this.array[e+1]=Rn(s),this.array[e+2]=Rn(n),this.array[e+3]=Rn(a),this}}class Ks extends Vn{constructor(e,t,s){super(new Float32Array(e),t,s)}}const tO=new bd,yh=new z,X0=new z;class Sg{constructor(e=new z,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const s=this.center;t!==void 0?s.copy(t):tO.setFromPoints(e).getCenter(s);let n=0;for(let a=0,l=e.length;a<l;a++)n=Math.max(n,s.distanceToSquared(e[a]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const s=this.center.distanceToSquared(e);return t.copy(e),s>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;yh.subVectors(e,this.center);const t=yh.lengthSq();if(t>this.radius*this.radius){const s=Math.sqrt(t),n=(s-this.radius)*.5;this.center.addScaledVector(yh,n/s),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(X0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(yh.copy(e.center).add(X0)),this.expandByPoint(yh.copy(e.center).sub(X0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}let sO=0;const ei=new Ze,Y0=new us,xu=new z,Bn=new bd,bh=new bd,xs=new z;class pr extends la{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:sO++}),this.uuid=Zr(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vP(e)?dE:hE)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,s=0){this.groups.push({start:e,count:t,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const a=new bn().getNormalMatrix(e);s.applyNormalMatrix(a),s.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ei.makeRotationFromQuaternion(e),this.applyMatrix4(ei),this}rotateX(e){return ei.makeRotationX(e),this.applyMatrix4(ei),this}rotateY(e){return ei.makeRotationY(e),this.applyMatrix4(ei),this}rotateZ(e){return ei.makeRotationZ(e),this.applyMatrix4(ei),this}translate(e,t,s){return ei.makeTranslation(e,t,s),this.applyMatrix4(ei),this}scale(e,t,s){return ei.makeScale(e,t,s),this.applyMatrix4(ei),this}lookAt(e){return Y0.lookAt(e),Y0.updateMatrix(),this.applyMatrix4(Y0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xu).negate(),this.translate(xu.x,xu.y,xu.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const s=[];for(let n=0,a=e.length;n<a;n++){const l=e[n];s.push(l.x,l.y,l.z||0)}this.setAttribute("position",new Ks(s,3))}else{const s=Math.min(e.length,t.count);for(let n=0;n<s;n++){const a=e[n];t.setXYZ(n,a.x,a.y,a.z||0)}e.length>t.count&&ue("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new bd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){le("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new z(-1/0,-1/0,-1/0),new z(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let s=0,n=t.length;s<n;s++){const a=t[s];Bn.setFromBufferAttribute(a),this.morphTargetsRelative?(xs.addVectors(this.boundingBox.min,Bn.min),this.boundingBox.expandByPoint(xs),xs.addVectors(this.boundingBox.max,Bn.max),this.boundingBox.expandByPoint(xs)):(this.boundingBox.expandByPoint(Bn.min),this.boundingBox.expandByPoint(Bn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&le('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sg);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){le("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new z,1/0);return}if(e){const s=this.boundingSphere.center;if(Bn.setFromBufferAttribute(e),t)for(let a=0,l=t.length;a<l;a++){const u=t[a];bh.setFromBufferAttribute(u),this.morphTargetsRelative?(xs.addVectors(Bn.min,bh.min),Bn.expandByPoint(xs),xs.addVectors(Bn.max,bh.max),Bn.expandByPoint(xs)):(Bn.expandByPoint(bh.min),Bn.expandByPoint(bh.max))}Bn.getCenter(s);let n=0;for(let a=0,l=e.count;a<l;a++)xs.fromBufferAttribute(e,a),n=Math.max(n,s.distanceToSquared(xs));if(t)for(let a=0,l=t.length;a<l;a++){const u=t[a],h=this.morphTargetsRelative;for(let d=0,f=u.count;d<f;d++)xs.fromBufferAttribute(u,d),h&&(xu.fromBufferAttribute(e,d),xs.add(xu)),n=Math.max(n,s.distanceToSquared(xs))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&le('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){le("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=t.position,n=t.normal,a=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Vn(new Float32Array(4*s.count),4));const l=this.getAttribute("tangent"),u=[],h=[];for(let I=0;I<s.count;I++)u[I]=new z,h[I]=new z;const d=new z,f=new z,m=new z,b=new Ue,x=new Ue,v=new Ue,T=new z,w=new z;function N(I,$,ae){d.fromBufferAttribute(s,I),f.fromBufferAttribute(s,$),m.fromBufferAttribute(s,ae),b.fromBufferAttribute(a,I),x.fromBufferAttribute(a,$),v.fromBufferAttribute(a,ae),f.sub(d),m.sub(d),x.sub(b),v.sub(b);const pe=1/(x.x*v.y-v.x*x.y);isFinite(pe)&&(T.copy(f).multiplyScalar(v.y).addScaledVector(m,-x.y).multiplyScalar(pe),w.copy(m).multiplyScalar(x.x).addScaledVector(f,-v.x).multiplyScalar(pe),u[I].add(T),u[$].add(T),u[ae].add(T),h[I].add(w),h[$].add(w),h[ae].add(w))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.count}]);for(let I=0,$=C.length;I<$;++I){const ae=C[I],pe=ae.start,me=ae.count;for(let xe=pe,Ce=pe+me;xe<Ce;xe+=3)N(e.getX(xe+0),e.getX(xe+1),e.getX(xe+2))}const R=new z,E=new z,k=new z,q=new z;function D(I){k.fromBufferAttribute(n,I),q.copy(k);const $=u[I];R.copy($),R.sub(k.multiplyScalar(k.dot($))).normalize(),E.crossVectors(q,$);const pe=E.dot(h[I])<0?-1:1;l.setXYZW(I,R.x,R.y,R.z,pe)}for(let I=0,$=C.length;I<$;++I){const ae=C[I],pe=ae.start,me=ae.count;for(let xe=pe,Ce=pe+me;xe<Ce;xe+=3)D(e.getX(xe+0)),D(e.getX(xe+1)),D(e.getX(xe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Vn(new Float32Array(t.count*3),3),this.setAttribute("normal",s);else for(let b=0,x=s.count;b<x;b++)s.setXYZ(b,0,0,0);const n=new z,a=new z,l=new z,u=new z,h=new z,d=new z,f=new z,m=new z;if(e)for(let b=0,x=e.count;b<x;b+=3){const v=e.getX(b+0),T=e.getX(b+1),w=e.getX(b+2);n.fromBufferAttribute(t,v),a.fromBufferAttribute(t,T),l.fromBufferAttribute(t,w),f.subVectors(l,a),m.subVectors(n,a),f.cross(m),u.fromBufferAttribute(s,v),h.fromBufferAttribute(s,T),d.fromBufferAttribute(s,w),u.add(f),h.add(f),d.add(f),s.setXYZ(v,u.x,u.y,u.z),s.setXYZ(T,h.x,h.y,h.z),s.setXYZ(w,d.x,d.y,d.z)}else for(let b=0,x=t.count;b<x;b+=3)n.fromBufferAttribute(t,b+0),a.fromBufferAttribute(t,b+1),l.fromBufferAttribute(t,b+2),f.subVectors(l,a),m.subVectors(n,a),f.cross(m),s.setXYZ(b+0,f.x,f.y,f.z),s.setXYZ(b+1,f.x,f.y,f.z),s.setXYZ(b+2,f.x,f.y,f.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,s=e.count;t<s;t++)xs.fromBufferAttribute(e,t),xs.normalize(),e.setXYZ(t,xs.x,xs.y,xs.z)}toNonIndexed(){function e(u,h){const d=u.array,f=u.itemSize,m=u.normalized,b=new d.constructor(h.length*f);let x=0,v=0;for(let T=0,w=h.length;T<w;T++){u.isInterleavedBufferAttribute?x=h[T]*u.data.stride+u.offset:x=h[T]*f;for(let N=0;N<f;N++)b[v++]=d[x++]}return new Vn(b,f,m)}if(this.index===null)return ue("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new pr,s=this.index.array,n=this.attributes;for(const u in n){const h=n[u],d=e(h,s);t.setAttribute(u,d)}const a=this.morphAttributes;for(const u in a){const h=[],d=a[u];for(let f=0,m=d.length;f<m;f++){const b=d[f],x=e(b,s);h.push(x)}t.morphAttributes[u]=h}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,h=l.length;u<h;u++){const d=l[u];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const d in h)h[d]!==void 0&&(e[d]=h[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const s=this.attributes;for(const h in s){const d=s[h];e.data.attributes[h]=d.toJSON(e.data)}const n={};let a=!1;for(const h in this.morphAttributes){const d=this.morphAttributes[h],f=[];for(let m=0,b=d.length;m<b;m++){const x=d[m];f.push(x.toJSON(e.data))}f.length>0&&(n[h]=f,a=!0)}a&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere=u.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone());const n=e.attributes;for(const d in n){const f=n[d];this.setAttribute(d,f.clone(t))}const a=e.morphAttributes;for(const d in a){const f=[],m=a[d];for(let b=0,x=m.length;b<x;b++)f.push(m[b].clone(t));this.morphAttributes[d]=f}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let d=0,f=l.length;d<f;d++){const m=l[d];this.addGroup(m.start,m.count,m.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fE{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=sc,this.updateRanges=[],this.version=0,this.uuid=Zr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,s){e*=this.stride,s*=t.stride;for(let n=0,a=this.stride;n<a;n++)this.array[e+n]=t.array[s+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(t,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const js=new z;class Q_{constructor(e,t,s,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=s,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,s=this.data.count;t<s;t++)js.fromBufferAttribute(this,t),js.applyMatrix4(e),this.setXYZ(t,js.x,js.y,js.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)js.fromBufferAttribute(this,t),js.applyNormalMatrix(e),this.setXYZ(t,js.x,js.y,js.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)js.fromBufferAttribute(this,t),js.transformDirection(e),this.setXYZ(t,js.x,js.y,js.z);return this}getComponent(e,t){let s=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(s=Xs(s,this.array)),s}setComponent(e,t,s){return this.normalized&&(s=Ie(s,this.array)),this.data.array[e*this.data.stride+this.offset+t]=s,this}setX(e,t){return this.normalized&&(t=Ie(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ie(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ie(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ie(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Xs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Xs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Xs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Xs(t,this.array)),t}setXY(e,t,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this}setXYZ(e,t,s,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array),n=Ie(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=n,this}setXYZW(e,t,s,n,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ie(t,this.array),s=Ie(s,this.array),n=Ie(n,this.array),a=Ie(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=n,this.data.array[e+3]=a,this}clone(e){if(e===void 0){a_("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let s=0;s<this.count;s++){const n=s*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[n+a])}return new Vn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Q_(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){a_("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let s=0;s<this.count;s++){const n=s*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[n+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}let nO=0;class In extends la{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:nO++}),this.uuid=Zr(),this.name="",this.type="Material",this.blending=ri,this.side=tr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ed,this.blendDst=td,this.blendEquation=ai,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new it(0,0,0),this.blendAlpha=0,this.depthFunc=Qu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=i_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tl,this.stencilZFail=tl,this.stencilZPass=tl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const s=e[t];if(s===void 0){ue(`Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){ue(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(s):n&&n.isVector3&&s&&s.isVector3?n.copy(s):this[t]=s}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const s={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(s.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(s.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==ri&&(s.blending=this.blending),this.side!==tr&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==ed&&(s.blendSrc=this.blendSrc),this.blendDst!==td&&(s.blendDst=this.blendDst),this.blendEquation!==ai&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==Qu&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==i_&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tl&&(s.stencilFail=this.stencilFail),this.stencilZFail!==tl&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==tl&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.allowOverride===!1&&(s.allowOverride=!1),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function n(a){const l=[];for(const u in a){const h=a[u];delete h.metadata,l.push(h)}return l}if(t){const a=n(e.textures),l=n(e.images);a.length>0&&(s.textures=a),l.length>0&&(s.images=l)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let s=null;if(t!==null){const n=t.length;s=new Array(n);for(let a=0;a!==n;++a)s[a]=t[a].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class iO extends In{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new it(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Or=new z,K0=new z,pf=new z,Ga=new z,Z0=new z,ff=new z,Q0=new z;class mE{constructor(e=new z,t=new z(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Or)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const s=t.dot(this.direction);return s<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Or.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Or.copy(this.origin).addScaledVector(this.direction,t),Or.distanceToSquared(e))}distanceSqToSegment(e,t,s,n){K0.copy(e).add(t).multiplyScalar(.5),pf.copy(t).sub(e).normalize(),Ga.copy(this.origin).sub(K0);const a=e.distanceTo(t)*.5,l=-this.direction.dot(pf),u=Ga.dot(this.direction),h=-Ga.dot(pf),d=Ga.lengthSq(),f=Math.abs(1-l*l);let m,b,x,v;if(f>0)if(m=l*h-u,b=l*u-h,v=a*f,m>=0)if(b>=-v)if(b<=v){const T=1/f;m*=T,b*=T,x=m*(m+l*b+2*u)+b*(l*m+b+2*h)+d}else b=a,m=Math.max(0,-(l*b+u)),x=-m*m+b*(b+2*h)+d;else b=-a,m=Math.max(0,-(l*b+u)),x=-m*m+b*(b+2*h)+d;else b<=-v?(m=Math.max(0,-(-l*a+u)),b=m>0?-a:Math.min(Math.max(-a,-h),a),x=-m*m+b*(b+2*h)+d):b<=v?(m=0,b=Math.min(Math.max(-a,-h),a),x=b*(b+2*h)+d):(m=Math.max(0,-(l*a+u)),b=m>0?a:Math.min(Math.max(-a,-h),a),x=-m*m+b*(b+2*h)+d);else b=l>0?-a:a,m=Math.max(0,-(l*b+u)),x=-m*m+b*(b+2*h)+d;return s&&s.copy(this.origin).addScaledVector(this.direction,m),n&&n.copy(K0).addScaledVector(pf,b),x}intersectSphere(e,t){Or.subVectors(e.center,this.origin);const s=Or.dot(this.direction),n=Or.dot(Or)-s*s,a=e.radius*e.radius;if(n>a)return null;const l=Math.sqrt(a-n),u=s-l,h=s+l;return h<0?null:u<0?this.at(h,t):this.at(u,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(e.normal)+e.constant)/t;return s>=0?s:null}intersectPlane(e,t){const s=this.distanceToPlane(e);return s===null?null:this.at(s,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let s,n,a,l,u,h;const d=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,b=this.origin;return d>=0?(s=(e.min.x-b.x)*d,n=(e.max.x-b.x)*d):(s=(e.max.x-b.x)*d,n=(e.min.x-b.x)*d),f>=0?(a=(e.min.y-b.y)*f,l=(e.max.y-b.y)*f):(a=(e.max.y-b.y)*f,l=(e.min.y-b.y)*f),s>l||a>n||((a>s||isNaN(s))&&(s=a),(l<n||isNaN(n))&&(n=l),m>=0?(u=(e.min.z-b.z)*m,h=(e.max.z-b.z)*m):(u=(e.max.z-b.z)*m,h=(e.min.z-b.z)*m),s>h||u>n)||((u>s||s!==s)&&(s=u),(h<n||n!==n)&&(n=h),n<0)?null:this.at(s>=0?s:n,t)}intersectsBox(e){return this.intersectBox(e,Or)!==null}intersectTriangle(e,t,s,n,a){Z0.subVectors(t,e),ff.subVectors(s,e),Q0.crossVectors(Z0,ff);let l=this.direction.dot(Q0),u;if(l>0){if(n)return null;u=1}else if(l<0)u=-1,l=-l;else return null;Ga.subVectors(this.origin,e);const h=u*this.direction.dot(ff.crossVectors(Ga,ff));if(h<0)return null;const d=u*this.direction.dot(Z0.cross(Ga));if(d<0||h+d>l)return null;const f=-u*Ga.dot(Q0);return f<0?null:this.at(f/l,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Qa extends In{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new it(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fi,this.combine=mg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const UN=new Ze,Wo=new mE,mf=new Sg,FN=new z,gf=new z,yf=new z,bf=new z,J0=new z,xf=new z,PN=new z,_f=new z;class na extends us{constructor(e=new pr,t=new Qa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){const n=t[s[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=n.length;a<l;a++){const u=n[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}getVertexPosition(e,t){const s=this.geometry,n=s.attributes.position,a=s.morphAttributes.position,l=s.morphTargetsRelative;t.fromBufferAttribute(n,e);const u=this.morphTargetInfluences;if(a&&u){xf.set(0,0,0);for(let h=0,d=a.length;h<d;h++){const f=u[h],m=a[h];f!==0&&(J0.fromBufferAttribute(m,e),l?xf.addScaledVector(J0,f):xf.addScaledVector(J0.sub(t),f))}t.add(xf)}return t}raycast(e,t){const s=this.geometry,n=this.material,a=this.matrixWorld;n!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),mf.copy(s.boundingSphere),mf.applyMatrix4(a),Wo.copy(e.ray).recast(e.near),!(mf.containsPoint(Wo.origin)===!1&&(Wo.intersectSphere(mf,FN)===null||Wo.origin.distanceToSquared(FN)>(e.far-e.near)**2))&&(UN.copy(a).invert(),Wo.copy(e.ray).applyMatrix4(UN),!(s.boundingBox!==null&&Wo.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(e,t,Wo)))}_computeIntersections(e,t,s){let n;const a=this.geometry,l=this.material,u=a.index,h=a.attributes.position,d=a.attributes.uv,f=a.attributes.uv1,m=a.attributes.normal,b=a.groups,x=a.drawRange;if(u!==null)if(Array.isArray(l))for(let v=0,T=b.length;v<T;v++){const w=b[v],N=l[w.materialIndex],C=Math.max(w.start,x.start),R=Math.min(u.count,Math.min(w.start+w.count,x.start+x.count));for(let E=C,k=R;E<k;E+=3){const q=u.getX(E),D=u.getX(E+1),I=u.getX(E+2);n=vf(this,N,e,s,d,f,m,q,D,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=w.materialIndex,t.push(n))}}else{const v=Math.max(0,x.start),T=Math.min(u.count,x.start+x.count);for(let w=v,N=T;w<N;w+=3){const C=u.getX(w),R=u.getX(w+1),E=u.getX(w+2);n=vf(this,l,e,s,d,f,m,C,R,E),n&&(n.faceIndex=Math.floor(w/3),t.push(n))}}else if(h!==void 0)if(Array.isArray(l))for(let v=0,T=b.length;v<T;v++){const w=b[v],N=l[w.materialIndex],C=Math.max(w.start,x.start),R=Math.min(h.count,Math.min(w.start+w.count,x.start+x.count));for(let E=C,k=R;E<k;E+=3){const q=E,D=E+1,I=E+2;n=vf(this,N,e,s,d,f,m,q,D,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=w.materialIndex,t.push(n))}}else{const v=Math.max(0,x.start),T=Math.min(h.count,x.start+x.count);for(let w=v,N=T;w<N;w+=3){const C=w,R=w+1,E=w+2;n=vf(this,l,e,s,d,f,m,C,R,E),n&&(n.faceIndex=Math.floor(w/3),t.push(n))}}}}function rO(i,e,t,s,n,a,l,u){let h;if(e.side===Rs?h=s.intersectTriangle(l,a,n,!0,u):h=s.intersectTriangle(n,a,l,e.side===tr,u),h===null)return null;_f.copy(u),_f.applyMatrix4(i.matrixWorld);const d=t.ray.origin.distanceTo(_f);return d<t.near||d>t.far?null:{distance:d,point:_f.clone(),object:i}}function vf(i,e,t,s,n,a,l,u,h,d){i.getVertexPosition(u,gf),i.getVertexPosition(h,yf),i.getVertexPosition(d,bf);const f=rO(i,e,t,s,gf,yf,bf,PN);if(f){const m=new z;Ci.getBarycoord(PN,gf,yf,bf,m),n&&(f.uv=Ci.getInterpolatedAttribute(n,u,h,d,m,new Ue)),a&&(f.uv1=Ci.getInterpolatedAttribute(a,u,h,d,m,new Ue)),l&&(f.normal=Ci.getInterpolatedAttribute(l,u,h,d,m,new z),f.normal.dot(s.direction)>0&&f.normal.multiplyScalar(-1));const b={a:u,b:h,c:d,normal:new z,materialIndex:0};Ci.getNormal(gf,yf,bf,b.normal),f.face=b,f.barycoord=m}return f}class gE extends Is{constructor(e=null,t=1,s=1,n,a,l,u,h,d=qt,f=qt,m,b){super(null,l,u,h,d,f,n,a,m,b),this.isDataTexture=!0,this.image={data:e,width:t,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ju extends Vn{constructor(e,t,s,n=1){super(e,t,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const ex=new z,aO=new z,oO=new bn;class kr{constructor(e=new z(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,s,n){return this.normal.set(e,t,s),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,s){const n=ex.subVectors(s,t).cross(aO.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const s=e.delta(ex),n=this.normal.dot(s);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/n;return a<0||a>1?null:t.copy(e.start).addScaledVector(s,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return t<0&&s>0||s<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const s=t||oO.getNormalMatrix(e),n=this.coplanarPoint(ex).applyMatrix4(e),a=this.normal.applyMatrix3(s).normalize();return this.constant=-n.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Xo=new Sg,lO=new Ue(.5,.5),Tf=new z;class J_{constructor(e=new kr,t=new kr,s=new kr,n=new kr,a=new kr,l=new kr){this.planes=[e,t,s,n,a,l]}set(e,t,s,n,a,l){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(s),u[3].copy(n),u[4].copy(a),u[5].copy(l),this}copy(e){const t=this.planes;for(let s=0;s<6;s++)t[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e,t=On,s=!1){const n=this.planes,a=e.elements,l=a[0],u=a[1],h=a[2],d=a[3],f=a[4],m=a[5],b=a[6],x=a[7],v=a[8],T=a[9],w=a[10],N=a[11],C=a[12],R=a[13],E=a[14],k=a[15];if(n[0].setComponents(d-l,x-f,N-v,k-C).normalize(),n[1].setComponents(d+l,x+f,N+v,k+C).normalize(),n[2].setComponents(d+u,x+m,N+T,k+R).normalize(),n[3].setComponents(d-u,x-m,N-T,k-R).normalize(),s)n[4].setComponents(h,b,w,E).normalize(),n[5].setComponents(d-h,x-b,N-w,k-E).normalize();else if(n[4].setComponents(d-h,x-b,N-w,k-E).normalize(),t===On)n[5].setComponents(d+h,x+b,N+w,k+E).normalize();else if(t===pi)n[5].setComponents(h,b,w,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Xo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Xo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Xo)}intersectsSprite(e){Xo.center.set(0,0,0);const t=lO.distanceTo(e.center);return Xo.radius=.7071067811865476+t,Xo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xo)}intersectsSphere(e){const t=this.planes,s=e.center,n=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(s)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let s=0;s<6;s++){const n=t[s];if(Tf.x=n.normal.x>0?e.max.x:e.min.x,Tf.y=n.normal.y>0?e.max.y:e.min.y,Tf.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Tf)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let s=0;s<6;s++)if(t[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const zi=new Ze,Ii=new J_;class ev{constructor(){this.coordinateSystem=On}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zi.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Ii.setFromProjectionMatrix(zi,n.coordinateSystem,n.reversedDepth),Ii.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zi.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Ii.setFromProjectionMatrix(zi,n.coordinateSystem,n.reversedDepth),Ii.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zi.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Ii.setFromProjectionMatrix(zi,n.coordinateSystem,n.reversedDepth),Ii.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zi.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Ii.setFromProjectionMatrix(zi,n.coordinateSystem,n.reversedDepth),Ii.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zi.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Ii.setFromProjectionMatrix(zi,n.coordinateSystem,n.reversedDepth),Ii.containsPoint(e))return!0}return!1}clone(){return new ev}}class yE extends In{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new it(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class uO extends In{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new it(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class tv extends Is{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=qt,this.minFilter=qt,this.generateMipmaps=!1,this.needsUpdate=!0}}class wg extends Is{constructor(e=[],t=Ju,s,n,a,l,u,h,d,f){super(e,t,s,n,a,l,u,h,d,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class hi extends Is{constructor(e,t,s=Gt,n,a,l,u=qt,h=qt,d,f=Ri,m=1){if(f!==Ri&&f!==Yr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const b={width:e,height:t,depth:m};super(b,n,a,l,u,h,f,s,d),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new K_(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class cO extends hi{constructor(e,t=Gt,s=Ju,n,a,l=qt,u=qt,h,d=Ri){const f={width:e,height:e,depth:1},m=[f,f,f,f,f,f];super(e,e,t,s,n,a,l,u,h,d),this.image=m,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class Mg extends pr{constructor(e=1,t=1,s=1,n=1,a=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:s,widthSegments:n,heightSegments:a,depthSegments:l};const u=this;n=Math.floor(n),a=Math.floor(a),l=Math.floor(l);const h=[],d=[],f=[],m=[];let b=0,x=0;v("z","y","x",-1,-1,s,t,e,l,a,0),v("z","y","x",1,-1,s,t,-e,l,a,1),v("x","z","y",1,1,e,s,t,n,l,2),v("x","z","y",1,-1,e,s,-t,n,l,3),v("x","y","z",1,-1,e,t,s,n,a,4),v("x","y","z",-1,-1,e,t,-s,n,a,5),this.setIndex(h),this.setAttribute("position",new Ks(d,3)),this.setAttribute("normal",new Ks(f,3)),this.setAttribute("uv",new Ks(m,2));function v(T,w,N,C,R,E,k,q,D,I,$){const ae=E/D,pe=k/I,me=E/2,xe=k/2,Ce=q/2,ge=D+1,j=I+1;let oe=0,fe=0;const Ne=new z;for(let De=0;De<j;De++){const O=De*pe-xe;for(let ee=0;ee<ge;ee++){const de=ee*ae-me;Ne[T]=de*C,Ne[w]=O*R,Ne[N]=Ce,d.push(Ne.x,Ne.y,Ne.z),Ne[T]=0,Ne[w]=0,Ne[N]=q>0?1:-1,f.push(Ne.x,Ne.y,Ne.z),m.push(ee/D),m.push(1-De/I),oe+=1}}for(let De=0;De<I;De++)for(let O=0;O<D;O++){const ee=b+O+ge*De,de=b+O+ge*(De+1),we=b+(O+1)+ge*(De+1),Oe=b+(O+1)+ge*De;h.push(ee,de,Oe),h.push(de,we,Oe),fe+=6}u.addGroup(x,fe,$),x+=fe,b+=oe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mg(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}class sv extends pr{constructor(e=1,t=1,s=1,n=32,a=1,l=!1,u=0,h=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:s,radialSegments:n,heightSegments:a,openEnded:l,thetaStart:u,thetaLength:h};const d=this;n=Math.floor(n),a=Math.floor(a);const f=[],m=[],b=[],x=[];let v=0;const T=[],w=s/2;let N=0;C(),l===!1&&(e>0&&R(!0),t>0&&R(!1)),this.setIndex(f),this.setAttribute("position",new Ks(m,3)),this.setAttribute("normal",new Ks(b,3)),this.setAttribute("uv",new Ks(x,2));function C(){const E=new z,k=new z;let q=0;const D=(t-e)/s;for(let I=0;I<=a;I++){const $=[],ae=I/a,pe=ae*(t-e)+e;for(let me=0;me<=n;me++){const xe=me/n,Ce=xe*h+u,ge=Math.sin(Ce),j=Math.cos(Ce);k.x=pe*ge,k.y=-ae*s+w,k.z=pe*j,m.push(k.x,k.y,k.z),E.set(ge,D,j).normalize(),b.push(E.x,E.y,E.z),x.push(xe,1-ae),$.push(v++)}T.push($)}for(let I=0;I<n;I++)for(let $=0;$<a;$++){const ae=T[$][I],pe=T[$+1][I],me=T[$+1][I+1],xe=T[$][I+1];(e>0||$!==0)&&(f.push(ae,pe,xe),q+=3),(t>0||$!==a-1)&&(f.push(pe,me,xe),q+=3)}d.addGroup(N,q,0),N+=q}function R(E){const k=v,q=new Ue,D=new z;let I=0;const $=E===!0?e:t,ae=E===!0?1:-1;for(let me=1;me<=n;me++)m.push(0,w*ae,0),b.push(0,ae,0),x.push(.5,.5),v++;const pe=v;for(let me=0;me<=n;me++){const Ce=me/n*h+u,ge=Math.cos(Ce),j=Math.sin(Ce);D.x=$*j,D.y=w*ae,D.z=$*ge,m.push(D.x,D.y,D.z),b.push(0,ae,0),q.x=ge*.5+.5,q.y=j*.5*ae+.5,x.push(q.x,q.y),v++}for(let me=0;me<n;me++){const xe=k+me,Ce=pe+me;E===!0?f.push(Ce,Ce+1,xe):f.push(Ce+1,Ce,xe),I+=3}d.addGroup(N,I,E===!0?1:2),N+=I}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sv(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ng extends pr{constructor(e=1,t=1,s=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:s,heightSegments:n};const a=e/2,l=t/2,u=Math.floor(s),h=Math.floor(n),d=u+1,f=h+1,m=e/u,b=t/h,x=[],v=[],T=[],w=[];for(let N=0;N<f;N++){const C=N*b-l;for(let R=0;R<d;R++){const E=R*m-a;v.push(E,-C,0),T.push(0,0,1),w.push(R/u),w.push(1-N/h)}}for(let N=0;N<h;N++)for(let C=0;C<u;C++){const R=C+d*N,E=C+d*(N+1),k=C+1+d*(N+1),q=C+1+d*N;x.push(R,E,q),x.push(E,k,q)}this.setIndex(x),this.setAttribute("position",new Ks(v,3)),this.setAttribute("normal",new Ks(T,3)),this.setAttribute("uv",new Ks(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ng(e.width,e.height,e.widthSegments,e.heightSegments)}}class nv extends pr{constructor(e=1,t=32,s=16,n=0,a=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:s,phiStart:n,phiLength:a,thetaStart:l,thetaLength:u},t=Math.max(3,Math.floor(t)),s=Math.max(2,Math.floor(s));const h=Math.min(l+u,Math.PI);let d=0;const f=[],m=new z,b=new z,x=[],v=[],T=[],w=[];for(let N=0;N<=s;N++){const C=[],R=N/s;let E=0;N===0&&l===0?E=.5/t:N===s&&h===Math.PI&&(E=-.5/t);for(let k=0;k<=t;k++){const q=k/t;m.x=-e*Math.cos(n+q*a)*Math.sin(l+R*u),m.y=e*Math.cos(l+R*u),m.z=e*Math.sin(n+q*a)*Math.sin(l+R*u),v.push(m.x,m.y,m.z),b.copy(m).normalize(),T.push(b.x,b.y,b.z),w.push(q+E,1-R),C.push(d++)}f.push(C)}for(let N=0;N<s;N++)for(let C=0;C<t;C++){const R=f[N][C+1],E=f[N][C],k=f[N+1][C],q=f[N+1][C+1];(N!==0||l>0)&&x.push(R,E,q),(N!==s-1||h<Math.PI)&&x.push(E,k,q)}this.setIndex(x),this.setAttribute("position",new Ks(v,3)),this.setAttribute("normal",new Ks(T,3)),this.setAttribute("uv",new Ks(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class hO extends In{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new it(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class bE extends In{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new it(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dO extends bE{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ue(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ge(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new it(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new it(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new it(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class pO extends In{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new it(16777215),this.specular=new it(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fi,this.combine=mg,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class fO extends In{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new it(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class mO extends In{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class gO extends In{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new it(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fi,this.combine=mg,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class yO extends In{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new it(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class bO extends yE{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class bl extends us{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new it(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class xO extends bl{constructor(e,t,s){super(e,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(us.DEFAULT_UP),this.updateMatrix(),this.groundColor=new it(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const tx=new Ze,ON=new z,VN=new z;class iv{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.biasNode=null,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ue(512,512),this.mapType=Vs,this.map=null,this.mapPass=null,this.matrix=new Ze,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new J_,this._frameExtents=new Ue(1,1),this._viewportCount=1,this._viewports=[new rt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,s=this.matrix;ON.setFromMatrixPosition(e.matrixWorld),t.position.copy(ON),VN.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(VN),t.updateMatrixWorld(),tx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tx,t.coordinateSystem,t.reversedDepth),t.coordinateSystem===pi||t.reversedDepth?s.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(tx)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this.biasNode=e.biasNode,this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const Sf=new z,wf=new sa,ki=new z;class xE extends us{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ze,this.projectionMatrix=new Ze,this.projectionMatrixInverse=new Ze,this.coordinateSystem=On,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorld.decompose(Sf,wf,ki),ki.x===1&&ki.y===1&&ki.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(Sf,wf,ki.set(1,1,1)).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorld.decompose(Sf,wf,ki),ki.x===1&&ki.y===1&&ki.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(Sf,wf,ki.set(1,1,1)).invert()}clone(){return new this.constructor().copy(this)}}const qa=new z,zN=new Ue,IN=new Ue;class un extends xE{constructor(e=50,t=1,s=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=nc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(jh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return nc*2*Math.atan(Math.tan(jh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,s){qa.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(qa.x,qa.y).multiplyScalar(-e/qa.z),qa.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(qa.x,qa.y).multiplyScalar(-e/qa.z)}getViewSize(e,t){return this.getViewBounds(e,zN,IN),t.subVectors(IN,zN)}setViewOffset(e,t,s,n,a,l){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=n,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(jh*.5*this.fov)/this.zoom,s=2*t,n=this.aspect*s,a=-.5*n;const l=this.view;if(this.view!==null&&this.view.enabled){const h=l.fullWidth,d=l.fullHeight;a+=l.offsetX*n/h,t-=l.offsetY*s/d,n*=l.width/h,s*=l.height/d}const u=this.filmOffset;u!==0&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+n,t,t-s,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class _O extends iv{constructor(){super(new un(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,s=nc*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height*this.aspect,a=e.distance||t.far;(s!==t.fov||n!==t.aspect||a!==t.far)&&(t.fov=s,t.aspect=n,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class rv extends bl{constructor(e,t,s=0,n=Math.PI/3,a=0,l=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(us.DEFAULT_UP),this.updateMatrix(),this.target=new us,this.distance=s,this.angle=n,this.penumbra=a,this.decay=l,this.map=null,this.shadow=new _O}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class vO extends iv{constructor(){super(new un(90,1,.5,500)),this.isPointLightShadow=!0}}class TO extends bl{constructor(e,t,s=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=n,this.shadow=new vO}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class av extends xE{constructor(e=-1,t=1,s=1,n=-1,a=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=s,this.bottom=n,this.near=a,this.far=l,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,s,n,a,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=n,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let a=s-e,l=s+e,u=n+t,h=n-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=d*this.view.offsetX,l=a+d*this.view.width,u-=f*this.view.offsetY,h=u-f*this.view.height}this.projectionMatrix.makeOrthographic(a,l,u,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class SO extends iv{constructor(){super(new av(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class wO extends bl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(us.DEFAULT_UP),this.updateMatrix(),this.target=new us,this.shadow=new SO}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class MO extends bl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class NO extends bl{constructor(e,t,s=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class AO{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new z)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const s=e.x,n=e.y,a=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.282095),t.addScaledVector(l[1],.488603*n),t.addScaledVector(l[2],.488603*a),t.addScaledVector(l[3],.488603*s),t.addScaledVector(l[4],1.092548*(s*n)),t.addScaledVector(l[5],1.092548*(n*a)),t.addScaledVector(l[6],.315392*(3*a*a-1)),t.addScaledVector(l[7],1.092548*(s*a)),t.addScaledVector(l[8],.546274*(s*s-n*n)),t}getIrradianceAt(e,t){const s=e.x,n=e.y,a=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.886227),t.addScaledVector(l[1],2*.511664*n),t.addScaledVector(l[2],2*.511664*a),t.addScaledVector(l[3],2*.511664*s),t.addScaledVector(l[4],2*.429043*s*n),t.addScaledVector(l[5],2*.429043*n*a),t.addScaledVector(l[6],.743125*a*a-.247708),t.addScaledVector(l[7],2*.429043*s*a),t.addScaledVector(l[8],.429043*(s*s-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(e.coefficients[s],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let s=0;s<9;s++)this.coefficients[s].lerp(e.coefficients[s],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const s=this.coefficients;for(let n=0;n<9;n++)s[n].fromArray(e,t+n*3);return this}toArray(e=[],t=0){const s=this.coefficients;for(let n=0;n<9;n++)s[n].toArray(e,t+n*3);return e}static getBasisAt(e,t){const s=e.x,n=e.y,a=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*a,t[3]=.488603*s,t[4]=1.092548*s*n,t[5]=1.092548*n*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*s*a,t[8]=.546274*(s*s-n*n)}}class CO extends bl{constructor(e=new AO,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}const _u=-90,vu=1;class EO extends us{constructor(e,t,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new un(_u,vu,e,t);n.layers=this.layers,this.add(n);const a=new un(_u,vu,e,t);a.layers=this.layers,this.add(a);const l=new un(_u,vu,e,t);l.layers=this.layers,this.add(l);const u=new un(_u,vu,e,t);u.layers=this.layers,this.add(u);const h=new un(_u,vu,e,t);h.layers=this.layers,this.add(h);const d=new un(_u,vu,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[s,n,a,l,u,h]=t;for(const d of t)this.remove(d);if(e===On)s.up.set(0,1,0),s.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else if(e===pi)s.up.set(0,-1,0),s.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,l,u,h,d,f]=this.children,m=e.getRenderTarget(),b=e.getActiveCubeFace(),x=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;const T=s.texture.generateMipmaps;s.texture.generateMipmaps=!1;let w=!1;e.isWebGLRenderer===!0?w=e.state.buffers.depth.getReversed():w=e.reversedDepthBuffer,e.setRenderTarget(s,0,n),w&&e.autoClear===!1&&e.clearDepth(),e.render(t,a),e.setRenderTarget(s,1,n),w&&e.autoClear===!1&&e.clearDepth(),e.render(t,l),e.setRenderTarget(s,2,n),w&&e.autoClear===!1&&e.clearDepth(),e.render(t,u),e.setRenderTarget(s,3,n),w&&e.autoClear===!1&&e.clearDepth(),e.render(t,h),e.setRenderTarget(s,4,n),w&&e.autoClear===!1&&e.clearDepth(),e.render(t,d),s.texture.generateMipmaps=T,e.setRenderTarget(s,5,n),w&&e.autoClear===!1&&e.clearDepth(),e.render(t,f),e.setRenderTarget(m,b,x),e.xr.enabled=v,s.texture.needsPMREMUpdate=!0}}class RO extends un{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class BO extends fE{constructor(e,t,s=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class kN{constructor(e=1,t=0,s=0){this.radius=e,this.phi=t,this.theta=s}set(e,t,s){return this.radius=e,this.phi=t,this.theta=s,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Ge(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,s){return this.radius=Math.sqrt(e*e+t*t+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,s),this.phi=Math.acos(Ge(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Ag{constructor(e,t,s,n){Ag.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,s,n)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let s=0;s<4;s++)this.elements[s]=e[s+t];return this}set(e,t,s,n){const a=this.elements;return a[0]=e,a[2]=t,a[1]=s,a[3]=n,this}}class DO extends la{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){ue("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function LO(i,e,t,s){const n=UO(s);switch(t){case tE:return i*e;case yg:return i*e/n.components*n.byteLength;case bg:return i*e/n.components*n.byteLength;case Zi:return i*e*2/n.components*n.byteLength;case xg:return i*e*2/n.components*n.byteLength;case gg:return i*e*3/n.components*n.byteLength;case Pn:return i*e*4/n.components*n.byteLength;case _g:return i*e*4/n.components*n.byteLength;case kh:case Gh:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case qh:case Hh:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case t_:case n_:return Math.max(i,16)*Math.max(e,8)/4;case e_:case s_:return Math.max(i,8)*Math.max(e,8)/2;case _m:case vm:case Sm:case wm:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case Tm:case nd:case Mm:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Nm:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Am:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case Cm:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case Em:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case Rm:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case Bm:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case Dm:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Lm:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case Um:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case Fm:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Pm:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Om:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Vm:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case zm:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Im:case nP:case iP:return Math.ceil(i/4)*Math.ceil(e/4)*16;case km:case Gm:return Math.ceil(i/4)*Math.ceil(e/4)*8;case id:case qm:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function UO(i){switch(i){case Vs:case Gu:return{byteLength:1,components:1};case rl:case qu:case Cs:return{byteLength:2,components:1};case JC:case eE:return{byteLength:2,components:4};case Gt:case Ps:case cn:return{byteLength:4,components:1};case j_:case $_:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:yd}}));typeof window<"u"&&(window.__THREE__?ue("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=yd);const FO=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],sx=new WeakMap;class PO{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=FO,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:s,material:n,object:a}=e;if(t={material:this.getMaterialData(n),geometry:{id:s.id,attributes:this.getAttributesData(s.attributes),indexId:s.index?s.index.id:null,indexVersion:s.index?s.index.version:null,drawRange:{start:s.drawRange.start,count:s.drawRange.count}},worldMatrix:a.matrixWorld.clone()},a.center&&(t.center=a.center.clone()),a.morphTargetInfluences&&(t.morphTargetInfluences=a.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:l,height:u}=e.context;t.bufferWidth=l,t.bufferHeight=u}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const s in e){const n=e[s];t[s]={id:n.id,version:n.version}}return t}containsNode(e){const t=e.material;for(const s in t)if(t[s]&&t[s].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const s of this.refreshUniforms){const n=e[s];n!=null&&(typeof n=="object"&&n.clone!==void 0?n.isTexture===!0?t[s]={id:n.id,version:n.version}:t[s]=n.clone():t[s]=n)}return t}equals(e,t){const{object:s,material:n,geometry:a}=e,l=this.getRenderObjectData(e);if(l.worldMatrix.equals(s.matrixWorld)!==!0)return l.worldMatrix.copy(s.matrixWorld),!1;const u=l.material;for(const C in u){const R=u[C],E=n[C];if(R.equals!==void 0){if(R.equals(E)===!1)return R.copy(E),!1}else if(E.isTexture===!0){if(R.id!==E.id||R.version!==E.version)return R.id=E.id,R.version=E.version,!1}else if(R!==E)return u[C]=E,!1}if(u.transmission>0){const{width:C,height:R}=e.context;if(l.bufferWidth!==C||l.bufferHeight!==R)return l.bufferWidth=C,l.bufferHeight=R,!1}const h=l.geometry,d=a.attributes,f=h.attributes,m=Object.keys(f),b=Object.keys(d);if(h.id!==a.id)return h.id=a.id,!1;if(m.length!==b.length)return l.geometry.attributes=this.getAttributesData(d),!1;for(const C of m){const R=f[C],E=d[C];if(E===void 0)return delete f[C],!1;if(R.id!==E.id||R.version!==E.version)return R.id=E.id,R.version=E.version,!1}const x=a.index,v=h.indexId,T=h.indexVersion,w=x?x.id:null,N=x?x.version:null;if(v!==w||T!==N)return h.indexId=w,h.indexVersion=N,!1;if(h.drawRange.start!==a.drawRange.start||h.drawRange.count!==a.drawRange.count)return h.drawRange.start=a.drawRange.start,h.drawRange.count=a.drawRange.count,!1;if(l.morphTargetInfluences){let C=!1;for(let R=0;R<l.morphTargetInfluences.length;R++)l.morphTargetInfluences[R]!==s.morphTargetInfluences[R]&&(l.morphTargetInfluences[R]=s.morphTargetInfluences[R],C=!0);if(C)return!1}if(l.lights){for(let C=0;C<t.length;C++)if(l.lights[C].map!==t[C].map)return!1}return l.center&&l.center.equals(s.center)===!1?(l.center.copy(s.center),!0):(e.bundle!==null&&(l.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const s of e)s.isSpotLight===!0&&s.map!==null&&t.push({map:s.map.version});return t}getLights(e,t){if(sx.has(e)){const n=sx.get(e);if(n.renderId===t)return n.lightsData}const s=this.getLightsData(e.getLights());return sx.set(e,{renderId:t,lightsData:s}),s}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:s}=t;if(this.renderId!==s)return this.renderId=s,!0;const n=e.object.static===!0,a=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(n||a)return!1;const l=this.getLights(e.lightsNode,s);return this.equals(e,l)!==!0}}const OO=[/^StackTrace\.js$/,/^TSLCore\.js$/,/^.*Node\.js$/,/^three\.webgpu.*\.js$/];function VO(i){const e=/(?:at\s+(.+?)\s+\()?(?:(.+?)@)?([^@\s()]+):(\d+):(\d+)/;return i.split(`
`).map(t=>{const s=t.match(e);if(!s)return null;const n=s[1]||s[2]||"",a=s[3].split("?")[0],l=parseInt(s[4],10),u=parseInt(s[5],10),h=a.split("/").pop();return{fn:n,file:h,line:l,column:u}}).filter(t=>t&&!OO.some(s=>s.test(t.file)))}class Zt{constructor(e=null){this.isStackTrace=!0,this.stack=VO(e||new Error().stack)}getLocation(){if(this.stack.length===0)return"[Unknown location]";const e=this.stack[0],t=e.fn;return`${t?`"${t}()" at `:""}"${e.file}:${e.line}"`}getError(e){if(this.stack.length===0)return e;const t=this.stack.map(s=>{const n=`${s.file}:${s.line}:${s.column}`;return s.fn?`    at ${s.fn} (${n})`:`    at ${n}`}).join(`
`);return`${e}
${t}`}}function ov(i,e=0){let t=3735928559^e,s=1103547991^e;if(i instanceof Array)for(let n=0,a;n<i.length;n++)a=i[n],t=Math.imul(t^a,2654435761),s=Math.imul(s^a,1597334677);else for(let n=0,a;n<i.length;n++)a=i.charCodeAt(n),t=Math.imul(t^a,2654435761),s=Math.imul(s^a,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&s)+(t>>>0)}const hc=i=>ov(i),xd=i=>ov(i),Wh=(...i)=>ov(i),zO=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),GN=new WeakMap;function _E(i){return zO.get(i)}function Wm(i){if(/[iu]?vec\d/.test(i))return i.startsWith("ivec")?Int32Array:i.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(i)||/float/.test(i))return Float32Array;if(/uint/.test(i))return Uint32Array;if(/int/.test(i))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${i}`)}function vE(i){if(/float|int|uint/.test(i))return 1;if(/vec2/.test(i))return 2;if(/vec3/.test(i))return 3;if(/vec4/.test(i)||/mat2/.test(i))return 4;if(/mat3/.test(i))return 9;if(/mat4/.test(i))return 16;le(`TSL: Unsupported type: ${i}`,new Zt)}function IO(i){if(/float|int|uint/.test(i))return 1;if(/vec2/.test(i))return 2;if(/vec3/.test(i))return 3;if(/vec4/.test(i)||/mat2/.test(i))return 4;if(/mat3/.test(i))return 12;if(/mat4/.test(i))return 16;le(`TSL: Unsupported type: ${i}`,new Zt)}function kO(i){if(/float|int|uint/.test(i))return 4;if(/vec2/.test(i))return 8;if(/vec3/.test(i)||/vec4/.test(i))return 16;if(/mat2/.test(i))return 8;if(/mat3/.test(i)||/mat4/.test(i))return 16;le(`TSL: Unsupported type: ${i}`,new Zt)}function io(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function lv(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new it(...e):t==="vec2"?new Ue(...e):t==="vec3"?new z(...e):t==="vec4"?new rt(...e):t==="mat2"?new Ag(...e):t==="mat3"?new bn(...e):t==="mat4"?new Ze(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?qO(e[0]):null}function TE(i){let e=GN.get(i);return e===void 0&&(e={},GN.set(i,e)),e}function GO(i){let e="";const t=new Uint8Array(i);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function qO(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}const Oh={VERTEX:"vertex",FRAGMENT:"fragment"},Re={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},HO={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},Es={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},SE=["fragment","vertex"],o_=["setup","analyze","generate"],l_=[...SE,"compute"],xl=["x","y","z","w"],jO={analyze:"setup",generate:"analyze"};let $O=0;class be extends la{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Re.NONE,this.updateBeforeType=Re.NONE,this.updateAfterType=Re.NONE,this.uuid=Y_.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:$O++}),this.stackTrace=null,be.captureStackTrace===!0&&(this.stackTrace=new Zt)}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Re.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Re.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Re.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const s of Object.getOwnPropertyNames(this)){const n=this[s];if(!(s.startsWith("_")===!0||e.has(n))){if(Array.isArray(n)===!0)for(let a=0;a<n.length;a++){const l=n[a];l&&l.isNode===!0&&t.push({property:s,index:a,childNode:l})}else if(n&&n.isNode===!0)t.push({property:s,childNode:n});else if(n&&Object.getPrototypeOf(n)===Object.prototype)for(const a in n){if(a.startsWith("_")===!0)continue;const l=n[a];l&&l.isNode===!0&&t.push({property:s,index:a,childNode:l})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const s=[];for(const{property:n,childNode:a}of this._getChildren(t))s.push(hc(n.slice(0,-4)),a.getCacheKey(e,t));this._cacheKey=Wh(xd(s),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let s=0;for(const n of this.getChildren())t["node"+s++]=n;return t.outputNode||null}analyze(e,t=null){const s=e.increaseUsage(this);if(this.parents===!0){const n=e.getDataFromNode(this,"any");n.stages=n.stages||{},n.stages[e.shaderStage]=n.stages[e.shaderStage]||[],n.stages[e.shaderStage].push(t)}if(s===1){const n=e.getNodeProperties(this);for(const a of Object.values(n))a&&a.isNode===!0&&a.build(e,this)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){ue("Abstract function.")}updateAfter(){ue("Abstract function.")}update(){ue("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);if(this._beforeNodes!==null){const h=this._beforeNodes;this._beforeNodes=null;for(const d of h)d.build(e,t);this._beforeNodes=h}const n=e.getDataFromNode(this);n.buildStages=n.buildStages||{},n.buildStages[e.buildStage]=!0;const a=jO[e.buildStage];if(a&&n.buildStages[a]!==!0){const h=e.getBuildStage();e.setBuildStage(a),this.build(e),e.setBuildStage(h)}e.addChain(this);let l=null;const u=e.getBuildStage();if(u==="setup"){e.addNode(this),this.updateReference(e);const h=e.getNodeProperties(this);if(h.initialized!==!0){h.initialized=!0,h.outputNode=this.setup(e)||h.outputNode||null;for(const d of Object.values(h))if(d&&d.isNode===!0){if(d.parents===!0){const f=e.getNodeProperties(d);f.parents=f.parents||[],f.parents.push(this)}d.build(e)}e.addSequentialNode(this)}l=h.outputNode}else if(u==="analyze")this.analyze(e,t);else if(u==="generate"){if(this.generate.length<2){const d=this.getNodeType(e),f=e.getDataFromNode(this);l=f.snippet,l===void 0?f.generated===void 0?(f.generated=!0,l=this.generate(e)||"",f.snippet=l):(ue("Node: Recursion detected.",this),l="/* Recursion detected. */"):f.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),l=e.format(l,d,t)}else l=this.generate(e,t)||"";l===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(le(`TSL: Invalid generated code, expected a "${t}".`),l=e.generateConst(t))}return e.removeChain(this),l}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:n,index:a,childNode:l}of t)a!==void 0?(s[n]===void 0&&(s[n]=Number.isInteger(a)?[]:{}),s[n][a]=l.toJSON(e.meta).uuid):s[n]=l.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const n=[];for(const a of e.inputNodes[s])n.push(t[a]);this[s]=n}else if(typeof e.inputNodes[s]=="object"){const n={};for(const a in e.inputNodes[s]){const l=e.inputNodes[s][a];n[a]=t[l]}this[s]=n}else{const n=e.inputNodes[s];this[s]=t[n]}}}toJSON(e){const{uuid:t,type:s}=this,n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{},nodes:{}});let a=e.nodes[t];a===void 0&&(a={uuid:t,type:s,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},n!==!0&&(e.nodes[a.uuid]=a),this.serialize(a),delete a.meta);function l(u){const h=[];for(const d in u){const f=u[d];delete f.metadata,h.push(f)}return h}if(n){const u=l(e.textures),h=l(e.images),d=l(e.nodes);u.length>0&&(a.textures=u),h.length>0&&(a.images=h),d.length>0&&(a.nodes=d)}return a}}be.captureStackTrace=!1;class _l extends be{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),s=this.node.build(e),n=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${s}[ ${n} ]`}}class wE extends be{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const n of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(n))&&(s=n);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,n=this.getNodeType(e),a=s.build(e,n);return e.format(a,n,t)}}class jt extends be{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,t)),a=e.getDataFromNode(this);if(a.propertyName!==void 0)return e.format(a.propertyName,n,t);if(n!=="void"&&t!=="void"&&this.hasDependencies(e)){const l=super.build(e,n),u=e.getVarFromNode(this,null,n),h=e.getPropertyName(u);return e.addLineFlowCode(`${h} = ${l}`,this),a.snippet=l,a.propertyName=h,e.format(a.propertyName,n,t)}}return super.build(e,t)}}class WO extends jt{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),n=e.getTypeLength(s),a=this.nodes,l=e.getComponentType(s),u=[];let h=0;for(const f of a){if(h>=n){le(`TSL: Length of parameters exceeds maximum length of function '${s}()' type.`,this.stackTrace);break}let m=f.getNodeType(e),b=e.getTypeLength(m),x;if(h+b>n&&(le(`TSL: Length of '${s}()' data exceeds maximum length of output type.`,this.stackTrace),b=n-h,m=e.getTypeFromLength(b)),h+=b,x=f.build(e,m),e.getComponentType(m)!==l){const T=e.getTypeFromLength(b,l);x=e.format(x,m,T)}u.push(x)}const d=`${e.getType(s)}( ${u.join(", ")} )`;return e.format(d,s,t)}}const XO=xl.join("");class ME extends be{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(xl.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const s=this.node,n=e.getTypeLength(s.getNodeType(e));let a=null;if(n>1){let l=null;this.getVectorLength()>=n&&(l=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const h=s.build(e,l);this.components.length===n&&this.components===XO.slice(0,this.components.length)?a=e.format(h,l,t):a=e.format(`${h}.${this.components}`,this.getNodeType(e),t)}else a=s.build(e,t);return a}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class YO extends jt{static get type(){return"SetNode"}constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:n}=this,a=this.getNodeType(e),l=e.getComponentType(n.getNodeType(e)),u=e.getTypeFromLength(s.length,l),h=n.build(e,u),d=t.build(e,a),f=e.getTypeLength(a),m=[];for(let b=0;b<f;b++){const x=xl[b];x===s[0]?(m.push(h),b+=s.length-1):m.push(d+"."+x)}return`${e.getType(a)}( ${m.join(", ")} )`}}class KO extends jt{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:s}=this,n=this.getNodeType(e),a=s.build(e),l=e.getVarFromNode(this),u=e.getPropertyName(l);e.addLineFlowCode(u+" = "+a,this);const h=e.getTypeLength(n),d=[];let f=0;for(let m=0;m<h;m++){const b=xl[m];b===t[f]?(d.push("1.0 - "+(u+"."+b)),f++):d.push(u+"."+b)}return`${e.getType(n)}( ${d.join(", ")} )`}}class uv extends be{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?io(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=io(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=GO(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?lv(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){ue("Abstract function.")}}const qN=/float|u?int/;class bi extends uv{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return qN.test(s)&&qN.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),s,t)}}class ZO extends be{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const s=this.getNodeType(e);return e.getStructTypeNode(s).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){ue(`TSL: Member "${this.property}" does not exist in struct.`,this.stackTrace);const s=this.getNodeType(e);return e.generateConst(s)}return this.structNode.build(e)+"."+this.property}}let go=null;const u_=new Map;function Z(i,e){if(u_.has(i)){ue(`TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);u_.set(i,e),i!=="assign"&&(be.prototype[i]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},be.prototype[i+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const QO=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),HN=i=>QO(i).split("").sort().join("");be.prototype.assign=function(...i){if(this.isStackNode!==!0)return go!==null?go.assign(this,...i):le("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn().",new Zt),this;{const e=u_.get("assign");return this.addToStack(e(...i))}};be.prototype.toVarIntent=function(){return this};be.prototype.get=function(i){return new ZO(this,i)};const Xh={};function Mf(i,e,t){Xh[i]=Xh[e]=Xh[t]={get(){this._cache=this._cache||{};let l=this._cache[i];return l===void 0&&(l=new ME(this,i),this._cache[i]=l),l},set(l){this[i].assign(ye(l))}};const s=i.toUpperCase(),n=e.toUpperCase(),a=t.toUpperCase();be.prototype["set"+s]=be.prototype["set"+n]=be.prototype["set"+a]=function(l){const u=HN(i);return new YO(this,u,ye(l))},be.prototype["flip"+s]=be.prototype["flip"+n]=be.prototype["flip"+a]=function(){const l=HN(i);return new KO(this,l)}}const Gi=["x","y","z","w"],qi=["r","g","b","a"],Hi=["s","t","p","q"];for(let i=0;i<4;i++){let e=Gi[i],t=qi[i],s=Hi[i];Mf(e,t,s);for(let n=0;n<4;n++){e=Gi[i]+Gi[n],t=qi[i]+qi[n],s=Hi[i]+Hi[n],Mf(e,t,s);for(let a=0;a<4;a++){e=Gi[i]+Gi[n]+Gi[a],t=qi[i]+qi[n]+qi[a],s=Hi[i]+Hi[n]+Hi[a],Mf(e,t,s);for(let l=0;l<4;l++)e=Gi[i]+Gi[n]+Gi[a]+Gi[l],t=qi[i]+qi[n]+qi[a]+qi[l],s=Hi[i]+Hi[n]+Hi[a]+Hi[l],Mf(e,t,s)}}}for(let i=0;i<32;i++)Xh[i]={get(){this._cache=this._cache||{};let e=this._cache[i];return e===void 0&&(e=new _l(this,new bi(i,"uint")),this._cache[i]=e),e},set(e){this[i].assign(ye(e))}};Object.defineProperties(be.prototype,Xh);const jN=new WeakMap,JO=function(i,e=null){const t=io(i);return t==="node"?i:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?ye(c_(i,e)):t==="shader"?i.isFn?i:P(i):i},eV=function(i,e=null){for(const t in i)i[t]=ye(i[t],e);return i},tV=function(i,e=null){const t=i.length;for(let s=0;s<t;s++)i[s]=ye(i[s],e);return i},NE=function(i,e=null,t=null,s=null){function n(f){return s!==null?(f=ye(Object.assign(f,s)),s.intent===!0&&(f=f.toVarIntent())):f=ye(f),f}let a,l=e,u,h;function d(f){let m;return l?m=/[a-z]/i.test(l)?l+"()":l:m=i.type,u!==void 0&&f.length<u?(le(`TSL: "${m}" parameter length is less than minimum required.`,new Zt),f.concat(new Array(u-f.length).fill(0))):h!==void 0&&f.length>h?(le(`TSL: "${m}" parameter length exceeds limit.`,new Zt),f.slice(0,h)):f}return e===null?a=(...f)=>n(new i(...ul(d(f)))):t!==null?(t=ye(t),a=(...f)=>n(new i(e,...ul(d(f)),t))):a=(...f)=>n(new i(e,...ul(d(f)))),a.setParameterLength=(...f)=>(f.length===1?u=h=f[0]:f.length===2&&([u,h]=f),a),a.setName=f=>(l=f,a),a},sV=function(i,...e){return new i(...ul(e))};class nV extends be{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:s}=this,n=e.getNodeProperties(t),a=e.getClosestSubBuild(t.subBuilds)||"",l=a||"default";if(n[l])return n[l];const u=e.subBuildFn,h=e.fnCall;e.subBuildFn=a,e.fnCall=this;let d=null;if(t.layout){let f=jN.get(e.constructor);f===void 0&&(f=new WeakMap,jN.set(e.constructor,f));let m=f.get(t);m===void 0&&(m=ye(e.buildFunctionNode(t)),f.set(t,m)),e.addInclude(m);const b=s?iV(s):null;d=ye(m.call(b))}else{const f=new Proxy(e,{get:(T,w,N)=>{let C;return Symbol.iterator===w?C=function*(){yield void 0}:C=Reflect.get(T,w,N),C}}),m=s?rV(s):null,b=Array.isArray(s)?s.length>0:s!==null,x=t.jsFunc,v=b||x.length>1?x(m,f):x(f);d=ye(v)}return e.subBuildFn=u,e.fnCall=h,t.once&&(n[l]=d),d}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),s=e.getSubBuildOutput(this);return t[s]=t[s]||this.setupOutput(e),t[s].subBuild=e.getClosestSubBuild(this),t[s]}build(e,t=null){let s=null;const n=e.getBuildStage(),a=e.getNodeProperties(this),l=e.getSubBuildOutput(this),u=this.getOutputNode(e),h=e.fnCall;if(e.fnCall=this,n==="setup"){const d=e.getSubBuildProperty("initialized",this);if(a[d]!==!0&&(a[d]=!0,a[l]=this.getOutputNode(e),a[l].build(e),this.shaderNode.subBuilds))for(const f of e.chaining){const m=e.getDataFromNode(f,"any");m.subBuilds=m.subBuilds||new Set;for(const b of this.shaderNode.subBuilds)m.subBuilds.add(b)}s=a[l]}else n==="analyze"?u.build(e,t):n==="generate"&&(s=u.build(e,t)||"");return e.fnCall=h,s}}function iV(i){let e;return Rg(i),i[0]&&(i[0].isNode||Object.getPrototypeOf(i[0])!==Object.prototype)?e=[...i]:e=i[0],e}function rV(i){let e=0;return Rg(i),new Proxy(i,{get:(t,s,n)=>{let a;if(s==="length")return a=i.length,a;if(Symbol.iterator===s)a=function*(){for(const l of i)yield ye(l)};else{if(i.length>0)if(Object.getPrototypeOf(i[0])===Object.prototype){const l=i[0];l[s]===void 0?a=l[e++]:a=Reflect.get(l,s,n)}else i[0]instanceof be&&(i[s]===void 0?a=i[e++]:a=Reflect.get(i,s,n));else a=Reflect.get(t,s,n);a=ye(a)}return a}})}class aV extends be{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new nV(this,e)}setup(){return this.call()}}const oV=[!1,!0],lV=[0,1,2,3],uV=[-1,-2],AE=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],cv=new Map;for(const i of oV)cv.set(i,new bi(i));const hv=new Map;for(const i of lV)hv.set(i,new bi(i,"uint"));const dv=new Map([...hv].map(i=>new bi(i.value,"int")));for(const i of uV)dv.set(i,new bi(i,"int"));const Cg=new Map([...dv].map(i=>new bi(i.value)));for(const i of AE)Cg.set(i,new bi(i));for(const i of AE)Cg.set(-i,new bi(-i));const Eg={bool:cv,uint:hv,ints:dv,float:Cg},$N=new Map([...cv,...Cg]),c_=(i,e)=>$N.has(i)?$N.get(i):i.isNode===!0?i:new bi(i,e),cs=function(i,e=null){return(...t)=>{for(const n of t)if(n===void 0)return le(`TSL: Invalid parameter for the type "${i}".`,new Zt),new bi(0,i);if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(n=>{const a=typeof n;return a!=="object"&&a!=="function"}))&&(t=[lv(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Vh(e.get(t[0]));if(t.length===1){const n=c_(t[0],i);return n.nodeType===i?Vh(n):Vh(new wE(n,i))}const s=t.map(n=>c_(n));return Vh(new WO(s,i))}},ad=i=>typeof i=="object"&&i!==null?i.value:i,CE=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function zu(i,e){return new aV(i,e)}const ye=(i,e=null)=>JO(i,e),Vh=(i,e=null)=>ye(i,e).toVarIntent(),Rg=(i,e=null)=>new eV(i,e),ul=(i,e=null)=>new tV(i,e),Pe=(i,e=null,t=null,s=null)=>new NE(i,e,t,s),ce=(i,...e)=>new sV(i,...e),re=(i,e=null,t=null,s={})=>new NE(i,e,t,{...s,intent:!0});let cV=0;class hV extends be{constructor(e,t=null){super();let s=null;t!==null&&(typeof t=="object"?s=t.return:(typeof t=="string"?s=t:le("TSL: Invalid layout type.",new Zt),t=null)),this.shaderNode=new zu(e,s),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const s={name:"fn"+cV++,type:t,inputs:[]};for(const n in e)n!=="return"&&s.inputs.push({name:n,type:e[n]});e=s}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return le('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".',this.stackTrace),e.generateConst(t)}}function P(i,e=null){const t=new hV(i,e);return new Proxy(()=>{},{apply(s,n,a){return t.call(...a)},get(s,n,a){return Reflect.get(t,n,a)},set(s,n,a,l){return Reflect.set(t,n,a,l)}})}const od=i=>{go=i},pv=()=>go,Me=(...i)=>go.If(...i),dV=(...i)=>go.Switch(...i);function Bg(i){return go&&go.addToStack(i),i}Z("toStack",Bg);const EE=new cs("color"),A=new cs("float",Eg.float),B=new cs("int",Eg.ints),se=new cs("uint",Eg.uint),mi=new cs("bool",Eg.bool),ie=new cs("vec2"),ls=new cs("ivec2"),fv=new cs("uvec2"),RE=new cs("bvec2"),L=new cs("vec3"),mv=new cs("ivec3"),vl=new cs("uvec3"),gv=new cs("bvec3"),Se=new cs("vec4"),yv=new cs("ivec4"),bv=new cs("uvec4"),BE=new cs("bvec4"),Dg=new cs("mat2"),vs=new cs("mat3"),co=new cs("mat4"),pV=(i="")=>new bi(i,"string"),fV=i=>new bi(i,"ArrayBuffer");Z("toColor",EE);Z("toFloat",A);Z("toInt",B);Z("toUint",se);Z("toBool",mi);Z("toVec2",ie);Z("toIVec2",ls);Z("toUVec2",fv);Z("toBVec2",RE);Z("toVec3",L);Z("toIVec3",mv);Z("toUVec3",vl);Z("toBVec3",gv);Z("toVec4",Se);Z("toIVec4",yv);Z("toUVec4",bv);Z("toBVec4",BE);Z("toMat2",Dg);Z("toMat3",vs);Z("toMat4",co);const DE=Pe(_l).setParameterLength(2),LE=(i,e)=>new wE(ye(i),e),mV=(i,e)=>new ME(ye(i),e);Z("element",DE);Z("convert",LE);const gV=i=>(ue("TSL: append() has been renamed to Stack().",new Zt),Bg(i));Z("append",i=>(ue("TSL: .append() has been renamed to .toStack().",new Zt),Bg(i)));class at extends be{static get type(){return"PropertyNode"}constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return hc(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Jr=(i,e)=>new at(i,e),ld=(i,e)=>new at(i,e,!0),pt=ce(at,"vec4","DiffuseColor"),sl=ce(at,"vec3","DiffuseContribution"),h_=ce(at,"vec3","EmissiveColor"),Yi=ce(at,"float","Roughness"),jr=ce(at,"float","Metalness"),Xm=ce(at,"float","Clearcoat"),$u=ce(at,"float","ClearcoatRoughness"),Ln=ce(at,"vec3","Sheen"),Ja=ce(at,"float","SheenRoughness"),Lg=ce(at,"float","Iridescence"),Ym=ce(at,"float","IridescenceIOR"),Km=ce(at,"float","IridescenceThickness"),Zm=ce(at,"float","AlphaT"),Za=ce(at,"float","Anisotropy"),Yh=ce(at,"vec3","AnisotropyT"),cl=ce(at,"vec3","AnisotropyB"),yo=ce(at,"color","SpecularColor"),al=ce(at,"color","SpecularColorBlended"),ol=ce(at,"float","SpecularF90"),Qm=ce(at,"float","Shininess"),Wu=ce(at,"vec4","Output"),im=ce(at,"float","dashSize"),d_=ce(at,"float","gapSize"),yV=ce(at,"float","pointWidth"),Kh=ce(at,"float","IOR"),Jm=ce(at,"float","Transmission"),xv=ce(at,"float","Thickness"),_v=ce(at,"float","AttenuationDistance"),vv=ce(at,"color","AttenuationColor"),Tv=ce(at,"float","Dispersion");class UE extends be{static get type(){return"UniformGroupNode"}constructor(e,t=!1,s=1){super("string"),this.name=e,this.shared=t,this.order=s,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const FE=i=>new UE(i),Ug=(i,e=0)=>new UE(i,!0,e),PE=Ug("frame"),ve=Ug("render"),Sv=FE("object");class _d extends uv{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=Sv}setName(e){return this.name=e,this}label(e){return ue('TSL: "label()" has been deprecated. Use "setName()" instead.',new Zt),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(s=>{const n=e(s,this);n!==void 0&&(this.value=n)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const s=this.getNodeType(e),n=this.getUniformHash(e);let a=e.getNodeFromHash(n);a===void 0&&(e.setHashNode(this,n),a=this);const l=a.getInputType(e),u=e.getUniformFromNode(a,l,e.shaderStage,this.name||e.context.nodeName),h=e.getPropertyName(u);e.context.nodeName!==void 0&&delete e.context.nodeName;let d=h;if(s==="bool"){const f=e.getDataFromNode(this);let m=f.propertyName;if(m===void 0){const b=e.getVarFromNode(this,null,"bool");m=e.getPropertyName(b),f.propertyName=m,d=e.format(h,l,s),e.addLineFlowCode(`${m} = ${d}`,this)}d=m}return e.format(d,s,t)}}const _e=(i,e)=>{const t=CE(e||i);if(t===i&&(i=lv(t)),i&&i.isNode===!0){let s=i.value;i.traverse(n=>{n.isConstNode===!0&&(s=n.value)}),i=s}return new _d(i,t)};class WN extends jt{static get type(){return"ArrayNode"}constructor(e,t,s=null){super(e),this.count=t,this.values=s,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const OE=(...i)=>{let e;if(i.length===1){const t=i[0];e=new WN(null,t.length,t)}else{const t=i[0],s=i[1];e=new WN(t,s)}return ye(e)};Z("toArray",(i,e)=>OE(Array(e).fill(i)));class bV extends jt{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const s=e.getTypeLength(t.node.getNodeType(e));return xl.join("").slice(0,s)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:s}=this,n=t.getScope(),a=e.getDataFromNode(n);a.assign=!0;const l=e.getNodeProperties(this);l.sourceNode=s,l.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:s,sourceNode:n}=e.getNodeProperties(this),a=this.needsSplitAssign(e),l=s.build(e),u=s.getNodeType(e),h=n.build(e,u),d=n.getNodeType(e),f=e.getDataFromNode(this);let m;if(f.initialized===!0)t!=="void"&&(m=l);else if(a){const b=e.getVarFromNode(this,null,u),x=e.getPropertyName(b);e.addLineFlowCode(`${x} = ${h}`,this);const v=s.node,w=v.node.context({assign:!0}).build(e);for(let N=0;N<v.components.length;N++){const C=v.components[N];e.addLineFlowCode(`${w}.${C} = ${x}[ ${N} ]`,this)}t!=="void"&&(m=l)}else m=`${l} = ${h}`,(t==="void"||d==="void")&&(e.addLineFlowCode(m,this),t!=="void"&&(m=l));return f.initialized=!0,e.format(m,u,t)}}const VE=Pe(bV).setParameterLength(2);Z("assign",VE);class xV extends jt{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],s=this.functionNode,n=s.getInputs(e),a=this.parameters,l=(h,d)=>{const f=d.type,m=f==="pointer";let b;return m?b="&"+h.build(e):b=h.build(e,f),b};if(Array.isArray(a)){if(a.length>n.length)le("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),a.length=n.length;else if(a.length<n.length)for(le("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");a.length<n.length;)a.push(A(0));for(let h=0;h<a.length;h++)t.push(l(a[h],n[h]))}else for(const h of n){const d=a[h.name];d!==void 0?t.push(l(d,h)):(le(`TSL: Input '${h.name}' not found in 'Fn()'.`),t.push(l(A(0),h)))}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const zE=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?ul(e):Rg(e[0]),new xV(ye(i),e));Z("call",zE);const _V={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Vt extends jt{static get type(){return"OperatorNode"}constructor(e,t,s,...n){if(super(),n.length>0){let a=new Vt(e,t,s);for(let l=0;l<n.length-1;l++)a=new Vt(e,a,n[l]);t=a,s=n[n.length-1]}this.op=e,this.aNode=t,this.bNode=s,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(_V[this.op],t)}getNodeType(e,t=null){const s=this.op,n=this.aNode,a=this.bNode,l=n.getNodeType(e),u=a?a.getNodeType(e):null;if(l==="void"||u==="void")return t||"void";if(s==="%")return l;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(l);if(s==="!"||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="=="||s==="!="||s==="<"||s===">"||s==="<="||s===">="){const h=Math.max(e.getTypeLength(l),e.getTypeLength(u));return h>1?`bvec${h}`:"bool"}else{if(e.isMatrix(l)){if(u==="float")return l;if(e.isVector(u))return e.getVectorFromMatrix(l);if(e.isMatrix(u))return l}else if(e.isMatrix(u)){if(l==="float")return u;if(e.isVector(l))return e.getVectorFromMatrix(u)}return e.getTypeLength(u)>e.getTypeLength(l)?u:l}}generate(e,t){const s=this.op,{aNode:n,bNode:a}=this,l=this.getNodeType(e,t);let u=null,h=null;l!=="void"?(u=n.getNodeType(e),h=a?a.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="||s==="!="?e.isVector(u)?h=u:e.isVector(h)?u=h:u!==h&&(u=h="float"):s===">>"||s==="<<"?(u=l,h=e.changeComponentType(h,"uint")):s==="%"?(u=l,h=e.isInteger(u)&&e.isInteger(h)?h:u):e.isMatrix(u)?h==="float"?h="float":e.isVector(h)?h=e.getVectorFromMatrix(u):e.isMatrix(h)||(u=h=l):e.isMatrix(h)?u==="float"?u="float":e.isVector(u)?u=e.getVectorFromMatrix(h):u=h=l:u=h=l):u=h=l;const d=n.build(e,u),f=a?a.build(e,h):null,m=e.getFunctionOperator(s);if(t!=="void"){const b=e.renderer.coordinateSystem===On;if(s==="=="||s==="!="||s==="<"||s===">"||s==="<="||s===">=")return b?e.isVector(u)?e.format(`${this.getOperatorMethod(e,t)}( ${d}, ${f} )`,l,t):e.format(`( ${d} ${s} ${f} )`,l,t):e.format(`( ${d} ${s} ${f} )`,l,t);if(s==="%")return e.isInteger(h)?e.format(`( ${d} % ${f} )`,l,t):e.format(`${this.getOperatorMethod(e,l)}( ${d}, ${f} )`,l,t);if(s==="!"||s==="~")return e.format(`(${s}${d})`,u,t);if(m)return e.format(`${m}( ${d}, ${f} )`,l,t);if(e.isMatrix(u)&&h==="float")return e.format(`( ${f} ${s} ${d} )`,l,t);if(u==="float"&&e.isMatrix(h))return e.format(`${d} ${s} ${f}`,l,t);{let x=`( ${d} ${s} ${f} )`;return!b&&l==="bool"&&e.isVector(u)&&e.isVector(h)&&(x=`all${x}`),e.format(x,l,t)}}else if(u!=="void")return m?e.format(`${m}( ${d}, ${f} )`,l,t):e.isMatrix(u)&&h==="float"?e.format(`${f} ${s} ${d}`,l,t):e.format(`${d} ${s} ${f}`,l,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const ss=re(Vt,"+").setParameterLength(2,1/0).setName("add"),$e=re(Vt,"-").setParameterLength(2,1/0).setName("sub"),Be=re(Vt,"*").setParameterLength(2,1/0).setName("mul"),kn=re(Vt,"/").setParameterLength(2,1/0).setName("div"),vd=re(Vt,"%").setParameterLength(2).setName("mod"),IE=re(Vt,"==").setParameterLength(2).setName("equal"),kE=re(Vt,"!=").setParameterLength(2).setName("notEqual"),GE=re(Vt,"<").setParameterLength(2).setName("lessThan"),wv=re(Vt,">").setParameterLength(2).setName("greaterThan"),qE=re(Vt,"<=").setParameterLength(2).setName("lessThanEqual"),HE=re(Vt,">=").setParameterLength(2).setName("greaterThanEqual"),jE=re(Vt,"&&").setParameterLength(2,1/0).setName("and"),$E=re(Vt,"||").setParameterLength(2,1/0).setName("or"),WE=re(Vt,"!").setParameterLength(1).setName("not"),XE=re(Vt,"^^").setParameterLength(2).setName("xor"),YE=re(Vt,"&").setParameterLength(2).setName("bitAnd"),KE=re(Vt,"~").setParameterLength(1).setName("bitNot"),ZE=re(Vt,"|").setParameterLength(2).setName("bitOr"),QE=re(Vt,"^").setParameterLength(2).setName("bitXor"),JE=re(Vt,"<<").setParameterLength(2).setName("shiftLeft"),eR=re(Vt,">>").setParameterLength(2).setName("shiftRight"),tR=P(([i])=>(i.addAssign(1),i)),sR=P(([i])=>(i.subAssign(1),i)),nR=P(([i])=>{const e=B(i).toConst();return i.addAssign(1),e}),iR=P(([i])=>{const e=B(i).toConst();return i.subAssign(1),e});Z("add",ss);Z("sub",$e);Z("mul",Be);Z("div",kn);Z("mod",vd);Z("equal",IE);Z("notEqual",kE);Z("lessThan",GE);Z("greaterThan",wv);Z("lessThanEqual",qE);Z("greaterThanEqual",HE);Z("and",jE);Z("or",$E);Z("not",WE);Z("xor",XE);Z("bitAnd",YE);Z("bitNot",KE);Z("bitOr",ZE);Z("bitXor",QE);Z("shiftLeft",JE);Z("shiftRight",eR);Z("incrementBefore",tR);Z("decrementBefore",sR);Z("increment",nR);Z("decrement",iR);const rR=(i,e)=>(ue('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.',new Zt),vd(B(i),B(e)));Z("modInt",rR);class H extends jt{static get type(){return"MathNode"}constructor(e,t,s=null,n=null){if(super(),(e===H.MAX||e===H.MIN)&&arguments.length>3){let a=new H(e,t,s);for(let l=2;l<arguments.length-1;l++)a=new H(e,a,arguments[l]);t=a,s=arguments[arguments.length-1],n=null}this.method=e,this.aNode=t,this.bNode=s,this.cNode=n,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,a=e.isMatrix(t)?0:e.getTypeLength(t),l=e.isMatrix(s)?0:e.getTypeLength(s),u=e.isMatrix(n)?0:e.getTypeLength(n);return a>l&&a>u?t:l>u?s:u>a?n:t}getNodeType(e){const t=this.method;return t===H.LENGTH||t===H.DISTANCE||t===H.DOT?"float":t===H.CROSS?"vec3":t===H.ALL||t===H.ANY?"bool":t===H.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:s,method:n}=this;let a=null;if(n===H.ONE_MINUS)a=$e(1,t);else if(n===H.RECIPROCAL)a=kn(1,t);else if(n===H.DIFFERENCE)a=At($e(t,s));else if(n===H.TRANSFORM_DIRECTION){let l=t,u=s;e.isMatrix(l.getNodeType(e))?u=Se(L(u),0):l=Se(L(l),0);const h=Be(l,u).xyz;a=fn(h)}return a!==null?a:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let n=this.method;const a=this.getNodeType(e),l=this.getInputType(e),u=this.aNode,h=this.bNode,d=this.cNode,f=e.renderer.coordinateSystem;if(n===H.NEGATE)return e.format("( - "+u.build(e,l)+" )",a,t);{const m=[];return n===H.CROSS?m.push(u.build(e,a),h.build(e,a)):f===On&&n===H.STEP?m.push(u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":l),h.build(e,l)):f===On&&(n===H.MIN||n===H.MAX)?m.push(u.build(e,l),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":l)):n===H.REFRACT?m.push(u.build(e,l),h.build(e,l),d.build(e,"float")):n===H.MIX?m.push(u.build(e,l),h.build(e,l),d.build(e,e.getTypeLength(d.getNodeType(e))===1?"float":l)):(f===pi&&n===H.ATAN&&h!==null&&(n="atan2"),e.shaderStage!=="fragment"&&(n===H.DFDX||n===H.DFDY)&&(ue(`TSL: '${n}' is not supported in the ${e.shaderStage} stage.`,this.stackTrace),n="/*"+n+"*/"),m.push(u.build(e,l)),h!==null&&m.push(h.build(e,l)),d!==null&&m.push(d.build(e,l))),e.format(`${e.getMethod(n,a)}( ${m.join(", ")} )`,a,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}H.ALL="all";H.ANY="any";H.RADIANS="radians";H.DEGREES="degrees";H.EXP="exp";H.EXP2="exp2";H.LOG="log";H.LOG2="log2";H.SQRT="sqrt";H.INVERSE_SQRT="inversesqrt";H.FLOOR="floor";H.CEIL="ceil";H.NORMALIZE="normalize";H.FRACT="fract";H.SIN="sin";H.COS="cos";H.TAN="tan";H.ASIN="asin";H.ACOS="acos";H.ATAN="atan";H.ABS="abs";H.SIGN="sign";H.LENGTH="length";H.NEGATE="negate";H.ONE_MINUS="oneMinus";H.DFDX="dFdx";H.DFDY="dFdy";H.ROUND="round";H.RECIPROCAL="reciprocal";H.TRUNC="trunc";H.FWIDTH="fwidth";H.TRANSPOSE="transpose";H.DETERMINANT="determinant";H.INVERSE="inverse";H.EQUALS="equals";H.MIN="min";H.MAX="max";H.STEP="step";H.REFLECT="reflect";H.DISTANCE="distance";H.DIFFERENCE="difference";H.DOT="dot";H.CROSS="cross";H.POW="pow";H.TRANSFORM_DIRECTION="transformDirection";H.MIX="mix";H.CLAMP="clamp";H.REFRACT="refract";H.SMOOTHSTEP="smoothstep";H.FACEFORWARD="faceforward";const Mv=A(1e-6),vV=A(1e6),eg=A(Math.PI),TV=A(Math.PI*2),SV=A(Math.PI*2),wV=A(Math.PI*.5),aR=re(H,H.ALL).setParameterLength(1),oR=re(H,H.ANY).setParameterLength(1),lR=re(H,H.RADIANS).setParameterLength(1),uR=re(H,H.DEGREES).setParameterLength(1),Nv=re(H,H.EXP).setParameterLength(1),ic=re(H,H.EXP2).setParameterLength(1),Fg=re(H,H.LOG).setParameterLength(1),sr=re(H,H.LOG2).setParameterLength(1),Zs=re(H,H.SQRT).setParameterLength(1),Av=re(H,H.INVERSE_SQRT).setParameterLength(1),nr=re(H,H.FLOOR).setParameterLength(1),Pg=re(H,H.CEIL).setParameterLength(1),fn=re(H,H.NORMALIZE).setParameterLength(1),Di=re(H,H.FRACT).setParameterLength(1),Ws=re(H,H.SIN).setParameterLength(1),Ai=re(H,H.COS).setParameterLength(1),cR=re(H,H.TAN).setParameterLength(1),hR=re(H,H.ASIN).setParameterLength(1),Cv=re(H,H.ACOS).setParameterLength(1),Ev=re(H,H.ATAN).setParameterLength(1,2),At=re(H,H.ABS).setParameterLength(1),Rv=re(H,H.SIGN).setParameterLength(1),ir=re(H,H.LENGTH).setParameterLength(1),Bv=re(H,H.NEGATE).setParameterLength(1),dR=re(H,H.ONE_MINUS).setParameterLength(1),Dv=re(H,H.DFDX).setParameterLength(1),Lv=re(H,H.DFDY).setParameterLength(1),pR=re(H,H.ROUND).setParameterLength(1),fR=re(H,H.RECIPROCAL).setParameterLength(1),Uv=re(H,H.TRUNC).setParameterLength(1),Fv=re(H,H.FWIDTH).setParameterLength(1),mR=re(H,H.TRANSPOSE).setParameterLength(1),gR=re(H,H.DETERMINANT).setParameterLength(1),yR=re(H,H.INVERSE).setParameterLength(1),mn=re(H,H.MIN).setParameterLength(2,1/0),zt=re(H,H.MAX).setParameterLength(2,1/0),rc=re(H,H.STEP).setParameterLength(2),bR=re(H,H.REFLECT).setParameterLength(2),xR=re(H,H.DISTANCE).setParameterLength(2),_R=re(H,H.DIFFERENCE).setParameterLength(2),gi=re(H,H.DOT).setParameterLength(2),ia=re(H,H.CROSS).setParameterLength(2),oi=re(H,H.POW).setParameterLength(2),Pv=i=>Be(i,i),vR=i=>Be(i,i,i),Ov=i=>Be(i,i,i,i),TR=re(H,H.TRANSFORM_DIRECTION).setParameterLength(2),SR=i=>Be(Rv(i),oi(At(i),1/3)),Vv=i=>gi(i,i),qe=re(H,H.MIX).setParameterLength(3),Li=(i,e=0,t=1)=>new H(H.CLAMP,ye(i),ye(e),ye(t)),Og=i=>Li(i),zv=re(H,H.REFRACT).setParameterLength(3),Ui=re(H,H.SMOOTHSTEP).setParameterLength(3),Iv=re(H,H.FACEFORWARD).setParameterLength(3),wR=P(([i])=>{const s=43758.5453,n=gi(i.xy,ie(12.9898,78.233)),a=vd(n,eg);return Di(Ws(a).mul(s))}),MR=(i,e,t)=>qe(e,t,i),NR=(i,e,t)=>Ui(e,t,i),AR=(i,e)=>rc(e,i),MV=Iv,NV=Av;Z("all",aR);Z("any",oR);Z("radians",lR);Z("degrees",uR);Z("exp",Nv);Z("exp2",ic);Z("log",Fg);Z("log2",sr);Z("sqrt",Zs);Z("inverseSqrt",Av);Z("floor",nr);Z("ceil",Pg);Z("normalize",fn);Z("fract",Di);Z("sin",Ws);Z("cos",Ai);Z("tan",cR);Z("asin",hR);Z("acos",Cv);Z("atan",Ev);Z("abs",At);Z("sign",Rv);Z("length",ir);Z("lengthSq",Vv);Z("negate",Bv);Z("oneMinus",dR);Z("dFdx",Dv);Z("dFdy",Lv);Z("round",pR);Z("reciprocal",fR);Z("trunc",Uv);Z("fwidth",Fv);Z("min",mn);Z("max",zt);Z("step",AR);Z("reflect",bR);Z("distance",xR);Z("dot",gi);Z("cross",ia);Z("pow",oi);Z("pow2",Pv);Z("pow3",vR);Z("pow4",Ov);Z("transformDirection",TR);Z("mix",MR);Z("clamp",Li);Z("refract",zv);Z("smoothstep",NR);Z("faceForward",Iv);Z("difference",_R);Z("saturate",Og);Z("cbrt",SR);Z("transpose",mR);Z("determinant",gR);Z("inverse",yR);Z("rand",wR);class AV extends be{static get type(){return"ConditionalNode"}constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const{ifNode:t,elseNode:s}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const n=t.getNodeType(e);if(s!==null){const a=s.getNodeType(e);if(e.getTypeLength(a)>e.getTypeLength(n))return a}return n}setup(e){const t=this.condNode,s=this.ifNode.isolate(),n=this.elseNode?this.elseNode.isolate():null,a=e.context.nodeBlock;e.getDataFromNode(s).parentNodeBlock=a,n!==null&&(e.getDataFromNode(n).parentNodeBlock=a);const l=e.context.uniformFlow,u=e.getNodeProperties(this);u.condNode=t,u.ifNode=l?s:s.context({nodeBlock:s}),u.elseNode=n?l?n:n.context({nodeBlock:n}):null}generate(e,t){const s=this.getNodeType(e),n=e.getDataFromNode(this);if(n.nodeProperty!==void 0)return n.nodeProperty;const{condNode:a,ifNode:l,elseNode:u}=e.getNodeProperties(this),h=e.currentFunctionNode,d=t!=="void",f=d?Jr(s).build(e):"";n.nodeProperty=f;const m=a.build(e,"bool");if(e.context.uniformFlow&&u!==null){const v=l.build(e,s),T=u.build(e,s),w=e.getTernary(m,v,T);return e.format(w,s,t)}e.addFlowCode(`
${e.tab}if ( ${m} ) {

`).addFlowTab();let x=l.build(e,s);if(x&&(d?x=f+" = "+x+";":(x="return "+x+";",h===null&&(ue("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let v=u.build(e,s);v&&(d?v=f+" = "+v+";":(v="return "+v+";",h===null&&(ue("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),v="// "+v))),e.removeFlowTab().addFlowCode(e.tab+"	"+v+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(f,s,t)}}const zs=Pe(AV).setParameterLength(2,3);Z("select",zs);class CR extends be{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const s=e.addContext(this.value),n=this.node.build(e,t);return e.setContext(s),n}}const ca=(i=null,e={})=>{let t=i;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new CR(t,e)},ER=i=>ca(i,{uniformFlow:!0}),kv=(i,e)=>ca(i,{nodeName:e});function RR(i,e,t=null){return ca(t,{getShadow:({light:s,shadowColorNode:n})=>e===s?n.mul(i):n})}function BR(i,e=null){return ca(e,{getAO:(t,{material:s})=>s.transparent===!0?t:t!==null?t.mul(i):i})}function DR(i,e){return ue('TSL: "label()" has been deprecated. Use "setName()" instead.'),kv(i,e)}Z("context",ca);Z("label",DR);Z("uniformFlow",ER);Z("setName",kv);Z("builtinShadowContext",(i,e,t)=>RR(e,t,i));Z("builtinAOContext",(i,e)=>BR(e,i));class rm extends be{static get type(){return"VarNode"}constructor(e,t=null,s=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=s,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let s=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const l=t.getDataFromNode(this);l.forceDeclaration=!0,s=!0}const n=t.getBaseStack();s?n.addToStackBefore(this):n.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:s,readOnly:n}=this,{renderer:a}=e,l=a.backend.isWebGPUBackend===!0;let u=!1,h=!1;n&&(u=e.isDeterministic(t),h=l?n:u);const d=this.getNodeType(e);if(d=="void")return this.isIntent(e)!==!0&&le('TSL: ".toVar()" can not be used with void type.',this.stackTrace),t.build(e);const f=e.getVectorType(d),m=t.build(e,f),b=e.getVarFromNode(this,s,f,void 0,h),x=e.getPropertyName(b);let v=x;if(h)if(l)v=u?`const ${x}`:`let ${x}`;else{const T=t.getArrayCount(e);v=`const ${e.getVar(b.type,x,T)}`}return e.addLineFlowCode(`${v} = ${m}`,this),x}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const Gv=Pe(rm),LR=(i,e=null)=>Gv(i,e).toStack(),UR=(i,e=null)=>Gv(i,e,!0).toStack(),FR=i=>Gv(i).setIntent(!0).toStack();Z("toVar",LR);Z("toConst",UR);Z("toVarIntent",FR);class CV extends be{static get type(){return"SubBuild"}constructor(e,t,s=null){super(s),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const s=this.node.build(e,...t);return e.removeSubBuild(),s}}const hl=(i,e,t=null)=>new CV(ye(i),e,t);class EV extends be{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=hl(e,"VERTEX"),this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let s=t.varying;if(s===void 0){const n=this.name,a=this.getNodeType(e),l=this.interpolationType,u=this.interpolationSampling;t.varying=s=e.getVaryingFromNode(this,n,a,l,u),t.node=hl(this.node,"VERTEX")}return s.needsInterpolation||(s.needsInterpolation=e.shaderStage==="fragment"),s}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Oh.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Oh.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),s=e.getNodeProperties(this),n=this.setupVarying(e);if(s[t]===void 0){const a=this.getNodeType(e),l=e.getPropertyName(n,Oh.VERTEX);e.flowNodeFromShaderStage(Oh.VERTEX,s.node,a,l),s[t]=l}return e.getPropertyName(n)}}const _o=Pe(EV).setParameterLength(1,2),PR=i=>_o(i);Z("toVarying",_o);Z("toVertexStage",PR);const OR=P(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),s=i.lessThanEqual(.04045);return qe(e,t,s)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),VR=P(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),s=i.lessThanEqual(.0031308);return qe(e,t,s)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),qv="WorkingColorSpace",RV="OutputColorSpace";class Hv extends jt{static get type(){return"ColorSpaceNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this.source=t,this.target=s}resolveColorSpace(e,t){return t===qv?nt.workingColorSpace:t===RV?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,s=this.resolveColorSpace(e,this.source),n=this.resolveColorSpace(e,this.target);let a=t;return nt.enabled===!1||s===n||!s||!n||(nt.getTransfer(s)===Fe&&(a=Se(OR(a.rgb),a.a)),nt.getPrimaries(s)!==nt.getPrimaries(n)&&(a=Se(vs(nt._getMatrix(new bn,s,n)).mul(a.rgb),a.a)),nt.getTransfer(n)===Fe&&(a=Se(VR(a.rgb),a.a))),a}}const zR=(i,e)=>new Hv(ye(i),qv,e),Vg=(i,e)=>new Hv(ye(i),e,qv),BV=(i,e,t)=>new Hv(ye(i),e,t);Z("workingToColorSpace",zR);Z("colorSpaceToWorking",Vg);let DV=class extends _l{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,s,n)}};class IR extends be{static get type(){return"ReferenceBaseNode"}constructor(e,t,s=null,n=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=n,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=Re.OBJECT}setGroup(e){return this.group=e,this}element(e){return new DV(this,ye(e))}setNodeType(e){const t=_e(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let n=1;n<t.length;n++)s=s[t[n]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const LV=(i,e,t)=>new IR(i,e,t);class UV extends IR{static get type(){return"RendererReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.renderer=s,this.setGroup(ve)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const kR=(i,e,t=null)=>new UV(i,e,t);class FV extends jt{static get type(){return"ToneMappingNode"}constructor(e,t=qR,s=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=s}customCacheKey(){return Wh(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,s=this._toneMapping;if(s===il)return t;let n=null;const a=e.renderer.library.getToneMappingFunction(s);return a!==null?n=Se(a(t.rgb,this.exposureNode),t.a):(le("ToneMappingNode: Unsupported Tone Mapping configuration.",s),n=t),n}}const GR=(i,e,t)=>new FV(i,ye(e),ye(t)),qR=kR("toneMappingExposure","float");Z("toneMapping",(i,e,t)=>GR(e,t,i));const XN=new WeakMap;function YN(i,e){let t=XN.get(i);return t===void 0&&(t=new fE(i,e),XN.set(i,t)),t}class Ha extends uv{static get type(){return"BufferAttributeNode"}constructor(e,t=null,s=0,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=n,this.usage=sc,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=e.getTypeLength(t),n=this.value,a=this.bufferStride||s,l=this.bufferOffset;let u;n.isInterleavedBuffer===!0?u=n:n.isBufferAttribute===!0?u=YN(n.array,a):u=YN(n,a);const h=new Q_(u,s,l);u.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),n=e.getPropertyName(s);let a=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=n,a=n):a=_o(this).build(e,t),a}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function zg(i,e=null,t=0,s=0,n=sc,a=!1){return e==="mat3"||e===null&&i.itemSize===9?vs(new Ha(i,"vec3",9,0).setUsage(n).setInstanced(a),new Ha(i,"vec3",9,3).setUsage(n).setInstanced(a),new Ha(i,"vec3",9,6).setUsage(n).setInstanced(a)):e==="mat4"||e===null&&i.itemSize===16?co(new Ha(i,"vec4",16,0).setUsage(n).setInstanced(a),new Ha(i,"vec4",16,4).setUsage(n).setInstanced(a),new Ha(i,"vec4",16,8).setUsage(n).setInstanced(a),new Ha(i,"vec4",16,12).setUsage(n).setInstanced(a)):new Ha(i,e,t,s).setUsage(n)}const jv=(i,e=null,t=0,s=0)=>zg(i,e,t,s),PV=(i,e=null,t=0,s=0)=>zg(i,e,t,s,rd),tg=(i,e=null,t=0,s=0)=>zg(i,e,t,s,sc,!0),p_=(i,e=null,t=0,s=0)=>zg(i,e,t,s,rd,!0);Z("toAttribute",i=>jv(i.value));class OV extends be{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Re.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return ue('TSL: "label()" has been deprecated. Use "setName()" instead.',new Zt),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const s=e.getNodeProperties(this);s.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:s}=e;if(s==="compute"){const n=this.computeNode.build(e,"void");n!==""&&e.addLineFlowCode(n,this)}else{const a=e.getNodeProperties(this).outputComputeNode;if(a)return a.build(e,t)}}}const $v=(i,e=[64])=>{(e.length===0||e.length>3)&&le("TSL: compute() workgroupSize must have 1, 2, or 3 elements",new Zt);for(let t=0;t<e.length;t++){const s=e[t];(typeof s!="number"||s<=0||!Number.isInteger(s))&&le(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`,new Zt)}for(;e.length<3;)e.push(1);return new OV(ye(i),e)},HR=(i,e,t)=>$v(i,t).setCount(e);Z("compute",HR);Z("computeKernel",$v);class VV extends be{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const n=this.node.getNodeType(e);return e.setCache(t),n}build(e,...t){const s=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const a=this.node.build(e,...t);return e.setCache(s),a}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const Xu=i=>new VV(ye(i));function jR(i,e=!0){return ue('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Xu(i).setParent(e)}Z("cache",jR);Z("isolate",Xu);class zV extends be{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const $R=Pe(zV).setParameterLength(2);Z("bypass",$R);class WR extends be{static get type(){return"RemapNode"}constructor(e,t,s,n=A(0),a=A(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=n,this.outHighNode=a,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:n,outHighNode:a,doClamp:l}=this;let u=e.sub(t).div(s.sub(t));return l===!0&&(u=u.clamp()),u.mul(a.sub(n)).add(n)}}const XR=Pe(WR,null,null,{doClamp:!1}).setParameterLength(3,5),YR=Pe(WR).setParameterLength(3,5);Z("remap",XR);Z("remapClamp",YR);class am extends be{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),n=this.snippet;if(s==="void")e.addLineFlowCode(n,this);else return e.format(n,s,t)}}const Bi=Pe(am).setParameterLength(1,2),KR=i=>(i?zs(i,Bi("discard")):Bi("discard")).toStack(),IV=()=>Bi("return").toStack();Z("discard",KR);class kV extends jt{static get type(){return"RenderOutputNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=s,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const s=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||il,n=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||mo;return s!==il&&(t=t.toneMapping(s)),n!==mo&&n!==nt.workingColorSpace&&(t=t.workingToColorSpace(n)),t}}const ZR=(i,e=null,t=null)=>new kV(ye(i),e,t);Z("renderOutput",ZR);class GV extends jt{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,s=this.node.build(e);if(t!==null)t(e,s);else{const n="--- TSL debug - "+e.shaderStage+" shader ---",a="-".repeat(n.length);let l="";l+="// #"+n+`#
`,l+=e.flow.code.replace(/^\t/mg,"")+`
`,l+="/* ... */ "+s+` /* ... */
`,l+="// #"+a+`#
`,a_(l)}return s}}const QR=(i,e=null)=>new GV(ye(i),e).toStack();Z("debug",QR);class JR{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class qV extends be{static get type(){return"InspectorNode"}constructor(e,t="",s=null){super(),this.node=e,this.name=t,this.callback=s,this.updateType=Re.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==JR&&ft('TSL: ".toInspector()" is only available with WebGPU.'),t}}function e2(i,e="",t=null){return i=ye(i),i.before(new qV(i,e,t))}Z("toInspector",e2);function HV(i){ue("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",i)}class t2 extends be{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const n=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(n)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const a=e.geometry.getAttribute(t),l=e.getTypeFromAttribute(a),u=e.getAttribute(t,l);return e.shaderStage==="vertex"?e.format(u.name,l,s):_o(this).build(e,s)}else return ue(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ra=(i,e=null)=>new t2(i,e),xt=(i=0)=>ra("uv"+(i>0?i:""),"vec2");class jV extends be{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),n=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${n} )`,this.getNodeType(e),t)}}const ho=Pe(jV).setParameterLength(1,2);class $V extends _d{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Re.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:n,height:a}=s;this.value=Math.log2(Math.max(n,a))}}}const Wv=Pe($V).setParameterLength(1);class s2 extends Error{constructor(e,t=null){super(e),this.name="NodeError",this.stackTrace=t}}const Xv=new Is;class ur extends _d{static get type(){return"TextureNode"}constructor(e=Xv,t=null,s=null,n=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.biasNode=n,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Re.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Gt?"uvec4":this.value.type===Ps?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return xt(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=_e(this.value.matrix)),this._matrixUniform.mul(L(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=_e(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(B(ho(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const s=this.value;if(!s||s.isTexture!==!0)throw new s2("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().",this.stackTrace);const n=P(()=>{let h=this.uvNode;return(h===null||e.context.forceUVContext===!0)&&e.context.getUV&&(h=e.context.getUV(this,e)),h||(h=this.getDefaultUV()),this.updateMatrix===!0&&(h=this.getTransformedUV(h)),h=this.setupUV(e,h),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Re.OBJECT:Re.NONE,h})();let a=this.levelNode;a===null&&e.context.getTextureLevel&&(a=e.context.getTextureLevel(this));let l=null,u=null;this.compareNode!==null&&(e.renderer.hasCompatibility(uo.TEXTURE_COMPARE)?l=this.compareNode:this.value.compareFunction===null||this.value.compareFunction===W_?u=this.compareNode:(l=this.compareNode,ft('TSL: Only "LessCompare" is supported for depth texture comparison fallback.'))),t.uvNode=n,t.levelNode=a,t.biasNode=this.biasNode,t.compareNode=l,t.compareStepNode=u,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,s,n,a,l,u,h,d){const f=this.value;let m;return a?m=e.generateTextureBias(f,t,s,a,l,d):h?m=e.generateTextureGrad(f,t,s,h,l,d):u?m=e.generateTextureCompare(f,t,s,u,l,d):this.sampler===!1?m=e.generateTextureLoad(f,t,s,n,l,d):n?m=e.generateTextureLevel(f,t,s,n,l,d):m=e.generateTexture(f,t,s,l,d),m}generate(e,t){const s=this.value,n=e.getNodeProperties(this),a=super.generate(e,"property");if(/^sampler/.test(t))return a+"_sampler";if(e.isReference(t))return a;{const l=e.getDataFromNode(this),u=this.getNodeType(e);let h=l.propertyName;if(h===void 0){const{uvNode:f,levelNode:m,biasNode:b,compareNode:x,compareStepNode:v,depthNode:T,gradNode:w,offsetNode:N}=n,C=this.generateUV(e,f),R=m?m.build(e,"float"):null,E=b?b.build(e,"float"):null,k=T?T.build(e,"int"):null,q=x?x.build(e,"float"):null,D=v?v.build(e,"float"):null,I=w?[w[0].build(e,"vec2"),w[1].build(e,"vec2")]:null,$=N?this.generateOffset(e,N):null,ae=e.getVarFromNode(this);h=e.getPropertyName(ae);let pe=this.generateSnippet(e,a,C,R,E,k,q,I,$);D!==null&&(pe=rc(Bi(D,"float"),Bi(pe,u)).build(e,u)),e.addLineFlowCode(`${h} = ${pe}`,this),l.snippet=pe,l.propertyName=h}let d=h;return e.needsToWorkingColorSpace(s)&&(d=Vg(Bi(d,u),s.colorSpace).setup(e).build(e,u)),e.format(d,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}sample(e){const t=this.clone();return t.uvNode=ye(e),t.referenceNode=this.getBase(),ye(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=ye(e).mul(Wv(t)),t.referenceNode=this.getBase();const s=t.value;return t.generateMipmaps===!1&&(s&&s.generateMipmaps===!1||s.minFilter===qt||s.magFilter===qt)&&(ue("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),ye(t)}level(e){const t=this.clone();return t.levelNode=ye(e),t.referenceNode=this.getBase(),ye(t)}size(e){return ho(this,e)}bias(e){const t=this.clone();return t.biasNode=ye(e),t.referenceNode=this.getBase(),ye(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=ye(e),t.referenceNode=this.getBase(),ye(t)}grad(e,t){const s=this.clone();return s.gradNode=[ye(e),ye(t)],s.referenceNode=this.getBase(),ye(s)}depth(e){const t=this.clone();return t.depthNode=ye(e),t.referenceNode=this.getBase(),ye(t)}offset(e){const t=this.clone();return t.offsetNode=ye(e),t.referenceNode=this.getBase(),ye(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const s=this._flipYUniform;s!==null&&(s.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const WV=Pe(ur).setParameterLength(1,4).setName("texture"),st=(i=Xv,e=null,t=null,s=null)=>{let n;return i&&i.isTextureNode===!0?(n=ye(i.clone()),n.referenceNode=i.getBase(),e!==null&&(n.uvNode=ye(e)),t!==null&&(n.levelNode=ye(t)),s!==null&&(n.biasNode=ye(s))):n=WV(i,e,t,s),n},XV=(i=Xv)=>st(i),kt=(...i)=>st(...i).setSampler(!1),YV=(i,e,t)=>st(i,e).level(t),KV=i=>(i.isNode===!0?i:st(i)).convert("sampler"),ZV=i=>(i.isNode===!0?i:st(i)).convert("samplerComparison");class Yv extends _d{static get type(){return"BufferNode"}constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Td=(i,e,t)=>new Yv(i,e,t);class QV extends _l{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),s=this.getNodeType(),n=this.node.getPaddedType();return e.format(t,n,s)}}class JV extends Yv{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?io(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Re.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,s=this.elementType;if(s==="float"||s==="int"||s==="uint")for(let n=0;n<e.length;n++){const a=n*4;t[a]=e[n]}else if(s==="color")for(let n=0;n<e.length;n++){const a=n*4,l=e[n];t[a]=l.r,t[a+1]=l.g,t[a+2]=l.b||0}else if(s==="mat2")for(let n=0;n<e.length;n++){const a=n*4,l=e[n];t[a]=l.elements[0],t[a+1]=l.elements[1],t[a+2]=l.elements[2],t[a+3]=l.elements[3]}else if(s==="mat3")for(let n=0;n<e.length;n++){const a=n*16,l=e[n];t[a]=l.elements[0],t[a+1]=l.elements[1],t[a+2]=l.elements[2],t[a+4]=l.elements[3],t[a+5]=l.elements[4],t[a+6]=l.elements[5],t[a+8]=l.elements[6],t[a+9]=l.elements[7],t[a+10]=l.elements[8],t[a+15]=1}else if(s==="mat4")for(let n=0;n<e.length;n++){const a=n*16,l=e[n];for(let u=0;u<l.elements.length;u++)t[a+u]=l.elements[u]}else for(let n=0;n<e.length;n++){const a=n*4,l=e[n];t[a]=l.x,t[a+1]=l.y,t[a+2]=l.z||0,t[a+3]=l.w||0}}setup(e){const t=this.array.length,s=this.elementType;let n=Float32Array;const a=this.paddedType,l=e.getTypeLength(a);return s.charAt(0)==="i"&&(n=Int32Array),s.charAt(0)==="u"&&(n=Uint32Array),this.value=new n(t*l),this.bufferCount=t,this.bufferType=a,this.update(),super.setup(e)}element(e){return new QV(this,ye(e))}}const Os=(i,e)=>new JV(i,e);class ez extends be{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const ha=Pe(ez).setParameterLength(1);let xh,_h;class Et extends be{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Et.DPR?"float":this.scope===Et.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Re.NONE;return(this.scope===Et.SIZE||this.scope===Et.VIEWPORT||this.scope===Et.DPR)&&(e=Re.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Et.VIEWPORT?t!==null?_h.copy(t.viewport):(e.getViewport(_h),_h.multiplyScalar(e.getPixelRatio())):this.scope===Et.DPR?this._output.value=e.getPixelRatio():t!==null?(xh.width=t.width,xh.height=t.height):e.getDrawingBufferSize(xh)}setup(){const e=this.scope;let t=null;return e===Et.SIZE?t=_e(xh||(xh=new Ue)):e===Et.VIEWPORT?t=_e(_h||(_h=new rt)):e===Et.DPR?t=_e(1):t=ie(Tl.div(pl)),this._output=t,t}generate(e){if(this.scope===Et.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(pl).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}Et.COORDINATE="coordinate";Et.VIEWPORT="viewport";Et.SIZE="size";Et.UV="uv";Et.DPR="dpr";const n2=ce(Et,Et.DPR),rr=ce(Et,Et.UV),pl=ce(Et,Et.SIZE),Tl=ce(Et,Et.COORDINATE),Kv=ce(Et,Et.VIEWPORT),Zv=Kv.zw,i2=Tl.sub(Kv.xy),tz=i2.div(Zv),sz=P(()=>(ue('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.',new Zt),pl),"vec2").once()();let nx=null,Nf=null,ix=null,Af=null,rx=null,Cf=null,ax=null,Ef=null,ox=null,Rf=null,lx=null,Bf=null,ux=null,Df=null;const vo=_e(0,"uint").setName("u_cameraIndex").setGroup(Ug("cameraIndex")).toVarying("v_cameraIndex"),eo=_e("float").setName("cameraNear").setGroup(ve).onRenderUpdate(({camera:i})=>i.near),to=_e("float").setName("cameraFar").setGroup(ve).onRenderUpdate(({camera:i})=>i.far),ea=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.projectionMatrix);Nf===null?Nf=Os(t).setGroup(ve).setName("cameraProjectionMatrices"):Nf.array=t,e=Nf.element(i.isMultiViewCamera?ha("gl_ViewID_OVR"):vo).toConst("cameraProjectionMatrix")}else nx===null&&(nx=_e(i.projectionMatrix).setName("cameraProjectionMatrix").setGroup(ve).onRenderUpdate(({camera:t})=>t.projectionMatrix)),e=nx;return e}).once()(),r2=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.projectionMatrixInverse);Af===null?Af=Os(t).setGroup(ve).setName("cameraProjectionMatricesInverse"):Af.array=t,e=Af.element(i.isMultiViewCamera?ha("gl_ViewID_OVR"):vo).toConst("cameraProjectionMatrixInverse")}else ix===null&&(ix=_e(i.projectionMatrixInverse).setName("cameraProjectionMatrixInverse").setGroup(ve).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse)),e=ix;return e}).once()(),xi=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.matrixWorldInverse);Cf===null?Cf=Os(t).setGroup(ve).setName("cameraViewMatrices"):Cf.array=t,e=Cf.element(i.isMultiViewCamera?ha("gl_ViewID_OVR"):vo).toConst("cameraViewMatrix")}else rx===null&&(rx=_e(i.matrixWorldInverse).setName("cameraViewMatrix").setGroup(ve).onRenderUpdate(({camera:t})=>t.matrixWorldInverse)),e=rx;return e}).once()(),nz=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.matrixWorld);Ef===null?Ef=Os(t).setGroup(ve).setName("cameraWorldMatrices"):Ef.array=t,e=Ef.element(i.isMultiViewCamera?ha("gl_ViewID_OVR"):vo).toConst("cameraWorldMatrix")}else ax===null&&(ax=_e(i.matrixWorld).setName("cameraWorldMatrix").setGroup(ve).onRenderUpdate(({camera:t})=>t.matrixWorld)),e=ax;return e}).once()(),iz=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.normalMatrix);Rf===null?Rf=Os(t).setGroup(ve).setName("cameraNormalMatrices"):Rf.array=t,e=Rf.element(i.isMultiViewCamera?ha("gl_ViewID_OVR"):vo).toConst("cameraNormalMatrix")}else ox===null&&(ox=_e(i.normalMatrix).setName("cameraNormalMatrix").setGroup(ve).onRenderUpdate(({camera:t})=>t.normalMatrix)),e=ox;return e}).once()(),a2=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(let s=0,n=i.cameras.length;s<n;s++)t.push(new z);Bf===null?Bf=Os(t).setGroup(ve).setName("cameraPositions").onRenderUpdate(({camera:s},n)=>{const a=s.cameras,l=n.array;for(let u=0,h=a.length;u<h;u++)l[u].setFromMatrixPosition(a[u].matrixWorld)}):Bf.array=t,e=Bf.element(i.isMultiViewCamera?ha("gl_ViewID_OVR"):vo).toConst("cameraPosition")}else lx===null&&(lx=_e(new z).setName("cameraPosition").setGroup(ve).onRenderUpdate(({camera:t},s)=>s.value.setFromMatrixPosition(t.matrixWorld))),e=lx;return e}).once()(),rz=P(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.viewport);Df===null?Df=Os(t,"vec4").setGroup(ve).setName("cameraViewports"):Df.array=t,e=Df.element(vo).toConst("cameraViewport")}else ux===null&&(ux=Se(0,0,pl.x,pl.y).toConst("cameraViewport")),e=ux;return e}).once()(),KN=new Sg;class je extends be{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Re.OBJECT,this.uniformNode=new _d(null)}getNodeType(){const e=this.scope;if(e===je.WORLD_MATRIX)return"mat4";if(e===je.POSITION||e===je.VIEW_POSITION||e===je.DIRECTION||e===je.SCALE)return"vec3";if(e===je.RADIUS)return"float"}update(e){const t=this.object3d,s=this.uniformNode,n=this.scope;if(n===je.WORLD_MATRIX)s.value=t.matrixWorld;else if(n===je.POSITION)s.value=s.value||new z,s.value.setFromMatrixPosition(t.matrixWorld);else if(n===je.SCALE)s.value=s.value||new z,s.value.setFromMatrixScale(t.matrixWorld);else if(n===je.DIRECTION)s.value=s.value||new z,t.getWorldDirection(s.value);else if(n===je.VIEW_POSITION){const a=e.camera;s.value=s.value||new z,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(a.matrixWorldInverse)}else if(n===je.RADIUS){const a=e.object.geometry;a.boundingSphere===null&&a.computeBoundingSphere(),KN.copy(a.boundingSphere).applyMatrix4(t.matrixWorld),s.value=KN.radius}}generate(e){const t=this.scope;return t===je.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===je.POSITION||t===je.VIEW_POSITION||t===je.DIRECTION||t===je.SCALE?this.uniformNode.nodeType="vec3":t===je.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}je.WORLD_MATRIX="worldMatrix";je.POSITION="position";je.SCALE="scale";je.VIEW_POSITION="viewPosition";je.DIRECTION="direction";je.RADIUS="radius";const az=Pe(je,je.DIRECTION).setParameterLength(1),oz=Pe(je,je.WORLD_MATRIX).setParameterLength(1),lz=Pe(je,je.POSITION).setParameterLength(1),uz=Pe(je,je.SCALE).setParameterLength(1),cz=Pe(je,je.VIEW_POSITION).setParameterLength(1),hz=Pe(je,je.RADIUS).setParameterLength(1);class yi extends je{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const dz=ce(yi,yi.DIRECTION),li=ce(yi,yi.WORLD_MATRIX),pz=ce(yi,yi.POSITION),fz=ce(yi,yi.SCALE),mz=ce(yi,yi.VIEW_POSITION),gz=ce(yi,yi.RADIUS),o2=_e(new bn).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),yz=_e(new Ze).onObjectUpdate(({object:i},e)=>e.value.copy(i.matrixWorld).invert()),To=P(i=>i.context.modelViewMatrix||l2).once()().toVar("modelViewMatrix"),l2=xi.mul(li),f_=P(i=>(i.context.isHighPrecisionModelViewMatrix=!0,_e("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),m_=P(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return _e("mat3").onObjectUpdate(({object:t,camera:s})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),u2=P(i=>i.shaderStage!=="fragment"?(ft("TSL: `clipSpace` is only available in fragment stage."),Se()):i.context.clipSpace.toVarying("v_clipSpace")).once()(),Sd=ra("position","vec3"),Ot=Sd.toVarying("positionLocal"),ac=Sd.toVarying("positionPrevious"),ar=P(i=>li.mul(Ot).xyz.toVarying(i.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),Qv=P(()=>Ot.transformDirection(li).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),Kt=P(i=>{if(i.shaderStage==="fragment"&&i.material.vertexNode){const e=r2.mul(u2);return e.xyz.div(e.w).toVar("positionView")}return i.context.setupPositionView().toVarying("v_positionView")},"vec3").once(["POSITION","VERTEX"])(),Tt=P(i=>{let e;return i.camera.isOrthographicCamera?e=L(0,0,1):e=Kt.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class bz extends be{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Rs?"false":e.getFrontFacing()}}const c2=ce(bz),Jv=A(c2).mul(2).sub(1),dc=P(([i],{material:e})=>{const t=e.side;return t===Rs?i=i.mul(-1):t===Wr&&(i=i.mul(Jv)),i}),Ig=ra("normal","vec3"),gn=P(i=>i.geometry.hasAttribute("normal")===!1?(ue('TSL: Vertex attribute "normal" not found on geometry.'),L(0,1,0)):Ig,"vec3").once()().toVar("normalLocal"),h2=Kt.dFdx().cross(Kt.dFdy()).normalize().toVar("normalFlat"),oc=P(i=>{let e;return i.isFlatShading()?e=h2:e=eT(gn).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),d2=P(i=>{let e=oc.transformDirection(xi);return i.isFlatShading()!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),et=P(i=>{let e;return i.subBuildFn==="NORMAL"||i.subBuildFn==="VERTEX"?(e=oc,i.isFlatShading()!==!0&&(e=dc(e))):e=i.context.setupNormal().context({getUV:null,getTextureLevel:null}),e},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),So=et.transformDirection(xi).toVar("normalWorld"),so=P(({subBuildFn:i,context:e})=>{let t;return i==="NORMAL"||i==="VERTEX"?t=et:t=e.setupClearcoatNormal().context({getUV:null,getTextureLevel:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),p2=P(([i,e=li])=>{const t=vs(e),s=i.div(L(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(s).xyz}),eT=P(([i],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(i);const s=o2.mul(i);return xi.transformDirection(s)}),xz=P(()=>(ue('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),et)).once(["NORMAL","VERTEX"])(),_z=P(()=>(ue('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),So)).once(["NORMAL","VERTEX"])(),vz=P(()=>(ue('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),so)).once(["NORMAL","VERTEX"])(),ZN=new fi,cx=new Ze,f2=_e(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),om=_e(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),tT=_e(new Ze).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(ZN.copy(t),cx.makeRotationFromEuler(ZN)):cx.identity(),cx}),m2=Tt.negate().reflect(et),g2=Tt.negate().refract(et,f2),y2=m2.transformDirection(xi).toVar("reflectVector"),b2=g2.transformDirection(xi).toVar("reflectVector"),x2=new wg;class Tz extends ur{static get type(){return"CubeTextureNode"}constructor(e,t=null,s=null,n=null){super(e,t,s,n),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Ju?y2:e.mapping===xm?b2:(le('CubeTextureNode: Mapping "%s" not supported.',e.mapping),L(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return s.isDepthTexture===!0?e.renderer.coordinateSystem===pi?L(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===pi||!s.isRenderTargetTexture)&&(t=L(t.x.negate(),t.yz)),tT.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const sT=Pe(Tz).setParameterLength(1,4).setName("cubeTexture"),Ys=(i=x2,e=null,t=null,s=null)=>{let n;return i&&i.isCubeTextureNode===!0?(n=ye(i.clone()),n.referenceNode=i,e!==null&&(n.uvNode=ye(e)),t!==null&&(n.levelNode=ye(t)),s!==null&&(n.biasNode=ye(s))):n=sT(i,e,t,s),n},Sz=(i=x2)=>sT(i);class wz extends _l{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,s,n)}}class kg extends be{static get type(){return"ReferenceNode"}constructor(e,t,s=null,n=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=n,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=Re.OBJECT}element(e){return new wz(this,ye(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return ue('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=Td(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Os(null,e):e==="texture"?t=st(null):e==="cubeTexture"?t=Ys(null):t=_e(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let n=1;n<t.length;n++)s=s[t[n]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Rt=(i,e,t)=>new kg(i,e,t),g_=(i,e,t,s)=>new kg(i,e,s,t);class Mz extends kg{static get type(){return"MaterialReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Hr=(i,e,t=null)=>new Mz(i,e,t),_2=xt(),Nz=Kt.dFdx(),Az=Kt.dFdy(),v2=_2.dFdx(),T2=_2.dFdy(),S2=et,w2=Az.cross(S2),M2=S2.cross(Nz),y_=w2.mul(v2.x).add(M2.mul(T2.x)),b_=w2.mul(v2.y).add(M2.mul(T2.y)),QN=y_.dot(y_).max(b_.dot(b_)),N2=QN.equal(0).select(0,QN.inverseSqrt()),Cz=y_.mul(N2).toVar("tangentViewFrame"),Ez=b_.mul(N2).toVar("bitangentViewFrame"),Gg=ra("tangent","vec4"),lc=Gg.xyz.toVar("tangentLocal"),qg=P(i=>{let e;return i.subBuildFn==="VERTEX"||i.geometry.hasAttribute("tangent")?e=To.mul(Se(lc,0)).xyz.toVarying("v_tangentView").normalize():e=Cz,i.isFlatShading()!==!0&&(e=dc(e)),e},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),A2=qg.transformDirection(xi).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),Hg=P(([i,e],t)=>{let s=i.mul(Gg.w).xyz;return t.subBuildFn==="NORMAL"&&t.isFlatShading()!==!0&&(s=s.toVarying(e)),s}).once(["NORMAL"]),Rz=Hg(Ig.cross(Gg),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),Bz=Hg(gn.cross(lc),"v_bitangentLocal").normalize().toVar("bitangentLocal"),C2=P(i=>{let e;return i.subBuildFn==="VERTEX"||i.geometry.hasAttribute("tangent")?e=Hg(et.cross(qg),"v_bitangentView").normalize():e=Ez,i.isFlatShading()!==!0&&(e=dc(e)),e},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),Dz=Hg(So.cross(A2),"v_bitangentWorld").normalize().toVar("bitangentWorld"),ll=vs(qg,C2,et).toVar("TBNViewMatrix"),E2=Tt.mul(ll),Lz=(i,e)=>i.sub(E2.mul(e)),R2=P(()=>{let i=cl.cross(Tt);return i=i.cross(cl).normalize(),i=qe(i,et,Za.mul(Yi.oneMinus()).oneMinus().pow2().pow2()).normalize(),i}).once()(),B2=i=>ye(i).mul(.5).add(.5),Uz=i=>ye(i).mul(2).sub(1),x_=i=>L(i,Zs(Og(A(1).sub(gi(i,i)))));class Fz extends jt{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Kr,this.unpackNormalMode=L0}setup(e){const{normalMapType:t,scaleNode:s,unpackNormalMode:n}=this;let a=this.node.mul(2).sub(1);if(t===Kr?n===sE?a=x_(a.xy):n===aP?a=x_(a.yw):n!==L0&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${n}`):n!==L0&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${n}'`),s!==null){let u=s;e.isFlatShading()===!0&&(u=dc(u)),a=L(a.xy.mul(u),a.z)}let l=null;return t===rP?l=eT(a):t===Kr?l=ll.mul(a).normalize():(le(`NodeMaterial: Unsupported normal map type: ${t}`),l=et),l}}const __=Pe(Fz).setParameterLength(1,2),Pz=P(({textureNode:i,bumpScale:e})=>{const t=n=>i.isolate().context({getUV:a=>n(a.uvNode||xt()),forceUVContext:!0}),s=A(t(n=>n));return ie(A(t(n=>n.add(n.dFdx()))).sub(s),A(t(n=>n.add(n.dFdy()))).sub(s)).mul(e)}),Oz=P(i=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=i,n=e.dFdx().normalize(),a=e.dFdy().normalize(),l=t,u=a.cross(l),h=l.cross(n),d=n.dot(u).mul(Jv),f=d.sign().mul(s.x.mul(u).add(s.y.mul(h)));return d.abs().mul(t).sub(f).normalize()});class Vz extends jt{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Pz({textureNode:this.textureNode,bumpScale:e});return Oz({surf_pos:Kt,surf_norm:et,dHdxy:t})}}const nT=Pe(Vz).setParameterLength(1,2),JN=new Map;class Q extends be{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let s=JN.get(e);return s===void 0&&(s=Hr(e,t),JN.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let n=null;if(s===Q.COLOR){const a=t.color!==void 0?this.getColor(s):L();t.map&&t.map.isTexture===!0?n=a.mul(this.getTexture("map")):n=a}else if(s===Q.OPACITY){const a=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?n=a.mul(this.getTexture("alpha")):n=a}else if(s===Q.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?n=this.getTexture("specular").r:n=A(1);else if(s===Q.SPECULAR_INTENSITY){const a=this.getFloat(s);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?n=a.mul(this.getTexture(s).a):n=a}else if(s===Q.SPECULAR_COLOR){const a=this.getColor(s);t.specularColorMap&&t.specularColorMap.isTexture===!0?n=a.mul(this.getTexture(s).rgb):n=a}else if(s===Q.ROUGHNESS){const a=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?n=a.mul(this.getTexture(s).g):n=a}else if(s===Q.METALNESS){const a=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?n=a.mul(this.getTexture(s).b):n=a}else if(s===Q.EMISSIVE){const a=this.getFloat("emissiveIntensity"),l=this.getColor(s).mul(a);t.emissiveMap&&t.emissiveMap.isTexture===!0?n=l.mul(this.getTexture(s)):n=l}else if(s===Q.NORMAL)t.normalMap?(n=__(this.getTexture("normal"),this.getCache("normalScale","vec2")),n.normalMapType=t.normalMapType,(t.normalMap.format==Zi||t.normalMap.format==id||t.normalMap.format==nd)&&(n.unpackNormalMode=sE)):t.bumpMap?n=nT(this.getTexture("bump").r,this.getFloat("bumpScale")):n=et;else if(s===Q.CLEARCOAT){const a=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?n=a.mul(this.getTexture(s).r):n=a}else if(s===Q.CLEARCOAT_ROUGHNESS){const a=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?n=a.mul(this.getTexture(s).r):n=a}else if(s===Q.CLEARCOAT_NORMAL)t.clearcoatNormalMap?n=__(this.getTexture(s),this.getCache(s+"Scale","vec2")):n=et;else if(s===Q.SHEEN){const a=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?n=a.mul(this.getTexture("sheenColor").rgb):n=a}else if(s===Q.SHEEN_ROUGHNESS){const a=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?n=a.mul(this.getTexture(s).a):n=a,n=n.clamp(1e-4,1)}else if(s===Q.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const a=this.getTexture(s);n=Dg(Lu.x,Lu.y,Lu.y.negate(),Lu.x).mul(a.rg.mul(2).sub(ie(1)).normalize().mul(a.b))}else n=Lu;else if(s===Q.IRIDESCENCE_THICKNESS){const a=Rt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const l=Rt("0","float",t.iridescenceThicknessRange);n=a.sub(l).mul(this.getTexture(s).g).add(l)}else n=a}else if(s===Q.TRANSMISSION){const a=this.getFloat(s);t.transmissionMap?n=a.mul(this.getTexture(s).r):n=a}else if(s===Q.THICKNESS){const a=this.getFloat(s);t.thicknessMap?n=a.mul(this.getTexture(s).g):n=a}else if(s===Q.IOR)n=this.getFloat(s);else if(s===Q.LIGHT_MAP)n=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===Q.AO)n=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(s===Q.LINE_DASH_OFFSET)n=t.dashOffset?this.getFloat(s):A(0);else{const a=this.getNodeType(e);n=this.getCache(s,a)}return n}}Q.ALPHA_TEST="alphaTest";Q.COLOR="color";Q.OPACITY="opacity";Q.SHININESS="shininess";Q.SPECULAR="specular";Q.SPECULAR_STRENGTH="specularStrength";Q.SPECULAR_INTENSITY="specularIntensity";Q.SPECULAR_COLOR="specularColor";Q.REFLECTIVITY="reflectivity";Q.ROUGHNESS="roughness";Q.METALNESS="metalness";Q.NORMAL="normal";Q.CLEARCOAT="clearcoat";Q.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Q.CLEARCOAT_NORMAL="clearcoatNormal";Q.EMISSIVE="emissive";Q.ROTATION="rotation";Q.SHEEN="sheen";Q.SHEEN_ROUGHNESS="sheenRoughness";Q.ANISOTROPY="anisotropy";Q.IRIDESCENCE="iridescence";Q.IRIDESCENCE_IOR="iridescenceIOR";Q.IRIDESCENCE_THICKNESS="iridescenceThickness";Q.IOR="ior";Q.TRANSMISSION="transmission";Q.THICKNESS="thickness";Q.ATTENUATION_DISTANCE="attenuationDistance";Q.ATTENUATION_COLOR="attenuationColor";Q.LINE_SCALE="scale";Q.LINE_DASH_SIZE="dashSize";Q.LINE_GAP_SIZE="gapSize";Q.LINE_WIDTH="linewidth";Q.LINE_DASH_OFFSET="dashOffset";Q.POINT_SIZE="size";Q.DISPERSION="dispersion";Q.LIGHT_MAP="light";Q.AO="ao";const D2=ce(Q,Q.ALPHA_TEST),L2=ce(Q,Q.COLOR),U2=ce(Q,Q.SHININESS),F2=ce(Q,Q.EMISSIVE),iT=ce(Q,Q.OPACITY),P2=ce(Q,Q.SPECULAR),v_=ce(Q,Q.SPECULAR_INTENSITY),O2=ce(Q,Q.SPECULAR_COLOR),Zh=ce(Q,Q.SPECULAR_STRENGTH),lm=ce(Q,Q.REFLECTIVITY),V2=ce(Q,Q.ROUGHNESS),z2=ce(Q,Q.METALNESS),I2=ce(Q,Q.NORMAL),k2=ce(Q,Q.CLEARCOAT),G2=ce(Q,Q.CLEARCOAT_ROUGHNESS),q2=ce(Q,Q.CLEARCOAT_NORMAL),H2=ce(Q,Q.ROTATION),j2=ce(Q,Q.SHEEN),$2=ce(Q,Q.SHEEN_ROUGHNESS),W2=ce(Q,Q.ANISOTROPY),X2=ce(Q,Q.IRIDESCENCE),Y2=ce(Q,Q.IRIDESCENCE_IOR),K2=ce(Q,Q.IRIDESCENCE_THICKNESS),Z2=ce(Q,Q.TRANSMISSION),Q2=ce(Q,Q.THICKNESS),J2=ce(Q,Q.IOR),eB=ce(Q,Q.ATTENUATION_DISTANCE),tB=ce(Q,Q.ATTENUATION_COLOR),sB=ce(Q,Q.LINE_SCALE),nB=ce(Q,Q.LINE_DASH_SIZE),iB=ce(Q,Q.LINE_GAP_SIZE),zz=ce(Q,Q.LINE_WIDTH),rB=ce(Q,Q.LINE_DASH_OFFSET),aB=ce(Q,Q.POINT_SIZE),oB=ce(Q,Q.DISPERSION),rT=ce(Q,Q.LIGHT_MAP),lB=ce(Q,Q.AO),Lu=_e(new Ue).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),uB=P(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Iz extends _l{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const s=this.storageBufferNode.structTypeNode;return s?s.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let s;const n=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&n!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?s=e.generatePBO(this):s=this.node.build(e):s=super.generate(e),n!==!0){const a=this.getNodeType(e);s=e.format(s,a,t)}return s}}const kz=Pe(Iz).setParameterLength(2);class Gz extends Yv{static get type(){return"StorageBufferNode"}constructor(e,t=null,s=0){let n,a=null;t&&t.isStruct?(n="struct",a=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(s=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(n=_E(e.itemSize),s=e.count):n=t,super(e,n,s),this.isStorageBufferNode=!0,this.structTypeNode=a,this.access=Es.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return kz(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Es.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=jv(this.value),this._varying=_o(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:s}=this.getAttributeData(),n=s.build(e);return e.registerTransform(n,t),n}}const po=(i,e=null,t=0)=>new Gz(i,e,t);class Ut extends be{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let n;if(s===Ut.VERTEX)n=e.getVertexIndex();else if(s===Ut.INSTANCE)n=e.getInstanceIndex();else if(s===Ut.DRAW)n=e.getDrawIndex();else if(s===Ut.INVOCATION_LOCAL)n=e.getInvocationLocalIndex();else if(s===Ut.INVOCATION_SUBGROUP)n=e.getInvocationSubgroupIndex();else if(s===Ut.SUBGROUP)n=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let a;return e.shaderStage==="vertex"||e.shaderStage==="compute"?a=n:a=_o(this).build(e,t),a}}Ut.VERTEX="vertex";Ut.INSTANCE="instance";Ut.SUBGROUP="subgroup";Ut.INVOCATION_LOCAL="invocationLocal";Ut.INVOCATION_SUBGROUP="invocationSubgroup";Ut.DRAW="draw";const cB=ce(Ut,Ut.VERTEX),or=ce(Ut,Ut.INSTANCE),qz=ce(Ut,Ut.SUBGROUP),Hz=ce(Ut,Ut.INVOCATION_SUBGROUP),jz=ce(Ut,Ut.INVOCATION_LOCAL),hB=ce(Ut,Ut.DRAW);class dB extends be{static get type(){return"InstanceNode"}constructor(e,t,s=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=s,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Re.FRAME,this.buffer=null,this.bufferColor=null,this.previousInstanceMatrixNode=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){let{instanceMatrixNode:t,instanceColorNode:s}=this;t===null&&(t=this._createInstanceMatrixNode(!0,e),this.instanceMatrixNode=t);const{instanceColor:n,isStorageColor:a}=this;if(n&&s===null){if(a)s=po(n,"vec3",Math.max(n.count,1)).element(or);else{const u=new ju(n.array,3),h=n.usage===rd?p_:tg;this.bufferColor=u,s=L(h(u,"vec3",3,0))}this.instanceColorNode=s}const l=t.mul(Ot).xyz;if(Ot.assign(l),e.needsPreviousData()&&ac.assign(this.getPreviousInstancedPosition(e)),e.hasGeometryAttribute("normal")){const u=p2(gn,t);gn.assign(u)}this.instanceColorNode!==null&&ld("vec3","vInstanceColor").assign(this.instanceColorNode)}update(e){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)),this.previousInstanceMatrixNode!==null&&e.object.previousInstanceMatrix.array.set(this.instanceMatrix.array)}getPreviousInstancedPosition(e){const t=e.object;return this.previousInstanceMatrixNode===null&&(t.previousInstanceMatrix=this.instanceMatrix.clone(),this.previousInstanceMatrixNode=this._createInstanceMatrixNode(!1,e)),this.previousInstanceMatrixNode.mul(ac).xyz}_createInstanceMatrixNode(e,t){let s;const{instanceMatrix:n}=this,{count:a}=n;if(this.isStorageMatrix)s=po(n,"mat4",Math.max(a,1)).element(or);else if(a*16*4<=t.getUniformBufferLimit())s=Td(n.array,"mat4",Math.max(a,1)).element(or);else{const u=new BO(n.array,16,1);e===!0&&(this.buffer=u);const h=n.usage===rd?p_:tg,d=[h(u,"vec4",16,0),h(u,"vec4",16,4),h(u,"vec4",16,8),h(u,"vec4",16,12)];s=co(...d)}return s}}const $z=Pe(dB).setParameterLength(2,3);class Wz extends dB{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:s,instanceColor:n}=e;super(t,s,n),this.instancedMesh=e}}const pB=Pe(Wz).setParameterLength(1);class Xz extends be{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=or:this.batchingIdNode=hB);const s=P(([v])=>{const T=B(ho(kt(this.batchMesh._indirectTexture),0).x).toConst(),w=B(v).mod(T).toConst(),N=B(v).div(T).toConst();return kt(this.batchMesh._indirectTexture,ls(w,N)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(B(this.batchingIdNode)),n=this.batchMesh._matricesTexture,a=B(ho(kt(n),0).x).toConst(),l=A(s).mul(4).toInt().toConst(),u=l.mod(a).toConst(),h=l.div(a).toConst(),d=co(kt(n,ls(u,h)),kt(n,ls(u.add(1),h)),kt(n,ls(u.add(2),h)),kt(n,ls(u.add(3),h))),f=this.batchMesh._colorsTexture;if(f!==null){const T=P(([w])=>{const N=B(ho(kt(f),0).x).toConst(),C=w,R=C.mod(N).toConst(),E=C.div(N).toConst();return kt(f,ls(R,E)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(s);ld("vec3","vBatchColor").assign(T)}const m=vs(d);Ot.assign(d.mul(Ot));const b=gn.div(L(m[0].dot(m[0]),m[1].dot(m[1]),m[2].dot(m[2]))),x=m.mul(b).xyz;gn.assign(x),e.hasGeometryAttribute("tangent")&&lc.mulAssign(m)}}const fB=Pe(Xz).setParameterLength(1),eA=new WeakMap;class mB extends be{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Re.OBJECT,this.skinIndexNode=ra("skinIndex","uvec4"),this.skinWeightNode=ra("skinWeight","vec4"),this.bindMatrixNode=Rt("bindMatrix","mat4"),this.bindMatrixInverseNode=Rt("bindMatrixInverse","mat4"),this.boneMatricesNode=g_("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Ot,this.toPositionNode=Ot,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:s,skinWeightNode:n,bindMatrixNode:a,bindMatrixInverseNode:l}=this,u=e.element(s.x),h=e.element(s.y),d=e.element(s.z),f=e.element(s.w),m=a.mul(t),b=ss(u.mul(n.x).mul(m),h.mul(n.y).mul(m),d.mul(n.z).mul(m),f.mul(n.w).mul(m));return l.mul(b).xyz}getSkinnedNormalAndTangent(e=this.boneMatricesNode,t=gn,s=lc){const{skinIndexNode:n,skinWeightNode:a,bindMatrixNode:l,bindMatrixInverseNode:u}=this,h=e.element(n.x),d=e.element(n.y),f=e.element(n.z),m=e.element(n.w);let b=ss(a.x.mul(h),a.y.mul(d),a.z.mul(f),a.w.mul(m));b=u.mul(b).mul(l);const x=b.transformDirection(t).xyz,v=b.transformDirection(s).xyz;return{skinNormal:x,skinTangent:v}}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=g_("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,ac)}setup(e){e.needsPreviousData()&&ac.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const{skinNormal:s,skinTangent:n}=this.getSkinnedNormalAndTangent();gn.assign(s),e.hasGeometryAttribute("tangent")&&lc.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;eA.get(t)!==e.frameId&&(eA.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const gB=i=>new mB(i),Yz=(i,e=null)=>{const t=new mB(i);return t.positionNode=po(new ju(i.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(or).toVar(),t.skinIndexNode=po(new ju(new Uint32Array(i.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(or).toVar(),t.skinWeightNode=po(new ju(i.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(or).toVar(),t.bindMatrixNode=_e(i.bindMatrix,"mat4"),t.bindMatrixInverseNode=_e(i.bindMatrixInverse,"mat4"),t.boneMatricesNode=Td(i.skeleton.boneMatrices,"mat4",i.skeleton.bones.length),t.toPositionNode=e,ye(t)};class Kz extends be{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let u=0,h=this.params.length-1;u<h;u++){const d=this.params[u],f=d.isNode!==!0&&d.name||this.getVarName(u),m=d.isNode!==!0&&d.type||"int";s[f]=Bi(f,m)}const n=e.addStack(),a=this.params[this.params.length-1](s);t.returnsNode=a.context({nodeLoop:a}),t.stackNode=n;const l=this.params[0];if(l.isNode!==!0&&typeof l.update=="function"){const u=P(this.params[0].update)(s);t.updateNode=u.context({nodeLoop:u})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),s=this.params,n=t.stackNode;for(let l=0,u=s.length-1;l<u;l++){const h=s[l];let d=!1,f=null,m=null,b=null,x=null,v=null,T=null;h.isNode?h.getNodeType(e)==="bool"?(d=!0,x="bool",m=h.build(e,x)):(x="int",b=this.getVarName(l),f="0",m=h.build(e,x),v="<"):(x=h.type||"int",b=h.name||this.getVarName(l),f=h.start,m=h.end,v=h.condition,T=h.update,typeof f=="number"?f=e.generateConst(x,f):f&&f.isNode&&(f=f.build(e,x)),typeof m=="number"?m=e.generateConst(x,m):m&&m.isNode&&(m=m.build(e,x)),f!==void 0&&m===void 0?(f=f+" - 1",m="0",v=">="):m!==void 0&&f===void 0&&(f="0",v="<"),v===void 0&&(Number(f)>Number(m)?v=">=":v="<"));let w;if(d)w=`while ( ${m} )`;else{const N={start:f,end:m},C=N.start,R=N.end;let E;const k=()=>v.includes("<")?"+=":"-=";if(T!=null)switch(typeof T){case"function":E=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":E=b+" "+k()+" "+e.generateConst(x,T);break;case"string":E=b+" "+T;break;default:T.isNode?E=b+" "+k()+" "+T.build(e):(le("TSL: 'Loop( { update: ... } )' is not a function, string or number.",this.stackTrace),E="break /* invalid update */")}else x==="int"||x==="uint"?T=v.includes("<")?"++":"--":T=k()+" 1.",E=b+" "+T;const q=e.getVar(x,b)+" = "+C,D=b+" "+v+" "+R;w=`for ( ${q}; ${D}; ${E} )`}e.addFlowCode((l===0?`
`:"")+e.tab+w+` {

`).addFlowTab()}const a=n.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+a);for(let l=0,u=this.params.length-1;l<u;l++)e.addFlowCode((l===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const mt=(...i)=>new Kz(ul(i,"int")).toStack(),Zz=()=>Bi("continue").toStack(),yB=()=>Bi("break").toStack(),hx=new WeakMap,Dn=new rt,tA=P(({bufferMap:i,influence:e,stride:t,width:s,depth:n,offset:a})=>{const l=B(cB).mul(t).add(a),u=l.div(s),h=l.sub(u.mul(s));return kt(i,ls(h,u)).depth(n).xyz.mul(e)});function Qz(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,s=i.morphAttributes.color!==void 0,n=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,a=n!==void 0?n.length:0;let l=hx.get(i);if(l===void 0||l.count!==a){let C=function(){w.dispose(),hx.delete(i),i.removeEventListener("dispose",C)};var u=C;l!==void 0&&l.texture.dispose();const h=i.morphAttributes.position||[],d=i.morphAttributes.normal||[],f=i.morphAttributes.color||[];let m=0;e===!0&&(m=1),t===!0&&(m=2),s===!0&&(m=3);let b=i.attributes.position.count*m,x=1;const v=4096;b>v&&(x=Math.ceil(b/v),b=v);const T=new Float32Array(b*x*4*a),w=new qP(T,b,x,a);w.type=cn,w.needsUpdate=!0;const N=m*4;for(let R=0;R<a;R++){const E=h[R],k=d[R],q=f[R],D=b*x*4*R;for(let I=0;I<E.count;I++){const $=I*N;e===!0&&(Dn.fromBufferAttribute(E,I),T[D+$+0]=Dn.x,T[D+$+1]=Dn.y,T[D+$+2]=Dn.z,T[D+$+3]=0),t===!0&&(Dn.fromBufferAttribute(k,I),T[D+$+4]=Dn.x,T[D+$+5]=Dn.y,T[D+$+6]=Dn.z,T[D+$+7]=0),s===!0&&(Dn.fromBufferAttribute(q,I),T[D+$+8]=Dn.x,T[D+$+9]=Dn.y,T[D+$+10]=Dn.z,T[D+$+11]=q.itemSize===4?Dn.w:1)}}l={count:a,texture:w,stride:m,size:new Ue(b,x)},hx.set(i,l),i.addEventListener("dispose",C)}return l}class Jz extends be{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=_e(1),this.updateType=Re.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,n=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,a=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,l=a!==void 0?a.length:0,{texture:u,stride:h,size:d}=Qz(t);s===!0&&Ot.mulAssign(this.morphBaseInfluence),n===!0&&gn.mulAssign(this.morphBaseInfluence);const f=B(d.width);mt(l,({i:m})=>{const b=A(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?b.assign(kt(this.mesh.morphTexture,ls(B(m).add(1),B(or))).r):b.assign(Rt("morphTargetInfluences","float").element(m).toVar()),Me(b.notEqual(0),()=>{s===!0&&Ot.addAssign(tA({bufferMap:u,influence:b,stride:h,width:f,depth:m,offset:B(0)})),n===!0&&gn.addAssign(tA({bufferMap:u,influence:b,stride:h,width:f,depth:m,offset:B(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const bB=Pe(Jz).setParameterLength(1);class pc extends be{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class eI extends pc{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class tI extends CR{static get type(){return"LightingContextNode"}constructor(e,t=null,s=null,n=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=n,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=L().toVar("directDiffuse"),n=L().toVar("directSpecular"),a=L().toVar("indirectDiffuse"),l=L().toVar("indirectSpecular"),u={directDiffuse:s,directSpecular:n,indirectDiffuse:a,indirectSpecular:l};return{radiance:L().toVar("radiance"),irradiance:L().toVar("irradiance"),iblIrradiance:L().toVar("iblIrradiance"),ambientOcclusion:A(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const xB=Pe(tI);class sI extends pc{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const Tu=new Ue;class jg extends ur{static get type(){return"ViewportTextureNode"}constructor(e=rr,t=null,s=null){let n=null;s===null?(n=new tv,n.minFilter=oo,s=n):n=s,super(s,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=n,this.isOutputTextureNode=!0,this.updateBeforeType=Re.RENDER,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,s;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,s=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,s=this._cacheTextures),e===null)return t;if(s.has(e)===!1){const n=t.clone();s.set(e,n)}return s.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,s=t.getRenderTarget();s===null?t.getDrawingBufferSize(Tu):Tu.set(s.width,s.height);const n=this.getTextureForReference(s);(n.image.width!==Tu.width||n.image.height!==Tu.height)&&(n.image.width=Tu.width,n.image.height=Tu.height,n.needsUpdate=!0);const a=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=a}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const nI=Pe(jg).setParameterLength(0,3),aT=Pe(jg,null,null,{generateMipmaps:!0}).setParameterLength(0,3),iI=aT(),_B=(i=rr,e=null)=>iI.sample(i,e);let Lf=null;class rI extends jg{static get type(){return"ViewportDepthTextureNode"}constructor(e=rr,t=null){Lf===null&&(Lf=new hi),super(e,t,Lf)}getTextureForReference(){return Lf}}const oT=Pe(rI).setParameterLength(0,2);class hn extends be{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===hn.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,s=this.valueNode;let n=null;if(t===hn.DEPTH_BASE)s!==null&&(n=TB().assign(s));else if(t===hn.DEPTH)e.isPerspectiveCamera?n=lT(Kt.z,eo,to):n=Yu(Kt.z,eo,to);else if(t===hn.LINEAR_DEPTH)if(s!==null)if(e.isPerspectiveCamera){const a=uT(s,eo,to);n=Yu(a,eo,to)}else n=s;else n=Yu(Kt.z,eo,to);return n}}hn.DEPTH_BASE="depthBase";hn.DEPTH="depth";hn.LINEAR_DEPTH="linearDepth";const Yu=(i,e,t)=>i.add(e).div(e.sub(t)),aI=(i,e,t)=>i.add(t).div(t.sub(e)),oI=P(([i,e,t],s)=>s.renderer.reversedDepthBuffer===!0?t.sub(e).mul(i).sub(t):e.sub(t).mul(i).sub(e)),lT=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),vB=(i,e,t)=>e.mul(i.add(t)).div(i.mul(e.sub(t))),uT=P(([i,e,t],s)=>s.renderer.reversedDepthBuffer===!0?e.mul(t).div(e.sub(t).mul(i).sub(e)):e.mul(t).div(t.sub(e).mul(i).sub(t))),cT=(i,e,t)=>{e=e.max(1e-6).toVar();const s=sr(i.negate().div(e)),n=sr(t.div(e));return s.div(n)},lI=(i,e,t)=>{const s=i.mul(Fg(t.div(e)));return A(Math.E).pow(s).mul(e).negate()},TB=Pe(hn,hn.DEPTH_BASE),hT=ce(hn,hn.DEPTH),sg=Pe(hn,hn.LINEAR_DEPTH).setParameterLength(0,1),uI=sg(oT());hT.assign=i=>TB(i);class di extends be{static get type(){return"ClippingNode"}constructor(e=di.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:s,unionPlanes:n}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===di.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(s,n):this.scope===di.HARDWARE?this.setupHardwareClipping(n,e):this.setupDefault(s,n)}setupAlphaToCoverage(e,t){return P(()=>{const s=A().toVar("distanceToPlane"),n=A().toVar("distanceToGradient"),a=A(1).toVar("clipOpacity"),l=t.length;if(this.hardwareClipping===!1&&l>0){const h=Os(t).setGroup(ve);mt(l,({i:d})=>{const f=h.element(d);s.assign(Kt.dot(f.xyz).negate().add(f.w)),n.assign(s.fwidth().div(2)),a.mulAssign(Ui(n.negate(),n,s))})}const u=e.length;if(u>0){const h=Os(e).setGroup(ve),d=A(1).toVar("intersectionClipOpacity");mt(u,({i:f})=>{const m=h.element(f);s.assign(Kt.dot(m.xyz).negate().add(m.w)),n.assign(s.fwidth().div(2)),d.mulAssign(Ui(n.negate(),n,s).oneMinus())}),a.mulAssign(d.oneMinus())}pt.a.mulAssign(a),pt.a.equal(0).discard()})()}setupDefault(e,t){return P(()=>{const s=t.length;if(this.hardwareClipping===!1&&s>0){const a=Os(t).setGroup(ve);mt(s,({i:l})=>{const u=a.element(l);Kt.dot(u.xyz).greaterThan(u.w).discard()})}const n=e.length;if(n>0){const a=Os(e).setGroup(ve),l=mi(!0).toVar("clipped");mt(n,({i:u})=>{const h=a.element(u);l.assign(Kt.dot(h.xyz).greaterThan(h.w).and(l))}),l.discard()}})()}setupHardwareClipping(e,t){const s=e.length;return t.enableHardwareClipping(s),P(()=>{const n=Os(e).setGroup(ve),a=ha(t.getClipDistance());mt(s,({i:l})=>{const u=n.element(l),h=Kt.dot(u.xyz).sub(u.w).negate();a.element(l).assign(h)})})()}}di.ALPHA_TO_COVERAGE="alphaToCoverage";di.DEFAULT="default";di.HARDWARE="hardware";const cI=()=>new di,hI=()=>new di(di.ALPHA_TO_COVERAGE),dI=()=>new di(di.HARDWARE),pI=.05,sA=P(([i])=>Di(Be(1e4,Ws(Be(17,i.x).add(Be(.1,i.y)))).mul(ss(.1,At(Ws(Be(13,i.y).add(i.x))))))),nA=P(([i])=>sA(ie(sA(i.xy),i.z))),fI=P(([i])=>{const e=zt(ir(Dv(i.xyz)),ir(Lv(i.xyz))),t=A(1).div(A(pI).mul(e)).toVar("pixScale"),s=ie(ic(nr(sr(t))),ic(Pg(sr(t)))),n=ie(nA(nr(s.x.mul(i.xyz))),nA(nr(s.y.mul(i.xyz)))),a=Di(sr(t)),l=ss(Be(a.oneMinus(),n.x),Be(a,n.y)),u=mn(a,a.oneMinus()),h=L(l.mul(l).div(Be(2,u).mul($e(1,u))),l.sub(Be(.5,u)).div($e(1,u)),$e(1,$e(1,l).mul($e(1,l)).div(Be(2,u).mul($e(1,u))))),d=l.lessThan(u.oneMinus()).select(l.lessThan(u).select(h.x,h.y),h.z);return Li(d,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class mI extends t2{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),s=e.hasGeometryAttribute(t);let n;return s===!0?n=super.generate(e):n=e.generateConst(this.nodeType,new rt(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const SB=(i=0)=>new mI(i),gI=P(([i,e])=>mn(1,i.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),yI=P(([i,e])=>mn(i.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),bI=P(([i,e])=>i.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),xI=P(([i,e])=>qe(i.mul(2).mul(e),i.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),rc(.5,i))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),_I=P(([i,e])=>{const t=e.a.add(i.a.mul(e.a.oneMinus()));return Se(e.rgb.mul(e.a).add(i.rgb.mul(i.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),wB=P(([i])=>Se(i.rgb.mul(i.a),i.a),{color:"vec4",return:"vec4"}),vI=P(([i])=>(Me(i.a.equal(0),()=>Se(0)),Se(i.rgb.div(i.a),i.a)),{color:"vec4",return:"vec4"});class Ht extends In{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.maskShadowNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const s=this[t];s&&s.isNode===!0&&e.push({property:t,childNode:s})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:s}of this._getNodeChildren())e.push(hc(t.slice(0,-4)),s.getCacheKey());return this.type+xd(e)}build(e){this.setup(e)}setupObserver(e){return new PO(e)}setup(e){e.context.setupNormal=()=>hl(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,s=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:le('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:le('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const n=this.setupVertex(e),a=hl(this.vertexNode||n,"VERTEX");e.context.clipSpace=a,e.stack.outputNode=a,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let l;const u=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(s!==null?s.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const h=this.setupLighting(e);u!==null&&e.stack.addToStack(u);const d=Se(h,pt.a).max(0);l=this.setupOutput(e,d),Wu.assign(l);const f=this.outputNode!==null;if(f&&(l=this.outputNode),e.context.getOutput&&(l=e.context.getOutput(l,e)),s!==null){const m=t.getMRT(),b=this.mrtNode;m!==null?(f&&Wu.assign(l),l=m,b!==null&&(l=m.merge(b))):b!==null&&(l=b)}}else{let h=this.fragmentNode;h.isOutputStructNode!==!0&&(h=Se(h)),l=this.setupOutput(e,h)}e.stack.outputNode=l,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:s}=e.clippingContext;let n=null;if(t.length>0||s.length>0){const a=e.renderer.currentSamples;this.alphaToCoverage&&a>1?n=hI():e.stack.addToStack(cI())}return n}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(dI()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:s}=e;let n=this.depthNode;if(n===null){const a=t.getMRT();a&&a.has("depth")?n=a.get("depth"):t.logarithmicDepthBuffer===!0&&(s.isPerspectiveCamera?n=cT(Kt.z,eo,to):n=Yu(Kt.z,eo,to))}n!==null&&hT.assign(n).toStack()}setupPositionView(){return To.mul(Ot).xyz}setupModelViewProjection(){return ea.mul(Kt)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.position=e.removeStack(),uB}setupPosition(e){const{object:t,geometry:s}=e;if((s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&bB(t).toStack(),t.isSkinnedMesh===!0&&gB(t).toStack(),this.displacementMap){const n=Hr("displacementMap","texture"),a=Hr("displacementScale","float"),l=Hr("displacementBias","float");Ot.addAssign(gn.normalize().mul(n.x.mul(a).add(l)))}return t.isBatchedMesh&&fB(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&pB(t).toStack(),this.positionNode!==null&&Ot.assign(hl(this.positionNode,"POSITION","vec3")),Ot}setupDiffuseColor(e){const{object:t,geometry:s}=e;this.maskNode!==null&&mi(this.maskNode).not().discard();let n=this.colorNode?Se(this.colorNode):L2;this.vertexColors===!0&&s.hasAttribute("color")&&(n=n.mul(SB())),t.instanceColor&&(n=ld("vec3","vInstanceColor").mul(n)),t.isBatchedMesh&&t._colorsTexture&&(n=ld("vec3","vBatchColor").mul(n)),pt.assign(n);const a=this.opacityNode?A(this.opacityNode):iT;pt.a.assign(pt.a.mul(a));let l=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(l=this.alphaTestNode!==null?A(this.alphaTestNode):D2,this.alphaToCoverage===!0?(pt.a=Ui(l,l.add(Fv(pt.a)),pt.a),pt.a.lessThanEqual(0).discard()):pt.a.lessThanEqual(l).discard()),this.alphaHash===!0&&pt.a.lessThan(fI(Ot)).discard(),e.isOpaque()&&pt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?L(0):pt.rgb}setupNormal(){return this.normalNode?L(this.normalNode):I2}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Hr("envMap","cubeTexture"):Hr("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new sI(rT)),t}setupLights(e){const t=[],s=this.setupEnvironment(e);s&&s.isLightingNode&&t.push(s);const n=this.setupLightMap(e);n&&n.isLightingNode&&t.push(n);let a=this.aoNode;a===null&&e.material.aoMap&&(a=lB),e.context.getAO&&(a=e.context.getAO(a,e)),a&&t.push(new eI(a));let l=this.lightsNode||e.lightsNode;return t.length>0&&(l=e.renderer.lighting.createNode([...l.getLights(),...t])),l}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:n,emissiveNode:a}=this,u=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let h=this.setupOutgoingLight(e);if(u&&u.getScope().hasLights){const d=this.setupLightingModel(e)||null;h=xB(u,d,s,n)}else s!==null&&(h=L(n!==null?qe(h,s,n):s));return(a&&a.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(h_.assign(L(a||F2)),h=h.add(h_)),h}setupFog(e,t){const s=e.fogNode;return s&&(Wu.assign(t),t=Se(s.toVar())),t}setupPremultipliedAlpha(e,t){return wB(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const s in e){const n=e[s];this[s]===void 0&&(this[s]=n,n&&n.clone&&(this[s]=n.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=In.prototype.toJSON.call(this,e);s.inputNodes={};for(const{property:a,childNode:l}of this._getNodeChildren())s.inputNodes[a]=l.toJSON(e).uuid;function n(a){const l=[];for(const u in a){const h=a[u];delete h.metadata,l.push(h)}return l}if(t){const a=n(e.textures),l=n(e.images),u=n(e.nodes);a.length>0&&(s.textures=a),l.length>0&&(s.images=l),u.length>0&&(s.nodes=u)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.maskShadowNode=e.maskShadowNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const TI=new yE;class SI extends Ht{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(TI),this.setValues(e)}}const wI=new bO;class MI extends Ht{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(wI),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?A(this.offsetNode):rB,t=this.dashScaleNode?A(this.dashScaleNode):sB,s=this.dashSizeNode?A(this.dashSizeNode):nB,n=this.gapSizeNode?A(this.gapSizeNode):iB;im.assign(s),d_.assign(n);const a=_o(ra("lineDistance").mul(t));(e?a.add(e):a).mod(im.add(d_)).greaterThan(im).discard()}}const NI=new mO;class AI extends Ht{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(NI),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?A(this.opacityNode):iT;pt.assign(Vg(Se(B2(et),e),Un))}}const dT=P(([i=Qv])=>{const e=i.z.atan(i.x).mul(1/(Math.PI*2)).add(.5),t=i.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ie(e,t)});class MB extends ua{constructor(e=1,t={}){super(e,e,t),this.isCubeRenderTarget=!0;const s={width:e,height:e,depth:1},n=[s,s,s,s,s,s];this.texture=new wg(n),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){const s=t.minFilter,n=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const a=new Mg(5,5,5),l=dT(Qv),u=new Ht;u.colorNode=st(t,l,0),u.side=Rs,u.blending=Xr;const h=new na(a,u),d=new Z_;d.add(h),t.minFilter===oo&&(t.minFilter=Gs);const f=new EO(1,10,this),m=e.getMRT();return e.setMRT(null),f.update(e,d),e.setMRT(m),t.minFilter=s,t.currentGenerateMipmaps=n,h.geometry.dispose(),h.material.dispose(),this}clear(e,t=!0,s=!0,n=!0){const a=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,s,n);e.setRenderTarget(a)}}const Qh=new WeakMap;class CI extends jt{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Ys(null);const t=new wg;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Re.RENDER}updateBefore(e){const{renderer:t,material:s}=e,n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const a=n.isTextureNode?n.value:s[n.property];if(a&&a.isTexture){const l=a.mapping;if(l===q_||l===H_){if(Qh.has(a)){const u=Qh.get(a);iA(u,a.mapping),this._cubeTexture=u}else{const u=a.image;if(EI(u)){const h=new MB(u.height);h.fromEquirectangularTexture(t,a),iA(h.texture,a.mapping),this._cubeTexture=h.texture,Qh.set(a,h.texture),a.addEventListener("dispose",NB)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function EI(i){return i==null?!1:i.height>0}function NB(i){const e=i.target;e.removeEventListener("dispose",NB);const t=Qh.get(e);t!==void 0&&(Qh.delete(e),t.dispose())}function iA(i,e){e===q_?i.mapping=Ju:e===H_&&(i.mapping=xm)}const AB=Pe(CI).setParameterLength(1);class pT extends pc{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=AB(this.envNode)}}class RI extends pc{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=A(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class $g{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class CB extends $g{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,s=e.reflectedLight,n=e.irradianceLightMap;s.indirectDiffuse.assign(Se(0)),n?s.indirectDiffuse.addAssign(n):s.indirectDiffuse.addAssign(Se(1,1,1,0)),s.indirectDiffuse.mulAssign(t),s.indirectDiffuse.mulAssign(pt.rgb)}finish(e){const{material:t,context:s}=e,n=s.outgoingLight,a=e.context.environment;if(a)switch(t.combine){case mg:n.rgb.assign(qe(n.rgb,n.rgb.mul(a.rgb),Zh.mul(lm)));break;case WF:n.rgb.assign(qe(n.rgb,a.rgb,Zh.mul(lm)));break;case XF:n.rgb.addAssign(a.rgb.mul(Zh.mul(lm)));break;default:ue("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const BI=new Qa;class EB extends Ht{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(BI),this.setValues(e)}setupNormal(){return dc(oc)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new pT(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new RI(rT)),t}setupOutgoingLight(){return pt.rgb}setupLightingModel(){return new CB}}const uc=P(({f0:i,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(s.oneMinus()).add(e.mul(s))}),fl=P(i=>i.diffuseColor.mul(1/Math.PI)),DI=()=>A(.25),LI=P(({dotNH:i})=>Qm.mul(A(.5)).add(1).mul(A(1/Math.PI)).mul(i.pow(Qm))),UI=P(({lightDirection:i})=>{const e=i.add(Tt).normalize(),t=et.dot(e).clamp(),s=Tt.dot(e).clamp(),n=uc({f0:yo,f90:1,dotVH:s}),a=DI(),l=LI({dotNH:t});return n.mul(a).mul(l)});class RB extends CB{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const a=et.dot(e).clamp().mul(t);s.directDiffuse.addAssign(a.mul(fl({diffuseColor:pt.rgb}))),this.specular===!0&&s.directSpecular.addAssign(a.mul(UI({lightDirection:e})).mul(Zh))}indirect(e){const{ambientOcclusion:t,irradiance:s,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(s.mul(fl({diffuseColor:pt}))),n.indirectDiffuse.mulAssign(t)}}const FI=new gO;class PI extends Ht{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(FI),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new pT(t):null}setupLightingModel(){return new RB(!1)}}const OI=new pO;class VI extends Ht{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(OI),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new pT(t):null}setupLightingModel(){return new RB}setupVariants(){const e=(this.shininessNode?A(this.shininessNode):U2).max(1e-4);Qm.assign(e);const t=this.specularNode||P2;yo.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const BB=P(i=>{if(i.geometry.hasAttribute("normal")===!1)return A(0);const e=oc.dFdx().abs().max(oc.dFdy().abs());return e.x.max(e.y).max(e.z)}),fT=P(i=>{const{roughness:e}=i,t=BB();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),DB=P(({alpha:i,dotNL:e,dotNV:t})=>{const s=i.pow2(),n=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt()),a=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt());return kn(.5,n.add(a).max(Mv))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),zI=P(({alphaT:i,alphaB:e,dotTV:t,dotBV:s,dotTL:n,dotBL:a,dotNV:l,dotNL:u})=>{const h=u.mul(L(i.mul(t),e.mul(s),l).length()),d=l.mul(L(i.mul(n),e.mul(a),u).length());return kn(.5,h.add(d))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),LB=P(({alpha:i,dotNH:e})=>{const t=i.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),II=A(1/Math.PI),kI=P(({alphaT:i,alphaB:e,dotNH:t,dotTH:s,dotBH:n})=>{const a=i.mul(e),l=L(e.mul(s),i.mul(n),a.mul(t)),u=l.dot(l),h=a.div(u);return II.mul(a.mul(h.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),mT=P(({lightDirection:i,f0:e,f90:t,roughness:s,f:n,normalView:a=et,USE_IRIDESCENCE:l,USE_ANISOTROPY:u})=>{const h=s.pow2(),d=i.add(Tt).normalize(),f=a.dot(i).clamp(),m=a.dot(Tt).clamp(),b=a.dot(d).clamp(),x=Tt.dot(d).clamp();let v=uc({f0:e,f90:t,dotVH:x}),T,w;if(ad(l)&&(v=Lg.mix(v,n)),ad(u)){const N=Yh.dot(i),C=Yh.dot(Tt),R=Yh.dot(d),E=cl.dot(i),k=cl.dot(Tt),q=cl.dot(d);T=zI({alphaT:Zm,alphaB:h,dotTV:C,dotBV:k,dotTL:N,dotBL:E,dotNV:m,dotNL:f}),w=kI({alphaT:Zm,alphaB:h,dotNH:b,dotTH:R,dotBH:q})}else T=DB({alpha:h,dotNL:f,dotNV:m}),w=LB({alpha:h,dotNH:b});return v.mul(T).mul(w)}),GI=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let ji=null;const ud=P(({roughness:i,dotNV:e})=>{ji===null&&(ji=new gE(GI,16,16,Zi,Cs),ji.name="DFG_LUT",ji.minFilter=Gs,ji.magFilter=Gs,ji.wrapS=Ki,ji.wrapT=Ki,ji.generateMipmaps=!1,ji.needsUpdate=!0);const t=ie(i,e);return st(ji,t).rg}),qI=P(({lightDirection:i,f0:e,f90:t,roughness:s,f:n,USE_IRIDESCENCE:a,USE_ANISOTROPY:l})=>{const u=mT({lightDirection:i,f0:e,f90:t,roughness:s,f:n,USE_IRIDESCENCE:a,USE_ANISOTROPY:l}),h=et.dot(i).clamp(),d=et.dot(Tt).clamp(),f=ud({roughness:s,dotNV:d}),m=ud({roughness:s,dotNV:h}),b=e.mul(f.x).add(t.mul(f.y)),x=e.mul(m.x).add(t.mul(m.y)),v=f.x.add(f.y),T=m.x.add(m.y),w=A(1).sub(v),N=A(1).sub(T),C=e.add(e.oneMinus().mul(.047619)),R=b.mul(x).mul(C).div(A(1).sub(w.mul(N).mul(C).mul(C)).add(Mv)),E=w.mul(N),k=R.mul(E);return u.add(k)}),UB=P(i=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:n}=i,a=ud({dotNV:e,roughness:n});return t.mul(a.x).add(s.mul(a.y))}),T_=P(({f:i,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),n=s.mul(s),a=s.mul(n,n).clamp(0,.9999);return i.sub(L(e).mul(a)).div(a.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),HI=P(({roughness:i,dotNH:e})=>{const t=i.pow2(),s=A(1).div(t),a=e.pow2().oneMinus().max(.0078125);return A(2).add(s).mul(a.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),jI=P(({dotNV:i,dotNL:e})=>A(1).div(A(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),$I=P(({lightDirection:i})=>{const e=i.add(Tt).normalize(),t=et.dot(i).clamp(),s=et.dot(Tt).clamp(),n=et.dot(e).clamp(),a=HI({roughness:Ja,dotNH:n}),l=jI({dotNV:s,dotNL:t});return Ln.mul(a).mul(l)}),rA=P(({N:i,V:e,roughness:t})=>{const a=.0078125,l=i.dot(e).saturate(),u=ie(t,l.oneMinus().sqrt());return u.assign(u.mul(.984375).add(a)),u}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),WI=P(({f:i})=>{const e=i.length();return zt(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Uf=P(({v1:i,v2:e})=>{const t=i.dot(e),s=t.abs().toVar(),n=s.mul(.0145206).add(.4965155).mul(s).add(.8543985).toVar(),a=s.add(4.1616724).mul(s).add(3.417594).toVar(),l=n.div(a),u=t.greaterThan(0).select(l,zt(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(l));return i.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),dx=P(({N:i,V:e,P:t,mInv:s,p0:n,p1:a,p2:l,p3:u})=>{const h=a.sub(n).toVar(),d=u.sub(n).toVar(),f=h.cross(d),m=L().toVar();return Me(f.dot(t.sub(n)).greaterThanEqual(0),()=>{const b=e.sub(i.mul(e.dot(i))).normalize(),x=i.cross(b).negate(),v=s.mul(vs(b,x,i).transpose()).toVar(),T=v.mul(n.sub(t)).normalize().toVar(),w=v.mul(a.sub(t)).normalize().toVar(),N=v.mul(l.sub(t)).normalize().toVar(),C=v.mul(u.sub(t)).normalize().toVar(),R=L(0).toVar();R.addAssign(Uf({v1:T,v2:w})),R.addAssign(Uf({v1:w,v2:N})),R.addAssign(Uf({v1:N,v2:C})),R.addAssign(Uf({v1:C,v2:T})),m.assign(L(WI({f:R})))}),m}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Wg=1/6,FB=i=>Be(Wg,Be(i,Be(i,i.negate().add(3)).sub(3)).add(1)),S_=i=>Be(Wg,Be(i,Be(i,Be(3,i).sub(6))).add(4)),PB=i=>Be(Wg,Be(i,Be(i,Be(-3,i).add(3)).add(3)).add(1)),w_=i=>Be(Wg,oi(i,3)),aA=i=>FB(i).add(S_(i)),oA=i=>PB(i).add(w_(i)),lA=i=>ss(-1,S_(i).div(FB(i).add(S_(i)))),uA=i=>ss(1,w_(i).div(PB(i).add(w_(i)))),cA=(i,e,t)=>{const s=i.uvNode,n=Be(s,e.zw).add(.5),a=nr(n),l=Di(n),u=aA(l.x),h=oA(l.x),d=lA(l.x),f=uA(l.x),m=lA(l.y),b=uA(l.y),x=ie(a.x.add(d),a.y.add(m)).sub(.5).mul(e.xy),v=ie(a.x.add(f),a.y.add(m)).sub(.5).mul(e.xy),T=ie(a.x.add(d),a.y.add(b)).sub(.5).mul(e.xy),w=ie(a.x.add(f),a.y.add(b)).sub(.5).mul(e.xy),N=aA(l.y).mul(ss(u.mul(i.sample(x).level(t)),h.mul(i.sample(v).level(t)))),C=oA(l.y).mul(ss(u.mul(i.sample(T).level(t)),h.mul(i.sample(w).level(t))));return N.add(C)},gT=P(([i,e])=>{const t=ie(i.size(B(e))),s=ie(i.size(B(e.add(1)))),n=kn(1,t),a=kn(1,s),l=cA(i,Se(n,t),nr(e)),u=cA(i,Se(a,s),Pg(e));return Di(e).mix(l,u)}),XI=P(([i,e])=>{const t=e.mul(Wv(i));return gT(i,t)}),hA=P(([i,e,t,s,n])=>{const a=L(zv(e.negate(),fn(i),kn(1,s))),l=L(ir(n[0].xyz),ir(n[1].xyz),ir(n[2].xyz));return fn(a).mul(t.mul(l))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),YI=P(([i,e])=>i.mul(Li(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),KI=aT(),ZI=_B(),dA=P(([i,e,t],{material:s})=>{const a=(s.side===Rs?KI:ZI).sample(i),l=sr(pl.x).mul(YI(e,t));return gT(a,l)}),pA=P(([i,e,t])=>(Me(t.notEqual(0),()=>{const s=Fg(e).negate().div(t);return Nv(s.negate().mul(i))}),L(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),QI=P(([i,e,t,s,n,a,l,u,h,d,f,m,b,x,v])=>{let T,w;if(v){T=Se().toVar(),w=L().toVar();const k=f.sub(1).mul(v.mul(.025)),q=L(f.sub(k),f,f.add(k));mt({start:0,end:3},({i:D})=>{const I=q.element(D),$=hA(i,e,m,I,u),ae=l.add($),pe=d.mul(h.mul(Se(ae,1))),me=ie(pe.xy.div(pe.w)).toVar();me.addAssign(1),me.divAssign(2),me.assign(ie(me.x,me.y.oneMinus()));const xe=dA(me,t,I);T.element(D).assign(xe.element(D)),T.a.addAssign(xe.a),w.element(D).assign(s.element(D).mul(pA(ir($),b,x).element(D)))}),T.a.divAssign(3)}else{const k=hA(i,e,m,f,u),q=l.add(k),D=d.mul(h.mul(Se(q,1))),I=ie(D.xy.div(D.w)).toVar();I.addAssign(1),I.divAssign(2),I.assign(ie(I.x,I.y.oneMinus())),T=dA(I,t,f),w=s.mul(pA(ir(k),b,x))}const N=w.rgb.mul(T.rgb),C=i.dot(e).clamp(),R=L(UB({dotNV:C,specularColor:n,specularF90:a,roughness:t})),E=w.r.add(w.g,w.b).div(3);return Se(R.oneMinus().mul(N),T.a.oneMinus().mul(E).oneMinus())}),JI=vs(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),ek=i=>{const e=i.sqrt();return L(1).add(e).div(L(1).sub(e))},fA=(i,e)=>i.sub(e).div(i.add(e)).pow2(),tk=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),s=L(54856e-17,44201e-17,52481e-17),n=L(1681e3,1795300,2208400),a=L(43278e5,93046e5,66121e5),l=A(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let u=s.mul(a.mul(2*Math.PI).sqrt()).mul(n.mul(t).add(e).cos()).mul(t.pow2().negate().mul(a).exp());return u=L(u.x.add(l),u.y,u.z).div(10685e-11),JI.mul(u)},mA=P(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:n})=>{const a=qe(i,e,Ui(0,.03,s)),u=i.div(a).pow2().mul(t.pow2().oneMinus()).oneMinus();Me(u.lessThan(0),()=>L(1));const h=u.sqrt(),d=fA(a,i),f=uc({f0:d,f90:1,dotVH:t}),m=f.oneMinus(),b=a.lessThan(i).select(Math.PI,0),x=A(Math.PI).sub(b),v=ek(n.clamp(0,.9999)),T=fA(v,a.toVec3()),w=uc({f0:T,f90:1,dotVH:h}),N=L(v.x.lessThan(a).select(Math.PI,0),v.y.lessThan(a).select(Math.PI,0),v.z.lessThan(a).select(Math.PI,0)),C=a.mul(s,h,2),R=L(x).add(N),E=f.mul(w).clamp(1e-5,.9999),k=E.sqrt(),q=m.pow2().mul(w).div(L(1).sub(E)),I=f.add(q).toVar(),$=q.sub(m).toVar();return mt({start:1,end:2,condition:"<=",name:"m"},({m:ae})=>{$.mulAssign(k);const pe=tk(A(ae).mul(C),A(ae).mul(R)).mul(2);I.addAssign($.mul(pe))}),I.max(L(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),vh=P(({normal:i,viewDir:e,roughness:t})=>{const s=i.dot(e).saturate(),n=t.mul(t),a=t.add(.1).reciprocal(),l=A(-1.9362).add(t.mul(1.0678)).add(n.mul(.4573)).sub(a.mul(.8469)),u=A(-.6014).add(t.mul(.5538)).sub(n.mul(.467)).sub(a.mul(.1255));return l.mul(s).add(u).exp().saturate()}),Th=L(.04),Ff=A(1);class OB extends $g{constructor(e=!1,t=!1,s=!1,n=!1,a=!1,l=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.anisotropy=n,this.transmission=a,this.dispersion=l,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=L().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=L().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=L().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=L().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=L().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=et.dot(Tt).clamp(),s=mA({outsideIOR:A(1),eta2:Ym,cosTheta1:t,thinFilmThickness:Km,baseF0:yo}),n=mA({outsideIOR:A(1),eta2:Ym,cosTheta1:t,thinFilmThickness:Km,baseF0:pt.rgb});this.iridescenceFresnel=qe(s,n,jr),this.iridescenceF0Dielectric=T_({f:s,f90:1,dotVH:t}),this.iridescenceF0Metallic=T_({f:n,f90:1,dotVH:t}),this.iridescenceF0=qe(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,jr)}if(this.transmission===!0){const t=ar,s=a2.sub(ar).normalize(),n=So,a=e.context;a.backdrop=QI(n,s,Yi,sl,al,ol,t,li,xi,ea,Kh,xv,vv,_v,this.dispersion?Tv:null),a.backdropAlpha=Jm,pt.a.mulAssign(qe(1,a.backdrop.a,Jm))}super.start(e)}computeMultiscattering(e,t,s,n,a=null){const l=et.dot(Tt).clamp(),u=ud({roughness:Yi,dotNV:l}),h=a?Lg.mix(n,a):n,d=h.mul(u.x).add(s.mul(u.y)),m=u.x.add(u.y).oneMinus(),b=h.add(h.oneMinus().mul(.047619)),x=d.mul(b).div(m.mul(b).oneMinus());e.addAssign(d),t.addAssign(x.mul(m))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const a=et.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(a.mul($I({lightDirection:e})));const l=vh({normal:et,viewDir:Tt,roughness:Ja}),u=vh({normal:et,viewDir:e,roughness:Ja}),h=Ln.r.max(Ln.g).max(Ln.b).mul(l.max(u)).oneMinus();a.mulAssign(h)}if(this.clearcoat===!0){const u=so.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(u.mul(mT({lightDirection:e,f0:Th,f90:Ff,roughness:$u,normalView:so})))}s.directDiffuse.addAssign(a.mul(fl({diffuseColor:sl}))),s.directSpecular.addAssign(a.mul(qI({lightDirection:e,f0:al,f90:1,roughness:Yi,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:s,halfHeight:n,reflectedLight:a,ltc_1:l,ltc_2:u}){const h=t.add(s).sub(n),d=t.sub(s).sub(n),f=t.sub(s).add(n),m=t.add(s).add(n),b=et,x=Tt,v=Kt.toVar(),T=rA({N:b,V:x,roughness:Yi}),w=l.sample(T).toVar(),N=u.sample(T).toVar(),C=vs(L(w.x,0,w.y),L(0,1,0),L(w.z,0,w.w)).toVar(),R=al.mul(N.x).add(ol.sub(al).mul(N.y)).toVar();if(a.directSpecular.addAssign(e.mul(R).mul(dx({N:b,V:x,P:v,mInv:C,p0:h,p1:d,p2:f,p3:m}))),a.directDiffuse.addAssign(e.mul(sl).mul(dx({N:b,V:x,P:v,mInv:vs(1,0,0,0,1,0,0,0,1),p0:h,p1:d,p2:f,p3:m}))),this.clearcoat===!0){const E=so,k=rA({N:E,V:x,roughness:$u}),q=l.sample(k),D=u.sample(k),I=vs(L(q.x,0,q.y),L(0,1,0),L(q.z,0,q.w)),$=Th.mul(D.x).add(Ff.sub(Th).mul(D.y));this.clearcoatSpecularDirect.addAssign(e.mul($).mul(dx({N:E,V:x,P:v,mInv:I,p0:h,p1:d,p2:f,p3:m})))}}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:s}=e.context,n=t.mul(fl({diffuseColor:sl})).toVar();if(this.sheen===!0){const a=vh({normal:et,viewDir:Tt,roughness:Ja}),l=Ln.r.max(Ln.g).max(Ln.b).mul(a).oneMinus();n.mulAssign(l)}s.indirectDiffuse.addAssign(n)}indirectSpecular(e){const{radiance:t,iblIrradiance:s,reflectedLight:n}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(s.mul(Ln,vh({normal:et,viewDir:Tt,roughness:Ja}))),this.clearcoat===!0){const w=so.dot(Tt).clamp(),N=UB({dotNV:w,specularColor:Th,specularF90:Ff,roughness:$u});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(N))}const a=L().toVar("singleScatteringDielectric"),l=L().toVar("multiScatteringDielectric"),u=L().toVar("singleScatteringMetallic"),h=L().toVar("multiScatteringMetallic");this.computeMultiscattering(a,l,ol,yo,this.iridescenceF0Dielectric),this.computeMultiscattering(u,h,ol,pt.rgb,this.iridescenceF0Metallic);const d=qe(a,u,jr),f=qe(l,h,jr),m=a.add(l),b=sl.mul(m.oneMinus()),x=s.mul(1/Math.PI),v=t.mul(d).add(f.mul(x)).toVar(),T=b.mul(x).toVar();if(this.sheen===!0){const w=vh({normal:et,viewDir:Tt,roughness:Ja}),N=Ln.r.max(Ln.g).max(Ln.b).mul(w).oneMinus();v.mulAssign(N),T.mulAssign(N)}n.indirectSpecular.addAssign(v),n.indirectDiffuse.addAssign(T)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:s}=e.context,a=et.dot(Tt).clamp().add(t),l=Yi.mul(-16).oneMinus().negate().exp2(),u=t.sub(a.pow(l).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),s.indirectDiffuse.mulAssign(t),s.indirectSpecular.mulAssign(u)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=so.dot(Tt).clamp(),n=uc({dotVH:s,f0:Th,f90:Ff}),a=t.mul(Xm.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Xm));t.assign(a)}if(this.sheen===!0){const s=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(s)}}}const gA=A(1),M_=A(-2),Pf=A(.8),px=A(-1),Of=A(.4),fx=A(2),Vf=A(.305),mx=A(3),yA=A(.21),sk=A(4),bA=A(4),nk=A(16),ik=P(([i])=>{const e=L(At(i)).toVar(),t=A(-1).toVar();return Me(e.x.greaterThan(e.z),()=>{Me(e.x.greaterThan(e.y),()=>{t.assign(zs(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(zs(i.y.greaterThan(0),1,4))})}).Else(()=>{Me(e.z.greaterThan(e.y),()=>{t.assign(zs(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(zs(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),rk=P(([i,e])=>{const t=ie().toVar();return Me(e.equal(0),()=>{t.assign(ie(i.z,i.y).div(At(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(ie(i.x.negate(),i.z.negate()).div(At(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(ie(i.x.negate(),i.y).div(At(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(ie(i.z.negate(),i.y).div(At(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(ie(i.x.negate(),i.z).div(At(i.y)))}).Else(()=>{t.assign(ie(i.x,i.y).div(At(i.z)))}),Be(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),ak=P(([i])=>{const e=A(0).toVar();return Me(i.greaterThanEqual(Pf),()=>{e.assign(gA.sub(i).mul(px.sub(M_)).div(gA.sub(Pf)).add(M_))}).ElseIf(i.greaterThanEqual(Of),()=>{e.assign(Pf.sub(i).mul(fx.sub(px)).div(Pf.sub(Of)).add(px))}).ElseIf(i.greaterThanEqual(Vf),()=>{e.assign(Of.sub(i).mul(mx.sub(fx)).div(Of.sub(Vf)).add(fx))}).ElseIf(i.greaterThanEqual(yA),()=>{e.assign(Vf.sub(i).mul(sk.sub(mx)).div(Vf.sub(yA)).add(mx))}).Else(()=>{e.assign(A(-2).mul(sr(Be(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),VB=P(([i,e])=>{const t=i.toVar();t.assign(Be(2,t).sub(1));const s=L(t,1).toVar();return Me(e.equal(0),()=>{s.assign(s.zyx)}).ElseIf(e.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{s.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),zB=P(([i,e,t,s,n,a])=>{const l=A(t),u=L(e),h=Li(ak(l),M_,a),d=Di(h),f=nr(h),m=L(cd(i,u,f,s,n,a)).toVar();return Me(d.notEqual(0),()=>{const b=L(cd(i,u,f.add(1),s,n,a)).toVar();m.assign(qe(m,b,d))}),m}),cd=P(([i,e,t,s,n,a])=>{const l=A(t).toVar(),u=L(e),h=A(ik(u)).toVar(),d=A(zt(bA.sub(l),0)).toVar();l.assign(zt(l,bA));const f=A(ic(l)).toVar(),m=ie(rk(u,h).mul(f.sub(2)).add(1)).toVar();return Me(h.greaterThan(2),()=>{m.y.addAssign(f),h.subAssign(3)}),m.x.addAssign(h.mul(f)),m.x.addAssign(d.mul(Be(3,nk))),m.y.addAssign(Be(4,ic(a).sub(f))),m.x.mulAssign(s),m.y.mulAssign(n),i.sample(m).grad(ie(),ie())}),gx=P(({envMap:i,mipInt:e,outputDirection:t,theta:s,axis:n,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})=>{const h=Ai(s),d=t.mul(h).add(n.cross(t).mul(Ws(s))).add(n.mul(n.dot(t).mul(h.oneMinus())));return cd(i,d,e,a,l,u)}),IB=P(({n:i,latitudinal:e,poleAxis:t,outputDirection:s,weights:n,samples:a,dTheta:l,mipInt:u,envMap:h,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m})=>{const b=L(zs(e,t,ia(t,s))).toVar();Me(b.equal(L(0)),()=>{b.assign(L(s.z,0,s.x.negate()))}),b.assign(fn(b));const x=L().toVar();return x.addAssign(n.element(0).mul(gx({theta:0,axis:b,outputDirection:s,mipInt:u,envMap:h,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m}))),mt({start:B(1),end:i},({i:v})=>{Me(v.greaterThanEqual(a),()=>{yB()});const T=A(l.mul(A(v))).toVar();x.addAssign(n.element(v).mul(gx({theta:T.mul(-1),axis:b,outputDirection:s,mipInt:u,envMap:h,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m}))),x.addAssign(n.element(v).mul(gx({theta:T,axis:b,outputDirection:s,mipInt:u,envMap:h,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m})))}),Se(x,1)}),ok=P(([i])=>{const e=se(i).toVar();return e.assign(e.shiftLeft(se(16)).bitOr(e.shiftRight(se(16)))),e.assign(e.bitAnd(se(1431655765)).shiftLeft(se(1)).bitOr(e.bitAnd(se(2863311530)).shiftRight(se(1)))),e.assign(e.bitAnd(se(858993459)).shiftLeft(se(2)).bitOr(e.bitAnd(se(3435973836)).shiftRight(se(2)))),e.assign(e.bitAnd(se(252645135)).shiftLeft(se(4)).bitOr(e.bitAnd(se(4042322160)).shiftRight(se(4)))),e.assign(e.bitAnd(se(16711935)).shiftLeft(se(8)).bitOr(e.bitAnd(se(4278255360)).shiftRight(se(8)))),A(e).mul(23283064365386963e-26)}),lk=P(([i,e])=>ie(A(i).div(A(e)),ok(i))),uk=P(([i,e,t])=>{const s=t.mul(t).toConst(),n=L(1,0,0).toConst(),a=ia(e,n).toConst(),l=Zs(i.x).toConst(),u=Be(2,3.14159265359).mul(i.y).toConst(),h=l.mul(Ai(u)).toConst(),d=l.mul(Ws(u)).toVar(),f=Be(.5,e.z.add(1)).toConst();d.assign(f.oneMinus().mul(Zs(h.mul(h).oneMinus())).add(f.mul(d)));const m=n.mul(h).add(a.mul(d)).add(e.mul(Zs(zt(0,h.mul(h).add(d.mul(d)).oneMinus()))));return fn(L(s.mul(m.x),s.mul(m.y),zt(0,m.z)))}),kB=P(({roughness:i,mipInt:e,envMap:t,N_immutable:s,GGX_SAMPLES:n,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})=>{const h=L(s).toVar(),d=L(0).toVar(),f=A(0).toVar();return Me(i.lessThan(.001),()=>{d.assign(cd(t,h,e,a,l,u))}).Else(()=>{const m=zs(At(h.z).lessThan(.999),L(0,0,1),L(1,0,0)),b=fn(ia(m,h)).toVar(),x=ia(h,b).toVar();mt({start:se(0),end:n},({i:v})=>{const T=lk(v,n),w=uk(T,L(0,0,1),i),N=fn(b.mul(w.x).add(x.mul(w.y)).add(h.mul(w.z))),C=fn(N.mul(gi(h,N).mul(2)).sub(h)),R=zt(gi(h,C),0);Me(R.greaterThan(0),()=>{const E=cd(t,C,e,a,l,u);d.addAssign(E.mul(R)),f.addAssign(R)})}),Me(f.greaterThan(0),()=>{d.assign(d.div(f))})}),Se(d,1)}),ro=4,xA=[.125,.215,.35,.446,.526,.582],nl=20,ck=512,Sh=new av(-1,1,1,-1,0,1),hk=new un(90,1),_A=new it;let yx=null,bx=0,xx=0;const dk=new z,ng=new WeakMap,pk=[3,1,5,0,4,2],_x=VB(xt(),ra("faceIndex")).normalize(),Xg=L(_x.x,_x.y,_x.z);class fk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,s=.1,n=100,a={}){const{size:l=256,position:u=dk,renderTarget:h=null}=a;if(this._setSize(l),this._hasInitialized===!1){ue('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const f=h||this._allocateTarget();return a.renderTarget=f,this.fromSceneAsync(e,t,s,n,a),f}yx=this._renderer.getRenderTarget(),bx=this._renderer.getActiveCubeFace(),xx=this._renderer.getActiveMipmapLevel();const d=h||this._allocateTarget();return d.depthBuffer=!0,this._init(d),this._sceneToCubeUV(e,s,n,d,u),t>0&&this._blur(d,0,0,t),this._applyPMREM(d),this._cleanup(d),d}async fromSceneAsync(e,t=0,s=.1,n=100,a={}){return ft('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,s,n,a)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){ue('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const s=t||this._allocateTarget();return this.fromEquirectangularAsync(e,s),s}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return ft('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){ue("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const s=t||this._allocateTarget();return this.fromCubemapAsync(e,t),s}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return ft('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TA(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=SA(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Ju||e.mapping===xm?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(yx,bx,xx),e.scissorTest=!1,Su(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),yx=this._renderer.getRenderTarget(),bx=this._renderer.getActiveCubeFace(),xx=this._renderer.getActiveMipmapLevel();const s=t||this._allocateTarget();return this._init(s),this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return vA(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=vA(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=mk(t)),this._blurMaterial=gk(t,e.width,e.height),this._ggxMaterial=yk(t,e.width,e.height)}}async _compileMaterial(e){const t=new na(new pr,e);await this._renderer.compile(t,Sh)}_sceneToCubeUV(e,t,s,n,a){const l=hk;l.near=t,l.far=s;const u=[1,1,1,1,-1,1],h=[1,-1,1,-1,1,-1],d=this._renderer,f=d.autoClear;d.getClearColor(_A),d.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new na(new Mg,new Qa({name:"PMREM.Background",side:Rs,depthWrite:!1,depthTest:!1})));const m=this._backgroundBox,b=m.material;let x=!1;const v=e.background;v?v.isColor&&(b.color.copy(v),e.background=null,x=!0):(b.color.copy(_A),x=!0),d.setRenderTarget(n),d.clear(),x&&d.render(m,l);for(let T=0;T<6;T++){const w=T%3;w===0?(l.up.set(0,u[T],0),l.position.set(a.x,a.y,a.z),l.lookAt(a.x+h[T],a.y,a.z)):w===1?(l.up.set(0,0,u[T]),l.position.set(a.x,a.y,a.z),l.lookAt(a.x,a.y+h[T],a.z)):(l.up.set(0,u[T],0),l.position.set(a.x,a.y,a.z),l.lookAt(a.x,a.y,a.z+h[T]));const N=this._cubeSize;Su(n,w*N,T>2?N:0,N,N),d.render(e,l)}d.autoClear=f,e.background=v}_textureToCubeUV(e,t){const s=this._renderer,n=e.mapping===Ju||e.mapping===xm;n?this._cubemapMaterial===null&&(this._cubemapMaterial=TA(e)):this._equirectMaterial===null&&(this._equirectMaterial=SA(e));const a=n?this._cubemapMaterial:this._equirectMaterial;a.fragmentNode.value=e;const l=this._lodMeshes[0];l.material=a;const u=this._cubeSize;Su(t,0,0,3*u,2*u),s.setRenderTarget(t),s.render(l,Sh)}_applyPMREM(e){const t=this._renderer,s=t.autoClear;t.autoClear=!1;const n=this._lodMeshes.length;for(let a=1;a<n;a++)this._applyGGXFilter(e,a-1,a);t.autoClear=s}_applyGGXFilter(e,t,s){const n=this._renderer,a=this._pingPongRenderTarget,l=this._ggxMaterial,u=this._lodMeshes[s];u.material=l;const h=ng.get(l),d=s/(this._lodMeshes.length-1),f=t/(this._lodMeshes.length-1),m=Math.sqrt(d*d-f*f),b=0+d*1.25,x=m*b,{_lodMax:v}=this,T=this._sizeLods[s],w=3*T*(s>v-ro?s-v+ro:0),N=4*(this._cubeSize-T);e.texture.frame=(e.texture.frame||0)+1,h.envMap.value=e.texture,h.roughness.value=x,h.mipInt.value=v-t,Su(a,w,N,3*T,2*T),n.setRenderTarget(a),n.render(u,Sh),a.texture.frame=(a.texture.frame||0)+1,h.envMap.value=a.texture,h.roughness.value=0,h.mipInt.value=v-s,Su(e,w,N,3*T,2*T),n.setRenderTarget(e),n.render(u,Sh)}_blur(e,t,s,n,a){const l=this._pingPongRenderTarget;this._halfBlur(e,l,t,s,n,"latitudinal",a),this._halfBlur(l,e,s,s,n,"longitudinal",a)}_halfBlur(e,t,s,n,a,l,u){const h=this._renderer,d=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&le("blur direction must be either latitudinal or longitudinal!");const f=3,m=this._lodMeshes[n];m.material=d;const b=ng.get(d),x=this._sizeLods[s]-1,v=isFinite(a)?Math.PI/(2*x):2*Math.PI/(2*nl-1),T=a/v,w=isFinite(a)?1+Math.floor(f*T):nl;w>nl&&ue(`sigmaRadians, ${a}, is too large and will clip, as it requested ${w} samples when the maximum is set to ${nl}`);const N=[];let C=0;for(let D=0;D<nl;++D){const I=D/T,$=Math.exp(-I*I/2);N.push($),D===0?C+=$:D<w&&(C+=2*$)}for(let D=0;D<N.length;D++)N[D]=N[D]/C;e.texture.frame=(e.texture.frame||0)+1,b.envMap.value=e.texture,b.samples.value=w,b.weights.array=N,b.latitudinal.value=l==="latitudinal"?1:0,u&&(b.poleAxis.value=u);const{_lodMax:R}=this;b.dTheta.value=v,b.mipInt.value=R-s;const E=this._sizeLods[n],k=3*E*(n>R-ro?n-R+ro:0),q=4*(this._cubeSize-E);Su(t,k,q,3*E,2*E),h.setRenderTarget(t),h.render(m,Sh)}}function mk(i){const e=[],t=[],s=[];let n=i;const a=i-ro+1+xA.length;for(let l=0;l<a;l++){const u=Math.pow(2,n);e.push(u);let h=1/u;l>i-ro?h=xA[l-i+ro-1]:l===0&&(h=0),t.push(h);const d=1/(u-2),f=-d,m=1+d,b=[f,f,m,f,m,m,f,f,m,m,f,m],x=6,v=6,T=3,w=2,N=1,C=new Float32Array(T*v*x),R=new Float32Array(w*v*x),E=new Float32Array(N*v*x);for(let q=0;q<x;q++){const D=q%3*2/3-1,I=q>2?0:-1,$=[D,I,0,D+2/3,I,0,D+2/3,I+1,0,D,I,0,D+2/3,I+1,0,D,I+1,0],ae=pk[q];C.set($,T*v*ae),R.set(b,w*v*ae);const pe=[ae,ae,ae,ae,ae,ae];E.set(pe,N*v*ae)}const k=new pr;k.setAttribute("position",new Vn(C,T)),k.setAttribute("uv",new Vn(R,w)),k.setAttribute("faceIndex",new Vn(E,N)),s.push(new na(k,null)),n>ro&&n--}return{lodMeshes:s,sizeLods:e,sigmas:t}}function vA(i,e){const t={magFilter:Gs,minFilter:Gs,generateMipmaps:!1,type:Cs,format:Pn,colorSpace:Hm},s=new ua(i,e,t);return s.texture.mapping=Qx,s.texture.name="PMREM.cubeUv",s.texture.isPMREMTexture=!0,s.scissorTest=!0,s}function Su(i,e,t,s,n){i.viewport.set(e,t,s,n),i.scissor.set(e,t,s,n)}function Yg(i){const e=new Ht;return e.depthTest=!1,e.depthWrite=!1,e.blending=Xr,e.name=`PMREM_${i}`,e}function gk(i,e,t){const s=Os(new Array(nl).fill(0)),n=_e(new z(0,1,0)),a=_e(0),l=A(nl),u=_e(0),h=_e(1),d=st(),f=_e(0),m=A(1/e),b=A(1/t),x=A(i),v={n:l,latitudinal:u,weights:s,poleAxis:n,outputDirection:Xg,dTheta:a,samples:h,envMap:d,mipInt:f,CUBEUV_TEXEL_WIDTH:m,CUBEUV_TEXEL_HEIGHT:b,CUBEUV_MAX_MIP:x},T=Yg("blur");return T.fragmentNode=IB({...v,latitudinal:u.equal(1)}),ng.set(T,v),T}function yk(i,e,t){const s=st(),n=_e(0),a=_e(0),l=A(1/e),u=A(1/t),h=A(i),d={envMap:s,roughness:n,mipInt:a,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h},f=Yg("ggx");return f.fragmentNode=kB({...d,N_immutable:Xg,GGX_SAMPLES:se(ck)}),ng.set(f,d),f}function TA(i){const e=Yg("cubemap");return e.fragmentNode=Ys(i,Xg),e}function SA(i){const e=Yg("equirect");return e.fragmentNode=st(i,dT(Xg),0),e}const wA=new WeakMap;function bk(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function xk(i,e,t){const s=_k(e);let n=s.get(i);if((n!==void 0?n.pmremVersion:-1)!==i.pmremVersion){const l=i.image;if(i.isCubeTexture)if(Tk(l))n=t.fromCubemap(i,n);else return null;else if(Sk(l))n=t.fromEquirectangular(i,n);else return null;n.pmremVersion=i.pmremVersion,s.set(i,n)}return n.texture}function _k(i){let e=wA.get(i);return e===void 0&&(e=new WeakMap,wA.set(i,e)),e}class vk extends jt{static get type(){return"PMREMNode"}constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null;const n=new Is;n.isRenderTargetTexture=!0,this._texture=st(n),this._width=_e(0),this._height=_e(0),this._maxMip=_e(0),this.updateBeforeType=Re.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=bk(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const s=t?t.pmremVersion:-1,n=this._value;s!==n.pmremVersion&&(n.isPMREMTexture===!0?t=n:t=xk(n,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new fk(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=tT.mul(L(t.x,t.y.negate(),t.z));let s=this.levelNode;return s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),zB(this._texture,t,s,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function Tk(i){if(i==null)return!1;let e=0;const t=6;for(let s=0;s<t;s++)i[s]!==void 0&&e++;return e===t}function Sk(i){return i==null?!1:i.height>0}const yT=Pe(vk).setParameterLength(1,3),MA=new WeakMap;class wk extends pc{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const m=s.isTextureNode?s.value:t[s.property],b=this._getPMREMNodeCache(e.renderer);let x=b.get(m);x===void 0&&(x=yT(m),b.set(m,x)),s=x}const a=t.useAnisotropy===!0||t.anisotropy>0?R2:et,l=s.context(NA(Yi,a)).mul(om),u=s.context(Mk(So)).mul(Math.PI).mul(om),h=Xu(l),d=Xu(u);e.context.radiance.addAssign(h),e.context.iblIrradiance.addAssign(d);const f=e.context.lightingModel.clearcoatRadiance;if(f){const m=s.context(NA($u,so)).mul(om),b=Xu(m);f.addAssign(b)}}_getPMREMNodeCache(e){let t=MA.get(e);return t===void 0&&(t=new WeakMap,MA.set(e,t)),t}}const NA=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Tt.negate().reflect(e),t=Ov(i).mix(t,e).normalize(),t=t.transformDirection(xi)),t),getTextureLevel:()=>i}},Mk=i=>({getUV:()=>i,getTextureLevel:()=>A(1)}),Nk=new bE;class GB extends Ht{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Nk),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new wk(t):null}setupLightingModel(){return new OB}setupSpecular(){const e=qe(L(.04),pt.rgb,jr);yo.assign(L(.04)),al.assign(e),ol.assign(1)}setupVariants(){const e=this.metalnessNode?A(this.metalnessNode):z2;jr.assign(e);let t=this.roughnessNode?A(this.roughnessNode):V2;t=fT({roughness:t}),Yi.assign(t),this.setupSpecular(),sl.assign(pt.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Ak=new dO;class Ck extends GB{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Ak),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?A(this.iorNode):J2;Kh.assign(e),yo.assign(mn(Pv(Kh.sub(1).div(Kh.add(1))).mul(O2),L(1)).mul(v_)),al.assign(qe(yo,pt.rgb,jr)),ol.assign(qe(v_,1,jr))}setupLightingModel(){return new OB(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?A(this.clearcoatNode):k2,s=this.clearcoatRoughnessNode?A(this.clearcoatRoughnessNode):G2;Xm.assign(t),$u.assign(fT({roughness:s}))}if(this.useSheen){const t=this.sheenNode?L(this.sheenNode):j2,s=this.sheenRoughnessNode?A(this.sheenRoughnessNode):$2;Ln.assign(t),Ja.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?A(this.iridescenceNode):X2,s=this.iridescenceIORNode?A(this.iridescenceIORNode):Y2,n=this.iridescenceThicknessNode?A(this.iridescenceThicknessNode):K2;Lg.assign(t),Ym.assign(s),Km.assign(n)}if(this.useAnisotropy){const t=(this.anisotropyNode?ie(this.anisotropyNode):W2).toVar();Za.assign(t.length()),Me(Za.equal(0),()=>{t.assign(ie(1,0))}).Else(()=>{t.divAssign(ie(Za)),Za.assign(Za.saturate())}),Zm.assign(Za.pow2().mix(Yi.pow2(),1)),Yh.assign(ll[0].mul(t.x).add(ll[1].mul(t.y))),cl.assign(ll[1].mul(t.x).sub(ll[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?A(this.transmissionNode):Z2,s=this.thicknessNode?A(this.thicknessNode):Q2,n=this.attenuationDistanceNode?A(this.attenuationDistanceNode):eB,a=this.attenuationColorNode?L(this.attenuationColorNode):tB;if(Jm.assign(t),xv.assign(s),_v.assign(n),vv.assign(a),this.useDispersion){const l=this.dispersionNode?A(this.dispersionNode):oB;Tv.assign(l)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?L(this.clearcoatNormalNode):q2}setup(e){e.context.setupClearcoatNormal=()=>hl(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.iorNode=e.iorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const Ek=P(({normal:i,lightDirection:e,builder:t})=>{const s=i.dot(e),n=ie(s.mul(.5).add(.5),0);if(t.material.gradientMap){const a=Hr("gradientMap","texture").context({getUV:()=>n});return L(a.r)}else{const a=n.fwidth().mul(.5);return qe(L(.7),L(1),Ui(A(.7).sub(a.x),A(.7).add(a.x),n.x))}});class Rk extends $g{direct({lightDirection:e,lightColor:t,reflectedLight:s},n){const a=Ek({normal:Ig,lightDirection:e,builder:n}).mul(t);s.directDiffuse.addAssign(a.mul(fl({diffuseColor:pt.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:s,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(s.mul(fl({diffuseColor:pt}))),n.indirectDiffuse.mulAssign(t)}}const Bk=new fO;class Dk extends Ht{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Bk),this.setValues(e)}setupLightingModel(){return new Rk}}const qB=P(()=>{const i=L(Tt.z,0,Tt.x.negate()).normalize(),e=Tt.cross(i);return ie(i.dot(et),e.dot(et)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),Lk=new yO;class Uk extends Ht{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Lk),this.setValues(e)}setupVariants(e){const t=qB;let s;e.material.matcap?s=Hr("matcap","texture").context({getUV:()=>t}):s=L(qe(.2,.8,t.y)),pt.rgb.mulAssign(s.rgb)}}class Fk extends jt{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:s}=this;if(this.getNodeType(e)==="vec2"){const a=t.cos(),l=t.sin();return Dg(a,l,l.negate(),a).mul(s)}else{const a=t,l=co(Se(1,0,0,0),Se(0,Ai(a.x),Ws(a.x).negate(),0),Se(0,Ws(a.x),Ai(a.x),0),Se(0,0,0,1)),u=co(Se(Ai(a.y),0,Ws(a.y),0),Se(0,1,0,0),Se(Ws(a.y).negate(),0,Ai(a.y),0),Se(0,0,0,1)),h=co(Se(Ai(a.z),Ws(a.z).negate(),0,0),Se(Ws(a.z),Ai(a.z),0,0),Se(0,0,1,0),Se(0,0,0,1));return l.mul(u).mul(h).mul(Se(s,1)).xyz}}}const wd=Pe(Fk).setParameterLength(2),Pk=new iO;class HB extends Ht{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Pk),this.setValues(e)}setupPositionView(e){const{object:t,camera:s}=e,{positionNode:n,rotationNode:a,scaleNode:l,sizeAttenuation:u}=this,h=To.mul(L(n||0));let d=ie(li[0].xyz.length(),li[1].xyz.length());l!==null&&(d=d.mul(ie(l))),s.isPerspectiveCamera&&u===!1&&(d=d.mul(h.z.negate()));let f=Sd.xy;if(t.center&&t.center.isVector2===!0){const x=LV("center","vec2",t);f=f.sub(x.sub(.5))}f=f.mul(d);const m=A(a||H2),b=wd(f,m);return Se(h.xy.add(b),h.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Ok=new uO,Vk=new Ue;class zk extends HB{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Ok),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return To.mul(L(e||Ot)).xyz}setupVertexSprite(e){const{material:t,camera:s}=e,{rotationNode:n,scaleNode:a,sizeNode:l,sizeAttenuation:u}=this;let h=super.setupVertex(e);if(t.isNodeMaterial!==!0)return h;let d=l!==null?ie(l):aB;d=d.mul(n2),s.isPerspectiveCamera&&u===!0&&(d=d.mul(Ik.div(Kt.z.negate()))),a&&a.isNode&&(d=d.mul(ie(a)));let f=Sd.xy;if(n&&n.isNode){const m=A(n);f=wd(f,m)}return f=f.mul(d),f=f.div(Zv.div(2)),f=f.mul(h.w),h=h.add(Se(f,0,0)),h}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const Ik=_e(1).onFrameUpdate(function({renderer:i}){const e=i.getSize(Vk);this.value=.5*e.y});class kk extends $g{constructor(){super(),this.shadowNode=A(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){pt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(pt.rgb)}}const Gk=new hO;class qk extends Ht{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Gk),this.setValues(e)}setupLightingModel(){return new kk}}Jr("vec3");Jr("vec3");Jr("vec3");class Hk{constructor(e,t,s){this.renderer=e,this.nodes=t,this.info=s,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,s)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,s),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class bo{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let s=this.weakMaps[t];return s===void 0&&(s=new WeakMap,this.weakMaps[t]=s),s}get(e){let t=this._getWeakMap(e);for(let s=0;s<e.length-1;s++)if(t=t.get(e[s]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let s=this._getWeakMap(e);for(let n=0;n<e.length-1;n++){const a=e[n];s.has(a)===!1&&s.set(a,new WeakMap),s=s.get(a)}return s.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let s=0;s<e.length-1;s++)if(t=t.get(e[s]),t===void 0)return!1;return t.delete(e[e.length-1])}}let jk=0;function $k(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const s=Object.getOwnPropertyDescriptors(t);for(const n in s)if(s[n]!==void 0){const a=s[n];a&&typeof a.get=="function"&&e.push(n)}t=Object.getPrototypeOf(t)}return e}class Wk{constructor(e,t,s,n,a,l,u,h,d,f){this.id=jk++,this._nodes=e,this._geometries=t,this.renderer=s,this.object=n,this.material=a,this.scene=l,this.camera=u,this.lightsNode=h,this.context=d,this.geometry=n.geometry,this.version=a.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,s=[],n=new Set,a={};for(const l of e){let u;if(l.node&&l.node.attribute?u=l.node.attribute:(u=t.getAttribute(l.name),a[l.name]=u.id),u===void 0)continue;s.push(u);const h=u.isInterleavedBufferAttribute?u.data:u;n.add(h)}return this.attributes=s,this.attributesId=a,this.vertexBuffers=Array.from(n.values()),s}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:s,group:n,drawRange:a}=this,l=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),h=u!==null;let d=1;if(s.isInstancedBufferGeometry===!0?d=s.instanceCount:e.count!==void 0&&(d=Math.max(0,e.count)),d===0)return null;if(l.instanceCount=d,e.isBatchedMesh===!0)return l;let f=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(f=2);let m=a.start*f,b=(a.start+a.count)*f;n!==null&&(m=Math.max(m,n.start*f),b=Math.min(b,(n.start+n.count)*f));const x=s.attributes.position;let v=1/0;h?v=u.count:x!=null&&(v=x.count),m=Math.max(m,0),b=Math.min(b,v);const T=b-m;return T<0||T===1/0?null:(l.vertexCount=T,l.firstVertex=m,l)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const s of Object.keys(e.attributes).sort()){const n=e.attributes[s];t+=s+",",n.data&&(t+=n.data.stride+","),n.offset&&(t+=n.offset+","),n.itemSize&&(t+=n.itemSize+","),n.normalized&&(t+="n,")}for(const s of Object.keys(e.morphAttributes).sort()){const n=e.morphAttributes[s];t+="morph-"+s+",";for(let a=0,l=n.length;a<l;a++){const u=n[a];t+=u.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:s}=this;let n=t.customProgramCacheKey();for(const a of $k(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(a))continue;const l=t[a];let u;if(l!==null){const h=typeof l;h==="number"?u=l!==0?"1":"0":h==="object"?(u="{",l.isTexture&&(u+=l.mapping,s.backend.isWebGPUBackend===!0&&(u+=l.magFilter,u+=l.minFilter,u+=l.wrapS,u+=l.wrapT,u+=l.wrapR)),u+="}"):u=String(l)}else u=String(l);n+=u+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(n+=e.uuid+","),n+=this.context.id+",",n+=e.receiveShadow+",",hc(n)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const s=this.geometry.getAttribute(t);if(s===void 0||e[t]!==s.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=Wh(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=Wh(e,1)),e=Wh(e,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const $i=[];class Xk{constructor(e,t,s,n,a,l){this.renderer=e,this.nodes=t,this.geometries=s,this.pipelines=n,this.bindings=a,this.info=l,this.chainMaps={}}get(e,t,s,n,a,l,u,h){const d=this.getChainMap(h);$i[0]=e,$i[1]=t,$i[2]=l,$i[3]=a;let f=d.get($i);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,s,n,a,l,u,h),d.set($i,f)):(f.camera=n,f.updateClipping(u),f.needsGeometryUpdate&&f.setGeometry(e.geometry),(f.version!==t.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(e,t,s,n,a,l,u,h)):f.version=t.version)),$i[0]=null,$i[1]=null,$i[2]=null,$i[3]=null,f}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new bo)}dispose(){this.chainMaps={}}createRenderObject(e,t,s,n,a,l,u,h,d,f,m){const b=this.getChainMap(m),x=new Wk(e,t,s,n,a,l,u,h,d,f);return x.onDispose=()=>{this.pipelines.delete(x),this.bindings.deleteForRender(x),this.nodes.delete(x),b.delete(x.getChainArray())},x}}class wo{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const ui={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},no=16,Yk=211,Kk=212;class Zk extends wo{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const s=this.get(e);if(s.version===void 0)t===ui.VERTEX?this.backend.createAttribute(e):t===ui.INDEX?this.backend.createIndexAttribute(e):t===ui.STORAGE?this.backend.createStorageAttribute(e):t===ui.INDIRECT&&this.backend.createIndirectStorageAttribute(e),s.version=this._getBufferAttribute(e).version;else{const n=this._getBufferAttribute(e);(s.version<n.version||n.usage===rd)&&(this.backend.updateAttribute(e),s.version=n.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function jB(i){return i.index!==null?i.index.version:i.attributes.position.version}function $B(i){return i.index!==null?i.index.id:i.attributes.position.id}function AA(i){const e=[],t=i.index,s=i.attributes.position;if(t!==null){const a=t.array;for(let l=0,u=a.length;l<u;l+=3){const h=a[l+0],d=a[l+1],f=a[l+2];e.push(h,d,d,f,f,h)}}else{const a=s.array;for(let l=0,u=a.length/3-1;l<u;l+=3){const h=l+0,d=l+1,f=l+2;e.push(h,d,d,f,f,h)}}const n=new(s.count>=65535?dE:hE)(e,1);return n.version=jB(i),n.__id=$B(i),n}class Qk extends wo{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,s=this.get(t);s.initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const a=t.index,l=e.getAttributes();a!==null&&this.attributes.delete(a);for(const h of l)this.attributes.delete(h);const u=this.wireframes.get(t);u!==void 0&&this.attributes.delete(u),t.removeEventListener("dispose",n),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",n),this._geometryDisposeListeners.set(t,n)}updateAttributes(e){const t=e.getAttributes();for(const a of t)a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute?this.updateAttribute(a,ui.STORAGE):this.updateAttribute(a,ui.VERTEX);const s=this.getIndex(e);s!==null&&this.updateAttribute(s,ui.INDEX);const n=e.geometry.indirect;n!==null&&this.updateAttribute(n,ui.INDIRECT)}updateAttribute(e,t){const s=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,s)):this.attributeCall.get(e.data)!==s&&(this.attributes.update(e,t),this.attributeCall.set(e.data,s),this.attributeCall.set(e,s)):this.attributeCall.get(e)!==s&&(this.attributes.update(e,t),this.attributeCall.set(e,s))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:s}=e;let n=t.index;if(s.wireframe===!0){const a=this.wireframes;let l=a.get(t);l===void 0?(l=AA(t),a.set(t,l)):(l.version!==jB(t)||l.__id!==$B(t))&&(this.attributes.delete(l),l=AA(t),a.set(t,l)),n=l}return n}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class Jk{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,s){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=s*(t/3):e.isPoints?this.render.points+=s*t:e.isLineSegments?this.render.lines+=s*(t/2):e.isLine?this.render.lines+=s*(t-1):le("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class WB{constructor(e){this.cacheKey=e,this.usedTimes=0}}class e4 extends WB{constructor(e,t,s){super(e),this.vertexProgram=t,this.fragmentProgram=s}}class t4 extends WB{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let s4=0;class vx{constructor(e,t,s,n=null,a=null){this.id=s4++,this.code=e,this.stage=t,this.name=s,this.transforms=n,this.attributes=a,this.usedTimes=0}}class n4 extends wo{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:s}=this,n=this.get(e);if(this._needsComputeUpdate(e)){const a=n.pipeline;a&&(a.usedTimes--,a.computeProgram.usedTimes--);const l=this.nodes.getForCompute(e);let u=this.programs.compute.get(l.computeShader);u===void 0&&(a&&a.computeProgram.usedTimes===0&&this._releaseProgram(a.computeProgram),u=new vx(l.computeShader,"compute",e.name,l.transforms,l.nodeAttributes),this.programs.compute.set(l.computeShader,u),s.createProgram(u));const h=this._getComputeCacheKey(e,u);let d=this.caches.get(h);d===void 0&&(a&&a.usedTimes===0&&this._releasePipeline(a),d=this._getComputePipeline(e,u,h,t)),d.usedTimes++,u.usedTimes++,n.version=e.version,n.pipeline=d}return n.pipeline}getForRender(e,t=null){const{backend:s}=this,n=this.get(e);if(this._needsRenderUpdate(e)){const a=n.pipeline;a&&(a.usedTimes--,a.vertexProgram.usedTimes--,a.fragmentProgram.usedTimes--);const l=e.getNodeBuilderState(),u=e.material?e.material.name:"";let h=this.programs.vertex.get(l.vertexShader);h===void 0&&(a&&a.vertexProgram.usedTimes===0&&this._releaseProgram(a.vertexProgram),h=new vx(l.vertexShader,"vertex",u),this.programs.vertex.set(l.vertexShader,h),s.createProgram(h));let d=this.programs.fragment.get(l.fragmentShader);d===void 0&&(a&&a.fragmentProgram.usedTimes===0&&this._releaseProgram(a.fragmentProgram),d=new vx(l.fragmentShader,"fragment",u),this.programs.fragment.set(l.fragmentShader,d),s.createProgram(d));const f=this._getRenderCacheKey(e,h,d);let m=this.caches.get(f);m===void 0?(a&&a.usedTimes===0&&this._releasePipeline(a),m=this._getRenderPipeline(e,h,d,f,t)):e.pipeline=m,m.usedTimes++,h.usedTimes++,d.usedTimes++,n.pipeline=m}return n.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,s,n){s=s||this._getComputeCacheKey(e,t);let a=this.caches.get(s);return a===void 0&&(a=new t4(s,t),this.caches.set(s,a),this.backend.createComputePipeline(a,n)),a}_getRenderPipeline(e,t,s,n,a){n=n||this._getRenderCacheKey(e,t,s);let l=this.caches.get(n);return l===void 0&&(l=new e4(n,t,s),this.caches.set(n,l),e.pipeline=l,this.backend.createRenderPipeline(e,a)),l}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,s){return t.id+","+s.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,s=e.stage;this.programs[s].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class i4 extends wo{constructor(e,t,s,n,a,l){super(),this.backend=e,this.textures=s,this.pipelines=a,this.attributes=n,this.nodes=t,this.info=l,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const s of t){const n=this.get(s);n.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,t,0),n.bindGroup=s)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const s of t){const n=this.get(s);n.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,t,0),n.bindGroup=s)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const s of t)this.backend.deleteBindGroupData(s),this.delete(s)}deleteForRender(e){const t=e.getBindings();for(const s of t)this.backend.deleteBindGroupData(s),this.delete(s)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const s=t.attribute,n=s.isIndirectStorageBufferAttribute?ui.INDIRECT:ui.STORAGE;this.attributes.update(s,n)}}_update(e,t){const{backend:s}=this;let n=!1,a=!0,l=0,u=0;for(const h of e.bindings)if(this.nodes.updateGroup(h)!==!1){if(h.isStorageBuffer){const f=h.attribute,m=f.isIndirectStorageBufferAttribute?ui.INDIRECT:ui.STORAGE,b=s.get(h);this.attributes.update(f,m),b.attribute!==f&&(b.attribute=f,n=!0)}if(h.isUniformBuffer)h.update()&&s.updateBinding(h);else if(h.isSampledTexture){const f=h.update(),m=h.texture,b=this.textures.get(m);if(f&&(this.textures.updateTexture(m),h.generation!==b.generation&&(h.generation=b.generation,n=!0),b.bindGroups.add(e)),s.get(m).externalTexture!==void 0||b.isDefaultTexture?a=!1:(l=l*10+m.id,u+=m.version),m.isStorageTexture===!0&&m.mipmapsAutoUpdate===!0){const v=this.get(m);h.store===!0?v.needsMipmap=!0:this.textures.needsMipmaps(m)&&v.needsMipmap===!0&&(this.backend.generateMipmaps(m),v.needsMipmap=!1)}}else if(h.isSampler&&h.update()){const m=this.textures.updateSampler(h.texture);h.samplerKey!==m&&(h.samplerKey=m,n=!0)}h.isBuffer&&h.updateRanges.length>0&&h.clearUpdateRanges()}n===!0&&this.backend.updateBindings(e,t,a?l:0,u)}}function r4(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function CA(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function EA(i){return(i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode)&&i.side===Wr&&i.forceSinglePass===!1}class a4{constructor(e,t,s){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,s),this.lightsArray=[],this.scene=t,this.camera=s,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,s,n,a,l,u){let h=this.renderItems[this.renderItemsIndex];return h===void 0?(h={id:e.id,object:e,geometry:t,material:s,groupOrder:n,renderOrder:e.renderOrder,z:a,group:l,clippingContext:u},this.renderItems[this.renderItemsIndex]=h):(h.id=e.id,h.object=e,h.geometry=t,h.material=s,h.groupOrder=n,h.renderOrder=e.renderOrder,h.z=a,h.group=l,h.clippingContext=u),this.renderItemsIndex++,h}push(e,t,s,n,a,l,u){const h=this.getNextRenderItem(e,t,s,n,a,l,u);e.occlusionTest===!0&&this.occlusionQueryCount++,s.transparent===!0||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode?(EA(s)&&this.transparentDoublePass.push(h),this.transparent.push(h)):this.opaque.push(h)}unshift(e,t,s,n,a,l,u){const h=this.getNextRenderItem(e,t,s,n,a,l,u);s.transparent===!0||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode?(EA(s)&&this.transparentDoublePass.unshift(h),this.transparent.unshift(h)):this.opaque.unshift(h)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||r4),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||CA),this.transparent.length>1&&this.transparent.sort(t||CA)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const s=this.renderItems[e];if(s.id===null)break;s.id=null,s.object=null,s.geometry=null,s.material=null,s.groupOrder=null,s.renderOrder=null,s.z=null,s.group=null,s.clippingContext=null}}}const wu=[];class o4{constructor(e){this.lighting=e,this.lists=new bo}get(e,t){const s=this.lists;wu[0]=e,wu[1]=t;let n=s.get(wu);return n===void 0&&(n=new a4(this.lighting,e,t),s.set(wu,n)),wu[0]=null,wu[1]=null,n}dispose(){this.lists=new bo}}let l4=0;class u4{constructor(){this.id=l4++,this.mrt=null,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new rt,this.scissor=!1,this.scissorValue=new rt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.camera=null,this.isRenderContext=!0}getCacheKey(){return XB(this)}}function XB(i){const{textures:e,activeCubeFace:t,activeMipmapLevel:s}=i,n=[t,s];for(const a of e)n.push(a.id);return xd(n)}class c4{constructor(e){this.renderer=e,this._renderContexts={}}get(e=null,t=null,s=0){let n;if(e===null)n="default";else{const h=e.texture.format,d=e.texture.type;n=`${e.textures.length}:${h}:${d}:${e.samples}:${e.depthBuffer}:${e.stencilBuffer}`}const a=t!==null?t.id:"default",l=n+"-"+a+"-"+s;let u=this._renderContexts[l];return u===void 0&&(u=new u4,u.mrt=t,this._renderContexts[l]=u),e!==null&&(u.sampleCount=e.samples===0?1:e.samples),u.clearDepthValue=this.renderer.getClearDepth(),u.clearStencilValue=this.renderer.getClearStencil(),u}dispose(){this._renderContexts={}}}const h4=new z;class d4 extends wo{constructor(e,t,s){super(),this.renderer=e,this.backend=t,this.info=s}updateRenderTarget(e,t=0){const s=this.get(e),n=e.samples===0?1:e.samples,a=s.depthTextureMips||(s.depthTextureMips={}),l=e.textures,u=this.getSize(l[0]),h=u.width>>t,d=u.height>>t;let f=e.depthTexture||a[t];const m=e.depthBuffer===!0||e.stencilBuffer===!0;let b=!1;f===void 0&&m&&(f=new hi,f.format=e.stencilBuffer?Yr:Ri,f.type=e.stencilBuffer?lo:Gt,f.image.width=h,f.image.height=d,f.image.depth=u.depth,f.renderTarget=e,f.isArrayTexture=e.multiview===!0&&u.depth>1,a[t]=f),(s.width!==u.width||u.height!==s.height)&&(b=!0,f&&(f.needsUpdate=!0,f.image.width=h,f.image.height=d,f.image.depth=f.isArrayTexture?f.image.depth:1)),s.width=u.width,s.height=u.height,s.textures=l,s.depthTexture=f||null,s.depth=e.depthBuffer,s.stencil=e.stencilBuffer,s.renderTarget=e,s.sampleCount!==n&&(b=!0,f&&(f.needsUpdate=!0),s.sampleCount=n);const x={sampleCount:n};if(e.isXRRenderTarget!==!0){for(let v=0;v<l.length;v++){const T=l[v];b&&(T.needsUpdate=!0),this.updateTexture(T,x)}f&&this.updateTexture(f,x)}s.initialized!==!0&&(s.initialized=!0,s.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",s.onDispose))}updateTexture(e,t={}){const s=this.get(e);if(s.initialized===!0&&s.version===e.version)return;const n=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,a=this.backend;if(n&&s.initialized===!0&&a.destroyTexture(e),e.isFramebufferTexture){const d=this.renderer.getRenderTarget();d?e.type=d.texture.type:e.type=Vs}const{width:l,height:u,depth:h}=this.getSize(e);if(t.width=l,t.height=u,t.depth=h,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,l,u):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,n||e.isStorageTexture===!0||e.isExternalTexture===!0)a.createTexture(e,t),s.generation=e.version;else if(e.version>0){const d=e.image;if(d===void 0)ue("Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)ue("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const m=[];for(const b of e.images)m.push(b);t.images=m}else t.image=d;(s.isDefaultTexture===void 0||s.isDefaultTexture===!0)&&(a.createTexture(e,t),s.isDefaultTexture=!1,s.generation=e.version),e.source.dataReady===!0&&a.updateTexture(e,t);const f=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!f&&a.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else a.createDefaultTexture(e),s.isDefaultTexture=!0,s.generation=e.version;s.initialized!==!0&&(s.initialized=!0,s.generation=e.version,s.bindGroups=new Set,this.info.memory.textures++,e.isVideoTexture&&nt.enabled===!0&&nt.getTransfer(e.colorSpace)!==Fe&&ue("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),s.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",s.onDispose)),s.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=h4){let s=e.images?e.images[0]:e.image;return s?(s.image!==void 0&&(s=s.image),typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement?(t.width=s.videoWidth||1,t.height=s.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&s instanceof VideoFrame?(t.width=s.displayWidth||1,t.height=s.displayHeight||1,t.depth=1):(t.width=s.width||1,t.height=s.height||1,t.depth=e.isCubeTexture?6:s.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,s){let n;return e.mipmaps.length>0?n=e.mipmaps.length:e.isCompressedTexture===!0?n=1:n=Math.floor(Math.log2(Math.max(t,s)))+1,n}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),s=t.textures,n=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let a=0;a<s.length;a++)this._destroyTexture(s[a]);n&&this._destroyTexture(n),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const s=t.isDefaultTexture;if(this.backend.destroyTexture(e,s),t.bindGroups)for(const n of t.bindGroups){const a=this.backend.get(n);a.groups=void 0,a.versions=void 0}this.delete(e),this.info.memory.textures--}}}class bT extends it{constructor(e,t,s,n=1){super(e,t,s),this.a=n}set(e,t,s,n=1){return this.a=n,super.set(e,t,s)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class YB extends at{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const s=this.getNodeType(e),n=e.getStructTypeNode(s);let a;return n!==null?a=n.getMemberType(e,t):(le(`TSL: Member "${t}" not found in struct "${s}".`,new Zt),a="float"),a}getHash(){return this.uuid}generate(){return this.name}}const p4=(i,e)=>new YB(i,e);class f4 extends be{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput(e)?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput(e)?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput(e)?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(le("TSL: Invalid node added to stack.",new Zt),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const s=new zu(t);return this._currentCond=zs(e,s),this.addToStack(this._currentCond)}ElseIf(e,t){const s=new zu(t),n=zs(e,s);return this._currentCond.elseNode=n,this._currentCond=n,this}Else(e){return this._currentCond.elseNode=new zu(e),this}Switch(e){return this._expressionNode=ye(e),this}Case(...e){const t=[];if(e.length>=2)for(let u=0;u<e.length-1;u++)t.push(this._expressionNode.equal(ye(e[u])));else le("TSL: Invalid parameter length. Case() requires at least two parameters.",new Zt);const s=e[e.length-1],n=new zu(s);let a=t[0];for(let u=1;u<t.length;u++)a=a.or(t[u]);const l=zs(a,n);return this._currentCond===null?(this._currentCond=l,this.addToStack(this._currentCond)):(this._currentCond.elseNode=l,this._currentCond=l,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let s=0;for(const n of this.getChildren())n.isVarNode&&n.isIntent(e)&&n.isAssign(e)!==!0||(t["node"+s++]=n);return t.outputNode||null}hasOutput(e){return this.outputNode&&this.outputNode.isNode&&this.outputNode.getNodeType(e)!=="void"}build(e,...t){const s=pv(),n=e.buildStage;od(this),e.setActiveStack(this);const a=d=>{if(this._currentNode=d,!(d.isVarNode&&d.isIntent(e)&&d.isAssign(e)!==!0)){if(n==="setup")d.build(e);else if(n==="analyze")d.build(e,this);else if(n==="generate"){const f=e.getDataFromNode(d,"any").stages,m=f&&f[e.shaderStage];if(d.isVarNode&&m&&m.length===1&&m[0]&&m[0].isStackNode)return;d.build(e,"void")}}},l=[...this.nodes];for(const d of l)a(d);this._currentNode=null;const u=this.nodes.filter(d=>l.indexOf(d)===-1);for(const d of u)a(d);let h;return this.hasOutput(e)?h=this.outputNode.build(e,...t):h=super.build(e,...t),od(s),e.removeActiveStack(this),h}}const um=Pe(f4).setParameterLength(0,1);function m4(i){return Object.entries(i).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class g4 extends be{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=m4(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,s=0;for(const n of this.membersLayout){const a=n.type,l=IO(a),u=kO(a)/e;t=Math.max(t,u);const d=s%t%u;d!==0&&(s+=u-d),s+=l}return Math.ceil(s/t)*t}getMemberType(e,t){const s=this.membersLayout.find(n=>n.name===t);return s?s.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class y4 extends be{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}_getChildren(){const e=super._getChildren(),t=e.find(s=>s.childNode===this.structTypeNode);return e.splice(e.indexOf(t),1),e.push(t),e}generate(e){const t=e.getVarFromNode(this),s=t.type,n=e.getPropertyName(t);return e.addLineFlowCode(`${n} = ${e.generateStruct(s,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const b4=(i,e=null)=>{const t=new g4(i,e),s=(...n)=>{let a=null;if(n.length>0)if(n[0].isNode){a={};const l=Object.keys(i);for(let u=0;u<n.length;u++)a[l[u]]=n[u]}else a=n[0];return new y4(t,a)};return s.layout=t,s.isStruct=!0,s};class KB extends be{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(){return"OutputType"}generate(e){const t=e.getDataFromNode(this);if(t.membersLayout===void 0){const l=this.members,u=[];for(let h=0;h<l.length;h++){const d="m"+h,f=l[h].getNodeType(e);u.push({name:d,type:f,index:h})}t.membersLayout=u,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}const s=e.getOutputStructName(),n=this.members,a=s!==""?s+".":"";for(let l=0;l<n.length;l++){const u=n[l].build(e);e.addLineFlowCode(`${a}m${l} = ${u}`,this)}return s}}const x4=Pe(KB);class ZB{constructor(e=ri){this.blending=e,this.blendSrc=ed,this.blendDst=td,this.blendEquation=ai,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultiplyAlpha=!1}copy(e){return this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.premultiplyAlpha=e.premultiplyAlpha,this}clone(){return new this.constructor().copy(this)}}const _4=new ZB(Xr),v4=new ZB(k_);function QB(i,e){for(let t=0;t<i.length;t++)if(i[t].name===e)return t;return-1}class T4 extends KB{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.blendModes={output:v4},this.isMRTNode=!0}setBlendMode(e,t){return this.blendModes[e]=t,this}getBlendMode(e){return this.blendModes[e]||_4}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes},s={...this.blendModes,...e.blendModes},n=JB(t);return n.blendings=s,n}setup(e){const t=this.outputNodes,s=e.renderer.getRenderTarget(),n=[],a=s.textures;for(const l in t){const u=QB(a,l);n[u]=Se(t[l])}return this.members=n,super.setup(e)}}const JB=Pe(T4);class Md extends jt{static get type(){return"BitcastNode"}constructor(e,t,s=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=s,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),s=e.getTypeLength(t);return e.getTypeFromLength(s,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let s="";if(this.inputType!==null){const n=this.valueNode.getNodeType(e);s=e.getTypeLength(n)===1?this.inputType:e.changeComponentType(n,this.inputType)}else s=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,s)}( ${this.valueNode.build(e,s)} )`}}const eD=re(Md).setParameterLength(2),S4=i=>new Md(i,"int","float"),tD=i=>new Md(i,"uint","float"),w4=i=>new Md(i,"float","int"),M4=i=>new Md(i,"float","uint"),zf={};class zn extends H{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,s){s==="int"?t.assign(eD(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return se;case"int":return B;case"uvec2":return fv;case"uvec3":return vl;case"uvec4":return bv;case"ivec2":return ls;case"ivec3":return mv;case"ivec4":return yv}}_createTrailingZerosBaseLayout(e,t){const s=this._returnDataNode(t);return P(([a])=>{const l=se(0);this._resolveElementType(a,l,t);const u=A(l.bitAnd(Bv(l))),d=tD(u).shiftRight(23).sub(127);return s(d)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const s=this._returnDataNode(t);return P(([a])=>{Me(a.equal(se(0)),()=>se(32));const l=se(0),u=se(0);return this._resolveElementType(a,l,t),Me(l.shiftRight(16).equal(0),()=>{u.addAssign(16),l.shiftLeftAssign(16)}),Me(l.shiftRight(24).equal(0),()=>{u.addAssign(8),l.shiftLeftAssign(8)}),Me(l.shiftRight(28).equal(0),()=>{u.addAssign(4),l.shiftLeftAssign(4)}),Me(l.shiftRight(30).equal(0),()=>{u.addAssign(2),l.shiftLeftAssign(2)}),Me(l.shiftRight(31).equal(0),()=>{u.addAssign(1)}),s(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const s=this._returnDataNode(t);return P(([a])=>{const l=se(0);this._resolveElementType(a,l,t),l.assign(l.sub(l.shiftRight(se(1)).bitAnd(se(1431655765)))),l.assign(l.bitAnd(se(858993459)).add(l.shiftRight(se(2)).bitAnd(se(858993459))));const u=l.add(l.shiftRight(se(4))).bitAnd(se(252645135)).mul(se(16843009)).shiftRight(se(24));return s(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,s,n){const a=this._returnDataNode(t);return P(([u])=>{if(s===1)return a(n(u));{const h=a(0),d=["x","y","z","w"];for(let f=0;f<s;f++){const m=d[f];h[m].assign(n(u[m]))}return h}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:s}=this,{renderer:n}=e;if(n.backend.isWebGPUBackend)return super.setup(e);const a=this.getInputType(e),l=e.getElementType(a),u=e.getTypeLength(a),h=`${t}_base_${l}`,d=`${t}_${a}`;let f=zf[h];if(f===void 0){switch(t){case zn.COUNT_LEADING_ZEROS:{f=this._createLeadingZerosBaseLayout(h,l);break}case zn.COUNT_TRAILING_ZEROS:{f=this._createTrailingZerosBaseLayout(h,l);break}case zn.COUNT_ONE_BITS:{f=this._createOneBitsBaseLayout(h,l);break}}zf[h]=f}let m=zf[d];return m===void 0&&(m=this._createMainLayout(d,a,u,f),zf[d]=m),P(()=>m(s))()}}zn.COUNT_TRAILING_ZEROS="countTrailingZeros";zn.COUNT_LEADING_ZEROS="countLeadingZeros";zn.COUNT_ONE_BITS="countOneBits";const N4=re(zn,zn.COUNT_TRAILING_ZEROS).setParameterLength(1),A4=re(zn,zn.COUNT_LEADING_ZEROS).setParameterLength(1),C4=re(zn,zn.COUNT_ONE_BITS).setParameterLength(1),E4=P(([i])=>{const e=i.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),N_=(i,e)=>oi(Be(4,i.mul($e(1,i))),e),R4=(i,e)=>i.lessThan(.5)?N_(i.mul(2),e).div(2):$e(1,N_(Be($e(1,i),2),e).div(2)),B4=(i,e,t)=>oi(kn(oi(i,e),ss(oi(i,e),oi($e(1,i),t))),1/e),D4=(i,e)=>Ws(eg.mul(e.mul(i).sub(1))).div(eg.mul(e.mul(i).sub(1)));class xT extends jt{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const L4=re(xT,"snorm").setParameterLength(1),U4=re(xT,"unorm").setParameterLength(1),F4=re(xT,"float16").setParameterLength(1);class _T extends jt{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const P4=re(_T,"snorm").setParameterLength(1),O4=re(_T,"unorm").setParameterLength(1),V4=re(_T,"float16").setParameterLength(1),Gr=P(([i])=>i.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),z4=P(([i])=>L(Gr(i.z.add(Gr(i.y.mul(1)))),Gr(i.z.add(Gr(i.x.mul(1)))),Gr(i.y.add(Gr(i.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),I4=P(([i,e,t])=>{const s=L(i).toVar(),n=A(1.4).toVar(),a=A(0).toVar(),l=L(s).toVar();return mt({start:A(0),end:A(3),type:"float",condition:"<="},()=>{const u=L(z4(l.mul(2))).toVar();s.addAssign(u.add(t.mul(A(.1).mul(e)))),l.mulAssign(1.8),n.mulAssign(1.5),s.mulAssign(1.2);const h=A(Gr(s.z.add(Gr(s.x.add(Gr(s.y)))))).toVar();a.addAssign(h.div(n)),l.addAssign(.14)}),a}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class k4 extends be{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let s=this._candidateFn;if(s===null){let n=null,a=-1;for(const l of this.functionNodes){const h=l.shaderNode.layout;if(h===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const d=h.inputs;if(t.length===d.length){let f=0;for(let m=0;m<t.length;m++){const b=t[m],x=d[m];b.getNodeType(e)===x.type&&f++}f>a&&(n=l,a=f)}}this._candidateFn=s=n}return s}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const G4=Pe(k4),Bs=i=>(...e)=>G4(i,...e),fc=_e(0).setGroup(ve).onRenderUpdate(i=>i.time),q4=_e(0).setGroup(ve).onRenderUpdate(i=>i.deltaTime),sD=_e(0,"uint").setGroup(ve).onRenderUpdate(i=>i.frameId),H4=(i=fc)=>i.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),j4=(i=fc)=>i.fract().round(),$4=(i=fc)=>i.add(.5).fract().mul(2).sub(1).abs(),W4=(i=fc)=>i.fract();function X4(i,e=null){return ca(e,{getUV:typeof i=="function"?i:()=>i})}const Y4=P(([i,e,t=ie(.5)])=>wd(i.sub(t),e).add(t)),K4=P(([i,e,t=ie(.5)])=>{const s=i.sub(t),n=s.dot(s),l=n.mul(n).mul(e);return i.add(s.mul(l))}),Z4=P(({position:i=null,horizontal:e=!0,vertical:t=!1})=>{let s;i!==null?(s=li.toVar(),s[3][0]=i.x,s[3][1]=i.y,s[3][2]=i.z):s=li;const n=xi.mul(s);return ad(e)&&(n[0][0]=li[0].length(),n[0][1]=0,n[0][2]=0),ad(t)&&(n[1][0]=0,n[1][1]=li[1].length(),n[1][2]=0),n[2][0]=0,n[2][1]=0,n[2][2]=1,ea.mul(n).mul(Ot)}),Q4=P(([i=null])=>{const e=sg();return sg(oT(i)).sub(e).lessThan(0).select(rr,i)}),J4=P(([i,e=xt(),t=A(0)])=>{const s=i.x,n=i.y,a=t.mod(s.mul(n)).floor(),l=a.mod(s),u=n.sub(a.add(1).div(s).ceil()),h=i.reciprocal(),d=ie(l,u);return e.add(d).mul(h)}),nD=P(([i,e=null,t=null,s=A(1),n=Ot,a=gn])=>{let l=a.abs().normalize();l=l.div(l.dot(L(1)));const u=n.yz.mul(s),h=n.zx.mul(s),d=n.xy.mul(s),f=i.value,m=e!==null?e.value:f,b=t!==null?t.value:f,x=st(f,u).mul(l.x),v=st(m,h).mul(l.y),T=st(b,d).mul(l.z);return ss(x,v,T)}),eG=(...i)=>nD(...i),Mu=new kr,Yo=new z,Nu=new z,Tx=new z,wh=new Ze,If=new z(0,0,-1),Wi=new rt,Mh=new z,kf=new z,Nh=new rt,Gf=new Ue,ig=new ua,tG=rr.flipX();ig.depthTexture=new hi(1,1);let qf=!1;class vT extends ur{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||ig.texture,tG),this._reflectorBaseNode=e.reflector||new sG(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=new vT({defaultTexture:ig.depthTexture,reflector:this._reflectorBaseNode})}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class sG extends be{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:s=new us,resolutionScale:n=1,generateMipmaps:a=!1,bounces:l=!0,depth:u=!1,samples:h=0}=t;this.textureNode=e,this.target=s,this.resolutionScale=n,t.resolution!==void 0&&(ft('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=a,this.bounces=l,this.depth=u,this.samples=h,this.updateBeforeType=l?Re.RENDER:Re.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const s=this.resolutionScale;t.getDrawingBufferSize(Gf),e.setSize(Math.round(Gf.width*s),Math.round(Gf.height*s))}setup(e){return this._updateResolution(ig,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new ua(0,0,{type:Cs,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=tP,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new hi),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&qf)return!1;qf=!0;const{scene:t,camera:s,renderer:n,material:a}=e,{target:l}=this,u=this.getVirtualCamera(s),h=this.getRenderTarget(u);n.getDrawingBufferSize(Gf),this._updateResolution(h,n),Nu.setFromMatrixPosition(l.matrixWorld),Tx.setFromMatrixPosition(s.matrixWorld),wh.extractRotation(l.matrixWorld),Yo.set(0,0,1),Yo.applyMatrix4(wh),Mh.subVectors(Nu,Tx);const d=Mh.dot(Yo)>0;let f=!1;if(d===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){qf=!1;return}f=!0}Mh.reflect(Yo).negate(),Mh.add(Nu),wh.extractRotation(s.matrixWorld),If.set(0,0,-1),If.applyMatrix4(wh),If.add(Tx),kf.subVectors(Nu,If),kf.reflect(Yo).negate(),kf.add(Nu),u.coordinateSystem=s.coordinateSystem,u.position.copy(Mh),u.up.set(0,1,0),u.up.applyMatrix4(wh),u.up.reflect(Yo),u.lookAt(kf),u.near=s.near,u.far=s.far,u.updateMatrixWorld(),u.projectionMatrix.copy(s.projectionMatrix),Mu.setFromNormalAndCoplanarPoint(Yo,Nu),Mu.applyMatrix4(u.matrixWorldInverse),Wi.set(Mu.normal.x,Mu.normal.y,Mu.normal.z,Mu.constant);const m=u.projectionMatrix;Nh.x=(Math.sign(Wi.x)+m.elements[8])/m.elements[0],Nh.y=(Math.sign(Wi.y)+m.elements[9])/m.elements[5],Nh.z=-1,Nh.w=(1+m.elements[10])/m.elements[14],Wi.multiplyScalar(1/Wi.dot(Nh));const b=0;m.elements[2]=Wi.x,m.elements[6]=Wi.y,m.elements[10]=n.coordinateSystem===pi?Wi.z-b:Wi.z+1-b,m.elements[14]=Wi.w,this.textureNode.value=h.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=h.depthTexture),a.visible=!1;const x=n.getRenderTarget(),v=n.getMRT(),T=n.autoClear;n.setMRT(null),n.setRenderTarget(h),n.autoClear=!0;const w=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",f?(n.clear(),this.hasOutput=!1):(n.render(t,u),this.hasOutput=!0),t.name=w,n.setMRT(v),n.setRenderTarget(x),n.autoClear=T,a.visible=!0,qf=!1,this.forceUpdate=!1}get resolution(){return ft('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){ft('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const nG=i=>new vT(i),Sx=new av(-1,1,1,-1,0,1);class iG extends pr{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Ks([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ks(t,2))}}const rG=new iG;class Kg extends na{constructor(e=null){super(rG,e),this.camera=Sx,this.isQuadMesh=!0}async renderAsync(e){ft('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,Sx)}render(e){e.render(this,Sx)}}const aG=new Ue;class oG extends ur{static get type(){return"RTTNode"}constructor(e,t=null,s=null,n={type:Cs}){const a=new ua(t,s,n);super(a.texture,xt()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=s,this.pixelRatio=1,this.renderTarget=a,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Kg(new Ht),this.updateBeforeType=Re.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const s=e*this.pixelRatio,n=t*this.pixelRatio;this.renderTarget.setSize(s,n),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const n=e.getPixelRatio(),a=e.getSize(aG),l=Math.floor(a.width*n),u=Math.floor(a.height*n);(l!==this.renderTarget.width||u!==this.renderTarget.height)&&(this.renderTarget.setSize(l,u),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const s=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(s)}clone(){const e=new ur(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const iD=(i,...e)=>new oG(ye(i),...e),lG=(i,...e)=>i.isSampleNode||i.isTextureNode?i:i.isPassNode?i.getTextureNode():iD(i,...e),Uu=P(([i,e,t],s)=>{let n;s.renderer.coordinateSystem===pi?(i=ie(i.x,i.y.oneMinus()).mul(2).sub(1),n=Se(L(i,e),1)):n=Se(L(i.x,i.y.oneMinus(),e).mul(2).sub(1),1);const a=Se(t.mul(n));return a.xyz.div(a.w)}),uG=P(([i,e])=>{const t=e.mul(Se(i,1)),s=t.xy.div(t.w).mul(.5).add(.5).toVar();return ie(s.x,s.y.oneMinus())}),cG=P(([i,e,t])=>{const s=ho(kt(e)),n=ls(i.mul(s)).toVar(),a=kt(e,n).toVar(),l=kt(e,n.sub(ls(2,0))).toVar(),u=kt(e,n.sub(ls(1,0))).toVar(),h=kt(e,n.add(ls(1,0))).toVar(),d=kt(e,n.add(ls(2,0))).toVar(),f=kt(e,n.add(ls(0,2))).toVar(),m=kt(e,n.add(ls(0,1))).toVar(),b=kt(e,n.sub(ls(0,1))).toVar(),x=kt(e,n.sub(ls(0,2))).toVar(),v=At($e(A(2).mul(u).sub(l),a)).toVar(),T=At($e(A(2).mul(h).sub(d),a)).toVar(),w=At($e(A(2).mul(m).sub(f),a)).toVar(),N=At($e(A(2).mul(b).sub(x),a)).toVar(),C=Uu(i,a,t).toVar(),R=v.lessThan(T).select(C.sub(Uu(i.sub(ie(A(1).div(s.x),0)),u,t)),C.negate().add(Uu(i.add(ie(A(1).div(s.x),0)),h,t))),E=w.lessThan(N).select(C.sub(Uu(i.add(ie(0,A(1).div(s.y))),m,t)),C.negate().add(Uu(i.sub(ie(0,A(1).div(s.y))),b,t)));return fn(ia(R,E))}),TT=P(([i])=>Di(A(52.9829189).mul(Di(gi(i,ie(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),Ei=P(([i,e,t])=>{const s=A(2.399963229728653),n=Zs(A(i).add(.5).div(A(e))),a=A(i).mul(s).add(t);return ie(Ai(a),Ws(a)).mul(n)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class hG extends be{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(xt())}sample(e){return this.callback(e)}}const dG=(i,e=null)=>new hG(i,ye(e));class dn extends be{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===dn.OBJECT?this.updateType=Re.OBJECT:e===dn.MATERIAL?this.updateType=Re.RENDER:e===dn.BEFORE_OBJECT?this.updateBeforeType=Re.OBJECT:e===dn.BEFORE_MATERIAL&&(this.updateBeforeType=Re.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}dn.OBJECT="object";dn.MATERIAL="material";dn.BEFORE_OBJECT="beforeObject";dn.BEFORE_MATERIAL="beforeMaterial";const Zg=(i,e)=>new dn(i,e).toStack(),pG=i=>Zg(dn.OBJECT,i),fG=i=>Zg(dn.MATERIAL,i),mG=i=>Zg(dn.BEFORE_OBJECT,i),gG=i=>Zg(dn.BEFORE_MATERIAL,i);class yG extends ju{constructor(e,t,s=Float32Array){const n=ArrayBuffer.isView(e)?e:new s(e*t);super(n,t),this.isStorageInstancedBufferAttribute=!0}}class bG extends Vn{constructor(e,t,s=Float32Array){const n=ArrayBuffer.isView(e)?e:new s(e*t);super(n,t),this.isStorageBufferAttribute=!0}}const xG=(i,e="float")=>{let t,s;e.isStruct===!0?(t=e.layout.getLength(),s=Wm("float")):(t=vE(e),s=Wm(e));const n=new bG(i,t,s);return po(n,e,i)},_G=(i,e="float")=>{let t,s;e.isStruct===!0?(t=e.layout.getLength(),s=Wm("float")):(t=vE(e),s=Wm(e));const n=new yG(i,t,s);return po(n,e,n.count)};class vG extends be{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const TG=ce(vG),Ah=new fi,wx=new Ze,rD=_e(0).setGroup(ve).onRenderUpdate(({scene:i})=>i.backgroundBlurriness),A_=_e(1).setGroup(ve).onRenderUpdate(({scene:i})=>i.backgroundIntensity),aD=_e(new Ze).setGroup(ve).onRenderUpdate(({scene:i})=>{const e=i.background;return e!==null&&e.isTexture&&e.mapping!==G_?(Ah.copy(i.backgroundRotation),Ah.x*=-1,Ah.y*=-1,Ah.z*=-1,wx.makeRotationFromEuler(Ah)):wx.identity(),wx});class SG extends ur{static get type(){return"StorageTextureNode"}constructor(e,t,s=null){super(e,t),this.storeNode=s,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=Es.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let s;return this.storeNode!==null?s=this.generateStore(e):s=super.generate(e,t),s}generateSnippet(e,t,s,n,a,l,u,h,d){const f=this.value;return e.generateStorageTextureLoad(f,t,s,n,l,d)}toReadWrite(){return this.setAccess(Es.READ_WRITE)}toReadOnly(){return this.setAccess(Es.READ_ONLY)}toWriteOnly(){return this.setAccess(Es.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:s,storeNode:n,depthNode:a}=t,l=super.generate(e,"property"),u=s.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),h=n.build(e,"vec4"),d=a?a.build(e,"int"):null,f=e.generateTextureStore(e,l,u,d,h);e.addLineFlowCode(f,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e.access=this.access,e}}const oD=Pe(SG).setParameterLength(1,3),wG=(i,e,t)=>{let s;return i.isStorageTextureNode===!0?(s=i.clone(),s.uvNode=e,s.storeNode=t):s=oD(i,e,t),t!==null&&s.toStack(),s},MG=P(({texture:i,uv:e})=>{const s=L().toVar();return Me(e.x.lessThan(1e-4),()=>{s.assign(L(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{s.assign(L(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{s.assign(L(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{s.assign(L(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{s.assign(L(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{s.assign(L(0,0,-1))}).Else(()=>{const a=i.sample(e.add(L(-.01,0,0))).r.sub(i.sample(e.add(L(.01,0,0))).r),l=i.sample(e.add(L(0,-.01,0))).r.sub(i.sample(e.add(L(0,.01,0))).r),u=i.sample(e.add(L(0,0,-.01))).r.sub(i.sample(e.add(L(0,0,.01))).r);s.assign(L(a,l,u))}),s.normalize()});class NG extends ur{static get type(){return"Texture3DNode"}constructor(e,t=null,s=null){super(e,t,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return L(.5,.5,.5)}setUpdateMatrix(){}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return MG({texture:this,uv:e})}}const Qg=Pe(NG).setParameterLength(1,3),AG=(...i)=>Qg(...i).setSampler(!1),CG=(i,e,t)=>Qg(i,e).level(t);class EG extends kg{static get type(){return"UserDataNode"}constructor(e,t,s=null){super(e,t,s),this.userData=s}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const RG=(i,e,t)=>new EG(i,e,t),RA=new WeakMap;class BG extends jt{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Re.OBJECT,this.updateAfterType=Re.OBJECT,this.previousModelWorldMatrix=_e(new Ze),this.previousProjectionMatrix=_e(new Ze).setGroup(ve),this.previousCameraViewMatrix=_e(new Ze)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:s}){const n=BA(s);this.previousModelWorldMatrix.value.copy(n);const a=lD(t);a.frameId!==e&&(a.frameId=e,a.previousProjectionMatrix===void 0?(a.previousProjectionMatrix=new Ze,a.previousCameraViewMatrix=new Ze,a.currentProjectionMatrix=new Ze,a.currentCameraViewMatrix=new Ze,a.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),a.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(a.previousProjectionMatrix.copy(a.currentProjectionMatrix),a.previousCameraViewMatrix.copy(a.currentCameraViewMatrix)),a.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),a.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(a.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(a.previousCameraViewMatrix))}updateAfter({object:e}){BA(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?ea:_e(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),s=e.mul(To).mul(Ot),n=this.previousProjectionMatrix.mul(t).mul(ac),a=s.xy.div(s.w),l=n.xy.div(n.w);return $e(a,l)}}function lD(i){let e=RA.get(i);return e===void 0&&(e={},RA.set(i,e)),e}function BA(i,e=0){const t=lD(i);let s=t[e];return s===void 0&&(t[e]=s=new Ze,t[e].copy(i.matrixWorld)),s}const DG=ce(BG),LG=P(([i])=>ST(i.rgb)),UG=P(([i,e=A(1)])=>e.mix(ST(i.rgb),i.rgb)),FG=P(([i,e=A(1)])=>{const t=ss(i.r,i.g,i.b).div(3),s=i.r.max(i.g.max(i.b)),n=s.sub(t).mul(e).mul(-3);return qe(i.rgb,s,n)}),PG=P(([i,e=A(1)])=>{const t=L(.57735,.57735,.57735),s=e.cos();return L(i.rgb.mul(s).add(t.cross(i.rgb).mul(e.sin()).add(t.mul(gi(t,i.rgb).mul(s.oneMinus())))))}),ST=(i,e=L(nt.getLuminanceCoefficients(new z)))=>gi(i,e),OG=P(([i,e=L(1),t=L(0),s=L(1),n=A(1),a=L(nt.getLuminanceCoefficients(new z,Hm))])=>{const l=i.rgb.dot(L(a)),u=zt(i.rgb.mul(e).add(t),0).toVar(),h=u.pow(s).toVar();return Me(u.r.greaterThan(0),()=>{u.r.assign(h.r)}),Me(u.g.greaterThan(0),()=>{u.g.assign(h.g)}),Me(u.b.greaterThan(0),()=>{u.b.assign(h.b)}),u.assign(l.add(u.sub(l).mul(n))),Se(u.rgb,i.a)}),VG=P(([i,e])=>i.mul(e).floor().div(e));let Hf=null;class zG extends jg{static get type(){return"ViewportSharedTextureNode"}constructor(e=rr,t=null){Hf===null&&(Hf=new tv),super(e,t,Hf)}getTextureForReference(){return Hf}updateReference(){return this}}const IG=Pe(zG).setParameterLength(0,2),jf=new Ue;class uD extends ur{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.isPassTextureNode=!0,this.setUpdateMatrix(!1)}setup(e){const t=e.getNodeProperties(this);return t.passNode=this.passNode,super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class DA extends uD{static get type(){return"PassMultipleTextureNode"}constructor(e,t,s=!1){super(e,null),this.textureName=t,this.previousTexture=s,this.isPassMultipleTextureNode=!0}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class cr extends jt{static get type(){return"PassNode"}constructor(e,t,s,n={}){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this.options=n,this._pixelRatio=1,this._width=1,this._height=1;const a=new hi;a.isRenderTargetTexture=!0,a.name="depth";const l=new ua(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Cs,...n});l.texture.name="output",l.depthTexture=a,this.renderTarget=l,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:l.texture,depth:a},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=_e(0),this._cameraFar=_e(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Re.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return ue("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return ue("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const s=this._textures[e],n=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[n]=t,this._textures[e]=t,this._previousTextures[e]=s,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new DA(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new DA(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const s=this._cameraNear,n=this._cameraFar;this._viewZNodes[e]=t=uT(this.getTextureNode(e),s,n)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const s=this._cameraNear,n=this._cameraFar,a=this.getViewZNode(e);this._linearDepthNodes[e]=t=Yu(a,s,n)}return t}async compileAsync(e){const t=e.getRenderTarget(),s=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(s)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===cr.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s}=this;let n,a;const l=t.getOutputRenderTarget();l&&l.isXRRenderTarget===!0?(a=1,n=t.xr.getCamera(),t.xr.updateCamera(n),jf.set(l.width,l.height)):(n=this.camera,a=t.getPixelRatio(),t.getSize(jf)),this._pixelRatio=a,this.setSize(jf.width,jf.height);const u=t.getRenderTarget(),h=t.getMRT(),d=t.autoClear,f=t.transparent,m=t.opaque,b=n.layers.mask,x=t.contextNode,v=s.overrideMaterial;this._cameraNear.value=n.near,this._cameraFar.value=n.far,this._layers!==null&&(n.layers.mask=this._layers.mask);for(const w in this._previousTextures)this.toggleTexture(w);this.overrideMaterial!==null&&(s.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:ca({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const T=s.name;s.name=this.name?this.name:s.name,t.render(s,n),s.name=T,s.overrideMaterial=v,t.setRenderTarget(u),t.setMRT(h),t.autoClear=d,t.transparent=f,t.opaque=m,t.contextNode=x,n.layers.mask=b}setSize(e,t){this._width=e,this._height=t;const s=Math.floor(this._width*this._pixelRatio*this._resolutionScale),n=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(s,n),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,s,n){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new rt),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,s,n),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,s,n){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new rt),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,s,n),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}cr.COLOR="color";cr.DEPTH="depth";const kG=(i,e,t)=>new cr(cr.COLOR,i,e,t),GG=(i,e)=>new uD(i,e),qG=(i,e,t)=>new cr(cr.DEPTH,i,e,t);class HG extends cr{static get type(){return"ToonOutlinePassNode"}constructor(e,t,s,n,a){super(cr.COLOR,e,t),this.colorNode=s,this.thicknessNode=n,this.alphaNode=a,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,s=t.getRenderObjectFunction();t.setRenderObjectFunction((n,a,l,u,h,d,f,m)=>{if((h.isMeshToonMaterial||h.isMeshToonNodeMaterial)&&h.wireframe===!1){const b=this._getOutlineMaterial(h);t.renderObject(n,a,l,u,b,d,f,m)}t.renderObject(n,a,l,u,h,d,f,m)}),super.updateBefore(e),t.setRenderObjectFunction(s)}_createMaterial(){const e=new Ht;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=Rs;const t=gn.negate(),s=ea.mul(To),n=A(1),a=s.mul(Se(Ot,1)),l=s.mul(Se(Ot.add(t),1)),u=fn(a.sub(l));return e.vertexNode=a.add(u.mul(this.thicknessNode).mul(a.w).mul(n)),e.colorNode=Se(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const jG=(i,e,t=new it(0,0,0),s=.003,n=1)=>new HG(i,e,ye(t),ye(s),ye(n)),cD=P(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),hD=P(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),dD=P(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),s=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$G=P(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),pD=P(([i,e])=>{const t=vs(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=vs(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=$G(i),i=s.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),WG=vs(L(1.6605,-.1246,-.0182),L(-.5876,1.1329,-.1006),L(-.0728,-.0083,1.1187)),XG=vs(L(.6274,.0691,.0164),L(.3293,.9195,.088),L(.0433,.0113,.8956)),YG=P(([i])=>{const e=L(i).toVar(),t=L(e.mul(e)).toVar(),s=L(t.mul(t)).toVar();return A(15.5).mul(s.mul(t)).sub(Be(40.14,s.mul(e))).add(Be(31.96,s).sub(Be(6.868,t.mul(e))).add(Be(.4298,t).add(Be(.1191,e).sub(.00232))))}),fD=P(([i,e])=>{const t=L(i).toVar(),s=vs(L(.856627153315983,.137318972929847,.11189821299995),L(.0951212405381588,.761241990602591,.0767994186031903),L(.0482516061458583,.101439036467562,.811302368396859)),n=vs(L(1.1271005818144368,-.1413297634984383,-.14132976349843826),L(-.11060664309660323,1.157823702216272,-.11060664309660294),L(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=A(-12.47393),l=A(4.026069);return t.mulAssign(e),t.assign(XG.mul(t)),t.assign(s.mul(t)),t.assign(zt(t,1e-10)),t.assign(sr(t)),t.assign(t.sub(a).div(l.sub(a))),t.assign(Li(t,0,1)),t.assign(YG(t)),t.assign(n.mul(t)),t.assign(oi(zt(L(0),t),L(2.2))),t.assign(WG.mul(t)),t.assign(Li(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),mD=P(([i,e])=>{const t=A(.76),s=A(.15);i=i.mul(e);const n=mn(i.r,mn(i.g,i.b)),a=zs(n.lessThan(.08),n.sub(Be(6.25,n.mul(n))),.04);i.subAssign(a);const l=zt(i.r,zt(i.g,i.b));Me(l.lessThan(t),()=>i);const u=$e(1,t),h=$e(1,u.mul(u).div(l.add(u.sub(t))));i.mulAssign(h.div(l));const d=$e(1,kn(1,s.mul(l.sub(h)).add(1)));return qe(i,L(h),d)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class fs extends be{static get type(){return"CodeNode"}constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=s}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const Jg=Pe(fs).setParameterLength(1,3),KG=(i,e)=>Jg(i,e,"js"),ZG=(i,e)=>Jg(i,e,"wgsl"),QG=(i,e)=>Jg(i,e,"glsl");class gD extends fs{static get type(){return"FunctionNode"}constructor(e="",t=[],s=""){super(e,t,s)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const s=this.getNodeType(e);return e.getStructTypeNode(s).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),n=s.name,a=s.type,l=e.getCodeFromNode(this,a);n!==""&&(l.name=n);const u=e.getPropertyName(l),h=this.getNodeFunction(e).getCode(u);return l.code=h+`
`,t==="property"?u:e.format(`${u}()`,a,t)}}const yD=(i,e=[],t="")=>{for(let a=0;a<e.length;a++){const l=e[a];typeof l=="function"&&(e[a]=l.functionNode)}const s=new gD(i,e,t),n=(...a)=>s.call(...a);return n.functionNode=s,n},JG=(i,e)=>yD(i,e,"glsl"),e5=(i,e)=>yD(i,e,"wgsl");function wT(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Kt.z).negate()}const bD=P(([i,e],t)=>{const s=wT(t);return Ui(i,e,s)}),xD=P(([i],e)=>{const t=wT(e);return i.mul(i,t,t).negate().exp().oneMinus()}),t5=P(([i,e],t)=>{const s=wT(t),a=e.sub(ar.y).max(0).toConst().mul(s).toConst();return i.mul(i,a,a).negate().exp().oneMinus()}),C_=P(([i,e])=>Se(e.toFloat().mix(Wu.rgb,i.toVec3()),Wu.a));let Ko=null,Zo=null;class s5 extends be{static get type(){return"RangeNode"}constructor(e=A(),t=A()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),s=this.getConstNode(this.maxNode),n=e.getTypeLength(io(t.value)),a=e.getTypeLength(io(s.value));return n>a?n:a}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(s=>{s.isConstNode===!0&&(t=s)}),t===null)throw new s2('THREE.TSL: No "ConstNode" found in node graph.',this.stackTrace);return t}setup(e){const t=e.object;let s=null;if(t.count>1){const n=this.getConstNode(this.minNode),a=this.getConstNode(this.maxNode),l=n.value,u=a.value,h=e.getTypeLength(io(l)),d=e.getTypeLength(io(u));Ko=Ko||new rt,Zo=Zo||new rt,Ko.setScalar(0),Zo.setScalar(0),h===1?Ko.setScalar(l):l.isColor?Ko.set(l.r,l.g,l.b,1):Ko.set(l.x,l.y,l.z||0,l.w||0),d===1?Zo.setScalar(u):u.isColor?Zo.set(u.r,u.g,u.b,1):Zo.set(u.x,u.y,u.z||0,u.w||0);const f=4,m=f*t.count,b=new Float32Array(m);for(let T=0;T<m;T++){const w=T%f,N=Ko.getComponent(w),C=Zo.getComponent(w);b[T]=Y_.lerp(N,C,Math.random())}const x=this.getNodeType(e);if(t.count*4*4<=e.getUniformBufferLimit())s=Td(b,"vec4",t.count).element(or).convert(x);else{const T=new ju(b,4);e.geometry.setAttribute("__range"+this.id,T),s=tg(T).convert(x)}}else s=A(0);return s}}const n5=Pe(s5).setParameterLength(2);class i5 extends be{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const s=this.getBuiltinName(e),n=this.getNodeType(e);return e.shaderStage==="compute"?e.format(s,n,t):(ue(`ComputeBuiltinNode: Compute built-in value ${s} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(n))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const Nd=(i,e)=>new i5(i,e),r5=Nd("numWorkgroups","uvec3"),a5=Nd("workgroupId","uvec3"),o5=Nd("globalId","uvec3"),l5=Nd("localId","uvec3"),u5=Nd("subgroupSize","uint");class c5 extends be{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:s}=e;s.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const MT=Pe(c5),h5=()=>MT("workgroup").toStack(),d5=()=>MT("storage").toStack(),p5=()=>MT("texture").toStack();class f5 extends _l{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let s;const n=e.context.assign;if(s=super.generate(e),n!==!0){const a=this.getNodeType(e);s=e.format(s,a,t)}return s}}class m5 extends be{constructor(e,t,s=0){super(t),this.bufferType=t,this.bufferCount=s,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return ue('TSL: "label()" has been deprecated. Use "setName()" instead.',new Zt),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new f5(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const g5=(i,e)=>new m5("Workgroup",i,e);class gs extends be{static get type(){return"AtomicFunctionNode"}constructor(e,t,s){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=s,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),s=t.parents,n=this.method,a=this.getNodeType(e),l=this.getInputType(e),u=this.pointerNode,h=this.valueNode,d=[];d.push(`&${u.build(e,l)}`),h!==null&&d.push(h.build(e,l));const f=`${e.getMethod(n,a)}( ${d.join(", ")} )`;if(s?s.length===1&&s[0].isStackNode===!0:!1)e.addLineFlowCode(f,this);else return t.constNode===void 0&&(t.constNode=Bi(f,a).toConst()),t.constNode.build(e)}}gs.ATOMIC_LOAD="atomicLoad";gs.ATOMIC_STORE="atomicStore";gs.ATOMIC_ADD="atomicAdd";gs.ATOMIC_SUB="atomicSub";gs.ATOMIC_MAX="atomicMax";gs.ATOMIC_MIN="atomicMin";gs.ATOMIC_AND="atomicAnd";gs.ATOMIC_OR="atomicOr";gs.ATOMIC_XOR="atomicXor";const y5=Pe(gs),fr=(i,e,t)=>y5(i,e,t).toStack(),b5=i=>fr(gs.ATOMIC_LOAD,i,null),x5=(i,e)=>fr(gs.ATOMIC_STORE,i,e),_5=(i,e)=>fr(gs.ATOMIC_ADD,i,e),v5=(i,e)=>fr(gs.ATOMIC_SUB,i,e),T5=(i,e)=>fr(gs.ATOMIC_MAX,i,e),S5=(i,e)=>fr(gs.ATOMIC_MIN,i,e),w5=(i,e)=>fr(gs.ATOMIC_AND,i,e),M5=(i,e)=>fr(gs.ATOMIC_OR,i,e),N5=(i,e)=>fr(gs.ATOMIC_XOR,i,e);class he extends jt{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,s=null){super(),this.method=e,this.aNode=t,this.bNode=s}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,s=this.bNode?this.bNode.getNodeType(e):null,n=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(s)?0:e.getTypeLength(s);return n>a?t:s}getNodeType(e){const t=this.method;return t===he.SUBGROUP_ELECT?"bool":t===he.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const s=this.method,n=this.getNodeType(e),a=this.getInputType(e),l=this.aNode,u=this.bNode,h=[];if(s===he.SUBGROUP_BROADCAST||s===he.SUBGROUP_SHUFFLE||s===he.QUAD_BROADCAST){const f=u.getNodeType(e);h.push(l.build(e,n),u.build(e,f==="float"?"int":n))}else s===he.SUBGROUP_SHUFFLE_XOR||s===he.SUBGROUP_SHUFFLE_DOWN||s===he.SUBGROUP_SHUFFLE_UP?h.push(l.build(e,n),u.build(e,"uint")):(l!==null&&h.push(l.build(e,a)),u!==null&&h.push(u.build(e,a)));const d=h.length===0?"()":`( ${h.join(", ")} )`;return e.format(`${e.getMethod(s,n)}${d}`,n,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}he.SUBGROUP_ELECT="subgroupElect";he.SUBGROUP_BALLOT="subgroupBallot";he.SUBGROUP_ADD="subgroupAdd";he.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";he.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";he.SUBGROUP_MUL="subgroupMul";he.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";he.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";he.SUBGROUP_AND="subgroupAnd";he.SUBGROUP_OR="subgroupOr";he.SUBGROUP_XOR="subgroupXor";he.SUBGROUP_MIN="subgroupMin";he.SUBGROUP_MAX="subgroupMax";he.SUBGROUP_ALL="subgroupAll";he.SUBGROUP_ANY="subgroupAny";he.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";he.QUAD_SWAP_X="quadSwapX";he.QUAD_SWAP_Y="quadSwapY";he.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";he.SUBGROUP_BROADCAST="subgroupBroadcast";he.SUBGROUP_SHUFFLE="subgroupShuffle";he.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";he.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";he.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";he.QUAD_BROADCAST="quadBroadcast";const A5=re(he,he.SUBGROUP_ELECT).setParameterLength(0),C5=re(he,he.SUBGROUP_BALLOT).setParameterLength(1),E5=re(he,he.SUBGROUP_ADD).setParameterLength(1),R5=re(he,he.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),B5=re(he,he.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),D5=re(he,he.SUBGROUP_MUL).setParameterLength(1),L5=re(he,he.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),U5=re(he,he.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),F5=re(he,he.SUBGROUP_AND).setParameterLength(1),P5=re(he,he.SUBGROUP_OR).setParameterLength(1),O5=re(he,he.SUBGROUP_XOR).setParameterLength(1),V5=re(he,he.SUBGROUP_MIN).setParameterLength(1),z5=re(he,he.SUBGROUP_MAX).setParameterLength(1),I5=re(he,he.SUBGROUP_ALL).setParameterLength(0),k5=re(he,he.SUBGROUP_ANY).setParameterLength(0),G5=re(he,he.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),q5=re(he,he.QUAD_SWAP_X).setParameterLength(1),H5=re(he,he.QUAD_SWAP_Y).setParameterLength(1),j5=re(he,he.QUAD_SWAP_DIAGONAL).setParameterLength(1),$5=re(he,he.SUBGROUP_BROADCAST).setParameterLength(2),W5=re(he,he.SUBGROUP_SHUFFLE).setParameterLength(2),X5=re(he,he.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),Y5=re(he,he.SUBGROUP_SHUFFLE_UP).setParameterLength(2),K5=re(he,he.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),Z5=re(he,he.QUAD_BROADCAST).setParameterLength(1);let $f;function ey(i){$f=$f||new WeakMap;let e=$f.get(i);return e===void 0&&$f.set(i,e={}),e}function ty(i){const e=ey(i);return e.shadowMatrix||(e.shadowMatrix=_e("mat4").setGroup(ve).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(i.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(i.shadow.camera.coordinateSystem=t.camera.coordinateSystem,i.shadow.camera.updateProjectionMatrix()),i.shadow.updateMatrices(i)),i.shadow.matrix)))}function _D(i,e=ar){const t=ty(i).mul(e);return t.xyz.div(t.w)}function NT(i){const e=ey(i);return e.position||(e.position=_e(new z).setGroup(ve).onRenderUpdate((t,s)=>s.value.setFromMatrixPosition(i.matrixWorld)))}function vD(i){const e=ey(i);return e.targetPosition||(e.targetPosition=_e(new z).setGroup(ve).onRenderUpdate((t,s)=>s.value.setFromMatrixPosition(i.target.matrixWorld)))}function AT(i){const e=ey(i);return e.viewPosition||(e.viewPosition=_e(new z).setGroup(ve).onRenderUpdate(({camera:t},s)=>{s.value=s.value||new z,s.value.setFromMatrixPosition(i.matrixWorld),s.value.applyMatrix4(t.matrixWorldInverse)}))}const CT=i=>xi.transformDirection(NT(i).sub(vD(i))),Q5=i=>i.sort((e,t)=>e.id-t.id),J5=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},Mx=new WeakMap,Ch=[];class ET extends be{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Jr("vec3","totalDiffuse"),this.totalSpecularNode=Jr("vec3","totalSpecular"),this.outgoingLightNode=Jr("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let s=0;s<e.length;s++){const n=e[s];if(Ch.push(n.id),Ch.push(n.castShadow?1:0),n.isSpotLight===!0){const a=n.map!==null?n.map.id:-1,l=n.colorNode?n.colorNode.getCacheKey():-1;Ch.push(a,l)}}const t=xd(Ch);return Ch.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const s of this._lightNodes)t.push(s.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const s of t.nodes)s.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],s=this._lightNodes,n=Q5(this._lights),a=e.renderer.library;for(const l of n)if(l.isNode)t.push(ye(l));else{let u=null;if(s!==null&&(u=J5(l.id,s)),u===null){const h=a.getLightNodeClass(l.constructor);if(h===null){ue(`LightsNode.setupNodeLights: Light node not found for ${l.constructor.name}`);continue}let d=null;Mx.has(l)?d=Mx.get(l):(d=new h(l),Mx.set(l,d)),t.push(d)}}this._lightNodes=t}setupDirectLight(e,t,s){const{lightingModel:n,reflectedLight:a}=e.context;n.direct({...s,lightNode:t,reflectedLight:a},e)}setupDirectRectAreaLight(e,t,s){const{lightingModel:n,reflectedLight:a}=e.context;n.directRectArea({...s,lightNode:t,reflectedLight:a},e)}setupLights(e,t){for(const s of t)s.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let s=this.outgoingLightNode;const n=e.context,a=n.lightingModel,l=e.getNodeProperties(this);if(a){const{totalDiffuseNode:u,totalSpecularNode:h}=this;n.outgoingLight=s;const d=e.addStack();l.nodes=d.nodes,a.start(e);const{backdrop:f,backdropAlpha:m}=n,{directDiffuse:b,directSpecular:x,indirectDiffuse:v,indirectSpecular:T}=n.reflectedLight;let w=b.add(v);f!==null&&(m!==null?w=L(m.mix(w,f)):w=L(f)),u.assign(w),h.assign(x.add(T)),s.assign(u.add(h)),a.finish(e),s=s.bypass(e.removeStack())}else l.nodes=[];return e.lightsNode=t,s}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const e6=(i=[])=>new ET().setLights(i);class t6 extends be{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Re.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){RT.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||ar)}}const RT=Jr("vec3","shadowPositionWorld");function s6(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new it),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function n6(i,e){return e=s6(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function i6(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function r6(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function a6(i,e){return e=r6(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function o6(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function l6(i,e,t){return t=n6(i,t),t=a6(e,t),t}function u6(i,e,t){i6(i,t),o6(e,t)}const rg=new WeakMap,TD=P(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let s=st(i,e.xy).setName("t_basic");return i.isArrayTexture&&(s=s.depth(t)),s.compare(e.z)}),SD=P(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:s})=>{const n=(f,m)=>{let b=st(i,f);return i.isArrayTexture&&(b=b.depth(s)),b.compare(m)},a=Rt("mapSize","vec2",t).setGroup(ve),l=Rt("radius","float",t).setGroup(ve),u=ie(1).div(a),h=l.mul(u.x),d=TT(Tl.xy).mul(6.28318530718);return ss(n(e.xy.add(Ei(0,5,d).mul(h)),e.z),n(e.xy.add(Ei(1,5,d).mul(h)),e.z),n(e.xy.add(Ei(2,5,d).mul(h)),e.z),n(e.xy.add(Ei(3,5,d).mul(h)),e.z),n(e.xy.add(Ei(4,5,d).mul(h)),e.z)).mul(1/5)}),wD=P(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:s})=>{const n=(m,b)=>{let x=st(i,m);return i.isArrayTexture&&(x=x.depth(s)),x.compare(b)},a=Rt("mapSize","vec2",t).setGroup(ve),l=ie(1).div(a),u=l.x,h=l.y,d=e.xy,f=Di(d.mul(a).add(.5));return d.subAssign(f.mul(l)),ss(n(d,e.z),n(d.add(ie(u,0)),e.z),n(d.add(ie(0,h)),e.z),n(d.add(l),e.z),qe(n(d.add(ie(u.negate(),0)),e.z),n(d.add(ie(u.mul(2),0)),e.z),f.x),qe(n(d.add(ie(u.negate(),h)),e.z),n(d.add(ie(u.mul(2),h)),e.z),f.x),qe(n(d.add(ie(0,h.negate())),e.z),n(d.add(ie(0,h.mul(2))),e.z),f.y),qe(n(d.add(ie(u,h.negate())),e.z),n(d.add(ie(u,h.mul(2))),e.z),f.y),qe(qe(n(d.add(ie(u.negate(),h.negate())),e.z),n(d.add(ie(u.mul(2),h.negate())),e.z),f.x),qe(n(d.add(ie(u.negate(),h.mul(2))),e.z),n(d.add(ie(u.mul(2),h.mul(2))),e.z),f.x),f.y)).mul(1/9)}),MD=P(({depthTexture:i,shadowCoord:e,depthLayer:t},s)=>{let n=st(i).sample(e.xy);i.isArrayTexture&&(n=n.depth(t)),n=n.rg;const a=n.x,l=zt(1e-7,n.y.mul(n.y)),u=s.renderer.reversedDepthBuffer?rc(a,e.z):rc(e.z,a),h=A(1).toVar();return Me(u.notEqual(1),()=>{const d=e.z.sub(a);let f=l.div(l.add(d.mul(d)));f=Li($e(f,.3).div(.65)),h.assign(zt(u,f))}),h}),ND=i=>{let e=rg.get(i);return e===void 0&&(e=new Ht,e.colorNode=Se(0,0,0,1),e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.blending=Xr,e.fog=!1,rg.set(i,e)),e},AD=i=>{const e=rg.get(i);e!==void 0&&(e.dispose(),rg.delete(i))},LA=new bo,Au=[],CD=(i,e,t,s)=>{Au[0]=i,Au[1]=e;let n=LA.get(Au);return(n===void 0||n.shadowType!==t||n.useVelocity!==s)&&(n=(a,l,u,h,d,f,...m)=>{(a.castShadow===!0||a.receiveShadow&&t===Ih)&&(s&&(TE(a).useVelocity=!0),a.onBeforeShadow(i,a,u,e.camera,h,l.overrideMaterial,f),i.renderObject(a,l,u,h,d,f,...m),a.onAfterShadow(i,a,u,e.camera,h,l.overrideMaterial,f))},n.shadowType=t,n.useVelocity=s,LA.set(Au,n)),Au[0]=null,Au[1]=null,n},c6=P(({samples:i,radius:e,size:t,shadowPass:s,depthLayer:n})=>{const a=A(0).toVar("meanVertical"),l=A(0).toVar("squareMeanVertical"),u=i.lessThanEqual(A(1)).select(A(0),A(2).div(i.sub(1))),h=i.lessThanEqual(A(1)).select(A(0),A(-1));mt({start:B(0),end:B(i),type:"int",condition:"<"},({i:f})=>{const m=h.add(A(f).mul(u));let b=s.sample(ss(Tl.xy,ie(0,m).mul(e)).div(t));s.value.isArrayTexture&&(b=b.depth(n)),b=b.x,a.addAssign(b),l.addAssign(b.mul(b))}),a.divAssign(i),l.divAssign(i);const d=Zs(l.sub(a.mul(a)).max(0));return ie(a,d)}),h6=P(({samples:i,radius:e,size:t,shadowPass:s,depthLayer:n})=>{const a=A(0).toVar("meanHorizontal"),l=A(0).toVar("squareMeanHorizontal"),u=i.lessThanEqual(A(1)).select(A(0),A(2).div(i.sub(1))),h=i.lessThanEqual(A(1)).select(A(0),A(-1));mt({start:B(0),end:B(i),type:"int",condition:"<"},({i:f})=>{const m=h.add(A(f).mul(u));let b=s.sample(ss(Tl.xy,ie(m,0).mul(e)).div(t));s.value.isArrayTexture&&(b=b.depth(n)),a.addAssign(b.x),l.addAssign(ss(b.y.mul(b.y),b.x.mul(b.x)))}),a.divAssign(i),l.divAssign(i);const d=Zs(l.sub(a.mul(a)).max(0));return ie(a,d)}),d6=[TD,SD,wD,MD];let Nx;const Wf=new Kg;class ED extends t6{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:s,shadowCoord:n,shadow:a,depthLayer:l}){const u=n.x.greaterThanEqual(0).and(n.x.lessThanEqual(1)).and(n.y.greaterThanEqual(0)).and(n.y.lessThanEqual(1)).and(n.z.lessThanEqual(1)),h=t({depthTexture:s,shadowCoord:n,shadow:a,depthLayer:l});return u.select(h,A(1))}setupShadowCoord(e,t){const{shadow:s}=this,{renderer:n}=e,a=s.biasNode||Rt("bias","float",s).setGroup(ve);let l=t,u;if(s.camera.isOrthographicCamera||n.logarithmicDepthBuffer!==!0)l=l.xyz.div(l.w),u=l.z;else{const h=l.w;l=l.xy.div(h);const d=Rt("near","float",s.camera).setGroup(ve),f=Rt("far","float",s.camera).setGroup(ve);u=cT(h.negate(),d,f)}return l=L(l.x,l.y.oneMinus(),n.reversedDepthBuffer?u.sub(a):u.add(a)),l}getShadowFilterFn(e){return d6[e]}setupRenderTarget(e,t){const s=new hi(e.mapSize.width,e.mapSize.height);s.name="ShadowDepthTexture",s.compareFunction=t.renderer.reversedDepthBuffer?Tg:vg;const n=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return n.texture.name="ShadowMap",n.texture.type=e.mapType,n.depthTexture=s,{shadowMap:n,depthTexture:s}}setupShadow(e){const{renderer:t,camera:s}=e,{light:n,shadow:a}=this,{depthTexture:l,shadowMap:u}=this.setupRenderTarget(a,e),h=t.shadowMap.type;if(h===kC||h===HF?(l.minFilter=Gs,l.magFilter=Gs):(l.minFilter=qt,l.magFilter=qt),a.camera.coordinateSystem=s.coordinateSystem,a.camera.updateProjectionMatrix(),h===Ih&&a.isPointLightShadow!==!0){l.compareFunction=null,u.depth>1?(u._vsmShadowMapVertical||(u._vsmShadowMapVertical=e.createRenderTarget(a.mapSize.width,a.mapSize.height,{format:Zi,type:Cs,depth:u.depth,depthBuffer:!1}),u._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=u._vsmShadowMapVertical,u._vsmShadowMapHorizontal||(u._vsmShadowMapHorizontal=e.createRenderTarget(a.mapSize.width,a.mapSize.height,{format:Zi,type:Cs,depth:u.depth,depthBuffer:!1}),u._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=u._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(a.mapSize.width,a.mapSize.height,{format:Zi,type:Cs,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(a.mapSize.width,a.mapSize.height,{format:Zi,type:Cs,depthBuffer:!1}));let R=st(l);l.isArrayTexture&&(R=R.depth(this.depthLayer));let E=st(this.vsmShadowMapVertical.texture);l.isArrayTexture&&(E=E.depth(this.depthLayer));const k=Rt("blurSamples","float",a).setGroup(ve),q=Rt("radius","float",a).setGroup(ve),D=Rt("mapSize","vec2",a).setGroup(ve);let I=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Ht);I.fragmentNode=c6({samples:k,radius:q,size:D,shadowPass:R,depthLayer:this.depthLayer}).context(e.getSharedContext()),I.name="VSMVertical",I=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Ht),I.fragmentNode=h6({samples:k,radius:q,size:D,shadowPass:E,depthLayer:this.depthLayer}).context(e.getSharedContext()),I.name="VSMHorizontal"}const d=Rt("intensity","float",a).setGroup(ve),f=Rt("normalBias","float",a).setGroup(ve),m=ty(n).mul(RT.add(So.mul(f))),b=this.setupShadowCoord(e,m),x=a.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(x===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const v=h===Ih&&a.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:l,T=this.setupShadowFilter(e,{filterFn:x,shadowTexture:u.texture,depthTexture:v,shadowCoord:b,shadow:a,depthLayer:this.depthLayer});let w;t.shadowMap.transmitted===!0&&(u.texture.isCubeTexture?w=Ys(u.texture,b.xyz):(w=st(u.texture,b),l.isArrayTexture&&(w=w.depth(this.depthLayer))));let N;w?N=qe(1,T.rgb.mix(w,1),d.mul(w.a)).toVar():N=qe(1,T,d).toVar(),this.shadowMap=u,this.shadow.map=u;const C=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return w&&N.toInspector(`${C} / Color`,()=>this.shadowMap.texture.isCubeTexture?Ys(this.shadowMap.texture):st(this.shadowMap.texture)),N.toInspector(`${C} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Ys(this.shadowMap.texture).r.oneMinus():kt(this.shadowMap.depthTexture,xt().mul(ho(st(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return P(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let s=this._node;return this.setupShadowPosition(e),s===null&&(this._node=s=this.setupShadow(e),this._currentShadowType=t),e.material.receivedShadowNode&&(s=e.material.receivedShadowNode(s)),s})()}renderShadow(e){const{shadow:t,shadowMap:s,light:n}=this,{renderer:a,scene:l}=e;t.updateMatrices(n),s.setSize(t.mapSize.width,t.mapSize.height,s.depth);const u=l.name;l.name=`Shadow Map [ ${n.name||"ID: "+n.id} ]`,a.render(l,t.camera),l.name=u}updateShadow(e){const{shadowMap:t,light:s,shadow:n}=this,{renderer:a,scene:l,camera:u}=e,h=a.shadowMap.type,d=t.depthTexture.version;this._depthVersionCached=d;const f=n.camera.layers.mask;(n.camera.layers.mask&4294967294)===0&&(n.camera.layers.mask=u.layers.mask);const m=a.getRenderObjectFunction(),b=a.getMRT(),x=b?b.has("velocity"):!1;Nx=l6(a,l,Nx),l.overrideMaterial=ND(s),a.setRenderObjectFunction(CD(a,n,h,x)),a.setClearColor(0,0),a.setRenderTarget(t),this.renderShadow(e),a.setRenderObjectFunction(m),h===Ih&&n.isPointLightShadow!==!0&&this.vsmPass(a),n.camera.layers.mask=f,u6(a,l,Nx)}vsmPass(e){const{shadow:t}=this,s=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,s),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,s),e.setRenderTarget(this.vsmShadowMapVertical),Wf.material=this.vsmMaterialVertical,Wf.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Wf.material=this.vsmMaterialHorizontal,Wf.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,AD(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let s=t.needsUpdate||t.autoUpdate;s&&(this._cameraFrameId[e.camera]===e.frameId&&(s=!1),this._cameraFrameId[e.camera]=e.frameId),s&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const RD=(i,e)=>new ED(i,e),p6=new it,UA=new Ze,Eh=new z,Ax=new z,f6=[new z(1,0,0),new z(-1,0,0),new z(0,-1,0),new z(0,1,0),new z(0,0,1),new z(0,0,-1)],m6=[new z(0,-1,0),new z(0,-1,0),new z(0,0,-1),new z(0,0,1),new z(0,-1,0),new z(0,-1,0)],g6=[new z(1,0,0),new z(-1,0,0),new z(0,1,0),new z(0,-1,0),new z(0,0,1),new z(0,0,-1)],y6=[new z(0,-1,0),new z(0,-1,0),new z(0,0,1),new z(0,0,-1),new z(0,-1,0),new z(0,-1,0)],BD=P(({depthTexture:i,bd3D:e,dp:t})=>Ys(i,e).compare(t)),DD=P(({depthTexture:i,bd3D:e,dp:t,shadow:s})=>{const n=Rt("radius","float",s).setGroup(ve),a=Rt("mapSize","vec2",s).setGroup(ve),l=n.div(a.x),u=At(e),h=fn(ia(e,u.x.greaterThan(u.z).select(L(0,1,0),L(1,0,0)))),d=ia(e,h),f=TT(Tl.xy).mul(6.28318530718),m=Ei(0,5,f),b=Ei(1,5,f),x=Ei(2,5,f),v=Ei(3,5,f),T=Ei(4,5,f);return Ys(i,e.add(h.mul(m.x).add(d.mul(m.y)).mul(l))).compare(t).add(Ys(i,e.add(h.mul(b.x).add(d.mul(b.y)).mul(l))).compare(t)).add(Ys(i,e.add(h.mul(x.x).add(d.mul(x.y)).mul(l))).compare(t)).add(Ys(i,e.add(h.mul(v.x).add(d.mul(v.y)).mul(l))).compare(t)).add(Ys(i,e.add(h.mul(T.x).add(d.mul(T.y)).mul(l))).compare(t)).mul(1/5)}),b6=P(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:s},n)=>{const a=t.xyz.toConst(),l=a.abs().toConst(),u=l.x.max(l.y).max(l.z),h=_e("float").setGroup(ve).onRenderUpdate(()=>s.camera.near),d=_e("float").setGroup(ve).onRenderUpdate(()=>s.camera.far),f=Rt("bias","float",s).setGroup(ve),m=A(1).toVar();return Me(u.sub(d).lessThanEqual(0).and(u.sub(h).greaterThanEqual(0)),()=>{let b;n.renderer.reversedDepthBuffer?(b=vB(u.negate(),h,d),b.subAssign(f)):(b=lT(u.negate(),h,d),b.addAssign(f));const x=a.normalize();m.assign(i({depthTexture:e,bd3D:x,dp:b,shadow:s}))}),m});class x6 extends ED{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===qF?BD:DD}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:s,shadowCoord:n,shadow:a}){return b6({filterFn:t,depthTexture:s,shadowCoord:n,shadow:a})}setupRenderTarget(e,t){const s=new cO(e.mapSize.width);s.name="PointShadowDepthTexture",s.compareFunction=t.renderer.reversedDepthBuffer?Tg:vg;const n=t.createCubeRenderTarget(e.mapSize.width);return n.texture.name="PointShadowMap",n.depthTexture=s,{shadowMap:n,depthTexture:s}}renderShadow(e){const{shadow:t,shadowMap:s,light:n}=this,{renderer:a,scene:l}=e,u=t.camera,h=t.matrix,d=a.coordinateSystem===pi,f=d?f6:g6,m=d?m6:y6;s.setSize(t.mapSize.width,t.mapSize.width);const b=a.autoClear,x=a.getClearColor(p6),v=a.getClearAlpha();a.autoClear=!1,a.setClearColor(t.clearColor,t.clearAlpha);for(let T=0;T<6;T++){a.setRenderTarget(s,T),a.clear();const w=n.distance||u.far;w!==u.far&&(u.far=w,u.updateProjectionMatrix()),Eh.setFromMatrixPosition(n.matrixWorld),u.position.copy(Eh),Ax.copy(u.position),Ax.add(f[T]),u.up.copy(m[T]),u.lookAt(Ax),u.updateMatrixWorld(),h.makeTranslation(-Eh.x,-Eh.y,-Eh.z),UA.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),t._frustum.setFromProjectionMatrix(UA,u.coordinateSystem,u.reversedDepth);const N=l.name;l.name=`Point Light Shadow [ ${n.name||"ID: "+n.id} ] - Face ${T+1}`,a.render(l,u),l.name=N}a.autoClear=b,a.setClearColor(x,v)}}const LD=(i,e)=>new x6(i,e);class Sl extends pc{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new it,this.colorNode=e&&e.colorNode||_e(this.color).setGroup(ve),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Re.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return AT(this.light).sub(e.context.positionView||Kt)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return RD(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let s=this.shadowColorNode;if(s===null){const n=this.light.shadow.shadowNode;let a;n!==void 0?a=ye(n):a=this.setupShadowNode(),this.shadowNode=a,this.shadowColorNode=s=this.colorNode.mul(a),this.baseColorNode=this.colorNode}e.context.getShadow&&(s=e.context.getShadow(this,e)),this.colorNode=s}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),s=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),s&&e.lightsNode.setupDirectRectAreaLight(e,this,s)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const BT=P(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const s=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(s.mul(i.div(e).pow4().oneMinus().clamp().pow2()),s)}),UD=({color:i,lightVector:e,cutoffDistance:t,decayExponent:s})=>{const n=e.normalize(),a=e.length(),l=BT({lightDistance:a,cutoffDistance:t,decayExponent:s}),u=i.mul(l);return{lightDirection:n,lightColor:u}};class _6 extends Sl{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=_e(0).setGroup(ve),this.decayExponentNode=_e(2).setGroup(ve)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return LD(this.light)}setupDirect(e){return UD({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const v6=P(([i=xt()])=>{const e=i.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()}),T6=P(([i=xt()],{renderer:e,material:t})=>{const s=Vv(i.mul(2).sub(1));let n;if(t.alphaToCoverage&&e.currentSamples>0){const a=A(s.fwidth()).toVar();n=Ui(a.oneMinus(),a.add(1),s).oneMinus()}else n=zs(s.greaterThan(1),0,1);return n}),Jh=P(([i,e,t])=>{const s=A(t).toVar(),n=A(e).toVar(),a=mi(i).toVar();return zs(a,n,s)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),ag=P(([i,e])=>{const t=mi(e).toVar(),s=A(i).toVar();return zs(t,s.negate(),s)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),ts=P(([i])=>{const e=A(i).toVar();return B(nr(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Ft=P(([i,e])=>{const t=A(i).toVar();return e.assign(ts(t)),t.sub(A(e))}),S6=P(([i,e,t,s,n,a])=>{const l=A(a).toVar(),u=A(n).toVar(),h=A(s).toVar(),d=A(t).toVar(),f=A(e).toVar(),m=A(i).toVar(),b=A($e(1,u)).toVar();return $e(1,l).mul(m.mul(b).add(f.mul(u))).add(l.mul(d.mul(b).add(h.mul(u))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),w6=P(([i,e,t,s,n,a])=>{const l=A(a).toVar(),u=A(n).toVar(),h=L(s).toVar(),d=L(t).toVar(),f=L(e).toVar(),m=L(i).toVar(),b=A($e(1,u)).toVar();return $e(1,l).mul(m.mul(b).add(f.mul(u))).add(l.mul(d.mul(b).add(h.mul(u))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),FD=Bs([S6,w6]),M6=P(([i,e,t,s,n,a,l,u,h,d,f])=>{const m=A(f).toVar(),b=A(d).toVar(),x=A(h).toVar(),v=A(u).toVar(),T=A(l).toVar(),w=A(a).toVar(),N=A(n).toVar(),C=A(s).toVar(),R=A(t).toVar(),E=A(e).toVar(),k=A(i).toVar(),q=A($e(1,x)).toVar(),D=A($e(1,b)).toVar();return A($e(1,m)).toVar().mul(D.mul(k.mul(q).add(E.mul(x))).add(b.mul(R.mul(q).add(C.mul(x))))).add(m.mul(D.mul(N.mul(q).add(w.mul(x))).add(b.mul(T.mul(q).add(v.mul(x))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),N6=P(([i,e,t,s,n,a,l,u,h,d,f])=>{const m=A(f).toVar(),b=A(d).toVar(),x=A(h).toVar(),v=L(u).toVar(),T=L(l).toVar(),w=L(a).toVar(),N=L(n).toVar(),C=L(s).toVar(),R=L(t).toVar(),E=L(e).toVar(),k=L(i).toVar(),q=A($e(1,x)).toVar(),D=A($e(1,b)).toVar();return A($e(1,m)).toVar().mul(D.mul(k.mul(q).add(E.mul(x))).add(b.mul(R.mul(q).add(C.mul(x))))).add(m.mul(D.mul(N.mul(q).add(w.mul(x))).add(b.mul(T.mul(q).add(v.mul(x))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),PD=Bs([M6,N6]),A6=P(([i,e,t])=>{const s=A(t).toVar(),n=A(e).toVar(),a=se(i).toVar(),l=se(a.bitAnd(se(7))).toVar(),u=A(Jh(l.lessThan(se(4)),n,s)).toVar(),h=A(Be(2,Jh(l.lessThan(se(4)),s,n))).toVar();return ag(u,mi(l.bitAnd(se(1)))).add(ag(h,mi(l.bitAnd(se(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),C6=P(([i,e,t,s])=>{const n=A(s).toVar(),a=A(t).toVar(),l=A(e).toVar(),u=se(i).toVar(),h=se(u.bitAnd(se(15))).toVar(),d=A(Jh(h.lessThan(se(8)),l,a)).toVar(),f=A(Jh(h.lessThan(se(4)),a,Jh(h.equal(se(12)).or(h.equal(se(14))),l,n))).toVar();return ag(d,mi(h.bitAnd(se(1)))).add(ag(f,mi(h.bitAnd(se(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),_s=Bs([A6,C6]),E6=P(([i,e,t])=>{const s=A(t).toVar(),n=A(e).toVar(),a=vl(i).toVar();return L(_s(a.x,n,s),_s(a.y,n,s),_s(a.z,n,s))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),R6=P(([i,e,t,s])=>{const n=A(s).toVar(),a=A(t).toVar(),l=A(e).toVar(),u=vl(i).toVar();return L(_s(u.x,l,a,n),_s(u.y,l,a,n),_s(u.z,l,a,n))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),ni=Bs([E6,R6]),B6=P(([i])=>{const e=A(i).toVar();return Be(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),D6=P(([i])=>{const e=A(i).toVar();return Be(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),L6=P(([i])=>{const e=L(i).toVar();return Be(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),OD=Bs([B6,L6]),U6=P(([i])=>{const e=L(i).toVar();return Be(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),VD=Bs([D6,U6]),Fn=P(([i,e])=>{const t=B(e).toVar(),s=se(i).toVar();return s.shiftLeft(t).bitOr(s.shiftRight(B(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),zD=P(([i,e,t])=>{i.subAssign(t),i.bitXorAssign(Fn(t,B(4))),t.addAssign(e),e.subAssign(i),e.bitXorAssign(Fn(i,B(6))),i.addAssign(t),t.subAssign(e),t.bitXorAssign(Fn(e,B(8))),e.addAssign(i),i.subAssign(t),i.bitXorAssign(Fn(t,B(16))),t.addAssign(e),e.subAssign(i),e.bitXorAssign(Fn(i,B(19))),i.addAssign(t),t.subAssign(e),t.bitXorAssign(Fn(e,B(4))),e.addAssign(i)}),Ad=P(([i,e,t])=>{const s=se(t).toVar(),n=se(e).toVar(),a=se(i).toVar();return s.bitXorAssign(n),s.subAssign(Fn(n,B(14))),a.bitXorAssign(s),a.subAssign(Fn(s,B(11))),n.bitXorAssign(a),n.subAssign(Fn(a,B(25))),s.bitXorAssign(n),s.subAssign(Fn(n,B(16))),a.bitXorAssign(s),a.subAssign(Fn(s,B(4))),n.bitXorAssign(a),n.subAssign(Fn(a,B(14))),s.bitXorAssign(n),s.subAssign(Fn(n,B(24))),s}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),ks=P(([i])=>{const e=se(i).toVar();return A(e).div(A(se(B(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),lr=P(([i])=>{const e=A(i).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),F6=P(([i])=>{const e=B(i).toVar(),t=se(se(1)).toVar(),s=se(se(B(3735928559)).add(t.shiftLeft(se(2))).add(se(13))).toVar();return Ad(s.add(se(e)),s,s)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),P6=P(([i,e])=>{const t=B(e).toVar(),s=B(i).toVar(),n=se(se(2)).toVar(),a=se().toVar(),l=se().toVar(),u=se().toVar();return a.assign(l.assign(u.assign(se(B(3735928559)).add(n.shiftLeft(se(2))).add(se(13))))),a.addAssign(se(s)),l.addAssign(se(t)),Ad(a,l,u)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),O6=P(([i,e,t])=>{const s=B(t).toVar(),n=B(e).toVar(),a=B(i).toVar(),l=se(se(3)).toVar(),u=se().toVar(),h=se().toVar(),d=se().toVar();return u.assign(h.assign(d.assign(se(B(3735928559)).add(l.shiftLeft(se(2))).add(se(13))))),u.addAssign(se(a)),h.addAssign(se(n)),d.addAssign(se(s)),Ad(u,h,d)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),V6=P(([i,e,t,s])=>{const n=B(s).toVar(),a=B(t).toVar(),l=B(e).toVar(),u=B(i).toVar(),h=se(se(4)).toVar(),d=se().toVar(),f=se().toVar(),m=se().toVar();return d.assign(f.assign(m.assign(se(B(3735928559)).add(h.shiftLeft(se(2))).add(se(13))))),d.addAssign(se(u)),f.addAssign(se(l)),m.addAssign(se(a)),zD(d,f,m),d.addAssign(se(n)),Ad(d,f,m)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),z6=P(([i,e,t,s,n])=>{const a=B(n).toVar(),l=B(s).toVar(),u=B(t).toVar(),h=B(e).toVar(),d=B(i).toVar(),f=se(se(5)).toVar(),m=se().toVar(),b=se().toVar(),x=se().toVar();return m.assign(b.assign(x.assign(se(B(3735928559)).add(f.shiftLeft(se(2))).add(se(13))))),m.addAssign(se(d)),b.addAssign(se(h)),x.addAssign(se(u)),zD(m,b,x),m.addAssign(se(l)),b.addAssign(se(a)),Ad(m,b,x)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),yt=Bs([F6,P6,O6,V6,z6]),I6=P(([i,e])=>{const t=B(e).toVar(),s=B(i).toVar(),n=se(yt(s,t)).toVar(),a=vl().toVar();return a.x.assign(n.bitAnd(B(255))),a.y.assign(n.shiftRight(B(8)).bitAnd(B(255))),a.z.assign(n.shiftRight(B(16)).bitAnd(B(255))),a}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),k6=P(([i,e,t])=>{const s=B(t).toVar(),n=B(e).toVar(),a=B(i).toVar(),l=se(yt(a,n,s)).toVar(),u=vl().toVar();return u.x.assign(l.bitAnd(B(255))),u.y.assign(l.shiftRight(B(8)).bitAnd(B(255))),u.z.assign(l.shiftRight(B(16)).bitAnd(B(255))),u}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),ii=Bs([I6,k6]),G6=P(([i])=>{const e=ie(i).toVar(),t=B().toVar(),s=B().toVar(),n=A(Ft(e.x,t)).toVar(),a=A(Ft(e.y,s)).toVar(),l=A(lr(n)).toVar(),u=A(lr(a)).toVar(),h=A(FD(_s(yt(t,s),n,a),_s(yt(t.add(B(1)),s),n.sub(1),a),_s(yt(t,s.add(B(1))),n,a.sub(1)),_s(yt(t.add(B(1)),s.add(B(1))),n.sub(1),a.sub(1)),l,u)).toVar();return OD(h)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),q6=P(([i])=>{const e=L(i).toVar(),t=B().toVar(),s=B().toVar(),n=B().toVar(),a=A(Ft(e.x,t)).toVar(),l=A(Ft(e.y,s)).toVar(),u=A(Ft(e.z,n)).toVar(),h=A(lr(a)).toVar(),d=A(lr(l)).toVar(),f=A(lr(u)).toVar(),m=A(PD(_s(yt(t,s,n),a,l,u),_s(yt(t.add(B(1)),s,n),a.sub(1),l,u),_s(yt(t,s.add(B(1)),n),a,l.sub(1),u),_s(yt(t.add(B(1)),s.add(B(1)),n),a.sub(1),l.sub(1),u),_s(yt(t,s,n.add(B(1))),a,l,u.sub(1)),_s(yt(t.add(B(1)),s,n.add(B(1))),a.sub(1),l,u.sub(1)),_s(yt(t,s.add(B(1)),n.add(B(1))),a,l.sub(1),u.sub(1)),_s(yt(t.add(B(1)),s.add(B(1)),n.add(B(1))),a.sub(1),l.sub(1),u.sub(1)),h,d,f)).toVar();return VD(m)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),DT=Bs([G6,q6]),H6=P(([i])=>{const e=ie(i).toVar(),t=B().toVar(),s=B().toVar(),n=A(Ft(e.x,t)).toVar(),a=A(Ft(e.y,s)).toVar(),l=A(lr(n)).toVar(),u=A(lr(a)).toVar(),h=L(FD(ni(ii(t,s),n,a),ni(ii(t.add(B(1)),s),n.sub(1),a),ni(ii(t,s.add(B(1))),n,a.sub(1)),ni(ii(t.add(B(1)),s.add(B(1))),n.sub(1),a.sub(1)),l,u)).toVar();return OD(h)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),j6=P(([i])=>{const e=L(i).toVar(),t=B().toVar(),s=B().toVar(),n=B().toVar(),a=A(Ft(e.x,t)).toVar(),l=A(Ft(e.y,s)).toVar(),u=A(Ft(e.z,n)).toVar(),h=A(lr(a)).toVar(),d=A(lr(l)).toVar(),f=A(lr(u)).toVar(),m=L(PD(ni(ii(t,s,n),a,l,u),ni(ii(t.add(B(1)),s,n),a.sub(1),l,u),ni(ii(t,s.add(B(1)),n),a,l.sub(1),u),ni(ii(t.add(B(1)),s.add(B(1)),n),a.sub(1),l.sub(1),u),ni(ii(t,s,n.add(B(1))),a,l,u.sub(1)),ni(ii(t.add(B(1)),s,n.add(B(1))),a.sub(1),l,u.sub(1)),ni(ii(t,s.add(B(1)),n.add(B(1))),a,l.sub(1),u.sub(1)),ni(ii(t.add(B(1)),s.add(B(1)),n.add(B(1))),a.sub(1),l.sub(1),u.sub(1)),h,d,f)).toVar();return VD(m)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Cd=Bs([H6,j6]),$6=P(([i])=>{const e=A(i).toVar(),t=B(ts(e)).toVar();return ks(yt(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),W6=P(([i])=>{const e=ie(i).toVar(),t=B(ts(e.x)).toVar(),s=B(ts(e.y)).toVar();return ks(yt(t,s))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),X6=P(([i])=>{const e=L(i).toVar(),t=B(ts(e.x)).toVar(),s=B(ts(e.y)).toVar(),n=B(ts(e.z)).toVar();return ks(yt(t,s,n))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Y6=P(([i])=>{const e=Se(i).toVar(),t=B(ts(e.x)).toVar(),s=B(ts(e.y)).toVar(),n=B(ts(e.z)).toVar(),a=B(ts(e.w)).toVar();return ks(yt(t,s,n,a))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),K6=Bs([$6,W6,X6,Y6]),Z6=P(([i])=>{const e=A(i).toVar(),t=B(ts(e)).toVar();return L(ks(yt(t,B(0))),ks(yt(t,B(1))),ks(yt(t,B(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Q6=P(([i])=>{const e=ie(i).toVar(),t=B(ts(e.x)).toVar(),s=B(ts(e.y)).toVar();return L(ks(yt(t,s,B(0))),ks(yt(t,s,B(1))),ks(yt(t,s,B(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),J6=P(([i])=>{const e=L(i).toVar(),t=B(ts(e.x)).toVar(),s=B(ts(e.y)).toVar(),n=B(ts(e.z)).toVar();return L(ks(yt(t,s,n,B(0))),ks(yt(t,s,n,B(1))),ks(yt(t,s,n,B(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),e8=P(([i])=>{const e=Se(i).toVar(),t=B(ts(e.x)).toVar(),s=B(ts(e.y)).toVar(),n=B(ts(e.z)).toVar(),a=B(ts(e.w)).toVar();return L(ks(yt(t,s,n,a,B(0))),ks(yt(t,s,n,a,B(1))),ks(yt(t,s,n,a,B(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),sy=Bs([Z6,Q6,J6,e8]),og=P(([i,e,t,s])=>{const n=A(s).toVar(),a=A(t).toVar(),l=B(e).toVar(),u=L(i).toVar(),h=A(0).toVar(),d=A(1).toVar();return mt(l,()=>{h.addAssign(d.mul(DT(u))),d.mulAssign(n),u.mulAssign(a)}),h}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ny=P(([i,e,t,s])=>{const n=A(s).toVar(),a=A(t).toVar(),l=B(e).toVar(),u=L(i).toVar(),h=L(0).toVar(),d=A(1).toVar();return mt(l,()=>{h.addAssign(d.mul(Cd(u))),d.mulAssign(n),u.mulAssign(a)}),h}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),t8=P(([i,e,t,s])=>{const n=A(s).toVar(),a=A(t).toVar(),l=B(e).toVar(),u=L(i).toVar();return ie(og(u,l,a,n),og(u.add(L(B(19),B(193),B(17))),l,a,n))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),s8=P(([i,e,t,s])=>{const n=A(s).toVar(),a=A(t).toVar(),l=B(e).toVar(),u=L(i).toVar(),h=L(ny(u,l,a,n)).toVar(),d=A(og(u.add(L(B(19),B(193),B(17))),l,a,n)).toVar();return Se(h,d)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),n8=P(([i,e,t,s,n,a,l])=>{const u=B(l).toVar(),h=A(a).toVar(),d=B(n).toVar(),f=B(s).toVar(),m=B(t).toVar(),b=B(e).toVar(),x=ie(i).toVar(),v=L(sy(ie(b.add(f),m.add(d)))).toVar(),T=ie(v.x,v.y).toVar();T.subAssign(.5),T.mulAssign(h),T.addAssign(.5);const w=ie(ie(A(b),A(m)).add(T)).toVar(),N=ie(w.sub(x)).toVar();return Me(u.equal(B(2)),()=>At(N.x).add(At(N.y))),Me(u.equal(B(3)),()=>zt(At(N.x),At(N.y))),gi(N,N)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),i8=P(([i,e,t,s,n,a,l,u,h])=>{const d=B(h).toVar(),f=A(u).toVar(),m=B(l).toVar(),b=B(a).toVar(),x=B(n).toVar(),v=B(s).toVar(),T=B(t).toVar(),w=B(e).toVar(),N=L(i).toVar(),C=L(sy(L(w.add(x),T.add(b),v.add(m)))).toVar();C.subAssign(.5),C.mulAssign(f),C.addAssign(.5);const R=L(L(A(w),A(T),A(v)).add(C)).toVar(),E=L(R.sub(N)).toVar();return Me(d.equal(B(2)),()=>At(E.x).add(At(E.y)).add(At(E.z))),Me(d.equal(B(3)),()=>zt(At(E.x),At(E.y),At(E.z))),gi(E,E)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),mc=Bs([n8,i8]),r8=P(([i,e,t])=>{const s=B(t).toVar(),n=A(e).toVar(),a=ie(i).toVar(),l=B().toVar(),u=B().toVar(),h=ie(Ft(a.x,l),Ft(a.y,u)).toVar(),d=A(1e6).toVar();return mt({start:-1,end:B(1),name:"x",condition:"<="},({x:f})=>{mt({start:-1,end:B(1),name:"y",condition:"<="},({y:m})=>{const b=A(mc(h,f,m,l,u,n,s)).toVar();d.assign(mn(d,b))})}),Me(s.equal(B(0)),()=>{d.assign(Zs(d))}),d}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),a8=P(([i,e,t])=>{const s=B(t).toVar(),n=A(e).toVar(),a=ie(i).toVar(),l=B().toVar(),u=B().toVar(),h=ie(Ft(a.x,l),Ft(a.y,u)).toVar(),d=ie(1e6,1e6).toVar();return mt({start:-1,end:B(1),name:"x",condition:"<="},({x:f})=>{mt({start:-1,end:B(1),name:"y",condition:"<="},({y:m})=>{const b=A(mc(h,f,m,l,u,n,s)).toVar();Me(b.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(b)}).ElseIf(b.lessThan(d.y),()=>{d.y.assign(b)})})}),Me(s.equal(B(0)),()=>{d.assign(Zs(d))}),d}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),o8=P(([i,e,t])=>{const s=B(t).toVar(),n=A(e).toVar(),a=ie(i).toVar(),l=B().toVar(),u=B().toVar(),h=ie(Ft(a.x,l),Ft(a.y,u)).toVar(),d=L(1e6,1e6,1e6).toVar();return mt({start:-1,end:B(1),name:"x",condition:"<="},({x:f})=>{mt({start:-1,end:B(1),name:"y",condition:"<="},({y:m})=>{const b=A(mc(h,f,m,l,u,n,s)).toVar();Me(b.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(b)}).ElseIf(b.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(b)}).ElseIf(b.lessThan(d.z),()=>{d.z.assign(b)})})}),Me(s.equal(B(0)),()=>{d.assign(Zs(d))}),d}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),l8=P(([i,e,t])=>{const s=B(t).toVar(),n=A(e).toVar(),a=L(i).toVar(),l=B().toVar(),u=B().toVar(),h=B().toVar(),d=L(Ft(a.x,l),Ft(a.y,u),Ft(a.z,h)).toVar(),f=A(1e6).toVar();return mt({start:-1,end:B(1),name:"x",condition:"<="},({x:m})=>{mt({start:-1,end:B(1),name:"y",condition:"<="},({y:b})=>{mt({start:-1,end:B(1),name:"z",condition:"<="},({z:x})=>{const v=A(mc(d,m,b,x,l,u,h,n,s)).toVar();f.assign(mn(f,v))})})}),Me(s.equal(B(0)),()=>{f.assign(Zs(f))}),f}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),u8=Bs([r8,l8]),c8=P(([i,e,t])=>{const s=B(t).toVar(),n=A(e).toVar(),a=L(i).toVar(),l=B().toVar(),u=B().toVar(),h=B().toVar(),d=L(Ft(a.x,l),Ft(a.y,u),Ft(a.z,h)).toVar(),f=ie(1e6,1e6).toVar();return mt({start:-1,end:B(1),name:"x",condition:"<="},({x:m})=>{mt({start:-1,end:B(1),name:"y",condition:"<="},({y:b})=>{mt({start:-1,end:B(1),name:"z",condition:"<="},({z:x})=>{const v=A(mc(d,m,b,x,l,u,h,n,s)).toVar();Me(v.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(v)}).ElseIf(v.lessThan(f.y),()=>{f.y.assign(v)})})})}),Me(s.equal(B(0)),()=>{f.assign(Zs(f))}),f}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),h8=Bs([a8,c8]),d8=P(([i,e,t])=>{const s=B(t).toVar(),n=A(e).toVar(),a=L(i).toVar(),l=B().toVar(),u=B().toVar(),h=B().toVar(),d=L(Ft(a.x,l),Ft(a.y,u),Ft(a.z,h)).toVar(),f=L(1e6,1e6,1e6).toVar();return mt({start:-1,end:B(1),name:"x",condition:"<="},({x:m})=>{mt({start:-1,end:B(1),name:"y",condition:"<="},({y:b})=>{mt({start:-1,end:B(1),name:"z",condition:"<="},({z:x})=>{const v=A(mc(d,m,b,x,l,u,h,n,s)).toVar();Me(v.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(v)}).ElseIf(v.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(v)}).ElseIf(v.lessThan(f.z),()=>{f.z.assign(v)})})})}),Me(s.equal(B(0)),()=>{f.assign(Zs(f))}),f}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),LT=Bs([o8,d8]),p8=P(([i,e,t,s,n,a,l,u,h,d,f])=>{const m=B(i).toVar(),b=ie(e).toVar(),x=ie(t).toVar(),v=ie(s).toVar(),T=A(n).toVar(),w=A(a).toVar(),N=A(l).toVar(),C=mi(u).toVar(),R=B(h).toVar(),E=A(d).toVar(),k=A(f).toVar(),q=b.mul(x).add(v),D=A(0).toVar();return Me(m.equal(B(0)),()=>{D.assign(Cd(q))}),Me(m.equal(B(1)),()=>{D.assign(sy(q))}),Me(m.equal(B(2)),()=>{D.assign(LT(q,T,B(0)))}),Me(m.equal(B(3)),()=>{D.assign(ny(L(q,0),R,E,k))}),D.assign(D.mul(N.sub(w)).add(w)),Me(C,()=>{D.assign(Li(D,w,N))}),D}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),f8=P(([i,e,t,s,n,a,l,u,h,d,f])=>{const m=B(i).toVar(),b=L(e).toVar(),x=L(t).toVar(),v=L(s).toVar(),T=A(n).toVar(),w=A(a).toVar(),N=A(l).toVar(),C=mi(u).toVar(),R=B(h).toVar(),E=A(d).toVar(),k=A(f).toVar(),q=b.mul(x).add(v),D=A(0).toVar();return Me(m.equal(B(0)),()=>{D.assign(Cd(q))}),Me(m.equal(B(1)),()=>{D.assign(sy(q))}),Me(m.equal(B(2)),()=>{D.assign(LT(q,T,B(0)))}),Me(m.equal(B(3)),()=>{D.assign(ny(q,R,E,k))}),D.assign(D.mul(N.sub(w)).add(w)),Me(C,()=>{D.assign(Li(D,w,N))}),D}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),m8=P(([i])=>{const e=i.y,t=i.z,s=L().toVar();return Me(e.lessThan(1e-4),()=>{s.assign(L(t,t,t))}).Else(()=>{let n=i.x;n=n.sub(nr(n)).mul(6).toVar();const a=B(Uv(n)),l=n.sub(A(a)),u=t.mul(e.oneMinus()),h=t.mul(e.mul(l).oneMinus()),d=t.mul(e.mul(l.oneMinus()).oneMinus());Me(a.equal(B(0)),()=>{s.assign(L(t,d,u))}).ElseIf(a.equal(B(1)),()=>{s.assign(L(h,t,u))}).ElseIf(a.equal(B(2)),()=>{s.assign(L(u,t,d))}).ElseIf(a.equal(B(3)),()=>{s.assign(L(u,h,t))}).ElseIf(a.equal(B(4)),()=>{s.assign(L(d,u,t))}).Else(()=>{s.assign(L(t,u,h))})}),s}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),g8=P(([i])=>{const e=L(i).toVar(),t=A(e.x).toVar(),s=A(e.y).toVar(),n=A(e.z).toVar(),a=A(mn(t,mn(s,n))).toVar(),l=A(zt(t,zt(s,n))).toVar(),u=A(l.sub(a)).toVar(),h=A().toVar(),d=A().toVar(),f=A().toVar();return f.assign(l),Me(l.greaterThan(0),()=>{d.assign(u.div(l))}).Else(()=>{d.assign(0)}),Me(d.lessThanEqual(0),()=>{h.assign(0)}).Else(()=>{Me(t.greaterThanEqual(l),()=>{h.assign(s.sub(n).div(u))}).ElseIf(s.greaterThanEqual(l),()=>{h.assign(ss(2,n.sub(t).div(u)))}).Else(()=>{h.assign(ss(4,t.sub(s).div(u)))}),h.mulAssign(1/6),Me(h.lessThan(0),()=>{h.addAssign(1)})}),L(h,d,f)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),y8=P(([i])=>{const e=L(i).toVar(),t=gv(wv(e,L(.04045))).toVar(),s=L(e.div(12.92)).toVar(),n=L(oi(zt(e.add(L(.055)),L(0)).div(1.055),L(2.4))).toVar();return qe(s,n,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ID=(i,e)=>{i=A(i),e=A(e);const t=ie(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Ui(i.sub(t),i.add(t),e)},kD=(i,e,t,s)=>qe(i,e,t[s].clamp()),b8=(i,e,t=xt())=>kD(i,e,t,"x"),x8=(i,e,t=xt())=>kD(i,e,t,"y"),_8=(i,e,t,s,n=xt())=>{const a=n.x.clamp(),l=n.y.clamp(),u=qe(i,e,a),h=qe(t,s,a);return qe(u,h,l)},GD=(i,e,t,s,n)=>qe(i,e,ID(t,s[n])),v8=(i,e,t,s=xt())=>GD(i,e,t,s,"x"),T8=(i,e,t,s=xt())=>GD(i,e,t,s,"y"),S8=(i=1,e=0,t=xt())=>t.mul(i).add(e),w8=(i,e=1)=>(i=A(i),i.abs().pow(e).mul(i.sign())),M8=(i,e=1,t=.5)=>A(i).sub(t).mul(e).add(t),N8=(i=xt(),e=1,t=0)=>DT(i.convert("vec2|vec3")).mul(e).add(t),A8=(i=xt(),e=1,t=0)=>Cd(i.convert("vec2|vec3")).mul(e).add(t),C8=(i=xt(),e=1,t=0)=>(i=i.convert("vec2|vec3"),Se(Cd(i),DT(i.add(ie(19,73)))).mul(e).add(t)),E8=(i,e=xt(),t=ie(1,1),s=ie(0,0),n=1,a=0,l=1,u=!1,h=1,d=2,f=.5)=>p8(i,e.convert("vec2|vec3"),t,s,n,a,l,u,h,d,f),R8=(i,e=xt(),t=ie(1,1),s=ie(0,0),n=1,a=0,l=1,u=!1,h=1,d=2,f=.5)=>f8(i,e.convert("vec2|vec3"),t,s,n,a,l,u,h,d,f),B8=(i=xt(),e=1)=>u8(i.convert("vec2|vec3"),e,B(1)),D8=(i=xt(),e=1)=>h8(i.convert("vec2|vec3"),e,B(1)),L8=(i=xt(),e=1)=>LT(i.convert("vec2|vec3"),e,B(1)),U8=(i=xt())=>K6(i.convert("vec2|vec3")),F8=(i=xt(),e=3,t=2,s=.5,n=1)=>og(i,B(e),t,s).mul(n),P8=(i=xt(),e=3,t=2,s=.5,n=1)=>t8(i,B(e),t,s).mul(n),O8=(i=xt(),e=3,t=2,s=.5,n=1)=>ny(i,B(e),t,s).mul(n),V8=(i=xt(),e=3,t=2,s=.5,n=1)=>s8(i,B(e),t,s).mul(n),z8=(i,e=A(0))=>ss(i,e),I8=(i,e=A(0))=>$e(i,e),k8=(i,e=A(1))=>Be(i,e),G8=(i,e=A(1))=>kn(i,e),q8=(i,e=A(1))=>vd(i,e),H8=(i,e=A(1))=>oi(i,e),j8=(i=A(0),e=A(1))=>Ev(i,e),$8=()=>fc,W8=()=>sD,X8=(i,e=A(1))=>$e(e,i),Y8=(i,e,t,s)=>i.greaterThan(e).mix(t,s),K8=(i,e,t,s)=>i.greaterThanEqual(e).mix(t,s),Z8=(i,e,t,s)=>i.equal(e).mix(t,s),Q8=(i,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},s=e.replace(/^out/,"").toLowerCase();if(t[s]!==void 0)return i.element(t[s])}if(typeof e=="number")return i.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return i.element(t[e])}return i},J8=(i,e=ie(.5,.5),t=ie(1,1),s=A(0),n=ie(0,0))=>{let a=i;if(e&&(a=a.sub(e)),t&&(a=a.mul(t)),s){const l=s.mul(Math.PI/180),u=l.cos(),h=l.sin();a=ie(a.x.mul(u).sub(a.y.mul(h)),a.x.mul(h).add(a.y.mul(u)))}return e&&(a=a.add(e)),n&&(a=a.add(n)),a},e9=(i,e)=>{i=ie(i),e=A(e);const t=e.mul(Math.PI/180);return wd(i,t)},t9=(i,e,t)=>{i=L(i),e=A(e),t=L(t);const s=e.mul(Math.PI/180),n=t.normalize(),a=s.cos(),l=s.sin(),u=A(1).sub(a);return i.mul(a).add(n.cross(i).mul(l)).add(n.mul(n.dot(i)).mul(u))},s9=(i,e)=>(i=L(i),e=A(e),nT(i,e)),n9=P(([i,e,t])=>{const s=fn(i).toVar(),n=$e(A(.5).mul(e.sub(t)),ar).div(s).toVar(),a=$e(A(-.5).mul(e.sub(t)),ar).div(s).toVar(),l=L().toVar();l.x=s.x.greaterThan(A(0)).select(n.x,a.x),l.y=s.y.greaterThan(A(0)).select(n.y,a.y),l.z=s.z.greaterThan(A(0)).select(n.z,a.z);const u=mn(l.x,l.y,l.z).toVar();return ar.add(s.mul(u)).toVar().sub(t)}),qD=P(([i,e])=>{const t=i.x,s=i.y,n=i.z;let a=e.element(0).mul(.886227);return a=a.add(e.element(1).mul(2*.511664).mul(s)),a=a.add(e.element(2).mul(2*.511664).mul(n)),a=a.add(e.element(3).mul(2*.511664).mul(t)),a=a.add(e.element(4).mul(2*.429043).mul(t).mul(s)),a=a.add(e.element(5).mul(2*.429043).mul(s).mul(n)),a=a.add(e.element(6).mul(n.mul(n).mul(.743125).sub(.247708))),a=a.add(e.element(7).mul(2*.429043).mul(t).mul(n)),a=a.add(e.element(8).mul(.429043).mul(Be(t,t).sub(Be(s,s)))),a});var _=Object.freeze({__proto__:null,BRDF_GGX:mT,BRDF_Lambert:fl,BasicPointShadowFilter:BD,BasicShadowFilter:TD,Break:yB,Const:UR,Continue:Zz,DFGLUT:ud,D_GGX:LB,Discard:KR,EPSILON:Mv,F_Schlick:uc,Fn:P,HALF_PI:wV,INFINITY:vV,If:Me,Loop:mt,NodeAccess:Es,NodeShaderStage:Oh,NodeType:HO,NodeUpdateType:Re,OnBeforeMaterialUpdate:gG,OnBeforeObjectUpdate:mG,OnMaterialUpdate:fG,OnObjectUpdate:pG,PCFShadowFilter:SD,PCFSoftShadowFilter:wD,PI:eg,PI2:TV,PointShadowFilter:DD,Return:IV,Schlick_to_F0:T_,ShaderNode:zu,Stack:Bg,Switch:dV,TBNViewMatrix:ll,TWO_PI:SV,VSMShadowFilter:MD,V_GGX_SmithCorrelated:DB,Var:LR,VarIntent:FR,abs:At,acesFilmicToneMapping:pD,acos:Cv,add:ss,addMethodChaining:Z,addNodeElement:HV,agxToneMapping:fD,all:aR,alphaT:Zm,and:jE,anisotropy:Za,anisotropyB:cl,anisotropyT:Yh,any:oR,append:gV,array:OE,arrayBuffer:fV,asin:hR,assign:VE,atan:Ev,atomicAdd:_5,atomicAnd:w5,atomicFunc:fr,atomicLoad:b5,atomicMax:T5,atomicMin:S5,atomicOr:M5,atomicStore:x5,atomicSub:v5,atomicXor:N5,attenuationColor:vv,attenuationDistance:_v,attribute:ra,attributeArray:xG,backgroundBlurriness:rD,backgroundIntensity:A_,backgroundRotation:aD,batch:fB,bentNormalView:R2,billboarding:Z4,bitAnd:YE,bitNot:KE,bitOr:ZE,bitXor:QE,bitangentGeometry:Rz,bitangentLocal:Bz,bitangentView:C2,bitangentWorld:Dz,bitcast:eD,blendBurn:gI,blendColor:_I,blendDodge:yI,blendOverlay:xI,blendScreen:bI,blur:IB,bool:mi,buffer:Td,bufferAttribute:jv,builtin:ha,builtinAOContext:BR,builtinShadowContext:RR,bumpMap:nT,bvec2:RE,bvec3:gv,bvec4:BE,bypass:$R,cache:jR,call:zE,cameraFar:to,cameraIndex:vo,cameraNear:eo,cameraNormalMatrix:iz,cameraPosition:a2,cameraProjectionMatrix:ea,cameraProjectionMatrixInverse:r2,cameraViewMatrix:xi,cameraViewport:rz,cameraWorldMatrix:nz,cbrt:SR,cdl:OG,ceil:Pg,checker:v6,cineonToneMapping:dD,clamp:Li,clearcoat:Xm,clearcoatNormalView:so,clearcoatRoughness:$u,clipSpace:u2,code:Jg,color:EE,colorSpaceToWorking:Vg,colorToDirection:Uz,compute:HR,computeKernel:$v,computeSkinning:Yz,context:ca,convert:LE,convertColorSpace:BV,convertToTexture:lG,cos:Ai,countLeadingZeros:A4,countOneBits:C4,countTrailingZeros:N4,cross:ia,cubeTexture:Ys,cubeTextureBase:sT,dFdx:Dv,dFdy:Lv,dashSize:im,debug:QR,decrement:iR,decrementBefore:sR,defaultBuildStages:o_,defaultShaderStages:SE,defined:ad,degrees:uR,deltaTime:q4,densityFogFactor:xD,depth:hT,depthPass:qG,determinant:gR,difference:_R,diffuseColor:pt,diffuseContribution:sl,directPointLight:UD,directionToColor:B2,directionToFaceDirection:dc,dispersion:Tv,disposeShadowMaterial:AD,distance:xR,div:kn,dot:gi,drawIndex:hB,dynamicBufferAttribute:PV,element:DE,emissive:h_,equal:IE,equirectUV:dT,exp:Nv,exp2:ic,exponentialHeightFogFactor:t5,expression:Bi,faceDirection:Jv,faceForward:Iv,faceforward:MV,float:A,floatBitsToInt:S4,floatBitsToUint:tD,floor:nr,fog:C_,fract:Di,frameGroup:PE,frameId:sD,frontFacing:c2,fwidth:Fv,gain:R4,gapSize:d_,getConstNodeType:CE,getCurrentStack:pv,getDirection:VB,getDistanceAttenuation:BT,getGeometryRoughness:BB,getNormalFromDepth:cG,getParallaxCorrectNormal:n9,getRoughness:fT,getScreenPosition:uG,getShIrradianceAt:qD,getShadowMaterial:ND,getShadowRenderObjectFunction:CD,getTextureIndex:QB,getViewPosition:Uu,ggxConvolution:kB,globalId:o5,glsl:QG,glslFn:JG,grayscale:LG,greaterThan:wv,greaterThanEqual:HE,hash:E4,highpModelNormalViewMatrix:m_,highpModelViewMatrix:f_,hue:PG,increment:nR,incrementBefore:tR,inspector:e2,instance:$z,instanceIndex:or,instancedArray:_G,instancedBufferAttribute:tg,instancedDynamicBufferAttribute:p_,instancedMesh:pB,int:B,intBitsToFloat:w4,interleavedGradientNoise:TT,inverse:yR,inverseSqrt:Av,inversesqrt:NV,invocationLocalIndex:jz,invocationSubgroupIndex:Hz,ior:Kh,iridescence:Lg,iridescenceIOR:Ym,iridescenceThickness:Km,isolate:Xu,ivec2:ls,ivec3:mv,ivec4:yv,js:KG,label:DR,length:ir,lengthSq:Vv,lessThan:GE,lessThanEqual:qE,lightPosition:NT,lightProjectionUV:_D,lightShadowMatrix:ty,lightTargetDirection:CT,lightTargetPosition:vD,lightViewPosition:AT,lightingContext:xB,lights:e6,linearDepth:sg,linearToneMapping:cD,localId:l5,log:Fg,log2:sr,logarithmicDepthToViewZ:lI,luminance:ST,mat2:Dg,mat3:vs,mat4:co,matcapUV:qB,materialAO:lB,materialAlphaTest:D2,materialAnisotropy:W2,materialAnisotropyVector:Lu,materialAttenuationColor:tB,materialAttenuationDistance:eB,materialClearcoat:k2,materialClearcoatNormal:q2,materialClearcoatRoughness:G2,materialColor:L2,materialDispersion:oB,materialEmissive:F2,materialEnvIntensity:om,materialEnvRotation:tT,materialIOR:J2,materialIridescence:X2,materialIridescenceIOR:Y2,materialIridescenceThickness:K2,materialLightMap:rT,materialLineDashOffset:rB,materialLineDashSize:nB,materialLineGapSize:iB,materialLineScale:sB,materialLineWidth:zz,materialMetalness:z2,materialNormal:I2,materialOpacity:iT,materialPointSize:aB,materialReference:Hr,materialReflectivity:lm,materialRefractionRatio:f2,materialRotation:H2,materialRoughness:V2,materialSheen:j2,materialSheenRoughness:$2,materialShininess:U2,materialSpecular:P2,materialSpecularColor:O2,materialSpecularIntensity:v_,materialSpecularStrength:Zh,materialThickness:Q2,materialTransmission:Z2,max:zt,maxMipLevel:Wv,mediumpModelViewMatrix:l2,metalness:jr,min:mn,mix:qe,mixElement:MR,mod:vd,modInt:rR,modelDirection:dz,modelNormalMatrix:o2,modelPosition:pz,modelRadius:gz,modelScale:fz,modelViewMatrix:To,modelViewPosition:mz,modelViewProjection:uB,modelWorldMatrix:li,modelWorldMatrixInverse:yz,morphReference:bB,mrt:JB,mul:Be,mx_aastep:ID,mx_add:z8,mx_atan2:j8,mx_cell_noise_float:U8,mx_contrast:M8,mx_divide:G8,mx_fractal_noise_float:F8,mx_fractal_noise_vec2:P8,mx_fractal_noise_vec3:O8,mx_fractal_noise_vec4:V8,mx_frame:W8,mx_heighttonormal:s9,mx_hsvtorgb:m8,mx_ifequal:Z8,mx_ifgreater:Y8,mx_ifgreatereq:K8,mx_invert:X8,mx_modulo:q8,mx_multiply:k8,mx_noise_float:N8,mx_noise_vec3:A8,mx_noise_vec4:C8,mx_place2d:J8,mx_power:H8,mx_ramp4:_8,mx_ramplr:b8,mx_ramptb:x8,mx_rgbtohsv:g8,mx_rotate2d:e9,mx_rotate3d:t9,mx_safepower:w8,mx_separate:Q8,mx_splitlr:v8,mx_splittb:T8,mx_srgb_texture_to_lin_rec709:y8,mx_subtract:I8,mx_timer:$8,mx_transform_uv:S8,mx_unifiednoise2d:E8,mx_unifiednoise3d:R8,mx_worley_noise_float:B8,mx_worley_noise_vec2:D8,mx_worley_noise_vec3:L8,negate:Bv,neutralToneMapping:mD,nodeArray:ul,nodeImmutable:ce,nodeObject:ye,nodeObjectIntent:Vh,nodeObjects:Rg,nodeProxy:Pe,nodeProxyIntent:re,normalFlat:h2,normalGeometry:Ig,normalLocal:gn,normalMap:__,normalView:et,normalViewGeometry:oc,normalWorld:So,normalWorldGeometry:d2,normalize:fn,not:WE,notEqual:kE,numWorkgroups:r5,objectDirection:az,objectGroup:Sv,objectPosition:lz,objectRadius:hz,objectScale:uz,objectViewPosition:cz,objectWorldMatrix:oz,oneMinus:dR,or:$E,orthographicDepthToViewZ:oI,oscSawtooth:W4,oscSine:H4,oscSquare:j4,oscTriangle:$4,output:Wu,outputStruct:x4,overloadingFn:Bs,packHalf2x16:F4,packSnorm2x16:L4,packUnorm2x16:U4,parabola:N_,parallaxDirection:E2,parallaxUV:Lz,parameter:p4,pass:kG,passTexture:GG,pcurve:B4,perspectiveDepthToViewZ:uT,pmremTexture:yT,pointShadow:LD,pointUV:TG,pointWidth:yV,positionGeometry:Sd,positionLocal:Ot,positionPrevious:ac,positionView:Kt,positionViewDirection:Tt,positionWorld:ar,positionWorldDirection:Qv,posterize:VG,pow:oi,pow2:Pv,pow3:vR,pow4:Ov,premultiplyAlpha:wB,property:Jr,quadBroadcast:Z5,quadSwapDiagonal:j5,quadSwapX:q5,quadSwapY:H5,radians:lR,rand:wR,range:n5,rangeFogFactor:bD,reciprocal:fR,reference:Rt,referenceBuffer:g_,reflect:bR,reflectVector:y2,reflectView:m2,reflector:nG,refract:zv,refractVector:b2,refractView:g2,reinhardToneMapping:hD,remap:XR,remapClamp:YR,renderGroup:ve,renderOutput:ZR,rendererReference:kR,replaceDefaultUV:X4,rotate:wd,rotateUV:Y4,roughness:Yi,round:pR,rtt:iD,sRGBTransferEOTF:OR,sRGBTransferOETF:VR,sample:dG,sampler:KV,samplerComparison:ZV,saturate:Og,saturation:UG,screenCoordinate:Tl,screenDPR:n2,screenSize:pl,screenUV:rr,select:zs,setCurrentStack:od,setName:kv,shaderStages:l_,shadow:RD,shadowPositionWorld:RT,shapeCircle:T6,sharedUniformGroup:Ug,sheen:Ln,sheenRoughness:Ja,shiftLeft:JE,shiftRight:eR,shininess:Qm,sign:Rv,sin:Ws,sinc:D4,skinning:gB,smoothstep:Ui,smoothstepElement:NR,specularColor:yo,specularColorBlended:al,specularF90:ol,spherizeUV:K4,split:mV,spritesheetUV:J4,sqrt:Zs,stack:um,step:rc,stepElement:AR,storage:po,storageBarrier:d5,storageTexture:oD,string:pV,struct:b4,sub:$e,subBuild:hl,subgroupAdd:E5,subgroupAll:I5,subgroupAnd:F5,subgroupAny:k5,subgroupBallot:C5,subgroupBroadcast:$5,subgroupBroadcastFirst:G5,subgroupElect:A5,subgroupExclusiveAdd:B5,subgroupExclusiveMul:U5,subgroupInclusiveAdd:R5,subgroupInclusiveMul:L5,subgroupIndex:qz,subgroupMax:z5,subgroupMin:V5,subgroupMul:D5,subgroupOr:P5,subgroupShuffle:W5,subgroupShuffleDown:K5,subgroupShuffleUp:Y5,subgroupShuffleXor:X5,subgroupSize:u5,subgroupXor:O5,tan:cR,tangentGeometry:Gg,tangentLocal:lc,tangentView:qg,tangentWorld:A2,texture:st,texture3D:Qg,texture3DLevel:CG,texture3DLoad:AG,textureBarrier:p5,textureBicubic:XI,textureBicubicLevel:gT,textureCubeUV:zB,textureLevel:YV,textureLoad:kt,textureSize:ho,textureStore:wG,thickness:xv,time:fc,toneMapping:GR,toneMappingExposure:qR,toonOutlinePass:jG,transformDirection:TR,transformNormal:p2,transformNormalToView:eT,transformedClearcoatNormalView:vz,transformedNormalView:xz,transformedNormalWorld:_z,transmission:Jm,transpose:mR,triNoise3D:I4,triplanarTexture:eG,triplanarTextures:nD,trunc:Uv,uint:se,uintBitsToFloat:M4,uniform:_e,uniformArray:Os,uniformCubeTexture:Sz,uniformFlow:ER,uniformGroup:FE,uniformTexture:XV,unpackHalf2x16:V4,unpackNormal:x_,unpackSnorm2x16:P4,unpackUnorm2x16:O4,unpremultiplyAlpha:vI,userData:RG,uv:xt,uvec2:fv,uvec3:vl,uvec4:bv,varying:_o,varyingProperty:ld,vec2:ie,vec3:L,vec4:Se,vectorComponents:xl,velocity:DG,vertexColor:SB,vertexIndex:cB,vertexStage:PR,vibrance:FG,viewZToLogarithmicDepth:cT,viewZToOrthographicDepth:Yu,viewZToPerspectiveDepth:lT,viewZToReversedOrthographicDepth:aI,viewZToReversedPerspectiveDepth:vB,viewport:Kv,viewportCoordinate:i2,viewportDepthTexture:oT,viewportLinearDepth:uI,viewportMipTexture:aT,viewportOpaqueMipTexture:_B,viewportResolution:sz,viewportSafeUV:Q4,viewportSharedTexture:IG,viewportSize:Zv,viewportTexture:nI,viewportUV:tz,vogelDiskSample:Ei,wgsl:ZG,wgslFn:e5,workgroupArray:g5,workgroupBarrier:h5,workgroupId:a5,workingToColorSpace:zR,xor:XE});const Ni=new bT;class i9 extends wo{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,s){const n=this.renderer,a=this.nodes.getBackgroundNode(e)||e.background;let l=!1;if(a===null)n._clearColor.getRGB(Ni),Ni.a=n._clearColor.a;else if(a.isColor===!0)a.getRGB(Ni),Ni.a=1,l=!0;else if(a.isNode===!0){const d=this.get(e),f=a;Ni.copy(n._clearColor);let m=d.backgroundMesh;if(m===void 0){let E=function(){a.removeEventListener("dispose",E),m.material.dispose(),m.geometry.dispose()};var h=E;const x=Se(f).mul(A_).context({getUV:()=>aD.mul(d2),getTextureLevel:()=>rD}),v=ea.element(3).element(3).equal(1),T=kn(1,ea.element(1).element(1)).mul(3),w=v.select(Ot.mul(T),Ot),N=To.mul(Se(w,0));let C=ea.mul(Se(N.xyz,1));C=C.setZ(C.w);const R=new Ht;R.name="Background.material",R.side=Rs,R.depthTest=!1,R.depthWrite=!1,R.allowOverride=!1,R.fog=!1,R.lights=!1,R.vertexNode=C,R.colorNode=x,d.backgroundMeshNode=x,d.backgroundMesh=m=new na(new nv(1,32,32),R),m.frustumCulled=!1,m.name="Background.mesh",a.addEventListener("dispose",E)}const b=f.getCacheKey();d.backgroundCacheKey!==b&&(d.backgroundMeshNode.node=Se(f).mul(A_),d.backgroundMeshNode.needsUpdate=!0,m.material.needsUpdate=!0,d.backgroundCacheKey=b),t.unshift(m,m.geometry,m.material,0,0,null,null)}else le("Renderer: Unsupported background configuration.",a);const u=n.xr.getEnvironmentBlendMode();if(u==="additive"?Ni.set(0,0,0,1):u==="alpha-blend"&&Ni.set(0,0,0,0),n.autoClear===!0||l===!0){const d=s.clearColorValue;d.r=Ni.r,d.g=Ni.g,d.b=Ni.b,d.a=Ni.a,(n.backend.isWebGLBackend===!0||n.alpha===!0)&&(d.r*=d.a,d.g*=d.a,d.b*=d.a),s.depthClearValue=n.getClearDepth(),s.stencilClearValue=n.getClearStencil(),s.clearColor=n.autoClearColor===!0,s.clearDepth=n.autoClearDepth===!0,s.clearStencil=n.autoClearStencil===!0}else s.clearColor=!1,s.clearDepth=!1,s.clearStencil=!1}}let r9=0;class E_{constructor(e="",t=[],s=0){this.name=e,this.bindings=t,this.index=s,this.id=r9++}}class a9{constructor(e,t,s,n,a,l,u,h,d,f=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=s,this.transforms=f,this.nodeAttributes=n,this.bindings=a,this.updateNodes=l,this.updateBeforeNodes=u,this.updateAfterNodes=h,this.observer=d,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const n=new E_(t.name,[],t.index);e.push(n);for(const a of t.bindings)n.bindings.push(a.clone())}else e.push(t);return e}}class FA{constructor(e,t,s=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=s}}class o9{constructor(e,t,s){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=s}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class HD{constructor(e,t,s=!1,n=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=s,this.count=n}}class l9 extends HD{constructor(e,t,s=null,n=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=s,this.interpolationSampling=n}}class u9{constructor(e,t,s=""){this.name=e,this.type=t,this.code=s,Object.defineProperty(this,"isNodeCode",{value:!0})}}let c9=0;class Cx{constructor(e=null){this.id=c9++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class h9{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class Mo{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0,this.index=-1}setValue(e){this.value=e}getValue(){return this.value}}class d9 extends Mo{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class p9 extends Mo{constructor(e,t=new Ue){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class f9 extends Mo{constructor(e,t=new z){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class m9 extends Mo{constructor(e,t=new rt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class g9 extends Mo{constructor(e,t=new it){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class y9 extends Mo{constructor(e,t=new Ag){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class b9 extends Mo{constructor(e,t=new bn){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class x9 extends Mo{constructor(e,t=new Ze){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class _9 extends d9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class v9 extends p9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class T9 extends f9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class S9 extends m9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class w9 extends g9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class M9 extends y9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class N9 extends b9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class A9 extends x9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let C9=0;const PA=new WeakMap,E9=new WeakMap,R9=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Xf=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class jD{constructor(e,t,s){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=s,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=um(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Cx,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:C9++})}isFlatShading(){return this.material.flatShading===!0||this.geometry.hasAttribute("normal")===!1}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===ri&&e.alphaToCoverage===!1}createRenderTarget(e,t,s){return new ua(e,t,s)}createCubeRenderTarget(e,t){return new MB(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const s=t[0].groupNode;let n=s.shared;if(n)for(let l=1;l<t.length;l++)s!==t[l].groupNode&&(n=!1);let a;if(n){let l="";for(const f of t)if(f.isNodeUniformsGroup){f.uniforms.sort((m,b)=>m.nodeUniform.node.id-b.nodeUniform.node.id);for(const m of f.uniforms)l+=m.nodeUniform.node.id}else l+=f.nodeUniform.id;const u=this.renderer._currentRenderContext||this.renderer;let h=PA.get(u);h===void 0&&(h=new Map,PA.set(u,h));const d=hc(l);a=h.get(d),a===void 0&&(a=new E_(e,t,this.bindingsIndexes[e].group),h.set(d,a))}else a=new E_(e,t,this.bindingsIndexes[e].group);return a}getBindGroupArray(e,t){const s=this.bindings[t];let n=s[e];return n===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),s[e]=n=[]),n}getBindings(){let e=this.bindGroups;if(e===null){const t={},s=this.bindings;for(const n of l_)for(const a in s[n]){const l=s[n][a],u=t[a]||(t[a]=[]);for(const h of l)u.includes(h)===!1&&u.push(h)}e=[];for(const n in t){const a=t[n],l=this._getBindGroup(n,a);e.push(l)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,s)=>t.bindings[0].groupNode.order-s.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const s=e[t];this.bindingsIndexes[s.name].group=t,s.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){const t=e.getUpdateBeforeType(),s=e.getUpdateAfterType();(t!==Re.NONE||s!==Re.NONE)&&this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Re.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),s=e.getUpdateAfterType();t!==Re.NONE&&this.updateBeforeNodes.push(e),s!==Re.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Gs||e.magFilter===Jx||e.magFilter===sd||e.magFilter===oo||e.minFilter===Gs||e.minFilter===Jx||e.minFilter===sd||e.minFilter===oo}getUniformBufferLimit(){return 16384}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const s=this.getDataFromNode(e);return s.cache===void 0&&(s.cache=new Cx(t?this.getCache():null)),s.cache}isAvailable(){return!1}getVertexIndex(){ue("Abstract function.")}getInstanceIndex(){ue("Abstract function.")}getDrawIndex(){ue("Abstract function.")}getFrontFacing(){ue("Abstract function.")}getFragCoord(){ue("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){ue("Abstract function.")}generateTextureLod(){ue("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,s=null){let n=this.generateArrayDeclaration(e,t)+"( ";for(let a=0;a<t;a++){const l=s?s[a]:null;l!==null?n+=l.build(this,e):n+=this.generateConst(e),a<t-1&&(n+=", ")}return n+=" )",n}generateStruct(e,t,s=null){const n=[];for(const a of t){const{name:l,type:u}=a;s&&s[l]&&s[l].isNode?n.push(s[l].build(this,u)):n.push(this.generateConst(u))}return e+"( "+n.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new it:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new Ue:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new z:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new rt)),e==="float")return Xf(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Xf(t.r)}, ${Xf(t.g)}, ${Xf(t.b)} )`;const s=this.getTypeLength(e),n=this.getComponentType(e),a=l=>this.generateConst(n,l);if(s===2)return`${this.getType(e)}( ${a(t.x)}, ${a(t.y)} )`;if(s===3)return`${this.getType(e)}( ${a(t.x)}, ${a(t.y)}, ${a(t.z)} )`;if(s===4&&e!=="mat2")return`${this.getType(e)}( ${a(t.x)}, ${a(t.y)}, ${a(t.z)}, ${a(t.w)} )`;if(s>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(a).join(", ")} )`;if(s>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const s=this.attributes;for(const a of s)if(a.name===e)return a;const n=new FA(e,t);return this.registerDeclaration(n),s.push(n),n}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ps)return"int";if(t===Gt)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let s=_E(e);const n=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(s=s.replace("vec","mat")),n+s}getTypeFromArray(e){return R9.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const s=t.array,n=e.itemSize,a=e.normalized;let l;return!(e instanceof pE)&&a!==!0&&(l=this.getTypeFromArray(s)),this.getTypeFromLength(n,l)}getTypeLength(e){const t=this.getVectorType(e),s=/vec([2-4])/.exec(t);return s!==null?Number(s[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=um(this.stack);const e=pv();return this.stacks.push(e),od(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const s=this.getDataFromNode(t);s.stack=e}return this.stack=e.parent,od(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,s=null){s=s===null?e.isGlobal(this)?this.globalCache:this.cache:s;let n=s.getData(e);n===void 0&&(n={},s.setData(e,n)),n[t]===void 0&&(n[t]={});let a=n[t];const l=n.any?n.any.subBuilds:null,u=this.getClosestSubBuild(l);return u&&(a.subBuildsCache===void 0&&(a.subBuildsCache={}),a=a.subBuildsCache[u]||(a.subBuildsCache[u]={}),a.subBuilds=l),a}getNodeProperties(e,t="any"){const s=this.getDataFromNode(e,t);return s.properties||(s.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const s=this.getDataFromNode(e,"vertex");let n=s.bufferAttribute;if(n===void 0){const a=this.uniforms.index++;n=new FA("nodeAttribute"+a,t,e),this.bufferAttributes.push(n),s.bufferAttribute=n}return n}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,s=null,n=this.shaderStage){const a=this.getDataFromNode(e,n,this.globalCache);let l=a.structType;if(l===void 0){const u=this.structs.index++;s===null&&(s="StructType"+u),l=new h9(s,t),this.structs[n].push(l),this.types[n][s]=e,a.structType=l}return l}getOutputStructTypeFromNode(e,t){const s=this.getStructTypeFromNode(e,t,"OutputType","fragment");return s.output=!0,s}getUniformFromNode(e,t,s=this.shaderStage,n=null){const a=this.getDataFromNode(e,s,this.globalCache);let l=a.uniform;if(l===void 0){const u=this.uniforms.index++;l=new o9(n||"nodeUniform"+u,t,e),this.uniforms[s].push(l),this.registerDeclaration(l),a.uniform=l}return l}getVarFromNode(e,t=null,s=e.getNodeType(this),n=this.shaderStage,a=!1){const l=this.getDataFromNode(e,n),u=this.getSubBuildProperty("variable",l.subBuilds);let h=l[u];if(h===void 0){const d=a?"_const":"_var",f=this.vars[n]||(this.vars[n]=[]),m=this.vars[d]||(this.vars[d]=0);t===null&&(t=(a?"nodeConst":"nodeVar")+m,this.vars[d]++),u!=="variable"&&(t=this.getSubBuildProperty(t,l.subBuilds));const b=e.getArrayCount(this);h=new HD(t,s,a,b),a||f.push(h),this.registerDeclaration(h),l[u]=h}return h}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,s=e.getNodeType(this),n=null,a=null){const l=this.getDataFromNode(e,"any"),u=this.getSubBuildProperty("varying",l.subBuilds);let h=l[u];if(h===void 0){const d=this.varyings,f=d.length;t===null&&(t="nodeVarying"+f),u!=="varying"&&(t=this.getSubBuildProperty(t,l.subBuilds)),h=new l9(t,s,n,a),d.push(h),this.registerDeclaration(h),l[u]=h}return h}registerDeclaration(e){const t=this.shaderStage,s=this.declarations[t]||(this.declarations[t]={}),n=this.getPropertyName(e);let a=1,l=n;for(;s[l]!==void 0;)l=n+"_"+a++;a>1&&(e.name=l,ue(`TSL: Declaration name '${n}' of '${e.type}' already in use. Renamed to '${l}'.`)),s[l]=e}getCodeFromNode(e,t,s=this.shaderStage){const n=this.getDataFromNode(e);let a=n.code;if(a===void 0){const l=this.codes[s]||(this.codes[s]=[]),u=l.length;a=new u9("nodeCode"+u,t),l.push(a),n.code=a}return a}addFlowCodeHierarchy(e,t){const{flowCodes:s,flowCodeBlock:n}=this.getDataFromNode(e);let a=!0,l=t;for(;l;){if(n.get(l)===!0){a=!1;break}l=this.getDataFromNode(l).parentNodeBlock}if(a)for(const u of s)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,t,s){const n=this.getDataFromNode(e),a=n.flowCodes||(n.flowCodes=[]),l=n.flowCodeBlock||(n.flowCodeBlock=new WeakMap);a.push(t),l.set(s,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),s=this.flowChildNode(e,t);return this.flowsData.set(e,s),s}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new gD,s=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=s,t}flowShaderNode(e){const t=e.layout,s={[Symbol.iterator](){let l=0;const u=Object.values(this);return{next:()=>({value:u[l],done:l++>=u.length})}}};for(const l of t.inputs)s[l.name]=new YB(l.type,l.name);e.layout=null;const n=e.call(s),a=this.flowStagesNode(n,t.type);return e.layout=t,a}flowBuildStage(e,t,s=null){const n=this.getBuildStage();this.setBuildStage(t);const a=e.build(this,s);return this.setBuildStage(n),a}flowStagesNode(e,t=null){const s=this.flow,n=this.vars,a=this.declarations,l=this.cache,u=this.buildStage,h=this.stack,d={code:""};this.flow=d,this.vars={},this.declarations={},this.cache=new Cx,this.stack=um();for(const f of o_)this.setBuildStage(f),d.result=e.build(this,t);return d.vars=this.getVars(this.shaderStage),this.flow=s,this.vars=n,this.declarations=a,this.cache=l,this.stack=h,this.setBuildStage(u),d}getFunctionOperator(){return null}buildFunctionCode(){ue("Abstract function.")}flowChildNode(e,t=null){const s=this.flow,n={code:""};return this.flow=n,n.result=e.build(this,t),this.flow=s,n}flowNodeFromShaderStage(e,t,s=null,n=null){const a=this.tab,l=this.cache,u=this.shaderStage,h=this.context;this.setShaderStage(e);const d={...this.context};delete d.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=d;let f=null;if(this.buildStage==="generate"){const m=this.flowChildNode(t,s);n!==null&&(m.code+=`${this.tab+n} = ${m.result};
`),this.flowCode[e]=this.flowCode[e]+m.code,f=m}else f=t.build(this);return this.setShaderStage(u),this.cache=l,this.tab=a,this.context=h,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){ue("Abstract function.")}getVaryings(){ue("Abstract function.")}getVar(e,t,s=null){return`${s!==null?this.generateArrayDeclaration(e,s):this.getType(e)} ${t}`}getVars(e){let t="";const s=this.vars[e];if(s!==void 0)for(const n of s)t+=`${this.getVar(n.type,n.name)}; `;return t}getUniforms(){ue("Abstract function.")}getCodes(e){const t=this.codes[e];let s="";if(t!==void 0)for(const n of t)s+=n.code+`
`;return s}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){ue("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const s=this.subBuildLayers;for(let n=t.length-1;n>=0;n--){const a=t[n];if(s.includes(a))return a}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let s;t!==null?s=this.getClosestSubBuild(t):s=this.subBuildFn;let n;return s?n=e?s+"_"+e:s:n=e,n}build(){const{object:e,material:t,renderer:s}=this;if(t!==null){let n=s.library.fromMaterial(t);n===null&&(le(`NodeMaterial: Material "${t.type}" is not compatible.`),n=new Ht),n.build(this)}else this.addFlow("compute",e);for(const n of o_){this.setBuildStage(n),this.context.position&&this.context.position.isNode&&this.flowNodeFromShaderStage("vertex",this.context.position);for(const a of l_){this.setShaderStage(a);const l=this.flowNodes[a];for(const u of l)n==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=E9.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const s=this.getSharedDataFromNode(e);let n=s.cache;if(n===void 0){if(t==="float"||t==="int"||t==="uint")n=new _9(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")n=new v9(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")n=new T9(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")n=new S9(e);else if(t==="color")n=new w9(e);else if(t==="mat2")n=new M9(e);else if(t==="mat3")n=new N9(e);else if(t==="mat4")n=new A9(e);else throw new Error(`Uniform "${t}" not implemented.`);s.cache=n}return n}format(e,t,s){if(t=this.getVectorType(t),s=this.getVectorType(s),t===s||s===null||this.isReference(s))return e;const n=this.getTypeLength(t),a=this.getTypeLength(s);return n===16&&a===9?`${this.getType(s)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:n===9&&a===4?`${this.getType(s)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:n>4||a>4||a===0?e:n===a?`${this.getType(s)}( ${e} )`:n>a?(e=s==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,a)}`,this.format(e,this.getTypeFromLength(a,this.getComponentType(t)),s)):a===4&&n>1?`${this.getType(s)}( ${this.format(e,t,"vec3")}, 1.0 )`:n===2?`${this.getType(s)}( ${this.format(e,t,"vec2")}, 0.0 )`:(n===1&&a>1&&t!==this.getComponentType(s)&&(e=`${this.getType(this.getComponentType(s))}( ${e} )`),`${this.getType(s)}( ${e} )`)}getSignature(){return`// Three.js r${yd} - Node System
`}needsPreviousData(){const e=this.renderer.getMRT();return e&&e.has("velocity")||TE(this.object).useVelocity===!0}}class OA{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let s=e.get(t);return s===void 0&&(s={renderId:0,frameId:0},e.set(t,s)),s}updateBeforeNode(e){const t=e.getUpdateBeforeType(),s=e.updateReference(this);if(t===Re.FRAME){const n=this._getMaps(this.updateBeforeMap,s);if(n.frameId!==this.frameId){const a=n.frameId;n.frameId=this.frameId,e.updateBefore(this)===!1&&(n.frameId=a)}}else if(t===Re.RENDER){const n=this._getMaps(this.updateBeforeMap,s);if(n.renderId!==this.renderId){const a=n.renderId;n.renderId=this.renderId,e.updateBefore(this)===!1&&(n.renderId=a)}}else t===Re.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),s=e.updateReference(this);if(t===Re.FRAME){const n=this._getMaps(this.updateAfterMap,s);n.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(n.frameId=this.frameId)}else if(t===Re.RENDER){const n=this._getMaps(this.updateAfterMap,s);n.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(n.renderId=this.renderId)}else t===Re.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),s=e.updateReference(this);if(t===Re.FRAME){const n=this._getMaps(this.updateMap,s);n.frameId!==this.frameId&&e.update(this)!==!1&&(n.frameId=this.frameId)}else if(t===Re.RENDER){const n=this._getMaps(this.updateMap,s);n.renderId!==this.renderId&&e.update(this)!==!1&&(n.renderId=this.renderId)}else t===Re.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class UT{constructor(e,t,s=null,n="",a=!1){this.type=e,this.name=t,this.count=s,this.qualifier=n,this.isConst=a}}UT.isNodeFunctionInput=!0;class B9 extends Sl{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class D9 extends Sl{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:CT(this.light),lightColor:e}}}class L9 extends Sl{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=NT(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=_e(new it).setGroup(ve)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:n}=this,l=So.dot(n).mul(.5).add(.5),u=qe(s,t,l);e.context.irradiance.addAssign(u)}}class FT extends Sl{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=_e(0).setGroup(ve),this.penumbraCosNode=_e(0).setGroup(ve),this.cutoffDistanceNode=_e(0).setGroup(ve),this.decayExponentNode=_e(0).setGroup(ve),this.colorNode=_e(this.color).setGroup(ve)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:s,penumbraCosNode:n}=this;return Ui(s,n,t)}getLightCoord(e){const t=e.getNodeProperties(this);let s=t.projectionUV;return s===void 0&&(s=_D(this.light,e.context.positionWorld),t.projectionUV=s),s}setupDirect(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:n,light:a}=this,l=this.getLightVector(e),u=l.normalize(),h=u.dot(CT(a)),d=this.getSpotAttenuation(e,h),f=l.length(),m=BT({lightDistance:f,cutoffDistance:s,decayExponent:n});let b=t.mul(d).mul(m),x,v;return a.colorNode?(v=this.getLightCoord(e),x=a.colorNode(v)):a.map&&(v=this.getLightCoord(e),x=st(a.map,v.xy).onRenderUpdate(()=>a.map)),x&&(b=v.mul(2).sub(1).abs().lessThan(1).all().select(b.mul(x),b)),{lightColor:b,lightDirection:u}}}class U9 extends FT{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const s=this.light.iesMap;let n=null;if(s&&s.isTexture===!0){const a=t.acos().mul(1/Math.PI);n=st(s,ie(a,0),0).r}else n=super.getSpotAttenuation(t);return n}}class F9 extends Sl{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let s=0;s<9;s++)t.push(new z);this.lightProbe=Os(t)}update(e){const{light:t}=this;super.update(e);for(let s=0;s<9;s++)this.lightProbe.array[s].copy(t.sh.coefficients[s]).multiplyScalar(t.intensity)}setup(e){const t=qD(So,this.lightProbe);e.context.irradiance.addAssign(t)}}const P9=P(([i,e])=>{const t=i.abs().sub(e);return ir(zt(t,0)).add(mn(zt(t.x,t.y),0))});class O9 extends FT{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let s=1;t.map!==null&&(s=t.map.width/t.map.height),t.shadow.aspect=s}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=A(0),s=this.penumbraCosNode,n=ty(this.light).mul(e.context.positionWorld||ar);return Me(n.w.greaterThan(0),()=>{const a=n.xyz.div(n.w),l=P9(a.xy.sub(ie(.5)),ie(.5)),u=kn(-1,$e(1,Cv(s)).sub(1));t.assign(Og(l.mul(-2).mul(u)))}),t}}const Ex=new Ze,Yf=new Ze;let Rh=null;class V9 extends Sl{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=_e(new z).setGroup(ve),this.halfWidth=_e(new z).setGroup(ve),this.updateType=Re.RENDER}update(e){super.update(e);const{light:t}=this,s=e.camera.matrixWorldInverse;Yf.identity(),Ex.copy(t.matrixWorld),Ex.premultiply(s),Yf.extractRotation(Ex),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Yf),this.halfHeight.value.applyMatrix4(Yf)}setupDirectRectArea(e){let t,s;e.isAvailable("float32Filterable")?(t=st(Rh.LTC_FLOAT_1),s=st(Rh.LTC_FLOAT_2)):(t=st(Rh.LTC_HALF_1),s=st(Rh.LTC_HALF_2));const{colorNode:n,light:a}=this,l=AT(a);return{lightColor:n,lightPosition:l,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:s}}static setLTC(e){Rh=e}}class $D{parseFunction(){ue("Abstract function.")}}class PT{constructor(e,t,s="",n=""){this.type=e,this.inputs=t,this.name=s,this.precision=n}getCode(){ue("Abstract function.")}}PT.isNodeFunction=!0;const z9=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,I9=/[a-z_0-9]+/ig,VA="#pragma main",k9=i=>{i=i.trim();const e=i.indexOf(VA),t=e!==-1?i.slice(e+VA.length):i,s=t.match(z9);if(s!==null&&s.length===5){const n=s[4],a=[];let l=null;for(;(l=I9.exec(n))!==null;)a.push(l);const u=[];let h=0;for(;h<a.length;){const v=a[h][0]==="const";v===!0&&h++;let T=a[h][0];T==="in"||T==="out"||T==="inout"?h++:T="";const w=a[h++][0];let N=Number.parseInt(a[h][0]);Number.isNaN(N)===!1?h++:N=null;const C=a[h++][0];u.push(new UT(w,C,N,T,v))}const d=t.substring(s[0].length),f=s[3]!==void 0?s[3]:"",m=s[2],b=s[1]!==void 0?s[1]:"",x=e!==-1?i.slice(0,e):"";return{type:m,inputs:u,name:f,precision:b,inputsCode:n,blockCode:d,headerCode:x}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class G9 extends PT{constructor(e){const{type:t,inputs:s,name:n,precision:a,inputsCode:l,blockCode:u,headerCode:h}=k9(e);super(t,s,n,a),this.inputsCode=l,this.blockCode=u,this.headerCode=h}getCode(e=this.name){let t;const s=this.blockCode;if(s!==""){const{type:n,inputsCode:a,headerCode:l,precision:u}=this;let h=`${n} ${e} ( ${a.trim()} )`;u!==""&&(h=`${u} ${h}`),t=l+h+s}else t="";return t}}class q9 extends $D{parseFunction(e){return new G9(e)}}const zA=new WeakMap,ti=[],ja=[];class H9 extends wo{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new OA,this.nodeBuilderCache=new Map,this.callHashCache=new bo,this.groupsData=new bo,this.cacheLib={}}updateGroup(e){const t=e.groupNode,s=t.name;if(s===Sv.name)return!0;if(s===ve.name){const a=this.get(e),l=this.nodeFrame.renderId;return a.renderId!==l?(a.renderId=l,!0):!1}if(s===PE.name){const a=this.get(e),l=this.nodeFrame.frameId;return a.frameId!==l?(a.frameId=l,!0):!1}ti[0]=t,ti[1]=e;let n=this.groupsData.get(ti);return n===void 0&&this.groupsData.set(ti,n={}),ti[0]=null,ti[1]=null,n.version!==t.version?(n.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let s=t.nodeBuilderState;if(s===void 0){const{nodeBuilderCache:n}=this,a=this.getForRenderCacheKey(e);if(s=n.get(a),s===void 0){const l=h=>{const d=this.backend.createNodeBuilder(e.object,this.renderer);return d.scene=e.scene,d.material=h,d.camera=e.camera,d.context.material=h,d.lightsNode=e.lightsNode,d.environmentNode=this.getEnvironmentNode(e.scene),d.fogNode=this.getFogNode(e.scene),d.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&d.enableMultiview(),d};let u=l(e.material);try{u.build()}catch(h){u=l(new Ht),u.build();let d=h.stackTrace;!d&&h.stack&&(d=new Zt(h.stack)),le("TSL: "+h,d)}s=this._createNodeBuilderState(u),n.set(a,s)}s.usedTimes++,t.nodeBuilderState=s}return s}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let s=t.nodeBuilderState;if(s===void 0){const n=this.backend.createNodeBuilder(e,this.renderer);n.build(),s=this._createNodeBuilderState(n),t.nodeBuilderState=s}return s}_createNodeBuilderState(e){return new a9(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const s=this.get(e);s.environmentNode&&(t=s.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const s=this.get(e);s.backgroundNode&&(t=s.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){ti[0]=e,ti[1]=t;const s=this.renderer.info.calls,n=this.callHashCache.get(ti)||{};if(n.callId!==s){const a=this.getEnvironmentNode(e),l=this.getFogNode(e);t&&ja.push(t.getCacheKey(!0)),a&&ja.push(a.getCacheKey()),l&&ja.push(l.getCacheKey()),ja.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),ja.push(this.renderer.shadowMap.enabled?1:0),ja.push(this.renderer.shadowMap.type),n.callId=s,n.cacheKey=xd(ja),this.callHashCache.set(ti,n),ja.length=0}return ti[0]=null,ti[1]=null,n.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),s=e.background;if(s){const n=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==s||n){const a=this.getCacheNode("background",s,()=>{if(s.isCubeTexture===!0||s.mapping===q_||s.mapping===H_||s.mapping===Qx){if(e.backgroundBlurriness>0||s.mapping===Qx)return yT(s);{let l;return s.isCubeTexture===!0?l=Ys(s):l=st(s),AB(l)}}else{if(s.isTexture===!0)return st(s,rr.flipY()).setUpdateMatrix(!0);s.isColor!==!0&&le("WebGPUNodes: Unsupported background configuration.",s)}},n);t.backgroundNode=a,t.background=s,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,s,n=!1){const a=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let l=a.get(t);return(l===void 0||n)&&(l=s(),a.set(t,l)),l}updateFog(e){const t=this.get(e),s=e.fog;if(s){if(t.fog!==s){const n=this.getCacheNode("fog",s,()=>{if(s.isFogExp2){const a=Rt("color","color",s).setGroup(ve),l=Rt("density","float",s).setGroup(ve);return C_(a,xD(l))}else if(s.isFog){const a=Rt("color","color",s).setGroup(ve),l=Rt("near","float",s).setGroup(ve),u=Rt("far","float",s).setGroup(ve);return C_(a,bD(l,u))}else le("Renderer: Unsupported fog configuration.",s)});t.fogNode=n,t.fog=s}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),s=e.environment;if(s){if(t.environment!==s){const n=this.getCacheNode("environment",s,()=>{if(s.isCubeTexture===!0)return Ys(s);if(s.isTexture===!0)return st(s);le("Nodes: Unsupported environment configuration.",s)});t.environmentNode=n,t.environment=s}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,s=null,n=null,a=null){const l=this.nodeFrame;return l.renderer=e,l.scene=t,l.object=s,l.camera=n,l.material=a,l}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return zA.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,s=this.getOutputCacheKey(),n=e.isArrayTexture?Qg(e,L(rr,ha("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):st(e,rr).renderOutput(t.toneMapping,t.currentColorSpace);return zA.set(e,s),n}updateBefore(e){const t=e.getNodeBuilderState();for(const s of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(s)}updateAfter(e){const t=e.getNodeBuilderState();for(const s of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(s)}updateForCompute(e){const t=this.getNodeFrame(),s=this.getForCompute(e);for(const n of s.updateNodes)t.updateNode(n)}updateForRender(e){const t=this.getNodeFrameForRender(e),s=e.getNodeBuilderState();for(const n of s.updateNodes)t.updateNode(n)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new OA,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Rx=new kr;class lg{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new bn,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,s){const n=e.length;for(let a=0;a<n;a++){Rx.copy(e[a]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const l=t[s+a],u=Rx.normal;l.x=-u.x,l.y=-u.y,l.z=-u.z,l.w=Rx.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let s=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const n=t.clippingPlanes,a=n.length;let l,u;if(this.clipIntersection?(l=this.intersectionPlanes,u=e.intersectionPlanes.length):(l=this.unionPlanes,u=e.unionPlanes.length),l.length!==u+a){l.length=u+a;for(let h=0;h<a;h++)l[u+h]=new rt;s=!0}this.projectPlanes(n,l,u),s&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new lg(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class j9{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Cu=[];class $9{constructor(){this.bundles=new bo}get(e,t){const s=this.bundles;Cu[0]=e,Cu[1]=t;let n=s.get(Cu);return n===void 0&&(n=new j9(e,t),s.set(Cu,n)),Cu[0]=null,Cu[1]=null,n}dispose(){this.bundles=new bo}}class WD{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const s=this.getMaterialNodeClass(e.type);if(s!==null){t=new s;for(const n in e)t[n]=e[n]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,s){if(s.has(t)){ue(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);s.set(t,e)}addClass(e,t,s){if(s.has(t)){ue(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);s.set(t,e)}}const W9=new ET,IA=new WeakMap;class X9{createNode(e=[]){return new ET().setLights(e)}getNode(e){if(e.isQuadMesh)return W9;let t=IA.get(e);return t===void 0&&(t=this.createNode(),IA.set(e,t)),t}}class zh extends ua{constructor(e=1,t=1,s={}){super(e,t,s),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const kA=new z,GA=new z;class Y9 extends la{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new un,this._cameraL.viewport=new rt,this._cameraR=new un,this._cameraR.viewport=new rt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new RO,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=tq.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ue,this._onSessionEvent=Q9.bind(this),this._onSessionEnd=J9.bind(this),this._onInputSourcesChange=eq.bind(this),this._onAnimationFrame=sq.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&ue("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&ue("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,s,n,a,l,u,h={}){const d=new Ng(e,t),f=new zh(a,l,{format:Pn,type:Vs,depthTexture:new hi(a,l,h.stencil?lo:Gt,void 0,void 0,void 0,void 0,void 0,void 0,h.stencil?Yr:Ri),stencilBuffer:h.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f._autoAllocateDepthBuffer=!0;const m=new Qa({color:16777215,side:tr});m.map=f.texture,m.map.offset.y=1,m.map.repeat.y=-1;const b=new na(d,m);b.position.copy(s),b.quaternion.copy(n);const x={type:"quad",width:e,height:t,translation:s,quaternion:n,pixelwidth:a,pixelheight:l,plane:b,material:m,rendercall:u,renderTarget:f};if(this._layers.push(x),this._session!==null){x.plane.material=new Qa({color:16777215,side:tr}),x.plane.material.blending=ku,x.plane.material.blendEquation=ai,x.plane.material.blendSrc=Ka,x.plane.material.blendDst=Ka,x.xrlayer=this._createXRLayer(x);const v=this._session.renderState.layers;v.unshift(x.xrlayer),this._session.updateRenderState({layers:v})}else f.isXRRenderTarget=!1;return b}createCylinderLayer(e,t,s,n,a,l,u,h,d={}){const f=new sv(e,e,e*t/s,64,64,!0,Math.PI-t/2,t),m=new zh(l,u,{format:Pn,type:Vs,depthTexture:new hi(l,u,d.stencil?lo:Gt,void 0,void 0,void 0,void 0,void 0,void 0,d.stencil?Yr:Ri),stencilBuffer:d.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});m._autoAllocateDepthBuffer=!0;const b=new Qa({color:16777215,side:Rs});b.map=m.texture,b.map.offset.y=1,b.map.repeat.y=-1;const x=new na(f,b);x.position.copy(n),x.quaternion.copy(a);const v={type:"cylinder",radius:e,centralAngle:t,aspectratio:s,translation:n,quaternion:a,pixelwidth:l,pixelheight:u,plane:x,material:b,rendercall:h,renderTarget:m};if(this._layers.push(v),this._session!==null){v.plane.material=new Qa({color:16777215,side:Rs}),v.plane.material.blending=ku,v.plane.material.blendEquation=ai,v.plane.material.blendSrc=Ka,v.plane.material.blendDst=Ka,v.xrlayer=this._createXRLayer(v);const T=this._session.renderState.layers;T.unshift(v.xrlayer),this._session.updateRenderState({layers:T})}else m.isXRRenderTarget=!1;return x}renderLayers(){const e=new z,t=new sa,s=this._renderer,n=this.isPresenting,a=s.getOutputRenderTarget(),l=s._frameBufferTarget;this.isPresenting=!1;const u=new Ue;s.getSize(u);const h=s._quad;for(const d of this._layers)if(d.renderTarget.isXRRenderTarget=this._session!==null,d.renderTarget._hasExternalTextures=d.renderTarget.isXRRenderTarget,d.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){d.xrlayer.transform=new XRRigidTransform(d.plane.getWorldPosition(e),d.plane.getWorldQuaternion(t));const f=this._glBinding.getSubImage(d.xrlayer,this._xrFrame);s.backend.setXRRenderTargetTextures(d.renderTarget,f.colorTexture,void 0),s._setXRLayerSize(d.renderTarget.width,d.renderTarget.height),s.setOutputRenderTarget(d.renderTarget),s.setRenderTarget(null),s._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:m,quad:b}=this._frameBufferTargets.get(d.renderTarget)||{frameBufferTarget:null,quad:null};m?(s._frameBufferTarget=m,s._quad=b):(s._quad=new Kg(new Ht),this._frameBufferTargets.set(d.renderTarget,{frameBufferTarget:s._getFrameBufferTarget(),quad:s._quad})),d.rendercall(),s._frameBufferTarget=null}else s.setRenderTarget(d.renderTarget),d.rendercall();s.setRenderTarget(null),s.setOutputRenderTarget(a),s._frameBufferTarget=l,s._setXRLayerSize(u.x,u.y),s._quad=h,this.isPresenting=n}getSession(){return this._session}async setSession(e){const t=this._renderer,s=t.backend;this._gl=t.getContext();const n=this._gl,a=n.getContextAttributes();if(this._session=e,e!==null){if(s.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await s.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let l=null,u=null,h=null;t.depth&&(h=t.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,l=t.stencil?Yr:Ri,u=t.stencil?lo:Gt);const d={colorFormat:n.RGBA8,depthFormat:h,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(d.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const f=this._glBinding.createProjectionLayer(d),m=[f];this._glProjLayer=f,t.setPixelRatio(1),t._setXRLayerSize(f.textureWidth,f.textureHeight);const b=this._useMultiview?2:1,x=new hi(f.textureWidth,f.textureHeight,u,void 0,void 0,void 0,void 0,void 0,void 0,l,b);if(this._xrRenderTarget=new zh(f.textureWidth,f.textureHeight,{format:Pn,type:Vs,colorSpace:t.outputColorSpace,depthTexture:x,stencilBuffer:t.stencil,samples:a.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const v of this._layers)v.plane.material=new Qa({color:16777215,side:v.type==="cylinder"?Rs:tr}),v.plane.material.blending=ku,v.plane.material.blendEquation=ai,v.plane.material.blendSrc=Ka,v.plane.material.blendDst=Ka,v.xrlayer=this._createXRLayer(v),m.unshift(v.xrlayer);e.updateRenderState({layers:m})}else{const l={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},u=new XRWebGLLayer(e,n,l);this._glBaseLayer=u,e.updateRenderState({baseLayer:u}),t.setPixelRatio(1),t._setXRLayerSize(u.framebufferWidth,u.framebufferHeight),this._xrRenderTarget=new zh(u.framebufferWidth,u.framebufferHeight,{format:Pn,type:Vs,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const s=e.near,n=e.far,a=this._cameraXR,l=this._cameraL,u=this._cameraR;a.near=u.near=l.near=s,a.far=u.far=l.far=n,a.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==a.near||this._currentDepthFar!==a.far)&&(t.updateRenderState({depthNear:a.near,depthFar:a.far}),this._currentDepthNear=a.near,this._currentDepthFar=a.far),a.layers.mask=e.layers.mask|6,l.layers.mask=a.layers.mask&-5,u.layers.mask=a.layers.mask&-3;const h=e.parent,d=a.cameras;qA(a,h);for(let f=0;f<d.length;f++)qA(d[f],h);d.length===2?K9(a,l,u):a.projectionMatrix.copy(l.projectionMatrix),Z9(e,a,h)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new QP,this._controllers[e]=t),t}}function K9(i,e,t){kA.setFromMatrixPosition(e.matrixWorld),GA.setFromMatrixPosition(t.matrixWorld);const s=kA.distanceTo(GA),n=e.projectionMatrix.elements,a=t.projectionMatrix.elements,l=n[14]/(n[10]-1),u=n[14]/(n[10]+1),h=(n[9]+1)/n[5],d=(n[9]-1)/n[5],f=(n[8]-1)/n[0],m=(a[8]+1)/a[0],b=l*f,x=l*m,v=s/(-f+m),T=v*-f;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(T),i.translateZ(v),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),n[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const w=l+v,N=u+v,C=b-T,R=x+(s-T),E=h*u/N*w,k=d*u/N*w;i.projectionMatrix.makePerspective(C,R,E,k,w,N),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function qA(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function Z9(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=nc*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function Q9(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const s=this.getReferenceSpace();t.update(i.inputSource,i.frame,s),t.dispatchEvent({type:i.type,data:i.inputSource})}}function J9(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const s=this._controllerInputSources[t];s!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(s))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new zh(t.pixelwidth,t.pixelheight,{format:Pn,type:Vs,depthTexture:new hi(t.pixelwidth,t.pixelheight,t.stencilBuffer?lo:Gt,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?Yr:Ri),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function eq(i){const e=this._controllers,t=this._controllerInputSources;for(let s=0;s<i.removed.length;s++){const n=i.removed[s],a=t.indexOf(n);a>=0&&(t[a]=null,e[a].disconnect(n))}for(let s=0;s<i.added.length;s++){const n=i.added[s];let a=t.indexOf(n);if(a===-1){for(let u=0;u<e.length;u++)if(u>=t.length){t.push(n),a=u;break}else if(t[u]===null){t[u]=n,a=u;break}if(a===-1)break}const l=e[a];l&&l.connect(n)}}function tq(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function sq(i,e){if(e===void 0)return;const t=this._cameraXR,s=this._renderer,n=s.backend,a=this._glBaseLayer,l=this.getReferenceSpace(),u=e.getViewerPose(l);if(this._xrFrame=e,u!==null){const h=u.views;this._glBaseLayer!==null&&n.setXRTarget(a.framebuffer);let d=!1;h.length!==t.cameras.length&&(t.cameras.length=0,d=!0);for(let f=0;f<h.length;f++){const m=h[f];let b;if(this._supportsLayers===!0){const v=this._glBinding.getViewSubImage(this._glProjLayer,m);b=v.viewport,f===0&&n.setXRRenderTargetTextures(this._xrRenderTarget,v.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:v.depthStencilTexture)}else b=a.getViewport(m);let x=this._cameras[f];x===void 0&&(x=new un,x.layers.enable(f),x.viewport=new rt,this._cameras[f]=x),x.matrix.fromArray(m.transform.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale),x.projectionMatrix.fromArray(m.projectionMatrix),x.projectionMatrixInverse.copy(x.projectionMatrix).invert(),x.viewport.set(b.x,b.y,b.width,b.height),f===0&&(t.matrix.copy(x.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),d===!0&&t.cameras.push(x)}s.setOutputRenderTarget(this._xrRenderTarget)}for(let h=0;h<this._controllers.length;h++){const d=this._controllerInputSources[h],f=this._controllers[h];d!==null&&f!==void 0&&f.update(d,e,l)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class nq extends la{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new rt(0,0,this._width,this._height),this._scissor=new rt(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new tv,this.depthTexture=new hi}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,s){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=s,this.domElement.width=Math.floor(e*s),this.domElement.height=Math.floor(t*s),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,s=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),s===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,s,n){const a=this._scissor;e.isVector4?a.copy(e):a.set(e,t,s,n)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,s,n,a=0,l=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,t,s,n),u.minDepth=a,u.maxDepth=l}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const HA=new Z_,Eu=new Ue,Bx=new rt,Dx=new J_,Lx=new ev,Kf=new Ze,Vr=new rt,iq={[tr]:Rs,[Rs]:tr,[Wr]:Wr};class rq{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:s=!1,reversedDepthBuffer:n=!1,alpha:a=!0,depth:l=!0,stencil:u=!1,antialias:h=!1,samples:d=0,getFallback:f=null,outputBufferType:m=Cs,multiview:b=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=a,this.logarithmicDepthBuffer=s,this.reversedDepthBuffer=n,this.outputColorSpace=Un,this.toneMapping=il,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=l,this.stencil=u,this.info=new Jk,this.contextNode=ca(),this.library=new WD,this.lighting=new X9,this._samples=d||h===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new nq(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new JR,this._inspector.setRenderer(this),this._getFallback=f,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Kg(new Ht),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const x=this.alpha===!0?0:1;this._clearColor=new bT(0,0,0,x),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=m,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._callDepth=-1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,transmitted:!1,type:kC},this.xr=new Y9(this,b),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(v,T,w)=>{await this.compileAsync(v,T);const N=this._renderLists.get(v,T),C=this._renderContexts.get(this._renderTarget,this._mrt),R=v.overrideMaterial||w.material,E=this._objects.get(w,R,v,T,N.lightsNode,C,C.clippingContext),{fragmentShader:k,vertexShader:q}=E.getNodeBuilderState();return{fragmentShader:k,vertexShader:q}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let s=this.backend;try{await s.init(this)}catch(n){if(this._getFallback!==null)try{this.backend=s=this._getFallback(n),await s.init(this)}catch(a){t(a);return}else{t(n);return}}this._nodes=new H9(this,s),this._animation=new Hk(this,this._nodes,this.info),this._attributes=new Zk(s),this._background=new i9(this,this._nodes),this._geometries=new Qk(this._attributes,this.info),this._textures=new d4(this,s,this.info),this._pipelines=new n4(s,this._nodes),this._bindings=new i4(s,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Xk(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new o4(this.lighting),this._bundles=new $9,this._renderContexts=new c4(this),this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,s=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const n=this._nodes.nodeFrame,a=n.renderId,l=this._currentRenderContext,u=this._currentRenderObjectFunction,h=this._handleObjectFunction,d=this._compilationPromises,f=e.isScene===!0?e:HA;s===null&&(s=e);const m=this._renderTarget,b=this._renderContexts.get(m,this._mrt),x=this._activeMipmapLevel,v=[];this._currentRenderContext=b,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=v,n.renderId++,n.update(),b.depth=this.depth,b.stencil=this.stencil,b.clippingContext||(b.clippingContext=new lg),b.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,m);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,b.clippingContext),s!==e&&s.traverseVisible(function(E){E.isLight&&E.layers.test(t.layers)&&T.pushLight(E)}),T.finish(),m!==null){this._textures.updateRenderTarget(m,x);const E=this._textures.get(m);b.textures=E.textures,b.depthTexture=E.depthTexture}else b.textures=null,b.depthTexture=null;s!==e?this._background.update(s,T,b):this._background.update(f,T,b);const w=T.opaque,N=T.transparent,C=T.transparentDoublePass,R=T.lightsNode;this.opaque===!0&&w.length>0&&this._renderObjects(w,t,f,R),this.transparent===!0&&N.length>0&&this._renderTransparents(N,C,t,f,R),n.renderId=a,this._currentRenderContext=l,this._currentRenderObjectFunction=u,this._handleObjectFunction=h,this._compilationPromises=d,await Promise.all(v)}async renderAsync(e,t){ft('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){le("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=f_,t.modelNormalViewMatrix=m_):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===f_&&e.modelNormalViewMatrix===m_}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return ft('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),le(t),this._isDeviceLost=!0}_renderBundle(e,t,s){const{bundleGroup:n,camera:a,renderList:l}=e,u=this._currentRenderContext,h=this._bundles.get(n,a),d=this.backend.get(h);d.renderContexts===void 0&&(d.renderContexts=new Set);const f=n.version!==d.version,m=d.renderContexts.has(u)===!1||f;if(d.renderContexts.add(u),m){this.backend.beginBundle(u),(d.renderObjects===void 0||f)&&(d.renderObjects=[]),this._currentRenderBundle=h;const{transparentDoublePass:b,transparent:x,opaque:v}=l;this.opaque===!0&&v.length>0&&this._renderObjects(v,a,t,s),this.transparent===!0&&x.length>0&&this._renderTransparents(x,b,a,t,s),this._currentRenderBundle=null,this.backend.finishBundle(u,h),d.version=n.version}else{const{renderObjects:b}=d;for(let x=0,v=b.length;x<v;x++){const T=b[x];this._nodes.needsRefresh(T)&&(this._nodes.updateBefore(T),this._nodes.updateForRender(T),this._bindings.updateForRender(T),this._nodes.updateAfter(T))}}this.backend.addBundle(u,h)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,s=e!==il,n=t!==nt.workingColorSpace;if(s===!1&&n===!1)return null;const{width:a,height:l}=this.getDrawingBufferSize(Eu),{depth:u,stencil:h}=this;let d=this._frameBufferTarget;d===null&&(d=new ua(a,l,{depthBuffer:u,stencilBuffer:h,type:this._outputBufferType,format:Pn,colorSpace:nt.workingColorSpace,generateMipmaps:!1,minFilter:Gs,magFilter:Gs,samples:this.samples}),d.isPostProcessingRenderTarget=!0,this._frameBufferTarget=d);const f=this.getOutputRenderTarget();d.depthBuffer=u,d.stencilBuffer=h,f!==null?d.setSize(f.width,f.height,f.depth):d.setSize(a,l,1);const m=this._canvasTarget;return d.viewport.copy(m._viewport),d.scissor.copy(m._scissor),d.viewport.multiplyScalar(m._pixelRatio),d.scissor.multiplyScalar(m._pixelRatio),d.scissorTest=m._scissorTest,d.multiview=f!==null?f.multiview:!1,d.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,d._autoAllocateDepthBuffer=f!==null?f._autoAllocateDepthBuffer:!1,d}_renderScene(e,t,s=!0){if(this._isDeviceLost===!0)return;const n=s?this._getFrameBufferTarget():null,a=this._nodes.nodeFrame,l=a.renderId,u=this._currentRenderContext,h=this._currentRenderObjectFunction,d=this._handleObjectFunction;this._callDepth++;const f=e.isScene===!0?e:HA,m=this._renderTarget||this._outputRenderTarget,b=this._activeCubeFace,x=this._activeMipmapLevel;let v;n!==null?(v=n,this.setRenderTarget(v)):v=m;const T=this._renderContexts.get(v,this._mrt,this._callDepth);this._currentRenderContext=T,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this._handleObjectFunction=this._renderObjectDirect,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,a.renderId=this.info.calls,this.backend.updateTimeStampUID(T),this.inspector.beginRender(this.backend.getTimestampUID(T),e,t,v);const w=this.xr;if(w.isPresenting===!1){let Ce=!1;if(this.reversedDepthBuffer===!0&&t.reversedDepth!==!0){if(t._reversedDepth=!0,t.isArrayCamera)for(const j of t.cameras)j._reversedDepth=!0;Ce=!0}const ge=this.coordinateSystem;if(t.coordinateSystem!==ge){if(t.coordinateSystem=ge,t.isArrayCamera)for(const j of t.cameras)j.coordinateSystem=ge;Ce=!0}if(Ce===!0&&(t.updateProjectionMatrix(),t.isArrayCamera))for(const j of t.cameras)j.updateProjectionMatrix()}e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),w.enabled===!0&&w.isPresenting===!0&&(w.cameraAutoUpdate===!0&&w.updateCamera(t),t=w.getCamera());const N=this._canvasTarget;let C=N._viewport,R=N._scissor,E=N._pixelRatio;v!==null&&(C=v.viewport,R=v.scissor,E=1),this.getDrawingBufferSize(Eu),Bx.set(0,0,Eu.width,Eu.height);const k=C.minDepth===void 0?0:C.minDepth,q=C.maxDepth===void 0?1:C.maxDepth;T.viewportValue.copy(C).multiplyScalar(E).floor(),T.viewportValue.width>>=x,T.viewportValue.height>>=x,T.viewportValue.minDepth=k,T.viewportValue.maxDepth=q,T.viewport=T.viewportValue.equals(Bx)===!1,T.scissorValue.copy(R).multiplyScalar(E).floor(),T.scissor=N._scissorTest&&T.scissorValue.equals(Bx)===!1,T.scissorValue.width>>=x,T.scissorValue.height>>=x,T.clippingContext||(T.clippingContext=new lg),T.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,v);const D=t.isArrayCamera?Lx:Dx;t.isArrayCamera||(Kf.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromProjectionMatrix(Kf,t.coordinateSystem,t.reversedDepth));const I=this._renderLists.get(e,t);if(I.begin(),this._projectObject(e,t,0,I,T.clippingContext),I.finish(),this.sortObjects===!0&&I.sort(this._opaqueSort,this._transparentSort),v!==null){this._textures.updateRenderTarget(v,x);const Ce=this._textures.get(v);T.textures=Ce.textures,T.depthTexture=Ce.depthTexture,T.width=Ce.width,T.height=Ce.height,T.renderTarget=v,T.depth=v.depthBuffer,T.stencil=v.stencilBuffer}else T.textures=null,T.depthTexture=null,T.width=Eu.width,T.height=Eu.height,T.depth=this.depth,T.stencil=this.stencil;T.width>>=x,T.height>>=x,T.activeCubeFace=b,T.activeMipmapLevel=x,T.occlusionQueryCount=I.occlusionQueryCount,T.scissorValue.max(Vr.set(0,0,0,0)),T.scissorValue.x+T.scissorValue.width>T.width&&(T.scissorValue.width=Math.max(T.width-T.scissorValue.x,0)),T.scissorValue.y+T.scissorValue.height>T.height&&(T.scissorValue.height=Math.max(T.height-T.scissorValue.y,0)),this._background.update(f,I,T),T.camera=t,this.backend.beginRender(T);const{bundles:$,lightsNode:ae,transparentDoublePass:pe,transparent:me,opaque:xe}=I;return $.length>0&&this._renderBundles($,f,ae),this.opaque===!0&&xe.length>0&&this._renderObjects(xe,t,f,ae),this.transparent===!0&&me.length>0&&this._renderTransparents(me,pe,t,f,ae),this.backend.finishRender(T),a.renderId=l,this._currentRenderContext=u,this._currentRenderObjectFunction=h,this._handleObjectFunction=d,this._callDepth--,n!==null&&(this.setRenderTarget(m,b,x),this._renderOutput(v)),f.onAfterRender(this,e,t,v),this.inspector.finishRender(this.backend.getTimestampUID(T)),T}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const s=this.autoClear,n=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=s,this.xr.enabled=n}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,s){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,s)}setSize(e,t,s=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,s)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,s,n){this._canvasTarget.setScissor(e,t,s,n)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,s,n,a=0,l=1){this._canvasTarget.setViewport(e,t,s,n,a,l)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this.reversedDepthBuffer===!0?1-this._clearDepth:this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,s=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const n=this._renderTarget||this._getFrameBufferTarget();let a=null;if(n!==null){this._textures.updateRenderTarget(n);const l=this._textures.get(n);a=this._renderContexts.get(n),a.textures=l.textures,a.depthTexture=l.depthTexture,a.width=l.width,a.height=l.height,a.renderTarget=n,a.depth=n.depthBuffer,a.stencil=n.stencilBuffer;const u=this.backend.getClearColor();a.clearColorValue.r=u.r,a.clearColorValue.g=u.g,a.clearColorValue.b=u.b,a.clearColorValue.a=u.a,a.clearDepthValue=this.getClearDepth(),a.clearStencilValue=this.getClearStencil(),a.activeCubeFace=this.getActiveCubeFace(),a.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,s,a),n!==null&&this._renderTarget===null&&this._renderOutput(n)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,s=!0){ft('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,s)}async clearColorAsync(){ft('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){ft('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){ft('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==il,t=this.currentColorSpace!==nt.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:il}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:nt.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,s=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=s}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return ue("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const s=this._nodes.nodeFrame,n=s.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const a=this.backend,l=this._pipelines,u=this._bindings,h=this._nodes,d=Array.isArray(e)?e:[e];if(d[0]===void 0||d[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");a.beginCompute(e);for(const f of d){if(l.has(f)===!1){const x=()=>{f.removeEventListener("dispose",x),l.delete(f),u.deleteForCompute(f),h.delete(f)};f.addEventListener("dispose",x);const v=f.onInitFunction;v!==null&&v.call(f,{renderer:this})}h.updateForCompute(f),u.updateForCompute(f);const m=u.getForCompute(f),b=l.getForCompute(f,m);a.compute(e,f,m,b,t)}a.finishCompute(e),s.renderId=n,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return ft('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){ft('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}initRenderTarget(e){if(this._initialized===!1)throw new Error('Renderer: .initRenderTarget() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateRenderTarget(e);const t=this._textures.get(e),s=this._renderContexts.get(e);s.textures=t.textures,s.depthTexture=t.depthTexture,s.width=t.width,s.height=t.height,s.renderTarget=e,s.depth=e.depthBuffer,s.stencil=e.stencilBuffer,this.backend.initRenderTarget(s)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Vr.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Vr.copy(t).floor();else{le("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Vr.set(0,0,e.image.width,e.image.height);let s=this._currentRenderContext,n;s!==null?n=s.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),n!==null&&(this._textures.updateRenderTarget(n),s=this._textures.get(n))),this._textures.updateTexture(e,{renderTarget:n}),this.backend.copyFramebufferToTexture(e,s,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,s=null,n=null,a=0,l=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,s,n,a,l),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,s,n,a,l=0,u=0){return this.backend.copyTextureToBuffer(e.textures[l],t,s,n,a,u)}_projectObject(e,t,s,n,a){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)s=e.renderOrder,e.isClippingGroup&&e.enabled&&(a=a.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)n.pushLight(e);else if(e.isSprite){const h=t.isArrayCamera?Lx:Dx;if(!e.frustumCulled||h.intersectsSprite(e,t)){this.sortObjects===!0&&Vr.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Kf);const{geometry:d,material:f}=e;f.visible&&n.push(e,d,f,s,Vr.z,null,a)}}else if(e.isLineLoop)le("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const h=t.isArrayCamera?Lx:Dx;if(!e.frustumCulled||h.intersectsObject(e,t)){const{geometry:d,material:f}=e;if(this.sortObjects===!0&&(d.boundingSphere===null&&d.computeBoundingSphere(),Vr.copy(d.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Kf)),Array.isArray(f)){const m=d.groups;for(let b=0,x=m.length;b<x;b++){const v=m[b],T=f[v.materialIndex];T&&T.visible&&n.push(e,d,T,s,Vr.z,v,a)}}else f.visible&&n.push(e,d,f,s,Vr.z,null,a)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const h=n;n=this._renderLists.get(e,t),n.begin(),h.pushBundle({bundleGroup:e,camera:t,renderList:n}),n.finish()}const u=e.children;for(let h=0,d=u.length;h<d;h++)this._projectObject(u[h],t,s,n,a)}_renderBundles(e,t,s){for(const n of e)this._renderBundle(n,t,s)}_renderTransparents(e,t,s,n,a){if(t.length>0){for(const{material:l}of t)l.side=Rs;this._renderObjects(t,s,n,a,"backSide");for(const{material:l}of t)l.side=tr;this._renderObjects(e,s,n,a);for(const{material:l}of t)l.side=Wr}else this._renderObjects(e,s,n,a)}_renderObjects(e,t,s,n,a=null){for(let l=0,u=e.length;l<u;l++){const{object:h,geometry:d,material:f,group:m,clippingContext:b}=e[l];this._currentRenderObjectFunction(h,s,t,d,f,m,n,b,a)}}_getShadowNodes(e){const t=e.version;let s=this._cacheShadowNodes.get(e);if(s===void 0||s.version!==t){const n=e.map!==null,a=e.colorNode&&e.colorNode.isNode,l=e.castShadowNode&&e.castShadowNode.isNode,u=e.maskShadowNode&&e.maskShadowNode.isNode||e.maskNode&&e.maskNode.isNode;let h=null,d=null,f=null;if(n||a||l||u){let m,b;if(l?(m=e.castShadowNode.rgb,b=e.castShadowNode.a,this.shadowMap.transmitted!==!0&&ft("Renderer: `shadowMap.transmitted` needs to be set to `true` when using `material.castShadowNode`.")):(m=L(0),b=A(1)),n&&(b=b.mul(Rt("map","texture",e).a)),a&&(b=b.mul(e.colorNode.a)),d=Se(m,b),u){const x=e.maskShadowNode||e.maskNode;d=P(([v])=>(x.not().discard(),v))(d)}}e.depthNode&&e.depthNode.isNode&&(f=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?h=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(h=e.positionNode),s={version:t,colorNode:d,depthNode:f,positionNode:h},this._cacheShadowNodes.set(e,s)}return s}renderObject(e,t,s,n,a,l,u,h=null,d=null){let f=!1,m,b,x,v;if(e.onBeforeRender(this,t,s,n,a,l),a.allowOverride===!0&&t.overrideMaterial!==null){const T=t.overrideMaterial;if(f=!0,m=T.isNodeMaterial?T.colorNode:null,b=T.isNodeMaterial?T.depthNode:null,x=T.isNodeMaterial?T.positionNode:null,v=t.overrideMaterial.side,a.positionNode&&a.positionNode.isNode&&(T.positionNode=a.positionNode),T.alphaTest=a.alphaTest,T.alphaMap=a.alphaMap,T.transparent=a.transparent||a.transmission>0||a.transmissionNode&&a.transmissionNode.isNode||a.backdropNode&&a.backdropNode.isNode,T.isShadowPassMaterial){const{colorNode:w,depthNode:N,positionNode:C}=this._getShadowNodes(a);this.shadowMap.type===Ih?T.side=a.shadowSide!==null?a.shadowSide:a.side:T.side=a.shadowSide!==null?a.shadowSide:iq[a.side],w!==null&&(T.colorNode=w),N!==null&&(T.depthNode=N),C!==null&&(T.positionNode=C)}a=T}a.transparent===!0&&a.side===Wr&&a.forceSinglePass===!1?(a.side=Rs,this._handleObjectFunction(e,a,t,s,u,l,h,"backSide"),a.side=tr,this._handleObjectFunction(e,a,t,s,u,l,h,d),a.side=Wr):this._handleObjectFunction(e,a,t,s,u,l,h,d),f&&(t.overrideMaterial.colorNode=m,t.overrideMaterial.depthNode=b,t.overrideMaterial.positionNode=x,t.overrideMaterial.side=v),e.onAfterRender(this,t,s,n,a,l)}hasCompatibility(e){return this.backend.hasCompatibility(e)}_renderObjectDirect(e,t,s,n,a,l,u,h){const d=this._objects.get(e,t,s,n,a,this._currentRenderContext,u,h);d.drawRange=e.geometry.drawRange,d.group=l,this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(d),d.bundle=this._currentRenderBundle.bundleGroup);const f=this._nodes.needsRefresh(d);f&&(this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d)),this._pipelines.updateForRender(d),this.backend.draw(d,this.info),f&&this._nodes.updateAfter(d)}_createObjectPipeline(e,t,s,n,a,l,u,h){const d=this._objects.get(e,t,s,n,a,this._currentRenderContext,u,h);d.drawRange=e.geometry.drawRange,d.group=l,this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d),this._pipelines.getForRender(d,this._compilationPromises),this._nodes.updateAfter(d)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class XD{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function aq(i){return i+(no-i%no)%no}class YD extends XD{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return aq(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class KD extends YD{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let oq=0;class ZD extends KD{constructor(e,t){super("UniformBuffer_"+oq++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class lq extends KD{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[],this._updateRangeCache=new Map}addUniformUpdateRange(e){const t=e.index;if(this._updateRangeCache.has(t)!==!0){const s=this.updateRanges,n=e.offset,a=e.itemSize,l={start:n,count:a};s.push(l),this._updateRangeCache.set(t,l)}}clearUpdateRanges(){this._updateRangeCache.clear(),super.clearUpdateRanges()}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let s=0,n=this.uniforms.length;s<n;s++){const a=this.uniforms[s],l=a.boundary,u=a.itemSize*e,h=t%no,d=h%l,f=h+d;t+=d,f!==0&&no-f<u&&(t+=no-f),a.offset=t/e,a.index=s,t+=u}return Math.ceil(t/no)*no}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);le("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const s=this.values,n=e.getValue(),a=e.offset,l=e.getType();if(s[a]!==n){const u=this._getBufferForType(l);u[a]=s[a]=n,t=!0,this.addUniformUpdateRange(e)}return t}updateVector2(e){let t=!1;const s=this.values,n=e.getValue(),a=e.offset,l=e.getType();if(s[a+0]!==n.x||s[a+1]!==n.y){const u=this._getBufferForType(l);u[a+0]=s[a+0]=n.x,u[a+1]=s[a+1]=n.y,t=!0,this.addUniformUpdateRange(e)}return t}updateVector3(e){let t=!1;const s=this.values,n=e.getValue(),a=e.offset,l=e.getType();if(s[a+0]!==n.x||s[a+1]!==n.y||s[a+2]!==n.z){const u=this._getBufferForType(l);u[a+0]=s[a+0]=n.x,u[a+1]=s[a+1]=n.y,u[a+2]=s[a+2]=n.z,t=!0,this.addUniformUpdateRange(e)}return t}updateVector4(e){let t=!1;const s=this.values,n=e.getValue(),a=e.offset,l=e.getType();if(s[a+0]!==n.x||s[a+1]!==n.y||s[a+2]!==n.z||s[a+4]!==n.w){const u=this._getBufferForType(l);u[a+0]=s[a+0]=n.x,u[a+1]=s[a+1]=n.y,u[a+2]=s[a+2]=n.z,u[a+3]=s[a+3]=n.w,t=!0,this.addUniformUpdateRange(e)}return t}updateColor(e){let t=!1;const s=this.values,n=e.getValue(),a=e.offset;if(s[a+0]!==n.r||s[a+1]!==n.g||s[a+2]!==n.b){const l=this.buffer;l[a+0]=s[a+0]=n.r,l[a+1]=s[a+1]=n.g,l[a+2]=s[a+2]=n.b,t=!0,this.addUniformUpdateRange(e)}return t}updateMatrix3(e){let t=!1;const s=this.values,n=e.getValue().elements,a=e.offset;if(s[a+0]!==n[0]||s[a+1]!==n[1]||s[a+2]!==n[2]||s[a+4]!==n[3]||s[a+5]!==n[4]||s[a+6]!==n[5]||s[a+8]!==n[6]||s[a+9]!==n[7]||s[a+10]!==n[8]){const l=this.buffer;l[a+0]=s[a+0]=n[0],l[a+1]=s[a+1]=n[1],l[a+2]=s[a+2]=n[2],l[a+4]=s[a+4]=n[3],l[a+5]=s[a+5]=n[4],l[a+6]=s[a+6]=n[5],l[a+8]=s[a+8]=n[6],l[a+9]=s[a+9]=n[7],l[a+10]=s[a+10]=n[8],t=!0,this.addUniformUpdateRange(e)}return t}updateMatrix4(e){let t=!1;const s=this.values,n=e.getValue().elements,a=e.offset;return cq(s,n,a)===!1&&(this.buffer.set(n,a),uq(s,n,a),t=!0,this.addUniformUpdateRange(e)),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function uq(i,e,t){for(let s=0,n=e.length;s<n;s++)i[t+s]=e[s]}function cq(i,e,t){for(let s=0,n=e.length;s<n;s++)if(i[t+s]!==e[s])return!1;return!0}let hq=0;class QD extends lq{constructor(e,t){super(e),this.id=hq++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class JD extends XD{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=-1},this.texture=t,this.version=t?t.version:-1,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=-1,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=-1},e.texture=this.texture,e}}let dq=0;class pq extends JD{constructor(e,t){super(e,t),this.id=dq++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class iy extends pq{constructor(e,t,s,n=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=s,this.access=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class e3 extends iy{constructor(e,t,s,n=null){super(e,t,s,n),this.isSampledCubeTexture=!0}}class R_ extends iy{constructor(e,t,s,n=null){super(e,t,s,n),this.isSampledTexture3D=!0}}const jA={bitcast_int_uint:new fs("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new fs("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},fq={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},$A={low:"lowp",medium:"mediump",high:"highp"},WA={swizzleAssign:!0,storageBuffer:!1},XA={perspective:"smooth",linear:"noperspective"},YA={centroid:"centroid"},KA=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision highp sampler2DShadow;
precision highp sampler2DArrayShadow;
precision highp samplerCubeShadow;
`;class mq extends jD{constructor(e,t){super(e,t,new q9),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==mo}_include(e){const t=jA[e];return t.build(this),this.addInclude(t),t}getMethod(e){return jA[e]!==void 0&&this._include(e),fq[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,s){return`${e} ? ${t} : ${s}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,s=this.flowShaderNode(e),n=[];for(const l of t.inputs)n.push(this.getType(l.type)+" "+l.name);return`${this.getType(t.type)} ${t.name}( ${n.join(", ")} ) {

	${s.vars}

${s.code}
	return ${s.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const s=t.array,n=t.count*t.itemSize,{itemSize:a}=t,l=t.array.constructor.name.toLowerCase().includes("int");let u=l?bg:yg;a===2?u=l?xg:Zi:a===3?u=l?sP:gg:a===4&&(u=l?_g:Pn);const h={Float32Array:cn,Uint8Array:Vs,Uint16Array:rl,Uint32Array:Gt,Int8Array:Gu,Int16Array:qu,Int32Array:Ps,Uint8ClampedArray:Vs},d=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/a))));let f=Math.ceil(n/a/d);d*f*a<n&&f++;const m=d*f*a,b=new s.constructor(m);b.set(s,0),t.array=b;const x=new gE(t.array,d,f,u,h[t.array.constructor.name]||cn);x.needsUpdate=!0,x.isPBOTexture=!0;const v=new ur(x,null,null);v.setPrecision("high"),t.pboNode=v,t.pbo=v.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:s}=e,n=t.value;if(this.renderer.backend.has(n)){const f=this.renderer.backend.get(n);f.pbo=n.pbo}const a=this.getUniformFromNode(n.pboNode,"texture",this.shaderStage,this.context.nodeName),l=this.getPropertyName(a);this.increaseUsage(s);const u=s.build(this,"uint"),h=this.getDataFromNode(e);let d=h.propertyName;if(d===void 0){const f=this.getVarFromNode(e);d=this.getPropertyName(f);const m=this.getDataFromNode(t);let b=m.propertySizeName;b===void 0&&(b=d+"Size",this.getVarFromNode(t,b,"uint"),this.addLineFlowCode(`${b} = uint( textureSize( ${l}, 0 ).x )`,e),m.propertySizeName=b);const{itemSize:x}=n,v="."+xl.join("").slice(0,x),T=`ivec2(${u} % ${b}, ${u} / ${b})`,w=this.generateTextureLoad(null,l,T,"0",null,null);let N="vec4";n.pbo.type===Gt?N="uvec4":n.pbo.type===Ps&&(N="ivec4"),this.addLineFlowCode(`${d} = ${N}(${w})${v}`,e),h.propertyName=d}return d}generateTextureLoad(e,t,s,n,a,l){n===null&&(n="0");let u;return a?l?u=`texelFetchOffset( ${t}, ivec3( ${s}, ${a} ), ${n}, ${l} )`:u=`texelFetch( ${t}, ivec3( ${s}, ${a} ), ${n} )`:l?u=`texelFetchOffset( ${t}, ${s}, ${n}, ${l} )`:u=`texelFetch( ${t}, ${s}, ${n} )`,e!==null&&e.isDepthTexture&&(u+=".x"),u}generateTexture(e,t,s,n,a){return n&&(s=`vec3( ${s}, ${n} )`),e.isDepthTexture?a?`textureOffset( ${t}, ${s}, ${a} ).x`:`texture( ${t}, ${s} ).x`:a?`textureOffset( ${t}, ${s}, ${a} )`:`texture( ${t}, ${s} )`}generateTextureLevel(e,t,s,n,a,l){return a&&(s=`vec3( ${s}, ${a} )`),l?`textureLodOffset( ${t}, ${s}, ${n}, ${l} )`:`textureLod( ${t}, ${s}, ${n} )`}generateTextureBias(e,t,s,n,a,l){return a&&(s=`vec3( ${s}, ${a} )`),l?`textureOffset( ${t}, ${s}, ${l}, ${n} )`:`texture( ${t}, ${s}, ${n} )`}generateTextureGrad(e,t,s,n,a,l){return a&&(s=`vec3( ${s}, ${a} )`),l?`textureGradOffset( ${t}, ${s}, ${n[0]}, ${n[1]}, ${l} )`:`textureGrad( ${t}, ${s}, ${n[0]}, ${n[1]} )`}generateTextureCompare(e,t,s,n,a,l,u=this.shaderStage){if(u==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${s}, ${n} ) )`:a?l?`textureOffset( ${t}, vec4( ${s}, ${a}, ${n} ), ${l} )`:`texture( ${t}, vec4( ${s}, ${a}, ${n} ) )`:l?`textureOffset( ${t}, vec3( ${s}, ${n} ), ${l} )`:`texture( ${t}, vec3( ${s}, ${n} ) )`;le(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${u} shader.`)}getVars(e){const t=[],s=this.vars[e];if(s!==void 0)for(const n of s)t.push(`${this.getVar(n.type,n.name,n.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],s=[],n={};for(const l of t){let u=null,h=!1;if(l.type==="texture"||l.type==="texture3D"){const d=l.node.value;let f="";(d.isDataTexture===!0||d.isData3DTexture===!0)&&(d.type===Gt?f="u":d.type===Ps&&(f="i")),l.type==="texture3D"&&d.isArrayTexture===!1?u=`${f}sampler3D ${l.name};`:d.compareFunction?d.isArrayTexture===!0?u=`sampler2DArrayShadow ${l.name};`:u=`sampler2DShadow ${l.name};`:d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0?u=`${f}sampler2DArray ${l.name};`:u=`${f}sampler2D ${l.name};`}else if(l.type==="cubeTexture")u=`samplerCube ${l.name};`;else if(l.type==="cubeDepthTexture")l.node.value.compareFunction?u=`samplerCubeShadow ${l.name};`:u=`samplerCube ${l.name};`;else if(l.type==="buffer"){const d=l.node,f=this.getType(d.bufferType),m=d.bufferCount,b=m>0?m:"";u=`${d.name} {
	${f} ${l.name}[${b}];
};
`}else{const d=l.groupNode.name;if(n[d]===void 0){const f=this.uniformGroups[d];if(f!==void 0){const m=[];for(const b of f.uniforms){const x=b.getType(),v=this.getVectorType(x),T=b.nodeUniform.node.precision;let w=`${v} ${b.name};`;T!==null&&(w=$A[T]+" "+w),m.push("	"+w)}n[d]=m}}h=!0}if(!h){const d=l.node.precision;d!==null&&(u=$A[d]+" "+u),u="uniform "+u,s.push(u)}}let a="";for(const l in n){const u=n[l];a+=this._getGLSLUniformStruct(l,u.join(`
`))+`
`}return a+=s.join(`
`),a}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ps){let s=e;e.isInterleavedBufferAttribute&&(s=e.data);const n=s.array;n instanceof Uint32Array||n instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const s=this.getAttributesArray();let n=0;for(const a of s)t+=`layout( location = ${n++} ) in ${a.type} ${a.name};
`}return t}getStructMembers(e){const t=[];for(const s of e.members)t.push(`	${s.type} ${s.name};`);return t.join(`
`)}getStructs(e){const t=[],s=this.structs[e],n=[];for(const a of s)if(a.output)for(const l of a.members)n.push(`layout( location = ${l.index} ) out ${l.type} ${l.name};`);else{let l="struct "+a.name+` {
`;l+=this.getStructMembers(a),l+=`
};
`,t.push(l)}return n.length===0&&n.push("layout( location = 0 ) out vec4 fragColor;"),`
`+n.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const s=this.varyings;if(e==="vertex"||e==="compute")for(const n of s){e==="compute"&&(n.needsInterpolation=!0);const a=this.getType(n.type);if(n.needsInterpolation)if(n.interpolationType){const l=XA[n.interpolationType]||n.interpolationType,u=YA[n.interpolationSampling]||"";t+=`${l} ${u} out ${a} ${n.name};
`}else{const l=a.includes("int")||a.includes("uv")||a.includes("iv")?"flat ":"";t+=`${l}out ${a} ${n.name};
`}else t+=`${a} ${n.name};
`}else if(e==="fragment"){for(const n of s)if(n.needsInterpolation){const a=this.getType(n.type);if(n.interpolationType){const l=XA[n.interpolationType]||n.interpolationType,u=YA[n.interpolationSampling]||"";t+=`${l} ${u} in ${a} ${n.name};
`}else{const l=a.includes("int")||a.includes("uv")||a.includes("iv")?"flat ":"";t+=`${l}in ${a} ${n.name};
`}}}for(const n of this.builtins[e])t+=`${n};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((s,n)=>s*n,1)}u`}getSubgroupSize(){le("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){le("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){le("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,s=this.shaderStage){const n=this.extensions[s]||(this.extensions[s]=new Map);n.has(e)===!1&&n.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const n=this.renderer.backend.extensions;this.object.isBatchedMesh&&n.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const s=this.extensions[e];if(s!==void 0)for(const{name:n,behavior:a}of s.values())t.push(`#extension ${n} : ${a}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=WA[e];if(t===void 0){let s;switch(t=!1,e){case"float32Filterable":s="OES_texture_float_linear";break;case"clipDistance":s="WEBGL_clip_cull_distance";break}if(s!==void 0){const n=this.renderer.backend.extensions;n.has(s)&&(n.get(s),t=!0)}WA[e]=t}return t}isFlipY(){return!0}getUniformBufferLimit(){const e=this.renderer.backend.gl;return e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE)}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let s=0;s<e.length;s++){const n=e[s],a=this.getPropertyName(n.attributeNode);a&&(t+=`${n.varyingName} = ${a};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${KA}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${KA}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let s=`// code

`;s+=this.flowCode[t];const n=this.flowNodes[t],a=n[n.length-1];for(const u of n){const h=this.getFlowData(u),d=u.name;d&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${d}
	`),s+=`${h.code}
	`,u===a&&t!=="compute"&&(s+=`// result
	`,t==="vertex"?(s+="gl_Position = ",s+=`${h.result};`):t==="fragment"&&(u.outputNode.isOutputStructNode||(s+="fragColor = ",s+=`${h.result};`)))}const l=e[t];l.extensions=this.getExtensions(t),l.uniforms=this.getUniforms(t),l.attributes=this.getAttributes(t),l.varyings=this.getVaryings(t),l.vars=this.getVars(t),l.structs=this.getStructs(t),l.codes=this.getCodes(t),l.transforms=this.getTransforms(t),l.flow=s}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,s,n=null){const a=super.getUniformFromNode(e,t,s,n),l=this.getDataFromNode(e,s,this.globalCache);let u=l.uniformGPU;if(u===void 0){const h=e.groupNode,d=h.name,f=this.getBindGroupArray(d,s);if(t==="texture")u=new iy(a.name,a.node,h),f.push(u);else if(t==="cubeTexture"||t==="cubeDepthTexture")u=new e3(a.name,a.node,h),f.push(u);else if(t==="texture3D")u=new R_(a.name,a.node,h),f.push(u);else if(t==="buffer"){a.name=`buffer${e.id}`;const m=this.getSharedDataFromNode(e);let b=m.buffer;b===void 0&&(e.name=`NodeBuffer_${e.id}`,b=new ZD(e,h),b.name=e.name,m.buffer=b),f.push(b),u=b}else{let m=this.uniformGroups[d];m===void 0?(m=new QD(d,h),this.uniformGroups[d]=m,f.push(m)):f.indexOf(m)===-1&&f.push(m),u=this.getNodeUniform(a,t);const b=u.name;m.uniforms.some(v=>v.name===b)||m.addUniform(u)}l.uniformGPU=u}return a}}let Ux=null,Ru=null;class t3{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[Qi.RENDER]:null,[Qi.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),s=this.renderer.info.frame;let n;e.isComputeNode===!0?n="c:"+this.renderer.info.compute.frameCalls:n="r:"+this.renderer.info.render.frameCalls,t.timestampUID=n+":"+e.id+":f"+s}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?Qi.COMPUTE:Qi.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){ft("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const s=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=s,s}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return Ux=Ux||new Ue,this.renderer.getDrawingBufferSize(Ux)}setScissorTest(){}getClearColor(){const e=this.renderer;return Ru=Ru||new bT,e.getClearColor(Ru),Ru.getRGB(Ru),Ru}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:TP(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${yd} webgpu`),this.domElement=e),e}hasCompatibility(){return!1}initRenderTarget(){}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let gq=0;class yq{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class bq{constructor(e){this.backend=e}createAttribute(e,t){const s=this.backend,{gl:n}=s,a=e.array,l=e.usage||n.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,h=s.get(u);let d=h.bufferGPU;d===void 0&&(d=this._createBuffer(n,t,a,l),h.bufferGPU=d,h.bufferType=t,h.version=u.version);let f;if(a instanceof Float32Array)f=n.FLOAT;else if(typeof Float16Array<"u"&&a instanceof Float16Array)f=n.HALF_FLOAT;else if(a instanceof Uint16Array)e.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(a instanceof Int16Array)f=n.SHORT;else if(a instanceof Uint32Array)f=n.UNSIGNED_INT;else if(a instanceof Int32Array)f=n.INT;else if(a instanceof Int8Array)f=n.BYTE;else if(a instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(a instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+a);let m={bufferGPU:d,bufferType:t,type:f,byteLength:a.byteLength,bytesPerElement:a.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:f===n.INT||f===n.UNSIGNED_INT||e.gpuType===Ps,id:gq++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const b=this._createBuffer(n,t,a,l);m=new yq(m,b)}s.set(e,m)}updateAttribute(e){const t=this.backend,{gl:s}=t,n=e.array,a=e.isInterleavedBufferAttribute?e.data:e,l=t.get(a),u=l.bufferType,h=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(s.bindBuffer(u,l.bufferGPU),h.length===0)s.bufferSubData(u,0,n);else{for(let d=0,f=h.length;d<f;d++){const m=h[d];s.bufferSubData(u,m.start*n.BYTES_PER_ELEMENT,n,m.start,m.count)}a.clearUpdateRanges()}s.bindBuffer(u,null),l.version=a.version}destroyAttribute(e){const t=this.backend,{gl:s}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const n=t.get(e);s.deleteBuffer(n.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:s}=t,n=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:a}=t.get(n),l=e.array,u=l.byteLength;s.bindBuffer(s.COPY_READ_BUFFER,a);const h=s.createBuffer();s.bindBuffer(s.COPY_WRITE_BUFFER,h),s.bufferData(s.COPY_WRITE_BUFFER,u,s.STREAM_READ),s.copyBufferSubData(s.COPY_READ_BUFFER,s.COPY_WRITE_BUFFER,0,0,u),await t.utils._clientWaitAsync();const d=new e.array.constructor(l.length);return s.bindBuffer(s.COPY_WRITE_BUFFER,h),s.getBufferSubData(s.COPY_WRITE_BUFFER,0,d),s.deleteBuffer(h),s.bindBuffer(s.COPY_READ_BUFFER,null),s.bindBuffer(s.COPY_WRITE_BUFFER,null),d.buffer}_createBuffer(e,t,s,n){const a=e.createBuffer();return e.bindBuffer(t,a),e.bufferData(t,s,n),e.bindBuffer(t,null),a}}let Bh,zr;class xq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthReversed=!1,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;Bh={[ai]:e.FUNC_ADD,[GC]:e.FUNC_SUBTRACT,[qC]:e.FUNC_REVERSE_SUBTRACT},zr={[Ka]:e.ZERO,[HC]:e.ONE,[jC]:e.SRC_COLOR,[ed]:e.SRC_ALPHA,[ZC]:e.SRC_ALPHA_SATURATE,[YC]:e.DST_COLOR,[WC]:e.DST_ALPHA,[$C]:e.ONE_MINUS_SRC_COLOR,[td]:e.ONE_MINUS_SRC_ALPHA,[KC]:e.ONE_MINUS_DST_COLOR,[XC]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),s=e.getParameter(e.VIEWPORT);this.currentScissor=new rt().fromArray(t),this.currentViewport=new rt().fromArray(s),this._tempVec4=new rt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==IF?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===kF?t.cullFace(t.BACK):e===GF?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:s}=this;e!==t&&(s.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e,t,s){const n=this.gl,a=this.backend.drawBuffersIndexedExt;if(!a){ft("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets.");return}for(let l=0;l<e.length;l++){const u=e[l];let h=null;if(t!==null){const d=t.getBlendMode(u.name);d.blending===k_?h=s:d.blending!==Xr&&(h=d)}else h=s;h!==null?this._setMRTBlendingIndex(l,h):a.blendFuncSeparateiOES(l,n.ONE,n.ZERO,n.ONE,n.ZERO)}}_setMRTBlendingIndex(e,t){const{gl:s}=this,n=this.backend.drawBuffersIndexedExt,a=t.blending,l=t.blendSrc,u=t.blendDst,h=t.blendEquation,d=t.premultipliedAlpha;if(a===ku){const f=t.blendSrcAlpha!==null?t.blendSrcAlpha:l,m=t.blendDstAlpha!==null?t.blendDstAlpha:u,b=t.blendEquationAlpha!==null?t.blendEquationAlpha:h;n.blendEquationSeparateiOES(e,Bh[h],Bh[b]),n.blendFuncSeparateiOES(e,zr[l],zr[u],zr[f],zr[m])}else if(n.blendEquationSeparateiOES(e,s.FUNC_ADD,s.FUNC_ADD),d)switch(a){case ri:n.blendFuncSeparateiOES(e,s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Pu:n.blendFuncSeparateiOES(e,s.ONE,s.ONE,s.ONE,s.ONE);break;case Ou:n.blendFuncSeparateiOES(e,s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case Vu:n.blendFuncSeparateiOES(e,s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ZERO,s.ONE);break;default:n.blendFuncSeparateiOES(e,s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break}else switch(a){case ri:n.blendFuncSeparateiOES(e,s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Pu:n.blendFuncSeparateiOES(e,s.SRC_ALPHA,s.ONE,s.ONE,s.ONE);break;case Ou:n.blendFuncSeparateiOES(e,s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case Vu:n.blendFuncSeparateiOES(e,s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ZERO,s.ONE);break;default:n.blendFuncSeparateiOES(e,s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break}}setBlending(e,t,s,n,a,l,u,h){const{gl:d}=this;if(e===Xr){this.currentBlendingEnabled===!0&&(this.disable(d.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(d.BLEND),this.currentBlendingEnabled=!0),e!==ku){if(e!==this.currentBlending||h!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==ai||this.currentBlendEquationAlpha!==ai)&&(d.blendEquation(d.FUNC_ADD),this.currentBlendEquation=ai,this.currentBlendEquationAlpha=ai),h)switch(e){case ri:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Pu:d.blendFunc(d.ONE,d.ONE);break;case Ou:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case Vu:d.blendFuncSeparate(d.DST_COLOR,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE);break;default:le("WebGLState: Invalid blending: ",e);break}else switch(e){case ri:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Pu:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE,d.ONE,d.ONE);break;case Ou:le("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Vu:le("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:le("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=h}return}a=a||t,l=l||s,u=u||n,(t!==this.currentBlendEquation||a!==this.currentBlendEquationAlpha)&&(d.blendEquationSeparate(Bh[t],Bh[a]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=a),(s!==this.currentBlendSrc||n!==this.currentBlendDst||l!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(d.blendFuncSeparate(zr[s],zr[n],zr[l],zr[u]),this.currentBlendSrc=s,this.currentBlendDst=n,this.currentBlendSrcAlpha=l,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setReversedDepth(e){if(this.currentDepthReversed!==e){const t=this.backend.extensions.get("EXT_clip_control");e?t.clipControlEXT(t.LOWER_LEFT_EXT,t.ZERO_TO_ONE_EXT):t.clipControlEXT(t.LOWER_LEFT_EXT,t.NEGATIVE_ONE_TO_ONE_EXT),this.currentDepthReversed=e}}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthReversed&&(e=uE[e]),this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case dm:t.depthFunc(t.NEVER);break;case pm:t.depthFunc(t.ALWAYS);break;case fm:t.depthFunc(t.LESS);break;case Qu:t.depthFunc(t.LEQUAL);break;case mm:t.depthFunc(t.EQUAL);break;case gm:t.depthFunc(t.GEQUAL);break;case ym:t.depthFunc(t.GREATER);break;case bm:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,s,n){const a=this._tempVec4.set(e,t,s,n);if(this.currentScissor.equals(a)===!1){const{gl:l}=this;l.scissor(a.x,a.y,a.z,a.w),this.currentScissor.copy(a)}}viewport(e,t,s,n){const a=this._tempVec4.set(e,t,s,n);if(this.currentViewport.equals(a)===!1){const{gl:l}=this;l.viewport(a.x,a.y,a.z,a.w),this.currentViewport.copy(a)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,s){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==s)&&(this.gl.stencilFunc(e,t,s),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=s)}setStencilOp(e,t,s){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==s)&&(this.gl.stencilOp(e,t,s),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=s)}setMaterial(e,t,s){const{gl:n}=this;e.side===Wr?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);let a=e.side===Rs;t&&(a=!a),this.setFlipSided(a),e.blending===ri&&e.transparent===!1?this.setBlending(Xr):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const l=e.stencilWrite;if(this.setStencilTest(l),l&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE),s>0&&this.currentClippingPlanes!==s)for(let h=0;h<8;h++)h<s?this.enable(12288+h):this.disable(12288+h)}setPolygonOffset(e,t,s){const{gl:n}=this;e?(this.enable(n.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==s)&&(n.polygonOffset(t,s),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=s)):this.disable(n.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const s=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(s.bindVertexArray(e),t!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:s,currentBoundFramebuffers:n}=this;return n[e]!==t?(s.bindFramebuffer(e,t),n[e]=t,e===s.DRAW_FRAMEBUFFER&&(n[s.FRAMEBUFFER]=t),e===s.FRAMEBUFFER&&(n[s.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:s}=this;let n=[],a=!1;if(e.textures!==null){n=this.currentDrawbuffers.get(t),n===void 0&&(n=[],this.currentDrawbuffers.set(t,n));const l=e.textures;if(n.length!==l.length||n[0]!==s.COLOR_ATTACHMENT0){for(let u=0,h=l.length;u<h;u++)n[u]=s.COLOR_ATTACHMENT0+u;n.length=l.length,a=!0}}else n[0]!==s.BACK&&(n[0]=s.BACK,a=!0);a&&s.drawBuffers(n)}activeTexture(e){const{gl:t,currentTextureSlot:s,maxTextures:n}=this;e===void 0&&(e=t.TEXTURE0+n-1),s!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,s){const{gl:n,currentTextureSlot:a,currentBoundTextures:l,maxTextures:u}=this;s===void 0&&(a===null?s=n.TEXTURE0+u-1:s=a);let h=l[s];h===void 0&&(h={type:void 0,texture:void 0},l[s]=h),(h.type!==e||h.texture!==t)&&(a!==s&&(n.activeTexture(s),this.currentTextureSlot=s),n.bindTexture(e,t),h.type=e,h.texture=t)}bindBufferBase(e,t,s){const{gl:n}=this,a=`${e}-${t}`;return this.currentBoundBufferBases[a]!==s?(n.bindBufferBase(e,t,s),this.currentBoundBufferBases[a]=s,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:s}=this,n=s[t];n!==void 0&&n.type!==void 0&&(e.bindTexture(n.type,null),n.type=void 0,n.texture=void 0)}}class _q{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=mo){const{gl:s,extensions:n}=this;let a;const l=nt.getTransfer(t);if(e===Vs)return s.UNSIGNED_BYTE;if(e===JC)return s.UNSIGNED_SHORT_4_4_4_4;if(e===eE)return s.UNSIGNED_SHORT_5_5_5_1;if(e===j_)return s.UNSIGNED_INT_5_9_9_9_REV;if(e===$_)return s.UNSIGNED_INT_10F_11F_11F_REV;if(e===Gu)return s.BYTE;if(e===qu)return s.SHORT;if(e===rl)return s.UNSIGNED_SHORT;if(e===Ps)return s.INT;if(e===Gt)return s.UNSIGNED_INT;if(e===cn)return s.FLOAT;if(e===Cs)return s.HALF_FLOAT;if(e===tE)return s.ALPHA;if(e===gg)return s.RGB;if(e===Pn)return s.RGBA;if(e===Ri)return s.DEPTH_COMPONENT;if(e===Yr)return s.DEPTH_STENCIL;if(e===yg)return s.RED;if(e===bg)return s.RED_INTEGER;if(e===Zi)return s.RG;if(e===xg)return s.RG_INTEGER;if(e===_g)return s.RGBA_INTEGER;if(e===kh||e===Gh||e===qh||e===Hh)if(l===Fe)if(a=n.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(e===kh)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Gh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===qh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Hh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=n.get("WEBGL_compressed_texture_s3tc"),a!==null){if(e===kh)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Gh)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===qh)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Hh)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===e_||e===t_||e===s_||e===n_)if(a=n.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(e===e_)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===t_)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===s_)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===n_)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===_m||e===vm||e===Tm||e===Sm||e===wm||e===nd||e===Mm)if(a=n.get("WEBGL_compressed_texture_etc"),a!==null){if(e===_m||e===vm)return l===Fe?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(e===Tm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC;if(e===Sm)return a.COMPRESSED_R11_EAC;if(e===wm)return a.COMPRESSED_SIGNED_R11_EAC;if(e===nd)return a.COMPRESSED_RG11_EAC;if(e===Mm)return a.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===Nm||e===Am||e===Cm||e===Em||e===Rm||e===Bm||e===Dm||e===Lm||e===Um||e===Fm||e===Pm||e===Om||e===Vm||e===zm)if(a=n.get("WEBGL_compressed_texture_astc"),a!==null){if(e===Nm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Am)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Cm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Em)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Rm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Bm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Dm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Lm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Um)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Fm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Pm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Om)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Vm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===zm)return l===Fe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Im)if(a=n.get("EXT_texture_compression_bptc"),a!==null){if(e===Im)return l===Fe?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===km||e===Gm||e===id||e===qm)if(a=n.get("EXT_texture_compression_rgtc"),a!==null){if(e===km)return a.COMPRESSED_RED_RGTC1_EXT;if(e===Gm)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===id)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===qm)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===lo?s.UNSIGNED_INT_24_8:s[e]!==void 0?s[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((s,n)=>{function a(){const l=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(l===e.WAIT_FAILED){e.deleteSync(t),n();return}if(l===e.TIMEOUT_EXPIRED){requestAnimationFrame(a);return}e.deleteSync(t),s()}a()})}}let ZA=!1,Zf,Fx,QA;class vq{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,ZA===!1&&(this._init(),ZA=!0)}_init(){const e=this.gl;Zf={[ec]:e.REPEAT,[Ki]:e.CLAMP_TO_EDGE,[tc]:e.MIRRORED_REPEAT},Fx={[qt]:e.NEAREST,[QC]:e.NEAREST_MIPMAP_NEAREST,[sd]:e.NEAREST_MIPMAP_LINEAR,[Gs]:e.LINEAR,[Jx]:e.LINEAR_MIPMAP_NEAREST,[oo]:e.LINEAR_MIPMAP_LINEAR},QA={[nE]:e.NEVER,[oE]:e.ALWAYS,[W_]:e.LESS,[vg]:e.LEQUAL,[iE]:e.EQUAL,[Tg]:e.GEQUAL,[rE]:e.GREATER,[aE]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let s;return e.isCubeTexture===!0?s=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?s=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?s=t.TEXTURE_3D:s=t.TEXTURE_2D,s}getInternalFormat(e,t,s,n,a=!1){const{gl:l,extensions:u}=this;if(e!==null){if(l[e]!==void 0)return l[e];ue("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let h=t;if(t===l.RED&&(s===l.FLOAT&&(h=l.R32F),s===l.HALF_FLOAT&&(h=l.R16F),s===l.UNSIGNED_BYTE&&(h=l.R8),s===l.UNSIGNED_SHORT&&(h=l.R16),s===l.UNSIGNED_INT&&(h=l.R32UI),s===l.BYTE&&(h=l.R8I),s===l.SHORT&&(h=l.R16I),s===l.INT&&(h=l.R32I)),t===l.RED_INTEGER&&(s===l.UNSIGNED_BYTE&&(h=l.R8UI),s===l.UNSIGNED_SHORT&&(h=l.R16UI),s===l.UNSIGNED_INT&&(h=l.R32UI),s===l.BYTE&&(h=l.R8I),s===l.SHORT&&(h=l.R16I),s===l.INT&&(h=l.R32I)),t===l.RG&&(s===l.FLOAT&&(h=l.RG32F),s===l.HALF_FLOAT&&(h=l.RG16F),s===l.UNSIGNED_BYTE&&(h=l.RG8),s===l.UNSIGNED_SHORT&&(h=l.RG16),s===l.UNSIGNED_INT&&(h=l.RG32UI),s===l.BYTE&&(h=l.RG8I),s===l.SHORT&&(h=l.RG16I),s===l.INT&&(h=l.RG32I)),t===l.RG_INTEGER&&(s===l.UNSIGNED_BYTE&&(h=l.RG8UI),s===l.UNSIGNED_SHORT&&(h=l.RG16UI),s===l.UNSIGNED_INT&&(h=l.RG32UI),s===l.BYTE&&(h=l.RG8I),s===l.SHORT&&(h=l.RG16I),s===l.INT&&(h=l.RG32I)),t===l.RGB){const d=a?jm:nt.getTransfer(n);s===l.FLOAT&&(h=l.RGB32F),s===l.HALF_FLOAT&&(h=l.RGB16F),s===l.UNSIGNED_BYTE&&(h=l.RGB8),s===l.UNSIGNED_SHORT&&(h=l.RGB16),s===l.UNSIGNED_INT&&(h=l.RGB32UI),s===l.BYTE&&(h=l.RGB8I),s===l.SHORT&&(h=l.RGB16I),s===l.INT&&(h=l.RGB32I),s===l.UNSIGNED_BYTE&&(h=d===Fe?l.SRGB8:l.RGB8),s===l.UNSIGNED_SHORT_5_6_5&&(h=l.RGB565),s===l.UNSIGNED_SHORT_5_5_5_1&&(h=l.RGB5_A1),s===l.UNSIGNED_SHORT_4_4_4_4&&(h=l.RGB4),s===l.UNSIGNED_INT_5_9_9_9_REV&&(h=l.RGB9_E5),s===l.UNSIGNED_INT_10F_11F_11F_REV&&(h=l.R11F_G11F_B10F)}if(t===l.RGB_INTEGER&&(s===l.UNSIGNED_BYTE&&(h=l.RGB8UI),s===l.UNSIGNED_SHORT&&(h=l.RGB16UI),s===l.UNSIGNED_INT&&(h=l.RGB32UI),s===l.BYTE&&(h=l.RGB8I),s===l.SHORT&&(h=l.RGB16I),s===l.INT&&(h=l.RGB32I)),t===l.RGBA){const d=a?jm:nt.getTransfer(n);s===l.FLOAT&&(h=l.RGBA32F),s===l.HALF_FLOAT&&(h=l.RGBA16F),s===l.UNSIGNED_BYTE&&(h=l.RGBA8),s===l.UNSIGNED_SHORT&&(h=l.RGBA16),s===l.UNSIGNED_INT&&(h=l.RGBA32UI),s===l.BYTE&&(h=l.RGBA8I),s===l.SHORT&&(h=l.RGBA16I),s===l.INT&&(h=l.RGBA32I),s===l.UNSIGNED_BYTE&&(h=d===Fe?l.SRGB8_ALPHA8:l.RGBA8),s===l.UNSIGNED_SHORT_4_4_4_4&&(h=l.RGBA4),s===l.UNSIGNED_SHORT_5_5_5_1&&(h=l.RGB5_A1)}return t===l.RGBA_INTEGER&&(s===l.UNSIGNED_BYTE&&(h=l.RGBA8UI),s===l.UNSIGNED_SHORT&&(h=l.RGBA16UI),s===l.UNSIGNED_INT&&(h=l.RGBA32UI),s===l.BYTE&&(h=l.RGBA8I),s===l.SHORT&&(h=l.RGBA16I),s===l.INT&&(h=l.RGBA32I)),t===l.DEPTH_COMPONENT&&(s===l.UNSIGNED_SHORT&&(h=l.DEPTH_COMPONENT16),s===l.UNSIGNED_INT&&(h=l.DEPTH_COMPONENT24),s===l.FLOAT&&(h=l.DEPTH_COMPONENT32F)),t===l.DEPTH_STENCIL&&s===l.UNSIGNED_INT_24_8&&(h=l.DEPTH24_STENCIL8),(h===l.R16F||h===l.R32F||h===l.RG16F||h===l.RG32F||h===l.RGBA16F||h===l.RGBA32F)&&u.get("EXT_color_buffer_float"),h}setTextureParameters(e,t){const{gl:s,extensions:n,backend:a}=this,l=nt.getPrimaries(nt.workingColorSpace),u=t.colorSpace===mo?null:nt.getPrimaries(t.colorSpace),h=t.colorSpace===mo||l===u?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,h),s.texParameteri(e,s.TEXTURE_WRAP_S,Zf[t.wrapS]),s.texParameteri(e,s.TEXTURE_WRAP_T,Zf[t.wrapT]),(e===s.TEXTURE_3D||e===s.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||s.texParameteri(e,s.TEXTURE_WRAP_R,Zf[t.wrapR])),s.texParameteri(e,s.TEXTURE_MAG_FILTER,Fx[t.magFilter]);const d=t.mipmaps!==void 0&&t.mipmaps.length>0,f=t.minFilter===Gs&&d?oo:t.minFilter;if(s.texParameteri(e,s.TEXTURE_MIN_FILTER,Fx[f]),t.compareFunction&&(s.texParameteri(e,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(e,s.TEXTURE_COMPARE_FUNC,QA[t.compareFunction])),n.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===qt||t.minFilter!==sd&&t.minFilter!==oo||t.type===cn&&n.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const m=n.get("EXT_texture_filter_anisotropic");s.texParameterf(e,m.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,a.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:s,defaultTextures:n}=this,a=this.getGLTextureType(e);let l=n[a];l===void 0&&(l=t.createTexture(),s.state.bindTexture(a,l),t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST),n[a]=l),s.set(e,{textureGPU:l,glTextureType:a})}createTexture(e,t){const{gl:s,backend:n}=this,{levels:a,width:l,height:u,depth:h}=t,d=n.utils.convert(e.format,e.colorSpace),f=n.utils.convert(e.type),m=this.getInternalFormat(e.internalFormat,d,f,e.colorSpace,e.isVideoTexture),b=s.createTexture(),x=this.getGLTextureType(e);n.state.bindTexture(x,b),this.setTextureParameters(x,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?s.texStorage3D(s.TEXTURE_2D_ARRAY,a,m,l,u,h):e.isData3DTexture?s.texStorage3D(s.TEXTURE_3D,a,m,l,u,h):e.isVideoTexture||s.texStorage2D(x,a,m,l,u),n.set(e,{textureGPU:b,glTextureType:x,glFormat:d,glType:f,glInternalFormat:m})}copyBufferToTexture(e,t){const{gl:s,backend:n}=this,{textureGPU:a,glTextureType:l,glFormat:u,glType:h}=n.get(t),{width:d,height:f}=t.source.data;s.bindBuffer(s.PIXEL_UNPACK_BUFFER,e),n.state.bindTexture(l,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texSubImage2D(l,0,0,0,d,f,u,h,0),s.bindBuffer(s.PIXEL_UNPACK_BUFFER,null),n.state.unbindTexture()}updateTexture(e,t){const{gl:s}=this,{width:n,height:a}=t,{textureGPU:l,glTextureType:u,glFormat:h,glType:d,glInternalFormat:f}=this.backend.get(e);if(!(e.isRenderTargetTexture||l===void 0))if(this.backend.state.bindTexture(u,l),this.setTextureParameters(u,e),e.isCompressedTexture){const m=e.mipmaps,b=t.image;for(let x=0;x<m.length;x++){const v=m[x];e.isCompressedArrayTexture?e.format!==s.RGBA?h!==null?s.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,x,0,0,0,v.width,v.height,b.depth,h,v.data):ue("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):s.texSubImage3D(s.TEXTURE_2D_ARRAY,x,0,0,0,v.width,v.height,b.depth,h,d,v.data):h!==null?s.compressedTexSubImage2D(s.TEXTURE_2D,x,0,0,v.width,v.height,h,v.data):ue("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const m=t.images,b=e.mipmaps;for(let x=0;x<6;x++){const v=Qf(m[x]);s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,0,0,n,a,h,d,v);for(let T=0;T<b.length;T++){const w=b[T],N=Qf(w.images[x]);s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+x,T+1,0,0,N.width,N.height,h,d,N)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const m=t.image;if(e.layerUpdates.size>0){const b=LO(m.width,m.height,e.format,e.type);for(const x of e.layerUpdates){const v=m.data.subarray(x*b/m.data.BYTES_PER_ELEMENT,(x+1)*b/m.data.BYTES_PER_ELEMENT);s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,x,m.width,m.height,1,h,d,v)}e.clearLayerUpdates()}else s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,h,d,m.data)}else if(e.isData3DTexture){const m=t.image;s.texSubImage3D(s.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,h,d,m.data)}else if(e.isVideoTexture)e.update(),s.texImage2D(u,0,f,h,d,t.image);else{const m=e.mipmaps;if(m.length>0)for(let b=0,x=m.length;b<x;b++){const v=m[b],T=Qf(v);s.texSubImage2D(u,b,0,0,v.width,v.height,h,d,T)}else{const b=Qf(t.image);s.texSubImage2D(u,0,0,0,n,a,h,d,b)}}}generateMipmaps(e){const{gl:t,backend:s}=this,{textureGPU:n,glTextureType:a}=s.get(e);s.state.bindTexture(a,n),t.generateMipmap(a)}deallocateRenderBuffers(e){const{gl:t,backend:s}=this;if(e){const n=s.get(e);if(n.renderBufferStorageSetup=void 0,n.framebuffers){for(const a in n.framebuffers)t.deleteFramebuffer(n.framebuffers[a]);delete n.framebuffers}if(n.depthRenderbuffer&&(t.deleteRenderbuffer(n.depthRenderbuffer),delete n.depthRenderbuffer),n.stencilRenderbuffer&&(t.deleteRenderbuffer(n.stencilRenderbuffer),delete n.stencilRenderbuffer),n.msaaFrameBuffer&&(t.deleteFramebuffer(n.msaaFrameBuffer),delete n.msaaFrameBuffer),n.msaaRenderbuffers){for(let a=0;a<n.msaaRenderbuffers.length;a++)t.deleteRenderbuffer(n.msaaRenderbuffers[a]);delete n.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:s,backend:n}=this,{textureGPU:a,renderTarget:l}=n.get(e);this.deallocateRenderBuffers(l),t===!1&&s.deleteTexture(a),n.delete(e)}copyTextureToTexture(e,t,s=null,n=null,a=0,l=0){const{gl:u,backend:h}=this,{state:d}=this.backend,{textureGPU:f,glTextureType:m,glType:b,glFormat:x}=h.get(t);d.bindTexture(m,f);let v,T,w,N,C,R,E,k,q;const D=e.isCompressedTexture?e.mipmaps[l]:e.image;if(s!==null)v=s.max.x-s.min.x,T=s.max.y-s.min.y,w=s.isBox3?s.max.z-s.min.z:1,N=s.min.x,C=s.min.y,R=s.isBox3?s.min.z:0;else{const ge=Math.pow(2,-a);v=Math.floor(D.width*ge),T=Math.floor(D.height*ge),e.isDataArrayTexture||e.isArrayTexture?w=D.depth:e.isData3DTexture?w=Math.floor(D.depth*ge):w=1,N=0,C=0,R=0}n!==null?(E=n.x,k=n.y,q=n.z):(E=0,k=0,q=0),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,t.unpackAlignment);const I=u.getParameter(u.UNPACK_ROW_LENGTH),$=u.getParameter(u.UNPACK_IMAGE_HEIGHT),ae=u.getParameter(u.UNPACK_SKIP_PIXELS),pe=u.getParameter(u.UNPACK_SKIP_ROWS),me=u.getParameter(u.UNPACK_SKIP_IMAGES);u.pixelStorei(u.UNPACK_ROW_LENGTH,D.width),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,D.height),u.pixelStorei(u.UNPACK_SKIP_PIXELS,N),u.pixelStorei(u.UNPACK_SKIP_ROWS,C),u.pixelStorei(u.UNPACK_SKIP_IMAGES,R);const xe=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,Ce=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const ge=h.get(e),j=h.get(t),oe=h.get(ge.renderTarget),fe=h.get(j.renderTarget),Ne=oe.framebuffers[ge.cacheKey],De=fe.framebuffers[j.cacheKey];d.bindFramebuffer(u.READ_FRAMEBUFFER,Ne),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,De);for(let O=0;O<w;O++)xe&&(u.framebufferTextureLayer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,ge.textureGPU,a,R+O),u.framebufferTextureLayer(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,f,l,q+O)),u.blitFramebuffer(N,C,v,T,E,k,v,T,u.DEPTH_BUFFER_BIT,u.NEAREST);d.bindFramebuffer(u.READ_FRAMEBUFFER,null),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else if(a!==0||e.isRenderTargetTexture||h.has(e)){const ge=h.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=u.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=u.createFramebuffer()),d.bindFramebuffer(u.READ_FRAMEBUFFER,this._srcFramebuffer),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let j=0;j<w;j++)xe?u.framebufferTextureLayer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,ge.textureGPU,a,R+j):u.framebufferTexture2D(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,ge.textureGPU,a),Ce?u.framebufferTextureLayer(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,f,l,q+j):u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,f,l),a!==0?u.blitFramebuffer(N,C,v,T,E,k,v,T,u.COLOR_BUFFER_BIT,u.NEAREST):Ce?u.copyTexSubImage3D(m,l,E,k,q+j,N,C,v,T):u.copyTexSubImage2D(m,l,E,k,N,C,v,T);d.bindFramebuffer(u.READ_FRAMEBUFFER,null),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else Ce?e.isDataTexture||e.isData3DTexture?u.texSubImage3D(m,l,E,k,q,v,T,w,x,b,D.data):t.isCompressedArrayTexture?u.compressedTexSubImage3D(m,l,E,k,q,v,T,w,x,D.data):u.texSubImage3D(m,l,E,k,q,v,T,w,x,b,D):e.isDataTexture?u.texSubImage2D(u.TEXTURE_2D,l,E,k,v,T,x,b,D.data):e.isCompressedTexture?u.compressedTexSubImage2D(u.TEXTURE_2D,l,E,k,D.width,D.height,x,D.data):u.texSubImage2D(u.TEXTURE_2D,l,E,k,v,T,x,b,D);u.pixelStorei(u.UNPACK_ROW_LENGTH,I),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,$),u.pixelStorei(u.UNPACK_SKIP_PIXELS,ae),u.pixelStorei(u.UNPACK_SKIP_ROWS,pe),u.pixelStorei(u.UNPACK_SKIP_IMAGES,me),l===0&&t.generateMipmaps&&u.generateMipmap(m),d.unbindTexture()}copyFramebufferToTexture(e,t,s){const{gl:n}=this,{state:a}=this.backend,{textureGPU:l}=this.backend.get(e),{x:u,y:h,z:d,w:f}=s,m=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,b=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(m){const x=u!==0||h!==0;let v,T;if(e.isDepthTexture===!0?(v=n.DEPTH_BUFFER_BIT,T=n.DEPTH_ATTACHMENT,t.stencil&&(v|=n.STENCIL_BUFFER_BIT)):(v=n.COLOR_BUFFER_BIT,T=n.COLOR_ATTACHMENT0),x){const w=this.backend.get(t.renderTarget),N=w.framebuffers[t.getCacheKey()],C=w.msaaFrameBuffer;a.bindFramebuffer(n.DRAW_FRAMEBUFFER,N),a.bindFramebuffer(n.READ_FRAMEBUFFER,C);const R=b-h-f;n.blitFramebuffer(u,R,u+d,R+f,u,R,u+d,R+f,v,n.NEAREST),a.bindFramebuffer(n.READ_FRAMEBUFFER,N),a.bindTexture(n.TEXTURE_2D,l),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,u,R,d,f),a.unbindTexture()}else{const w=n.createFramebuffer();a.bindFramebuffer(n.DRAW_FRAMEBUFFER,w),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,T,n.TEXTURE_2D,l,0),n.blitFramebuffer(0,0,d,f,0,0,d,f,v,n.NEAREST),n.deleteFramebuffer(w)}}else a.bindTexture(n.TEXTURE_2D,l),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,u,b-f-h,d,f),a.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,s,n=!1){const{gl:a}=this,l=t.renderTarget,{depthTexture:u,depthBuffer:h,stencilBuffer:d,width:f,height:m}=l;if(a.bindRenderbuffer(a.RENDERBUFFER,e),h&&!d){let b=a.DEPTH_COMPONENT24;n===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(a.RENDERBUFFER,l.samples,b,f,m):s>0?(u&&u.isDepthTexture&&u.type===a.FLOAT&&(b=a.DEPTH_COMPONENT32F),a.renderbufferStorageMultisample(a.RENDERBUFFER,s,b,f,m)):a.renderbufferStorage(a.RENDERBUFFER,b,f,m),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e)}else h&&d&&(s>0?a.renderbufferStorageMultisample(a.RENDERBUFFER,s,a.DEPTH24_STENCIL8,f,m):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,f,m),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e));a.bindRenderbuffer(a.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,s,n,a,l){const{backend:u,gl:h}=this,{textureGPU:d,glFormat:f,glType:m}=this.backend.get(e),b=h.createFramebuffer();u.state.bindFramebuffer(h.READ_FRAMEBUFFER,b);const x=e.isCubeTexture?h.TEXTURE_CUBE_MAP_POSITIVE_X+l:h.TEXTURE_2D;h.framebufferTexture2D(h.READ_FRAMEBUFFER,h.COLOR_ATTACHMENT0,x,d,0);const v=this._getTypedArrayType(m),T=this._getBytesPerTexel(m,f),N=n*a*T,C=h.createBuffer();h.bindBuffer(h.PIXEL_PACK_BUFFER,C),h.bufferData(h.PIXEL_PACK_BUFFER,N,h.STREAM_READ),h.readPixels(t,s,n,a,f,m,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const R=new v(N/v.BYTES_PER_ELEMENT);return h.bindBuffer(h.PIXEL_PACK_BUFFER,C),h.getBufferSubData(h.PIXEL_PACK_BUFFER,0,R),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),u.state.bindFramebuffer(h.READ_FRAMEBUFFER,null),h.deleteFramebuffer(b),R}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:s}=this;let n=0;if(e===s.UNSIGNED_BYTE&&(n=1),(e===s.UNSIGNED_SHORT_4_4_4_4||e===s.UNSIGNED_SHORT_5_5_5_1||e===s.UNSIGNED_SHORT_5_6_5||e===s.UNSIGNED_SHORT||e===s.HALF_FLOAT)&&(n=2),(e===s.UNSIGNED_INT||e===s.FLOAT)&&(n=4),t===s.RGBA)return n*4;if(t===s.RGB)return n*3;if(t===s.ALPHA)return n}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function Qf(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}class Tq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class Sq{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const s=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const JA={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class wq{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:s,mode:n,object:a,type:l,info:u,index:h}=this;h!==0?s.drawElements(n,t,l,e):s.drawArrays(n,e,t),u.update(a,t,1)}renderInstances(e,t,s){const{gl:n,mode:a,type:l,index:u,object:h,info:d}=this;s!==0&&(u!==0?n.drawElementsInstanced(a,t,l,e,s):n.drawArraysInstanced(a,e,t,s),d.update(h,t,s))}renderMultiDraw(e,t,s){const{extensions:n,mode:a,object:l,info:u}=this;if(s===0)return;const h=n.get("WEBGL_multi_draw");if(h===null)for(let d=0;d<s;d++)this.render(e[d],t[d]);else{this.index!==0?h.multiDrawElementsWEBGL(a,t,0,this.type,e,0,s):h.multiDrawArraysWEBGL(a,e,0,t,0,s);let d=0;for(let f=0;f<s;f++)d+=t[f];u.update(l,d,1)}}renderMultiDrawInstances(e,t,s,n){const{extensions:a,mode:l,object:u,info:h}=this;if(s===0)return;const d=a.get("WEBGL_multi_draw");if(d===null)for(let f=0;f<s;f++)this.renderInstances(e[f],t[f],n[f]);else{this.index!==0?d.multiDrawElementsInstancedWEBGL(l,t,0,this.type,e,0,n,0,s):d.multiDrawArraysInstancedWEBGL(l,e,0,t,0,n,0,s);let f=0;for(let m=0;m<s;m++)f+=t[m]*n[m];h.update(u,f,1)}}}class s3{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(ue(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class Mq extends s3{constructor(e,t,s=2048){if(super(s),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){ue("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let n=0;n<this.maxQueries;n++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const s=this.queries[t];if(s)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,s),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(n){le("Error in beginQuery:",n),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(s){le("Error in endQuery:",s),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[a,l]of this.queryOffsets)if(this.queryStates.get(l)==="ended"){const h=this.queries[l];e.set(a,this.resolveQuery(h))}if(e.size===0)return this.lastValue;const t={},s=[];for(const[a,l]of e){const u=a.match(/^(.*):f(\d+)$/),h=parseInt(u[2]);s.includes(h)===!1&&s.push(h),t[h]===void 0&&(t[h]=0);const d=await l;this.timestamps.set(a,d),t[h]+=d}const n=t[s[s.length-1]];return this.lastValue=n,this.frames=s,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return le("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let s,n=!1;const a=()=>{s&&(clearTimeout(s),s=null)},l=h=>{n||(n=!0,a(),t(h))},u=()=>{if(this.isDisposed){l(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){l(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){s=setTimeout(u,1);return}const f=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(f)/1e6)}catch(h){le("Error checking query:",h),t(this.lastValue)}};u()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class eC extends t3{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,s={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},n=t.context!==void 0?t.context:e.domElement.getContext("webgl2",s);function a(l){l.preventDefault();const u={api:"WebGL",message:l.statusMessage||"Unknown reason",reason:null,originalEvent:l};e.onDeviceLost(u)}this._onContextLost=a,e.domElement.addEventListener("webglcontextlost",a,!1),this.gl=n,this.extensions=new Tq(this),this.capabilities=new Sq(this),this.attributeUtils=new bq(this),this.textureUtils=new vq(this),this.bufferRenderer=new wq(this),this.state=new xq(this),this.utils=new _q(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.extensions.get("EXT_clip_control"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed"),t.reversedDepthBuffer===!0&&this.extensions.has("EXT_clip_control")&&this.state.setReversedDepth(!0)}get coordinateSystem(){return On}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,s=null){const n=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:n.RGBA8}),s!==null){const a=e.stencilBuffer?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:s,glInternalFormat:a}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&ue("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Mq(this.gl,e,2048));const s=this.timestampQueryPool[e];s.allocateQueriesForContext(t)!==null&&s.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,s=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:a,height:l}=this.getDrawingBufferSize();t.viewport(0,0,a,l)}if(e.scissor)this.updateScissor(e);else{const{width:a,height:l}=this.getDrawingBufferSize();t.scissor(0,0,a,l)}this.initTimestampQuery(Qi.RENDER,this.getTimestampUID(e)),s.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const n=e.occlusionQueryCount;n>0&&(s.currentOcclusionQueries=s.occlusionQueries,s.currentOcclusionQueryObjects=s.occlusionQueryObjects,s.lastOcclusionObject=null,s.occlusionQueries=new Array(n),s.occlusionQueryObjects=new Array(n),s.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:s}=this,n=this.get(e),a=n.previousContext;s.resetVertexState();const l=e.occlusionQueryCount;l>0&&(l>n.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let h=0;h<u.length;h++){const d=u[h];d.generateMipmaps&&this.generateMipmaps(d)}if(this._currentContext=a,this._resolveRenderTarget(e),a!==null){if(this._setFramebuffer(a),a.viewport)this.updateViewport(a);else{const{width:h,height:d}=this.getDrawingBufferSize();s.viewport(0,0,h,d)}if(a.scissor)this.updateScissor(a);else{const{width:h,height:d}=this.getDrawingBufferSize();s.scissor(0,0,h,d)}}this.prepareTimestampBuffer(Qi.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:s,currentOcclusionQueryObjects:n}=t;if(s&&n){const a=new WeakSet,{gl:l}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const u=()=>{let h=0;for(let d=0;d<s.length;d++){const f=s[d];f!==null&&l.getQueryParameter(f,l.QUERY_RESULT_AVAILABLE)&&(l.getQueryParameter(f,l.QUERY_RESULT)===0&&a.add(n[d]),s[d]=null,l.deleteQuery(f),h++)}h<s.length?requestAnimationFrame(u):t.occluded=a};u()}}isOccluded(e,t){const s=this.get(e);return s.occluded&&s.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:s,y:n,width:a,height:l}=e.viewportValue;t.viewport(s,e.height-l-n,a,l)}updateScissor(e){const{state:t}=this,{x:s,y:n,width:a,height:l}=e.scissorValue;t.scissor(s,e.height-l-n,a,l)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,s,n=null,a=!0,l=!0){const{gl:u,renderer:h}=this;n===null&&(n={textures:null,clearColorValue:this.getClearColor()});let d=0;if(e&&(d|=u.COLOR_BUFFER_BIT),t&&(d|=u.DEPTH_BUFFER_BIT),s&&(d|=u.STENCIL_BUFFER_BIT),d!==0){let f;n.clearColorValue?f=n.clearColorValue:f=this.getClearColor();const m=h.getClearDepth(),b=h.getClearStencil();if(t&&this.state.setDepthMask(!0),n.textures===null)u.clearColor(f.r,f.g,f.b,f.a),u.clear(d);else{if(a&&this._setFramebuffer(n),e)for(let x=0;x<n.textures.length;x++)x===0?u.clearBufferfv(u.COLOR,x,[f.r,f.g,f.b,f.a]):u.clearBufferfv(u.COLOR,x,[0,0,0,1]);t&&s?u.clearBufferfi(u.DEPTH_STENCIL,0,m,b):t?u.clearBufferfv(u.DEPTH,0,[m]):s&&u.clearBufferiv(u.STENCIL,0,[b]),a&&l&&this._resolveRenderTarget(n)}}}beginCompute(e){const{state:t,gl:s}=this;t.bindFramebuffer(s.FRAMEBUFFER,null),this.initTimestampQuery(Qi.COMPUTE,this.getTimestampUID(e))}compute(e,t,s,n,a=null){const{state:l,gl:u}=this;this.discard===!1&&(l.enable(u.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:h,transformBuffers:d,attributes:f}=this.get(n),m=this._getVaoKey(f),b=this.vaoCache[m];b===void 0?this.vaoCache[m]=this._createVao(f):l.setVertexState(b),l.useProgram(h),this._bindUniforms(s);const x=this._getTransformFeedback(d);u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,x),u.beginTransformFeedback(u.POINTS),a=a!==null?a:t.count,Array.isArray(a)?(ft("WebGLBackend.compute(): The count parameter must be a single number, not an array."),a=a[0]):a&&typeof a=="object"&&a.isIndirectStorageBufferAttribute&&(ft("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),a=t.count),f[0].isStorageInstancedBufferAttribute?u.drawArraysInstanced(u.POINTS,0,1,a):u.drawArrays(u.POINTS,0,a),u.endTransformFeedback(),u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,null);for(let v=0;v<d.length;v++){const T=d[v];T.pbo&&this.has(T.pbo)&&this.textureUtils.copyBufferToTexture(T.transformBuffer,T.pbo),T.switchBuffers()}}finishCompute(e){const{state:t,gl:s}=this;this.discard=!1,t.disable(s.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Qi.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:s,material:n,context:a,hardwareClippingPlanes:l}=e,{programGPU:u}=this.get(s),{gl:h,state:d}=this,f=this.get(a),m=e.getDrawParameters();if(m===null)return;this._bindUniforms(e.getBindings());const b=t.isMesh&&t.matrixWorld.determinant()<0;d.setMaterial(n,b,l),a.mrt!==null&&a.textures!==null&&d.setMRTBlending(a.textures,a.mrt,n),d.useProgram(u);const x=e.getAttributes(),v=this.get(x);let T=v.vaoGPU;if(T===void 0){const I=this._getVaoKey(x);T=this.vaoCache[I],T===void 0&&(T=this._createVao(x),this.vaoCache[I]=T,v.vaoGPU=T)}const w=e.getIndex(),N=w!==null?this.get(w).bufferGPU:null;d.setVertexState(T,N);const C=f.lastOcclusionObject;if(C!==t&&C!==void 0){if(C!==null&&C.occlusionTest===!0&&(h.endQuery(h.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),t.occlusionTest===!0){const I=h.createQuery();h.beginQuery(h.ANY_SAMPLES_PASSED,I),f.occlusionQueries[f.occlusionQueryIndex]=I,f.occlusionQueryObjects[f.occlusionQueryIndex]=t}f.lastOcclusionObject=t}const R=this.bufferRenderer;t.isPoints?R.mode=h.POINTS:t.isLineSegments?R.mode=h.LINES:t.isLine?R.mode=h.LINE_STRIP:t.isLineLoop?R.mode=h.LINE_LOOP:n.wireframe===!0?(d.setLineWidth(n.wireframeLinewidth*this.renderer.getPixelRatio()),R.mode=h.LINES):R.mode=h.TRIANGLES;const{vertexCount:E,instanceCount:k}=m;let{firstVertex:q}=m;if(R.object=t,w!==null){q*=w.array.BYTES_PER_ELEMENT;const I=this.get(w);R.index=w.count,R.type=I.type}else R.index=0;const D=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(ft("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),R.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?R.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):ft("WebGLBackend: WEBGL_multi_draw not supported."):k>1?R.renderInstances(q,E,k):R.render(q,E)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const I=this.get(e.camera),$=e.camera.cameras,ae=e.getBindingGroup("cameraIndex").bindings[0];if(I.indexesGPU===void 0||I.indexesGPU.length!==$.length){const j=new Uint32Array([0,0,0,0]),oe=[];for(let fe=0,Ne=$.length;fe<Ne;fe++){const De=h.createBuffer();j[0]=fe,h.bindBuffer(h.UNIFORM_BUFFER,De),h.bufferData(h.UNIFORM_BUFFER,j,h.STATIC_DRAW),oe.push(De)}I.indexesGPU=oe}const pe=this.get(ae),me=this.renderer.getPixelRatio(),xe=this._currentContext.renderTarget,Ce=this._isRenderCameraDepthArray(this._currentContext),ge=this._currentContext.activeCubeFace;if(Ce){const j=this.get(xe.depthTexture);if(j.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){j.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:oe}=xe;for(let fe=0,Ne=$.length;fe<Ne;fe++)this.renderer._activeCubeFace=fe,this._currentContext.activeCubeFace=fe,this._setFramebuffer(this._currentContext),this.clear(!1,!0,oe,this._currentContext,!1,!1);this.renderer._activeCubeFace=ge,this._currentContext.activeCubeFace=ge}}for(let j=0,oe=$.length;j<oe;j++){const fe=$[j];if(t.layers.test(fe.layers)){Ce&&(this.renderer._activeCubeFace=j,this._currentContext.activeCubeFace=j,this._setFramebuffer(this._currentContext));const Ne=fe.viewport;if(Ne!==void 0){const De=Ne.x*me,O=Ne.y*me,ee=Ne.width*me,de=Ne.height*me;d.viewport(Math.floor(De),Math.floor(e.context.height-de-O),Math.floor(ee),Math.floor(de))}d.bindBufferBase(h.UNIFORM_BUFFER,pe.index,I.indexesGPU[j]),D()}this._currentContext.activeCubeFace=ge,this.renderer._activeCubeFace=ge}}else D()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,s,n,a,l){return this.textureUtils.copyTextureToBuffer(e,t,s,n,a,l)}updateSampler(){return""}createNodeBuilder(e,t){return new mq(e,t)}createProgram(e){const t=this.gl,{stage:s,code:n}=e,a=s==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(a,n),t.compileShader(a),this.set(e,{shaderGPU:a})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const s=this.gl,n=e.pipeline,{fragmentProgram:a,vertexProgram:l}=n,u=s.createProgram(),h=this.get(a).shaderGPU,d=this.get(l).shaderGPU;if(s.attachShader(u,h),s.attachShader(u,d),s.linkProgram(u),this.set(n,{programGPU:u,fragmentShader:h,vertexShader:d}),t!==null&&this.parallel){const f=new Promise(m=>{const b=this.parallel,x=()=>{s.getProgramParameter(u,b.COMPLETION_STATUS_KHR)?(this._completeCompile(e,n),m()):requestAnimationFrame(x)};x()});t.push(f);return}this._completeCompile(e,n)}_handleSource(e,t){const s=e.split(`
`),n=[],a=Math.max(t-6,0),l=Math.min(t+6,s.length);for(let u=a;u<l;u++){const h=u+1;n.push(`${h===t?">":" "} ${h}: ${s[u]}`)}return n.join(`
`)}_getShaderErrors(e,t,s){const n=e.getShaderParameter(t,e.COMPILE_STATUS),l=(e.getShaderInfoLog(t)||"").trim();if(n&&l==="")return"";const u=/ERROR: 0:(\d+)/.exec(l);if(u){const h=parseInt(u[1]);return s.toUpperCase()+`

`+l+`

`+this._handleSource(e.getShaderSource(t),h)}else return l}_logProgramError(e,t,s){if(this.renderer.debug.checkShaderErrors){const n=this.gl,l=(n.getProgramInfoLog(e)||"").trim();if(n.getProgramParameter(e,n.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(n,e,s,t);else{const u=this._getShaderErrors(n,s,"vertex"),h=this._getShaderErrors(n,t,"fragment");le("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(e,n.VALIDATE_STATUS)+`

Program Info Log: `+l+`
`+u+`
`+h)}else l!==""&&ue("WebGLProgram: Program Info Log:",l)}}_completeCompile(e,t){const{state:s,gl:n}=this,a=this.get(t),{programGPU:l,fragmentShader:u,vertexShader:h}=a;n.getProgramParameter(l,n.LINK_STATUS)===!1&&this._logProgramError(l,u,h),s.useProgram(l);const d=e.getBindings();this._setupBindings(d,l),this.set(t,{programGPU:l})}createComputePipeline(e,t){const{state:s,gl:n}=this,a={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(a);const{computeProgram:l}=e,u=n.createProgram(),h=this.get(a).shaderGPU,d=this.get(l).shaderGPU,f=l.transforms,m=[],b=[];for(let w=0;w<f.length;w++){const N=f[w];m.push(N.varyingName),b.push(N.attributeNode)}n.attachShader(u,h),n.attachShader(u,d),n.transformFeedbackVaryings(u,m,n.SEPARATE_ATTRIBS),n.linkProgram(u),n.getProgramParameter(u,n.LINK_STATUS)===!1&&this._logProgramError(u,h,d),s.useProgram(u),this._setupBindings(t,u);const x=l.attributes,v=[],T=[];for(let w=0;w<x.length;w++){const N=x[w].node.attribute;v.push(N),this.has(N)||this.attributeUtils.createAttribute(N,n.ARRAY_BUFFER)}for(let w=0;w<b.length;w++){const N=b[w].attribute;this.has(N)||this.attributeUtils.createAttribute(N,n.ARRAY_BUFFER);const C=this.get(N);T.push(C)}this.set(e,{programGPU:u,transformBuffers:T,attributes:v})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let s=0,n=0;for(const a of t){this.set(a,{textures:n,uniformBuffers:s});for(const l of a.bindings)l.isUniformBuffer&&s++,l.isSampledTexture&&n++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,s=this.get(e);let n=s.uniformBuffers,a=s.textures;for(const l of e.bindings){const u=this.get(l);if(l.isUniformsGroup||l.isUniformBuffer){const h=l.buffer;let{bufferGPU:d}=this.get(h);d===void 0?(d=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,d),t.bufferData(t.UNIFORM_BUFFER,h.byteLength,t.DYNAMIC_DRAW),this.set(h,{bufferGPU:d})):t.bindBuffer(t.UNIFORM_BUFFER,d);const f=l.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,d),f.length===0)t.bufferData(t.UNIFORM_BUFFER,h,t.DYNAMIC_DRAW);else{const m=$m(h),b=m?1:h.BYTES_PER_ELEMENT;for(let x=0,v=f.length;x<v;x++){const T=f[x],w=T.start*b,N=T.count*b,C=w*(m?h.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,C,h,w,N)}}u.index=n++,u.bufferGPU=d,this.set(l,u)}else if(l.isSampledTexture){const{textureGPU:h,glTextureType:d}=this.get(l.texture);u.index=a++,u.textureGPU=h,u.glTextureType=d,this.set(l,u)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,a=e.buffer,l=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,n),l.length===0)t.bufferData(t.UNIFORM_BUFFER,a,t.DYNAMIC_DRAW);else{const u=$m(a),h=u?1:a.BYTES_PER_ELEMENT;for(let d=0,f=l.length;d<f;d++){const m=l[d],b=m.start*h,x=m.count*h,v=b*(u?a.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,v,a,b,x)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(JA).filter(n=>JA[n]===e),s=this.extensions;for(let n=0;n<t.length;n++)if(s.has(t[n]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,s=null,n=null,a=0,l=0){this.textureUtils.copyTextureToTexture(e,t,s,n,a,l)}copyFramebufferToTexture(e,t,s){this.textureUtils.copyFramebufferToTexture(e,t,s)}hasCompatibility(e){return e===uo.TEXTURE_COMPARE?!0:super.hasCompatibility(e)}initRenderTarget(e){const{gl:t,state:s}=this;this._setFramebuffer(e),s.bindFramebuffer(t.FRAMEBUFFER,null)}_setFramebuffer(e){const{gl:t,state:s}=this;let n=null;if(e.textures!==null){const a=e.renderTarget,l=this.get(a),{samples:u,depthBuffer:h,stencilBuffer:d}=a,f=a.isCubeRenderTarget===!0,m=a.isRenderTarget3D===!0,b=a.depth>1,x=a.isXRRenderTarget===!0,v=x===!0&&a._hasExternalTextures===!0;let T=l.msaaFrameBuffer,w=l.depthRenderbuffer;const N=this.extensions.get("WEBGL_multisampled_render_to_texture"),C=this.extensions.get("OVR_multiview2"),R=this._useMultisampledExtension(a),E=XB(e);let k;if(f?(l.cubeFramebuffers||(l.cubeFramebuffers={}),k=l.cubeFramebuffers[E]):x&&v===!1?k=this._xrFramebuffer:(l.framebuffers||(l.framebuffers={}),k=l.framebuffers[E]),k===void 0){k=t.createFramebuffer(),s.bindFramebuffer(t.FRAMEBUFFER,k);const q=e.textures,D=[];if(f){l.cubeFramebuffers[E]=k;const{textureGPU:$}=this.get(q[0]),ae=this.renderer._activeCubeFace,pe=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ae,$,pe)}else{l.framebuffers[E]=k;for(let $=0;$<q.length;$++){const ae=q[$],pe=this.get(ae);pe.renderTarget=e.renderTarget,pe.cacheKey=E;const me=t.COLOR_ATTACHMENT0+$;if(a.multiview)C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,me,pe.textureGPU,0,u,0,2);else if(m||b){const xe=this.renderer._activeCubeFace,Ce=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,me,pe.textureGPU,Ce,xe)}else if(R)N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,me,t.TEXTURE_2D,pe.textureGPU,0,u);else{const xe=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,me,t.TEXTURE_2D,pe.textureGPU,xe)}}}const I=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(a._autoAllocateDepthBuffer===!0){const $=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage($,e,0,R),l.xrDepthRenderbuffer=$,D.push(d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,$),t.framebufferRenderbuffer(t.FRAMEBUFFER,I,t.RENDERBUFFER,$)}else if(e.depthTexture!==null){D.push(d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const $=this.get(e.depthTexture);if($.renderTarget=e.renderTarget,$.cacheKey=E,a.multiview)C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,I,$.textureGPU,0,u,0,2);else if(v&&R)N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,I,t.TEXTURE_2D,$.textureGPU,0,u);else if(e.depthTexture.isArrayTexture){const ae=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,I,$.textureGPU,0,ae)}else if(e.depthTexture.isCubeTexture){const ae=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_CUBE_MAP_POSITIVE_X+ae,$.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_2D,$.textureGPU,0)}l.depthInvalidationArray=D}else{if(this._isRenderCameraDepthArray(e)){s.bindFramebuffer(t.FRAMEBUFFER,k);const D=this.renderer._activeCubeFace,I=this.get(e.depthTexture),$=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,$,I.textureGPU,0,D)}if((x||R||a.multiview)&&a._isOpaqueFramebuffer!==!0){s.bindFramebuffer(t.FRAMEBUFFER,k);const D=this.get(e.textures[0]);a.multiview?C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,D.textureGPU,0,u,0,2):R?N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,D.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,D.textureGPU,0);const I=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(a._autoAllocateDepthBuffer===!0){const $=l.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,$),t.framebufferRenderbuffer(t.FRAMEBUFFER,I,t.RENDERBUFFER,$)}else{const $=this.get(e.depthTexture);a.multiview?C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,I,$.textureGPU,0,u,0,2):R?N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,I,t.TEXTURE_2D,$.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_2D,$.textureGPU,0)}}}if(u>0&&R===!1&&!a.multiview){if(T===void 0){const q=[];T=t.createFramebuffer(),s.bindFramebuffer(t.FRAMEBUFFER,T);const D=[],I=e.textures;for(let $=0;$<I.length;$++){D[$]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,D[$]),q.push(t.COLOR_ATTACHMENT0+$);const ae=e.textures[$],pe=this.get(ae);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,pe.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+$,t.RENDERBUFFER,D[$])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),l.msaaFrameBuffer=T,l.msaaRenderbuffers=D,h&&w===void 0){w=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(w,e,u),l.depthRenderbuffer=w;const $=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;q.push($)}l.invalidationArray=q}n=l.msaaFrameBuffer}else n=k;s.drawBuffers(e,k)}s.bindFramebuffer(t.FRAMEBUFFER,n)}_getVaoKey(e){let t="";for(let s=0;s<e.length;s++){const n=this.get(e[s]);t+=":"+n.id}return t}_createVao(e){const{gl:t}=this,s=t.createVertexArray();t.bindVertexArray(s);for(let n=0;n<e.length;n++){const a=e[n],l=this.get(a);t.bindBuffer(t.ARRAY_BUFFER,l.bufferGPU),t.enableVertexAttribArray(n);let u,h;a.isInterleavedBufferAttribute===!0?(u=a.data.stride*l.bytesPerElement,h=a.offset*l.bytesPerElement):(u=0,h=0),l.isInteger?t.vertexAttribIPointer(n,a.itemSize,l.type,u,h):t.vertexAttribPointer(n,a.itemSize,l.type,a.normalized,u,h),a.isInstancedBufferAttribute&&!a.isInterleavedBufferAttribute?t.vertexAttribDivisor(n,a.meshPerAttribute):a.isInterleavedBufferAttribute&&a.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(n,a.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),s}_getTransformFeedback(e){let t="";for(let a=0;a<e.length;a++)t+=":"+e[a].id;let s=this.transformFeedbackCache[t];if(s!==void 0)return s;const{gl:n}=this;s=n.createTransformFeedback(),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,s);for(let a=0;a<e.length;a++){const l=e[a];n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,a,l.transformBuffer)}return n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=s,s}_setupBindings(e,t){const s=this.gl;for(const n of e)for(const a of n.bindings){const u=this.get(a).index;if(a.isUniformsGroup||a.isUniformBuffer){const h=s.getUniformBlockIndex(t,a.name);s.uniformBlockBinding(t,h,u)}else if(a.isSampledTexture){const h=s.getUniformLocation(t,a.name);s.uniform1i(h,u)}}}_bindUniforms(e){const{gl:t,state:s}=this;for(const n of e)for(const a of n.bindings){const l=this.get(a),u=l.index;a.isUniformsGroup||a.isUniformBuffer?s.bindBufferBase(t.UNIFORM_BUFFER,u,l.bufferGPU):a.isSampledTexture&&s.bindTexture(l.glTextureType,l.textureGPU,t.TEXTURE0+u)}}_resolveRenderTarget(e){const{gl:t,state:s}=this,n=e.renderTarget;if(e.textures!==null&&n){const a=this.get(n);if(n.samples>0&&this._useMultisampledExtension(n)===!1){const l=a.framebuffers[e.getCacheKey()];let u=t.COLOR_BUFFER_BIT;n.resolveDepthBuffer&&(n.depthBuffer&&(u|=t.DEPTH_BUFFER_BIT),n.stencilBuffer&&n.resolveStencilBuffer&&(u|=t.STENCIL_BUFFER_BIT));const h=a.msaaFrameBuffer,d=a.msaaRenderbuffers,f=e.textures,m=f.length>1;if(s.bindFramebuffer(t.READ_FRAMEBUFFER,h),s.bindFramebuffer(t.DRAW_FRAMEBUFFER,l),m)for(let b=0;b<f.length;b++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.TEXTURE_2D,null,0);for(let b=0;b<f.length;b++){if(m){const{textureGPU:x}=this.get(f[b]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,d[b]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,x,0)}if(e.scissor){const{x,y:v,width:T,height:w}=e.scissorValue,N=e.height-w-v;t.blitFramebuffer(x,N,x+T,N+w,x,N,x+T,N+w,u,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,u,t.NEAREST)}if(m)for(let b=0;b<f.length;b++){const{textureGPU:x}=this.get(f[b]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.RENDERBUFFER,d[b]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.TEXTURE_2D,x,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,a.invalidationArray)}else if(n.resolveDepthBuffer===!1&&a.framebuffers){const l=a.framebuffers[e.getCacheKey()];s.bindFramebuffer(t.DRAW_FRAMEBUFFER,l),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,a.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Jf={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list"},Ji=typeof self<"u"&&self.GPUShaderStage?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},As={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},$s={Store:"store"},dt={Load:"load",Clear:"clear"},tC={CCW:"ccw",CW:"cw"},sC={None:"none",Back:"back"},ug={Uint16:"uint16",Uint32:"uint32"},F={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},Px={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Xi={Linear:"linear",Nearest:"nearest"},Ke={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Qo={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},nC={None:0,All:15},$a={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},Ox={Storage:"storage",ReadOnlyStorage:"read-only-storage"},Vx={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},iC={NonFiltering:"non-filtering",Comparison:"comparison"},Jo={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},rC={TwoD:"2d",ThreeD:"3d"},Fs={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},Nq={All:"all"},em={Vertex:"vertex",Instance:"instance"},B_={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},aC={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class Aq extends JD{constructor(e,t,s){super(e,t?t.value:null),this.textureNode=t,this.groupNode=s}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Cq extends YD{constructor(e,t){super(e,t?t.array:null),this._attribute=t,this.isStorageBuffer=!0}get attribute(){return this._attribute}}let Eq=0;class Rq extends Cq{constructor(e,t){super("StorageBuffer_"+Eq++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Es.READ_WRITE,this.groupNode=t}get attribute(){return this.nodeUniform.value}get buffer(){return this.nodeUniform.value.array}}class Bq extends wo{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4f,
	@location( 0 ) vTex : vec2f,
	@location( 1 ) @interpolate(flat, either) vBaseArrayLayer: u32,
};

@group( 0 ) @binding ( 2 )
var<uniform> flipY: u32;

@vertex
fn mainVS(
		@builtin( vertex_index ) vertexIndex : u32,
		@builtin( instance_index ) instanceIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array(
		vec2f( -1, -1 ),
		vec2f( -1,  3 ),
		vec2f(  3, -1 ),
	);

	let p = pos[ vertexIndex ];
	let mult = select( vec2f( 0.5, -0.5 ), vec2f( 0.5, 0.5 ), flipY != 0 );
	Varys.vTex = p * mult + vec2f( 0.5 );
	Varys.Position = vec4f( p, 0, 1 );
	Varys.vBaseArrayLayer = instanceIndex;

	return Varys;

}

@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img2d : texture_2d<f32>;

@fragment
fn main_2d( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2d, imgSampler, Varys.vTex );

}

@group( 0 ) @binding( 1 )
var img2dArray : texture_2d_array<f32>;

@fragment
fn main_2d_array( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2dArray, imgSampler, Varys.vTex, Varys.vBaseArrayLayer );

}

const faceMat = array(
  mat3x3f(  0,  0,  -2,  0, -2,   0,  1,  1,   1 ),   // pos-x
  mat3x3f(  0,  0,   2,  0, -2,   0, -1,  1,  -1 ),   // neg-x
  mat3x3f(  2,  0,   0,  0,  0,   2, -1,  1,  -1 ),   // pos-y
  mat3x3f(  2,  0,   0,  0,  0,  -2, -1, -1,   1 ),   // neg-y
  mat3x3f(  2,  0,   0,  0, -2,   0, -1,  1,   1 ),   // pos-z
  mat3x3f( -2,  0,   0,  0, -2,   0,  1,  1,  -1 ),   // neg-z
);

@group( 0 ) @binding( 1 )
var imgCube : texture_cube<f32>;

@fragment
fn main_cube( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( imgCube, imgSampler, faceMat[ Varys.vBaseArrayLayer ] * vec3f( fract( Varys.vTex ), 1 ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Xi.Linear}),this.flipYSampler=e.createSampler({minFilter:Xi.Nearest}),this.flipUniformBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),e.queue.writeBuffer(this.flipUniformBuffer,0,new Uint32Array([1])),this.noFlipUniformBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM}),this.transferPipelines={},this.mipmapShaderModule=e.createShaderModule({label:"mipmap",code:t})}getTransferPipeline(e,t){t=t||"2d-array";const s=`${e}-${t}`;let n=this.transferPipelines[s];return n===void 0&&(n=this.device.createRenderPipeline({label:`mipmap-${e}-${t}`,vertex:{module:this.mipmapShaderModule},fragment:{module:this.mipmapShaderModule,entryPoint:`main_${t.replace("-","_")}`,targets:[{format:e}]},layout:"auto"}),this.transferPipelines[s]=n),n}flipY(e,t,s=0){const n=t.format,{width:a,height:l}=t.size,u=this.device.createTexture({size:{width:a,height:l},format:n,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),h=this.getTransferPipeline(n,e.textureBindingViewDimension),d=this.getTransferPipeline(n,u.textureBindingViewDimension),f=this.device.createCommandEncoder({}),m=(b,x,v,T,w,N)=>{const C=b.getBindGroupLayout(0),R=this.device.createBindGroup({layout:C,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:x.createView({dimension:x.textureBindingViewDimension||"2d-array",baseMipLevel:0,mipLevelCount:1})},{binding:2,resource:{buffer:N?this.flipUniformBuffer:this.noFlipUniformBuffer}}]}),E=f.beginRenderPass({colorAttachments:[{view:T.createView({dimension:"2d",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:w,arrayLayerCount:1}),loadOp:dt.Clear,storeOp:$s.Store}]});E.setPipeline(b),E.setBindGroup(0,R),E.draw(3,1,0,v),E.end()};m(h,e,s,u,0,!1),m(d,u,0,e,s,!0),this.device.queue.submit([f.finish()]),u.destroy()}generateMipmaps(e,t=null){const s=this.get(e),n=s.layers||this._mipmapCreateBundles(e),a=t||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,n),t===null&&this.device.queue.submit([a.finish()]),s.layers=n}_mipmapCreateBundles(e){const t=e.textureBindingViewDimension||"2d-array",s=this.getTransferPipeline(e.format,t),n=s.getBindGroupLayout(0),a=[];for(let l=1;l<e.mipLevelCount;l++)for(let u=0;u<e.depthOrArrayLayers;u++){const h=this.device.createBindGroup({layout:n,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:e.createView({dimension:t,baseMipLevel:l-1,mipLevelCount:1})},{binding:2,resource:{buffer:this.noFlipUniformBuffer}}]}),d={colorAttachments:[{view:e.createView({dimension:"2d",baseMipLevel:l,mipLevelCount:1,baseArrayLayer:u,arrayLayerCount:1}),loadOp:dt.Clear,storeOp:$s.Store}]},f=this.device.createRenderBundleEncoder({colorFormats:[e.format]});f.setPipeline(s),f.setBindGroup(0,h),f.draw(3,1,0,u),a.push({renderBundles:[f.finish()],passDescriptor:d})}return a}_mipmapRunBundles(e,t){const s=t.length;for(let n=0;n<s;n++){const a=t[n],l=e.beginRenderPass(a.passDescriptor);l.executeBundles(a.renderBundles),l.end()}}}const Dq={[nE]:"never",[W_]:"less",[iE]:"equal",[vg]:"less-equal",[rE]:"greater",[Tg]:"greater-equal",[oE]:"always",[aE]:"not-equal"},Lq=[0,1,3,2,4,5];class Uq{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,s=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let n=this._samplerCache.get(s);if(n===void 0){const l={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};e.isDepthTexture&&e.compareFunction===null&&(l.magFilter=Xi.Nearest,l.minFilter=Xi.Nearest,l.mipmapFilter=Xi.Nearest),l.magFilter===Xi.Linear&&l.minFilter===Xi.Linear&&l.mipmapFilter===Xi.Linear&&(l.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&t.hasCompatibility(uo.TEXTURE_COMPARE)&&(l.compare=Dq[e.compareFunction]),n={sampler:t.device.createSampler(l),usedTimes:0},this._samplerCache.set(s,n)}const a=t.get(e);if(a.sampler!==n.sampler){if(a.sampler!==void 0){const l=this._samplerCache.get(a.samplerKey);l.usedTimes--,l.usedTimes===0&&this._samplerCache.delete(a.samplerKey)}a.samplerKey=s,a.sampler=n.sampler,n.usedTimes++}return s}createDefaultTexture(e){let t;const s=D_(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(s):t=this._getDefaultTextureGPU(s),this.backend.get(e).texture=t}createTexture(e,t={}){const s=this.backend,n=s.get(e);if(n.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){n.texture=e.sourceTexture,n.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:a,height:l,depth:u,levels:h}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const d=this._getDimension(e),f=e.internalFormat||t.format||D_(e,s.device);n.format=f;const{samples:m,primarySamples:b,isMSAA:x}=s.utils.getTextureSampleData(e);let v=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(v|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&f!==F.RGB9E5UFloat&&(v|=GPUTextureUsage.RENDER_ATTACHMENT);const T={label:e.name,size:{width:a,height:l,depthOrArrayLayers:u},mipLevelCount:h,sampleCount:b,dimension:d,format:f,usage:v};if(f===void 0){ue("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}e.isCubeTexture&&(T.textureBindingViewDimension=Fs.Cube);try{n.texture=s.device.createTexture(T)}catch{ue("WebGPURenderer: Failed to create texture with descriptor:",T),this.createDefaultTexture(e);return}if(x){const w=Object.assign({},T);w.label=w.label+"-msaa",w.sampleCount=m,w.mipLevelCount=1,n.msaaTexture=s.device.createTexture(w)}n.initialized=!0,n.textureDescriptorGPU=T}destroyTexture(e,t=!1){const s=this.backend,n=s.get(e);n.texture!==void 0&&t===!1&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),s.delete(e)}generateMipmaps(e,t=null){const s=this.backend.get(e);this._generateMipmaps(s.texture,t)}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:s,height:n}=e.getDrawingBufferSize(),a=e.renderer.currentSamples,l=t.colorTexture,u=e.get(l);if(l.width===s&&l.height===n&&l.samples===a)return u.texture;let h=u.texture;return h&&h.destroy(),h=e.device.createTexture({label:"colorBuffer",size:{width:s,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),l.source.width=s,l.source.height=n,l.samples=a,u.texture=h,h}getDepthBuffer(e=!0,t=!1){const s=this.backend,n=s.renderer.getCanvasTarget(),{width:a,height:l}=s.getDrawingBufferSize(),u=s.renderer.currentSamples,h=n.depthTexture;if(h.width===a&&h.height===l&&h.samples===u&&h.depth===e&&h.stencil===t)return s.get(h).texture;const d=s.get(h).texture;let f,m;if(t?(f=Yr,m=lo):e&&(f=Ri,m=Gt),d!==void 0){if(h.image.width===a&&h.image.height===l&&h.format===f&&h.type===m&&h.samples===u)return d;this.destroyTexture(h)}return h.name="depthBuffer",h.format=f,h.type=m,h.image.width=a,h.image.height=l,h.samples=u,this.createTexture(h,{width:a,height:l}),s.get(h).texture}updateTexture(e,t){const s=this.backend.get(e),n=e.mipmaps,{textureDescriptorGPU:a}=s;if(!(e.isRenderTargetTexture||a===void 0)){if(e.isDataTexture)if(n.length>0)for(let l=0,u=n.length;l<u;l++){const h=n[l];this._copyBufferToTexture(h,s.texture,a,0,e.flipY,0,l)}else this._copyBufferToTexture(t.image,s.texture,a,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let l=0;l<t.image.depth;l++)this._copyBufferToTexture(t.image,s.texture,a,l,e.flipY,l);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,s.texture,a);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,s.texture,a);else if(n.length>0)for(let l=0,u=n.length;l<u;l++){const h=n[l];this._copyImageToTexture(h,s.texture,a,0,e.flipY,e.premultiplyAlpha,l)}else this._copyImageToTexture(t.image,s.texture,a,0,e.flipY,e.premultiplyAlpha);s.version=e.version}}async copyTextureToBuffer(e,t,s,n,a,l){const u=this.backend.device,h=this.backend.get(e),d=h.texture,f=h.textureDescriptorGPU.format,m=this._getBytesPerTexel(f);let b=n*m;b=Math.ceil(b/256)*256;const x=u.createBuffer({size:(a-1)*b+n*m,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),v=u.createCommandEncoder();v.copyTextureToBuffer({texture:d,origin:{x:t,y:s,z:l}},{buffer:x,bytesPerRow:b},{width:n,height:a});const T=this._getTypedArrayType(f);u.queue.submit([v.finish()]),await x.mapAsync(GPUMapMode.READ);const w=x.getMappedRange();return new T(w)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const s=new Is;s.minFilter=qt,s.magFilter=qt,this.createTexture(s,{width:1,height:1,format:e}),this.defaultTexture[e]=t=s}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const s=new wg;s.minFilter=qt,s.magFilter=qt,this.createTexture(s,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=s}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,s){const n=e.images,a=e.mipmaps;for(let l=0;l<6;l++){const u=n[l],h=e.flipY===!0?Lq[l]:l;u.isDataTexture?this._copyBufferToTexture(u.image,t,s,h,e.flipY):this._copyImageToTexture(u,t,s,h,e.flipY,e.premultiplyAlpha);for(let d=0;d<a.length;d++){const m=a[d].images[l];m.isDataTexture?this._copyBufferToTexture(m.image,t,s,h,e.flipY,0,d+1):this._copyImageToTexture(m,t,s,h,e.flipY,e.premultiplyAlpha,d+1)}}}_copyImageToTexture(e,t,s,n,a,l,u=0){const h=this.backend.device,d=u>0?e.width:s.size.width,f=u>0?e.height:s.size.height;try{h.queue.copyExternalImageToTexture({source:e,flipY:a},{texture:t,mipLevel:u,origin:{x:0,y:0,z:n},premultipliedAlpha:l},{width:d,height:f,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new Bq(this.backend.device)),e}_generateMipmaps(e,t=null){this._getPassUtils().generateMipmaps(e,t)}_flipY(e,t,s=0){this._getPassUtils().flipY(e,t,s)}_copyBufferToTexture(e,t,s,n,a,l=0,u=0){const h=this.backend.device,d=e.data,f=this._getBytesPerTexel(s.format),m=e.width*f;h.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:n}},d,{offset:e.width*e.height*f*l,bytesPerRow:m},{width:e.width,height:e.height,depthOrArrayLayers:1}),a===!0&&this._flipY(t,s,n)}_copyCompressedBufferToTexture(e,t,s){const n=this.backend.device,a=this._getBlockData(s.format),l=s.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const h=e[u],d=h.width,f=h.height,m=l?s.size.depthOrArrayLayers:1,b=Math.ceil(d/a.width)*a.byteLength,x=b*Math.ceil(f/a.height);for(let v=0;v<m;v++)n.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:v}},h.data,{offset:v*x,bytesPerRow:b,rowsPerImage:Math.ceil(f/a.height)},{width:Math.ceil(d/a.width)*a.width,height:Math.ceil(f/a.height)*a.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===F.BC1RGBAUnorm||e===F.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===F.BC2RGBAUnorm||e===F.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.BC3RGBAUnorm||e===F.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.BC4RUnorm||e===F.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===F.BC5RGUnorm||e===F.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===F.BC6HRGBUFloat||e===F.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===F.BC7RGBAUnorm||e===F.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.ETC2RGB8Unorm||e===F.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===F.ETC2RGB8A1Unorm||e===F.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===F.ETC2RGBA8Unorm||e===F.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===F.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===F.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===F.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===F.ASTC4x4Unorm||e===F.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.ASTC5x4Unorm||e===F.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===F.ASTC5x5Unorm||e===F.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===F.ASTC6x5Unorm||e===F.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===F.ASTC6x6Unorm||e===F.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===F.ASTC8x5Unorm||e===F.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===F.ASTC8x6Unorm||e===F.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===F.ASTC8x8Unorm||e===F.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===F.ASTC10x5Unorm||e===F.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===F.ASTC10x6Unorm||e===F.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===F.ASTC10x8Unorm||e===F.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===F.ASTC10x10Unorm||e===F.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===F.ASTC12x10Unorm||e===F.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===F.ASTC12x12Unorm||e===F.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=Px.ClampToEdge;return e===ec?t=Px.Repeat:e===tc&&(t=Px.MirrorRepeat),t}_convertFilterMode(e){let t=Xi.Linear;return(e===qt||e===QC||e===sd)&&(t=Xi.Nearest),t}_getBytesPerTexel(e){if(e===F.R8Unorm||e===F.R8Snorm||e===F.R8Uint||e===F.R8Sint)return 1;if(e===F.R16Uint||e===F.R16Sint||e===F.R16Float||e===F.RG8Unorm||e===F.RG8Snorm||e===F.RG8Uint||e===F.RG8Sint)return 2;if(e===F.R32Uint||e===F.R32Sint||e===F.R32Float||e===F.RG16Uint||e===F.RG16Sint||e===F.RG16Float||e===F.RGBA8Unorm||e===F.RGBA8UnormSRGB||e===F.RGBA8Snorm||e===F.RGBA8Uint||e===F.RGBA8Sint||e===F.BGRA8Unorm||e===F.BGRA8UnormSRGB||e===F.RGB9E5UFloat||e===F.RGB10A2Unorm||e===F.RG11B10UFloat||e===F.Depth32Float||e===F.Depth24Plus||e===F.Depth24PlusStencil8||e===F.Depth32FloatStencil8)return 4;if(e===F.RG32Uint||e===F.RG32Sint||e===F.RG32Float||e===F.RGBA16Uint||e===F.RGBA16Sint||e===F.RGBA16Float)return 8;if(e===F.RGBA32Uint||e===F.RGBA32Sint||e===F.RGBA32Float)return 16}_getTypedArrayType(e){if(e===F.R8Uint)return Uint8Array;if(e===F.R8Sint)return Int8Array;if(e===F.R8Unorm)return Uint8Array;if(e===F.R8Snorm)return Int8Array;if(e===F.RG8Uint)return Uint8Array;if(e===F.RG8Sint)return Int8Array;if(e===F.RG8Unorm)return Uint8Array;if(e===F.RG8Snorm)return Int8Array;if(e===F.RGBA8Uint)return Uint8Array;if(e===F.RGBA8Sint)return Int8Array;if(e===F.RGBA8Unorm||e===F.RGBA8UnormSRGB)return Uint8Array;if(e===F.RGBA8Snorm)return Int8Array;if(e===F.R16Uint)return Uint16Array;if(e===F.R16Sint)return Int16Array;if(e===F.RG16Uint)return Uint16Array;if(e===F.RG16Sint)return Int16Array;if(e===F.RGBA16Uint)return Uint16Array;if(e===F.RGBA16Sint)return Int16Array;if(e===F.R16Float||e===F.RG16Float||e===F.RGBA16Float)return Uint16Array;if(e===F.R32Uint)return Uint32Array;if(e===F.R32Sint)return Int32Array;if(e===F.R32Float)return Float32Array;if(e===F.RG32Uint)return Uint32Array;if(e===F.RG32Sint)return Int32Array;if(e===F.RG32Float)return Float32Array;if(e===F.RGBA32Uint)return Uint32Array;if(e===F.RGBA32Sint)return Int32Array;if(e===F.RGBA32Float)return Float32Array;if(e===F.BGRA8Unorm||e===F.BGRA8UnormSRGB)return Uint8Array;if(e===F.RGB10A2Unorm||e===F.RGB9E5UFloat||e===F.RG11B10UFloat)return Uint32Array;if(e===F.Depth32Float)return Float32Array;if(e===F.Depth24Plus||e===F.Depth24PlusStencil8)return Uint32Array;if(e===F.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=rC.ThreeD:t=rC.TwoD,t}}function D_(i,e=null){const t=i.format,s=i.type,n=i.colorSpace,a=nt.getTransfer(n);let l;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case kh:case Gh:l=a===Fe?F.BC1RGBAUnormSRGB:F.BC1RGBAUnorm;break;case qh:l=a===Fe?F.BC2RGBAUnormSRGB:F.BC2RGBAUnorm;break;case Hh:l=a===Fe?F.BC3RGBAUnormSRGB:F.BC3RGBAUnorm;break;case km:l=F.BC4RUnorm;break;case Gm:l=F.BC4RSnorm;break;case id:l=F.BC5RGUnorm;break;case qm:l=F.BC5RGSnorm;break;case Im:l=a===Fe?F.BC7RGBAUnormSRGB:F.BC7RGBAUnorm;break;case vm:case _m:l=a===Fe?F.ETC2RGB8UnormSRGB:F.ETC2RGB8Unorm;break;case Tm:l=a===Fe?F.ETC2RGBA8UnormSRGB:F.ETC2RGBA8Unorm;break;case Sm:l=F.EACR11Unorm;break;case wm:l=F.EACR11Snorm;break;case nd:l=F.EACRG11Unorm;break;case Mm:l=F.EACRG11Snorm;break;case Nm:l=a===Fe?F.ASTC4x4UnormSRGB:F.ASTC4x4Unorm;break;case Am:l=a===Fe?F.ASTC5x4UnormSRGB:F.ASTC5x4Unorm;break;case Cm:l=a===Fe?F.ASTC5x5UnormSRGB:F.ASTC5x5Unorm;break;case Em:l=a===Fe?F.ASTC6x5UnormSRGB:F.ASTC6x5Unorm;break;case Rm:l=a===Fe?F.ASTC6x6UnormSRGB:F.ASTC6x6Unorm;break;case Bm:l=a===Fe?F.ASTC8x5UnormSRGB:F.ASTC8x5Unorm;break;case Dm:l=a===Fe?F.ASTC8x6UnormSRGB:F.ASTC8x6Unorm;break;case Lm:l=a===Fe?F.ASTC8x8UnormSRGB:F.ASTC8x8Unorm;break;case Um:l=a===Fe?F.ASTC10x5UnormSRGB:F.ASTC10x5Unorm;break;case Fm:l=a===Fe?F.ASTC10x6UnormSRGB:F.ASTC10x6Unorm;break;case Pm:l=a===Fe?F.ASTC10x8UnormSRGB:F.ASTC10x8Unorm;break;case Om:l=a===Fe?F.ASTC10x10UnormSRGB:F.ASTC10x10Unorm;break;case Vm:l=a===Fe?F.ASTC12x10UnormSRGB:F.ASTC12x10Unorm;break;case zm:l=a===Fe?F.ASTC12x12UnormSRGB:F.ASTC12x12Unorm;break;case Pn:l=a===Fe?F.RGBA8UnormSRGB:F.RGBA8Unorm;break;default:le("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Pn:switch(s){case Gu:l=F.RGBA8Snorm;break;case qu:l=F.RGBA16Sint;break;case rl:l=F.RGBA16Uint;break;case Gt:l=F.RGBA32Uint;break;case Ps:l=F.RGBA32Sint;break;case Vs:l=a===Fe?F.RGBA8UnormSRGB:F.RGBA8Unorm;break;case Cs:l=F.RGBA16Float;break;case cn:l=F.RGBA32Float;break;default:le("WebGPURenderer: Unsupported texture type with RGBAFormat.",s)}break;case gg:switch(s){case j_:l=F.RGB9E5UFloat;break;case $_:l=F.RG11B10UFloat;break;default:le("WebGPURenderer: Unsupported texture type with RGBFormat.",s)}break;case yg:switch(s){case Gu:l=F.R8Snorm;break;case qu:l=F.R16Sint;break;case rl:l=F.R16Uint;break;case Gt:l=F.R32Uint;break;case Ps:l=F.R32Sint;break;case Vs:l=F.R8Unorm;break;case Cs:l=F.R16Float;break;case cn:l=F.R32Float;break;default:le("WebGPURenderer: Unsupported texture type with RedFormat.",s)}break;case Zi:switch(s){case Gu:l=F.RG8Snorm;break;case qu:l=F.RG16Sint;break;case rl:l=F.RG16Uint;break;case Gt:l=F.RG32Uint;break;case Ps:l=F.RG32Sint;break;case Vs:l=F.RG8Unorm;break;case Cs:l=F.RG16Float;break;case cn:l=F.RG32Float;break;default:le("WebGPURenderer: Unsupported texture type with RGFormat.",s)}break;case Ri:switch(s){case rl:l=F.Depth16Unorm;break;case Gt:l=F.Depth24Plus;break;case cn:l=F.Depth32Float;break;default:le("WebGPURenderer: Unsupported texture type with DepthFormat.",s)}break;case Yr:switch(s){case lo:l=F.Depth24PlusStencil8;break;case cn:e&&e.features.has(B_.Depth32FloatStencil8)===!1&&le('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),l=F.Depth32FloatStencil8;break;default:le("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",s)}break;case bg:switch(s){case Ps:l=F.R32Sint;break;case Gt:l=F.R32Uint;break;default:le("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",s)}break;case xg:switch(s){case Ps:l=F.RG32Sint;break;case Gt:l=F.RG32Uint;break;default:le("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",s)}break;case _g:switch(s){case Ps:l=F.RGBA32Sint;break;case Gt:l=F.RGBA32Uint;break;default:le("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",s)}break;default:le("WebGPURenderer: Unsupported texture format.",t)}return l}const Fq=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Pq=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,oC={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Oq=i=>{i=i.trim();const e=i.match(Fq);if(e!==null&&e.length===4){const t=e[2],s=[];let n=null;for(;(n=Pq.exec(t))!==null;)s.push({name:n[1],type:n[2]});const a=[];for(let f=0;f<s.length;f++){const{name:m,type:b}=s[f];let x=b;x.startsWith("ptr")?x="pointer":(x.startsWith("texture")&&(x=b.split("<")[0]),x=oC[x]),a.push(new UT(x,m))}const l=i.substring(e[0].length),u=e[3]||"void",h=e[1]!==void 0?e[1]:"";return{type:oC[u]||u,inputs:a,name:h,inputsCode:t,blockCode:l,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Vq extends PT{constructor(e){const{type:t,inputs:s,name:n,inputsCode:a,blockCode:l,outputType:u}=Oq(e);super(t,s,n),this.inputsCode=a,this.blockCode=l,this.outputType=u}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class zq extends $D{parseFunction(e){return new Vq(e)}}const Iq={[Es.READ_ONLY]:"read",[Es.WRITE_ONLY]:"write",[Es.READ_WRITE]:"read_write"},lC={[ec]:"repeat",[Ki]:"clamp",[tc]:"mirror"},zx={vertex:Ji.VERTEX,fragment:Ji.FRAGMENT,compute:Ji.COMPUTE},uC={instance:!0,swizzleAssign:!1,storageBuffer:!0},kq={"^^":"tsl_xor"},Gq={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},cC={},Dh={tsl_xor:new fs("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new fs("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new fs("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new fs("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new fs("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new fs("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new fs("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new fs("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new fs("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new fs("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new fs("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new fs("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new fs(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`),biquadraticTextureArray:new fs(`
fn tsl_biquadraticTexture_array( map : texture_2d_array<f32>, coord : vec2f, iRes : vec2u, layer : u32, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, layer, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, layer, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, layer, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, layer, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},qq={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let n3="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(n3+=`diagnostic( off, derivative_uniformity );
`);class Hq extends jD{constructor(e,t){super(e,t,new zq),this.uniformGroups={},this.uniformGroupsBindings={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,s,n,a,l=this.shaderStage){return l==="fragment"?n?a?`textureSample( ${t}, ${t}_sampler, ${s}, ${n}, ${a} )`:`textureSample( ${t}, ${t}_sampler, ${s}, ${n} )`:a?`textureSample( ${t}, ${t}_sampler, ${s}, ${a} )`:`textureSample( ${t}, ${t}_sampler, ${s} )`:this.generateTextureSampleLevel(e,t,s,"0",n)}generateTextureSampleLevel(e,t,s,n,a,l){return this.isUnfilterable(e)===!1?a?l?`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${a}, ${n}, ${l} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${a}, ${n} )`:l?`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${n}, ${l} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,s,l,n,a):this.generateTextureLod(e,t,s,a,l,n)}generateWrapFunction(e){const t=`tsl_coord_${lC[e.wrapS]}S_${lC[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let s=cC[t];if(s===void 0){const n=[],a=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let l=`fn ${t}( coord : ${a} ) -> ${a} {

	return ${a}(
`;const u=(h,d)=>{h===ec?(n.push(Dh.repeatWrapping_float),l+=`		tsl_repeatWrapping_float( coord.${d} )`):h===Ki?(n.push(Dh.clampWrapping_float),l+=`		tsl_clampWrapping_float( coord.${d} )`):h===tc?(n.push(Dh.mirrorWrapping_float),l+=`		tsl_mirrorWrapping_float( coord.${d} )`):(l+=`		coord.${d}`,ue(`WebGPURenderer: Unsupported texture wrap type "${h}" for vertex shader.`))};u(e.wrapS,"x"),l+=`,
`,u(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(l+=`,
`,u(e.wrapR,"z")),l+=`
	);

}
`,cC[t]=s=new fs(l,n)}return s.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,s){const n=this.getDataFromNode(e,this.shaderStage,this.globalCache);n.dimensionsSnippet===void 0&&(n.dimensionsSnippet={});let a=n.dimensionsSnippet[s];if(n.dimensionsSnippet[s]===void 0){let l,u;const{primarySamples:h}=this.renderer.backend.utils.getTextureSampleData(e),d=h>1;e.is3DTexture||e.isData3DTexture?u="vec3<u32>":u="vec2<u32>",d||e.isStorageTexture?l=t:l=`${t}${s?`, u32( ${s} )`:""}`,a=new rm(new am(`textureDimensions( ${l} )`,u)),n.dimensionsSnippet[s]=a,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(n.arrayLayerCount=new rm(new am(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(n.cubeFaceCount=new rm(new am("6u","u32")))}return a.build(this)}generateFilteredTexture(e,t,s,n,a="0u",l){const u=this.generateWrapFunction(e),h=this.generateTextureDimension(e,t,a);return n&&(s=`${s} + vec2<f32>(${n}) / ${h}`),l?(this._include("biquadraticTextureArray"),`tsl_biquadraticTexture_array( ${t}, ${u}( ${s} ), ${h}, u32( ${l} ), u32( ${a} ) )`):(this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${t}, ${u}( ${s} ), ${h}, u32( ${a} ) )`)}generateTextureLod(e,t,s,n,a,l="0u"){if(e.isCubeTexture===!0){a&&(s=`${s} + vec3<f32>(${a})`);const x=e.isDepthTexture?"u32":"f32";return`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${x}( ${l} ) )`}const u=this.generateWrapFunction(e),h=this.generateTextureDimension(e,t,l),d=e.is3DTexture||e.isData3DTexture?"vec3":"vec2",f=d==="vec3"?"vec3<u32>( 1, 1, 1 )":"vec2<u32>( 1, 1 )";a&&(s=`${s} + ${d}<f32>(${a}) / ${d}<f32>( ${h} )`);const m=`${d}<f32>( 0 )`,b=`${d}<f32>( ${h} - ${f} )`;return s=`${d}<u32>( clamp( floor( ${u}( ${s} ) * ${d}<f32>( ${h} ) ), ${m}, ${b} ) )`,this.generateTextureLoad(e,t,s,l,n,null)}generateStorageTextureLoad(e,t,s,n,a,l){l&&(s=`${s} + ${l}`);let u;return a?u=`textureLoad( ${t}, ${s}, ${a} )`:u=`textureLoad( ${t}, ${s} )`,u}generateTextureLoad(e,t,s,n,a,l){n===null&&(n="0u"),l&&(s=`${s} + ${l}`);let u;return a?u=`textureLoad( ${t}, ${s}, ${a}, u32( ${n} ) )`:(u=`textureLoad( ${t}, ${s}, u32( ${n} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(u+=".x")),u}generateTextureStore(e,t,s,n,a){let l;return n?l=`textureStore( ${t}, ${s}, ${n}, ${a} )`:l=`textureStore( ${t}, ${s}, ${a} )`,l}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null&&this.renderer.hasCompatibility(uo.TEXTURE_COMPARE)}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===cn||this.isSampleCompare(e)===!1&&e.minFilter===qt&&e.magFilter===qt||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,s,n,a,l=this.shaderStage){let u=null;return this.isUnfilterable(e)?u=this.generateTextureLod(e,t,s,n,a,"0",l):u=this._generateTextureSample(e,t,s,n,a,l),u}generateTextureGrad(e,t,s,n,a,l,u=this.shaderStage){if(u==="fragment")return a?l?`textureSampleGrad( ${t}, ${t}_sampler, ${s}, ${a}, ${n[0]}, ${n[1]}, ${l} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${s}, ${a}, ${n[0]}, ${n[1]} )`:l?`textureSampleGrad( ${t}, ${t}_sampler, ${s}, ${n[0]}, ${n[1]}, ${l} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${s}, ${n[0]}, ${n[1]} )`;le(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${u} shader.`)}generateTextureCompare(e,t,s,n,a,l,u=this.shaderStage){if(u==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?l?`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${a}, ${n}, ${l} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${a}, ${n} )`:l?`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${n}, ${l} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${n} )`;le(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${u} shader.`)}generateTextureLevel(e,t,s,n,a,l){return this.isUnfilterable(e)===!1?a?l?`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${a}, ${n}, ${l} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${a}, ${n} )`:l?`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${n}, ${l} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,s,l,n,a):this.generateTextureLod(e,t,s,a,l,n)}generateTextureBias(e,t,s,n,a,l,u=this.shaderStage){if(u==="fragment")return a?l?`textureSampleBias( ${t}, ${t}_sampler, ${s}, ${a}, ${n}, ${l} )`:`textureSampleBias( ${t}, ${t}_sampler, ${s}, ${a}, ${n} )`:l?`textureSampleBias( ${t}, ${t}_sampler, ${s}, ${n}, ${l} )`:`textureSampleBias( ${t}, ${t}_sampler, ${s}, ${n} )`;le(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${u} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const s=e.name,n=e.type;return n==="texture"||n==="cubeTexture"||n==="cubeDepthTexture"||n==="storageTexture"||n==="texture3D"?s:n==="buffer"||n==="storageBuffer"||n==="indirectStorageBuffer"?this.isCustomStruct(e)?s:s+".value":e.groupNode.name+"."+s}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=kq[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(ue("WebGPURenderer: Atomic operations are only supported in compute shaders."),Es.READ_WRITE):Es.READ_ONLY:e.access}getStorageAccess(e,t){return Iq[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,s,n=null){const a=super.getUniformFromNode(e,t,s,n),l=this.getDataFromNode(e,s,this.globalCache);if(l.uniformGPU===void 0){let u;const h=e.groupNode,d=h.name,f=this.getBindGroupArray(d,s);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let m=null;const b=this.getNodeAccess(e,s);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?m=new R_(a.name,a.node,h,b):m=new iy(a.name,a.node,h,b):t==="cubeTexture"||t==="cubeDepthTexture"?m=new e3(a.name,a.node,h,b):t==="texture3D"&&(m=new R_(a.name,a.node,h,b)),m.store=e.isStorageTextureNode===!0,m.mipLevel=m.store?e.mipLevel:0,m.setVisibility(zx[s]),e.value.isCubeTexture===!0||this.isUnfilterable(e.value)===!1&&m.store===!1){const v=new Aq(`${a.name}_sampler`,a.node,h);v.setVisibility(zx[s]),f.push(v,m),u=[v,m]}else f.push(m),u=[m]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const m=this.getSharedDataFromNode(e);let b=m.buffer;if(b===void 0){const x=t==="buffer"?ZD:Rq;b=new x(e,h),m.buffer=b}b.setVisibility(b.getVisibility()|zx[s]),f.push(b),u=b,a.name=n||"NodeBuffer_"+a.id}else{let m=this.uniformGroups[d];m===void 0&&(m=new QD(d,h),m.setVisibility(Ji.VERTEX|Ji.FRAGMENT|Ji.COMPUTE),this.uniformGroups[d]=m),f.indexOf(m)===-1&&f.push(m),u=this.getNodeUniform(a,t);const b=u.name;m.uniforms.some(v=>v.name===b)||m.addUniform(u)}l.uniformGPU=u}return a}getBuiltin(e,t,s,n=this.shaderStage){const a=this.builtins[n]||(this.builtins[n]=new Map);return a.has(e)===!1&&a.set(e,{name:e,property:t,type:s}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,s=this.flowShaderNode(e),n=[];for(const l of t.inputs)n.push(l.name+" : "+this.getType(l.type));let a=`fn ${t.name}( ${n.join(", ")} ) -> ${this.getType(t.type)} {
${s.vars}
${s.code}
`;return s.result&&(a+=`	return ${s.result};
`),a+=`
}
`,a}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],s=this.directives[e];if(s!==void 0)for(const n of s)t.push(`enable ${n};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],s=this.builtins[e];if(s!==void 0)for(const{name:n,property:a,type:l}of s.values())t.push(`@builtin( ${n} ) ${a} : ${l}`);return t.join(`,
	`)}getScopedArray(e,t,s,n){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:s,bufferCount:n}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:s,scope:n,bufferType:a,bufferCount:l}of this.scopedArrays.values()){const u=this.getType(a);t.push(`var<${n}> ${s}: array< ${u}, ${l} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const s=this.getBuiltins("attribute");s&&t.push(s);const n=this.getAttributesArray();for(let a=0,l=n.length;a<l;a++){const u=n[a],h=u.name,d=this.getType(u.type);t.push(`@location( ${a} ) ${h} : ${d}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const s of e.members){const n=e.output?"@location( "+s.index+" ) ":"";let a=this.getType(s.type);s.atomic&&(a="atomic< "+a+" >"),t.push(`	${n+s.name} : ${a}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const s=this.structs[e];if(s.length>0){const n=[];for(const a of s){let l=`struct ${a.name} {
`;l+=this.getStructMembers(a),l+=`
};`,n.push(l)}t=`
`+n.join(`

`)+`
`}return t}getVar(e,t,s=null){let n=`var ${t} : `;return s!==null?n+=this.generateArrayDeclaration(e,s):n+=this.getType(e),n}getVars(e){const t=[],s=this.vars[e];if(s!==void 0)for(const n of s)t.push(`	${this.getVar(n.type,n.name,n.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","builtinClipSpace","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const a=this.varyings,l=this.vars[e];for(let u=0;u<a.length;u++){const h=a[u];if(h.needsInterpolation){let d=`@location( ${u} )`;if(h.interpolationType){const f=h.interpolationSampling!==null?`, ${h.interpolationSampling} )`:" )";d+=` @interpolate( ${h.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(h.type)&&(d+=" @interpolate(flat, either)");t.push(`${d} ${h.name} : ${this.getType(h.type)}`)}else e==="vertex"&&l.includes(h)===!1&&l.push(h)}}const s=this.getBuiltins(e);s&&t.push(s);const n=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+n):n}isCustomStruct(e){const t=e.value,s=e.node,n=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&s.structTypeNode!==null,a=s.value&&s.value.array&&typeof s.value.itemSize=="number"&&s.value.array.length>s.value.itemSize;return n&&!a}getUniforms(e){const t=this.uniforms[e],s=[],n=[],a=[],l={};for(const h of t){const d=h.groupNode.name,f=this.bindingsIndexes[d];if(h.type==="texture"||h.type==="cubeTexture"||h.type==="cubeDepthTexture"||h.type==="storageTexture"||h.type==="texture3D"){const m=h.node.value;(m.isCubeTexture===!0||this.isUnfilterable(m)===!1&&h.node.isStorageTextureNode!==!0)&&(this.isSampleCompare(m)?s.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${h.name}_sampler : sampler_comparison;`):s.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${h.name}_sampler : sampler;`));let x,v="";const{primarySamples:T}=this.renderer.backend.utils.getTextureSampleData(m);if(T>1&&(v="_multisampled"),m.isCubeTexture===!0&&m.isDepthTexture===!0)x="texture_depth_cube";else if(m.isCubeTexture===!0)x="texture_cube<f32>";else if(m.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&m.compareFunction===null?x=`texture${v}_2d<f32>`:x=`texture_depth${v}_2d${m.isArrayTexture===!0?"_array":""}`;else if(h.node.isStorageTextureNode===!0){const w=D_(m),N=this.getStorageAccess(h.node,e),C=h.node.value.is3DTexture,R=h.node.value.isArrayTexture;x=`texture_storage_${C?"3d":`2d${R?"_array":""}`}<${w}, ${N}>`}else if(m.isArrayTexture===!0||m.isDataArrayTexture===!0||m.isCompressedArrayTexture===!0)x="texture_2d_array<f32>";else if(m.is3DTexture===!0||m.isData3DTexture===!0)x="texture_3d<f32>";else{const w=this.getComponentTypeFromTexture(m).charAt(0);x=`texture${v}_2d<${w}32>`}s.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${h.name} : ${x};`)}else if(h.type==="buffer"||h.type==="storageBuffer"||h.type==="indirectStorageBuffer"){const m=h.node,b=this.getType(m.getNodeType(this)),x=m.bufferCount,v=x>0&&h.type==="buffer"?", "+x:"",T=m.isStorageBufferNode?`storage, ${this.getStorageAccess(m,e)}`:"uniform";if(this.isCustomStruct(h))n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${T}> ${h.name} : ${b};`);else{const N=`	value : array< ${m.isAtomic?`atomic<${b}>`:`${b}`}${v} >`;n.push(this._getWGSLStructBinding(h.name,N,T,f.binding++,f.group))}}else{const m=h.groupNode.name;if(l[m]===void 0){const b=this.uniformGroups[m];if(b!==void 0){const x=[];for(const T of b.uniforms){const w=T.getType(),N=this.getType(this.getVectorType(w));x.push(`	${T.name} : ${N}`)}let v=this.uniformGroupsBindings[m];v===void 0&&(v={index:f.binding++,id:f.group},this.uniformGroupsBindings[m]=v),l[m]={index:v.index,id:v.id,snippets:x}}}}}for(const h in l){const d=l[h];a.push(this._getWGSLStructBinding(h,d.snippets.join(`,
`),"uniform",d.index,d.id))}return[...s,...n,...a].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const s=e[t];s.uniforms=this.getUniforms(t),s.attributes=this.getAttributes(t),s.varyings=this.getVaryings(t),s.structs=this.getStructs(t),s.vars=this.getVars(t),s.codes=this.getCodes(t),s.directives=this.getDirectives(t),s.scopedArrays=this.getScopedArrays(t);let n=`// code

`;n+=this.flowCode[t];const a=this.flowNodes[t],l=a[a.length-1],u=l.outputNode,h=u!==void 0&&u.isOutputStructNode===!0;for(const d of a){const f=this.getFlowData(d),m=d.name;if(m&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${m}
`),n+=`${f.code}
	`,d===l&&t!=="compute"){if(n+=`// result

	`,t==="vertex")n+=`varyings.builtinClipSpace = ${f.result};`;else if(t==="fragment")if(h)s.returnType=u.getNodeType(this),s.structs+="var<private> output : "+s.returnType+";",n+=`return ${f.result};`;else{let b="	@location(0) color: vec4<f32>";const x=this.getBuiltins("output");x&&(b+=`,
	`+x),s.returnType="OutputStruct",s.structs+=this._getWGSLStruct("OutputStruct",b),s.structs+=`
var<private> output : OutputStruct;`,n+=`output.color = ${f.result};

	return output;`}}}s.flow=n}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let s;return t!==null&&(s=this._getWGSLMethod(e+"_"+t)),s===void 0&&(s=this._getWGSLMethod(e)),s||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,s){return`select( ${s}, ${t}, ${e} )`}getType(e){return Gq[e]||e}isAvailable(e){let t=uC[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),uC[e]=t),t}getUniformBufferLimit(){return this.renderer.backend.device.limits.maxUniformBufferBindingSize}_getWGSLMethod(e){return Dh[e]!==void 0&&this._include(e),qq[e]}_include(e){const t=Dh[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${n3}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[s,n,a]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${s}, ${n}, ${a} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${s} * numWorkgroups.x )
		+ globalId.z * ( ${s} * numWorkgroups.x ) * ( ${n} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,s,n=0,a=0){const l=e+"Struct";return`${this._getWGSLStruct(l,t)}
@binding( ${n} ) @group( ${a} )
var<${s}> ${e} : ${l};`}}class jq{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depth&&(e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.stencil?t=F.Depth24PlusStencil8:t=F.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const a=this.backend.renderer,l=a.getRenderTarget();t=l?l.samples:a.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const s=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:s?1:t,isMSAA:s}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Jf.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Jf.LineList;if(e.isLine)return Jf.LineStrip;if(e.isMesh)return Jf.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===Vs)return F.BGRA8Unorm;if(t===Cs)return F.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const i3=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&i3.set(Float16Array,["float16"]);const $q=new Map([[pE,["float16"]]]),Wq=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Xq{constructor(e){this.backend=e}createAttribute(e,t){const s=this._getBufferAttribute(e),n=this.backend,a=n.get(s);let l=a.buffer;if(l===void 0){const u=n.device;let h=s.array;if(e.normalized===!1){if(h.constructor===Int16Array||h.constructor===Int8Array)h=new Int32Array(h);else if((h.constructor===Uint16Array||h.constructor===Uint8Array)&&(h=new Uint32Array(h),t&GPUBufferUsage.INDEX))for(let m=0;m<h.length;m++)h[m]===65535&&(h[m]=4294967295)}if(s.array=h,(s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute)&&s.itemSize===3){h=new h.constructor(s.count*4);for(let m=0;m<s.count;m++)h.set(s.array.subarray(m*3,m*3+3),m*4);s.itemSize=4,s.array=h,a._force3to4BytesAlignment=!0}const d=h.byteLength,f=d+(4-d%4)%4;l=u.createBuffer({label:s.name,size:f,usage:t,mappedAtCreation:!0}),new h.constructor(l.getMappedRange()).set(h),l.unmap(),a.buffer=l}}updateAttribute(e){const t=this._getBufferAttribute(e),s=this.backend,n=s.device,a=s.get(t),l=s.get(t).buffer;let u=t.array;if(a._force3to4BytesAlignment===!0){u=new u.constructor(t.count*4);for(let d=0;d<t.count;d++)u.set(t.array.subarray(d*3,d*3+3),d*4);t.array=u}const h=t.updateRanges;if(h.length===0)n.queue.writeBuffer(l,0,u,0);else{const d=$m(u),f=d?1:u.BYTES_PER_ELEMENT;for(let m=0,b=h.length;m<b;m++){const x=h[m];let v,T;if(a._force3to4BytesAlignment===!0){const N=Math.floor(x.start/3),C=Math.ceil(x.count/3);v=N*4*f,T=C*4*f}else v=x.start*f,T=x.count*f;const w=v*(d?u.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(l,w,u,v,T)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),s=new Map;for(let n=0;n<t.length;n++){const a=t[n],l=a.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(a);let h=s.get(u);if(h===void 0){let m,b;a.isInterleavedBufferAttribute===!0?(m=a.data.stride*l,b=a.data.isInstancedInterleavedBuffer?em.Instance:em.Vertex):(m=a.itemSize*l,b=a.isInstancedBufferAttribute?em.Instance:em.Vertex),a.normalized===!1&&(a.array.constructor===Int16Array||a.array.constructor===Uint16Array)&&(m=4),h={arrayStride:m,attributes:[],stepMode:b},s.set(u,h)}const d=this._getVertexFormat(a),f=a.isInterleavedBufferAttribute===!0?a.offset*l:0;h.attributes.push({shaderLocation:n,offset:f,format:d})}return Array.from(s.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,s=t.device,a=t.get(this._getBufferAttribute(e)).buffer,l=a.size,u=s.createBuffer({label:`${e.name}_readback`,size:l,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),h=s.createCommandEncoder({label:`readback_encoder_${e.name}`});h.copyBufferToBuffer(a,0,u,0,l);const d=h.finish();s.queue.submit([d]),await u.mapAsync(GPUMapMode.READ);const f=u.getMappedRange(),m=new e.array.constructor(f.slice(0));return u.unmap(),m.buffer}_getVertexFormat(e){const{itemSize:t,normalized:s}=e,n=e.array.constructor,a=e.constructor;let l;if(t===1)l=Wq.get(n);else{const h=($q.get(a)||i3.get(n))[s?1:0];if(h){const d=n.BYTES_PER_ELEMENT*t,m=Math.floor((d+3)/4)*4/n.BYTES_PER_ELEMENT;if(m%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");l=`${h}x${m}`}}return l||le("WebGPUAttributeUtils: Vertex format not supported yet."),l}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Yq{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class Kq{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,s=t.device,n=t.get(e);if(n.layout)return n.layout.layoutGPU;const a=this._createLayoutEntries(e),l=hc(JSON.stringify(a));let u=this._bindGroupLayoutCache.get(l);return u===void 0&&(u=new Yq(s.createBindGroupLayout({entries:a})),this._bindGroupLayoutCache.set(l,u)),u.usedTimes++,n.layout=u,n.layoutKey=l,u.layoutGPU}createBindings(e,t,s,n=0){const{backend:a}=this,l=a.get(e),u=this.createBindingsLayout(e);let h;s>0&&(l.groups===void 0&&(l.groups=[],l.versions=[]),l.versions[s]===n&&(h=l.groups[s])),h===void 0&&(h=this.createBindGroup(e,u),s>0&&(l.groups[s]=h,l.versions[s]=n)),l.group=h}updateBinding(e){const t=this.backend,s=t.device,n=e.buffer,a=t.get(e).buffer,l=e.updateRanges;if(l.length===0)s.queue.writeBuffer(a,0,n,0);else{const u=$m(n),h=u?1:n.BYTES_PER_ELEMENT;for(let d=0,f=l.length;d<f;d++){const m=l[d],b=m.start*h,x=m.count*h,v=b*(u?n.BYTES_PER_ELEMENT:1);s.queue.writeBuffer(a,v,n,b,x)}}}createBindGroupIndex(e,t){const n=this.backend.device,a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,l=e[0],u=n.createBuffer({label:"bindingCameraIndex_"+l,size:16,usage:a});n.queue.writeBuffer(u,0,e,0);const h=[{binding:0,resource:{buffer:u}}];return n.createBindGroup({label:"bindGroupCameraIndex_"+l,layout:t,entries:h})}createBindGroup(e,t){const s=this.backend,n=s.device;let a=0;const l=[];for(const u of e.bindings){if(u.isUniformBuffer){const h=s.get(u);if(h.buffer===void 0){const d=u.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,m=[];u.visibility&Ji.VERTEX&&m.push("vertex"),u.visibility&Ji.FRAGMENT&&m.push("fragment"),u.visibility&Ji.COMPUTE&&m.push("compute");const b=`(${m.join(",")})`,x=n.createBuffer({label:`bindingBuffer${u.id}_${u.name}_${b}`,size:d,usage:f});h.buffer=x}l.push({binding:a,resource:{buffer:h.buffer}})}else if(u.isStorageBuffer){const h=s.get(u.attribute).buffer;l.push({binding:a,resource:{buffer:h}})}else if(u.isSampledTexture){const h=s.get(u.texture);let d;if(h.externalTexture!==void 0)d=n.importExternalTexture({source:h.externalTexture});else{const f=u.store?1:h.texture.mipLevelCount,m=u.store?u.mipLevel:0;let b=`view-${h.texture.width}-${h.texture.height}`;if(h.texture.depthOrArrayLayers>1&&(b+=`-${h.texture.depthOrArrayLayers}`),b+=`-${f}-${m}`,d=h[b],d===void 0){const x=Nq.All;let v;u.isSampledCubeTexture?v=Fs.Cube:u.isSampledTexture3D?v=Fs.ThreeD:u.texture.isArrayTexture||u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?v=Fs.TwoDArray:v=Fs.TwoD,d=h[b]=h.texture.createView({aspect:x,dimension:v,mipLevelCount:f,baseMipLevel:m})}}l.push({binding:a,resource:d})}else if(u.isSampler){const h=s.get(u.texture);l.push({binding:a,resource:h.sampler})}a++}return n.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:l})}_createLayoutEntries(e){const t=[];let s=0;for(const n of e.bindings){const a=this.backend,l={binding:s,visibility:n.visibility};if(n.isUniformBuffer||n.isStorageBuffer){const u={};n.isStorageBuffer&&(n.visibility&Ji.COMPUTE&&(n.access===Es.READ_WRITE||n.access===Es.WRITE_ONLY)?u.type=Ox.Storage:u.type=Ox.ReadOnlyStorage),l.buffer=u}else if(n.isSampledTexture&&n.store){const u={};u.format=this.backend.get(n.texture).texture.format;const h=n.access;h===Es.READ_WRITE?u.access=Vx.ReadWrite:h===Es.WRITE_ONLY?u.access=Vx.WriteOnly:u.access=Vx.ReadOnly,n.texture.isArrayTexture?u.viewDimension=Fs.TwoDArray:n.texture.is3DTexture&&(u.viewDimension=Fs.ThreeD),l.storageTexture=u}else if(n.isSampledTexture){const u={},{primarySamples:h}=a.utils.getTextureSampleData(n.texture);if(h>1&&(u.multisampled=!0,n.texture.isDepthTexture||(u.sampleType=Jo.UnfilterableFloat)),n.texture.isDepthTexture)a.compatibilityMode&&n.texture.compareFunction===null?u.sampleType=Jo.UnfilterableFloat:u.sampleType=Jo.Depth;else if(n.texture.isDataTexture||n.texture.isDataArrayTexture||n.texture.isData3DTexture){const d=n.texture.type;d===Ps?u.sampleType=Jo.SInt:d===Gt?u.sampleType=Jo.UInt:d===cn&&(this.backend.hasFeature("float32-filterable")?u.sampleType=Jo.Float:u.sampleType=Jo.UnfilterableFloat)}n.isSampledCubeTexture?u.viewDimension=Fs.Cube:n.texture.isArrayTexture||n.texture.isDataArrayTexture||n.texture.isCompressedArrayTexture?u.viewDimension=Fs.TwoDArray:n.isSampledTexture3D&&(u.viewDimension=Fs.ThreeD),l.texture=u}else if(n.isSampler){const u={};n.texture.isDepthTexture&&(n.texture.compareFunction!==null&&a.hasCompatibility(uo.TEXTURE_COMPARE)?u.type=iC.Comparison:u.type=iC.NonFiltering),l.sampler=u}else le(`WebGPUBindingUtils: Unsupported binding "${n}".`);t.push(l),s++}return t}deleteBindGroupData(e){const{backend:t}=this,s=t.get(e);s.layout&&(s.layout.usedTimes--,s.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(s.layoutKey),s.layout=void 0,s.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class Zq{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:s,material:n,geometry:a,pipeline:l}=e,{vertexProgram:u,fragmentProgram:h}=l,d=this.backend,f=d.device,m=d.utils,b=d.get(l),x=[];for(const xe of e.getBindings()){const Ce=d.get(xe),{layoutGPU:ge}=Ce.layout;x.push(ge)}const v=d.attributeUtils.createShaderVertexBuffers(e);let T;n.blending!==Xr&&(n.blending!==ri||n.transparent!==!1)&&(T=this._getBlending(n));let w={};n.stencilWrite===!0&&(w={compare:this._getStencilCompare(n),failOp:this._getStencilOperation(n.stencilFail),depthFailOp:this._getStencilOperation(n.stencilZFail),passOp:this._getStencilOperation(n.stencilZPass)});const N=this._getColorWriteMask(n),C=[];if(e.context.textures!==null){const xe=e.context.textures,Ce=e.context.mrt;for(let ge=0;ge<xe.length;ge++){const j=xe[ge],oe=m.getTextureFormatGPU(j);let fe;if(Ce!==null)if(this.backend.compatibilityMode!==!0){const Ne=Ce.getBlendMode(j.name);Ne.blending===k_?fe=T:Ne.blending!==Xr&&(fe=this._getBlending(Ne))}else ft("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets."),fe=T;else fe=T;C.push({format:oe,blend:fe,writeMask:N})}}else{const xe=m.getCurrentColorFormat(e.context);C.push({format:xe,blend:T,writeMask:N})}const R=d.get(u).module,E=d.get(h).module,k=this._getPrimitiveState(s,a,n),q=this._getDepthCompare(n),D=m.getCurrentDepthStencilFormat(e.context),I=this._getSampleCount(e.context),$={label:`renderPipeline_${n.name||n.type}_${n.id}`,vertex:Object.assign({},R,{buffers:v}),fragment:Object.assign({},E,{targets:C}),primitive:k,multisample:{count:I,alphaToCoverageEnabled:n.alphaToCoverage&&I>1},layout:f.createPipelineLayout({bindGroupLayouts:x})},ae={},pe=e.context.depth,me=e.context.stencil;if((pe===!0||me===!0)&&(pe===!0&&(ae.format=D,ae.depthWriteEnabled=n.depthWrite,ae.depthCompare=q),me===!0&&(ae.stencilFront=w,ae.stencilBack=w,ae.stencilReadMask=n.stencilFuncMask,ae.stencilWriteMask=n.stencilWriteMask),n.polygonOffset===!0&&(ae.depthBias=n.polygonOffsetUnits,ae.depthBiasSlopeScale=n.polygonOffsetFactor,ae.depthBiasClamp=0),$.depthStencil=ae),f.pushErrorScope("validation"),t===null)b.pipeline=f.createRenderPipeline($),f.popErrorScope().then(xe=>{xe!==null&&(b.error=!0,le(xe.message))});else{const xe=new Promise(async Ce=>{try{b.pipeline=await f.createRenderPipelineAsync($)}catch{}const ge=await f.popErrorScope();ge!==null&&(b.error=!0,le(ge.message)),Ce()});t.push(xe)}}createBundleEncoder(e,t="renderBundleEncoder"){const s=this.backend,{utils:n,device:a}=s,l=n.getCurrentDepthStencilFormat(e),u=n.getCurrentColorFormats(e),h=this._getSampleCount(e),d={label:t,colorFormats:u,depthStencilFormat:l,sampleCount:h};return a.createRenderBundleEncoder(d)}createComputePipeline(e,t){const s=this.backend,n=s.device,a=s.get(e.computeProgram).module,l=s.get(e),u=[];for(const h of t){const d=s.get(h),{layoutGPU:f}=d.layout;u.push(f)}l.pipeline=n.createComputePipeline({compute:a,layout:n.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let t,s;const n=e.blending,a=e.blendSrc,l=e.blendDst,u=e.blendEquation;if(n===ku){const h=e.blendSrcAlpha!==null?e.blendSrcAlpha:a,d=e.blendDstAlpha!==null?e.blendDstAlpha:l,f=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;t={srcFactor:this._getBlendFactor(a),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)},s={srcFactor:this._getBlendFactor(h),dstFactor:this._getBlendFactor(d),operation:this._getBlendOperation(f)}}else{const h=e.premultipliedAlpha,d=(f,m,b,x)=>{t={srcFactor:f,dstFactor:m,operation:Qo.Add},s={srcFactor:b,dstFactor:x,operation:Qo.Add}};if(h)switch(n){case ri:d(Ke.One,Ke.OneMinusSrcAlpha,Ke.One,Ke.OneMinusSrcAlpha);break;case Pu:d(Ke.One,Ke.One,Ke.One,Ke.One);break;case Ou:d(Ke.Zero,Ke.OneMinusSrc,Ke.Zero,Ke.One);break;case Vu:d(Ke.Dst,Ke.OneMinusSrcAlpha,Ke.Zero,Ke.One);break}else switch(n){case ri:d(Ke.SrcAlpha,Ke.OneMinusSrcAlpha,Ke.One,Ke.OneMinusSrcAlpha);break;case Pu:d(Ke.SrcAlpha,Ke.One,Ke.One,Ke.One);break;case Ou:le(`WebGPURenderer: "SubtractiveBlending" requires "${e.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break;case Vu:le(`WebGPURenderer: "MultiplyBlending" requires "${e.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break}}if(t!==void 0&&s!==void 0)return{color:t,alpha:s};le("WebGPURenderer: Invalid blending: ",n)}_getBlendFactor(e){let t;switch(e){case Ka:t=Ke.Zero;break;case HC:t=Ke.One;break;case jC:t=Ke.Src;break;case $C:t=Ke.OneMinusSrc;break;case ed:t=Ke.SrcAlpha;break;case td:t=Ke.OneMinusSrcAlpha;break;case YC:t=Ke.Dst;break;case KC:t=Ke.OneMinusDst;break;case WC:t=Ke.DstAlpha;break;case XC:t=Ke.OneMinusDstAlpha;break;case ZC:t=Ke.SrcAlphaSaturated;break;case Yk:t=Ke.Constant;break;case Kk:t=Ke.OneMinusConstant;break;default:le("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const s=e.stencilFunc;switch(s){case fP:t=As.Never;break;case i_:t=As.Always;break;case mP:t=As.Less;break;case yP:t=As.LessEqual;break;case gP:t=As.Equal;break;case _P:t=As.GreaterEqual;break;case bP:t=As.Greater;break;case xP:t=As.NotEqual;break;default:le("WebGPURenderer: Invalid stencil function.",s)}return t}_getStencilOperation(e){let t;switch(e){case tl:t=$a.Keep;break;case oP:t=$a.Zero;break;case lP:t=$a.Replace;break;case pP:t=$a.Invert;break;case uP:t=$a.IncrementClamp;break;case cP:t=$a.DecrementClamp;break;case hP:t=$a.IncrementWrap;break;case dP:t=$a.DecrementWrap;break;default:le("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case ai:t=Qo.Add;break;case GC:t=Qo.Subtract;break;case qC:t=Qo.ReverseSubtract;break;case jF:t=Qo.Min;break;case $F:t=Qo.Max;break;default:le("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,s){const n={},a=this.backend.utils;n.topology=a.getPrimitiveTopology(e,s),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(n.stripIndexFormat=t.index.array instanceof Uint16Array?ug.Uint16:ug.Uint32);let l=s.side===Rs;return e.isMesh&&e.matrixWorld.determinant()<0&&(l=!l),n.frontFace=l===!0?tC.CW:tC.CCW,n.cullMode=s.side===Wr?sC.None:sC.Back,n}_getColorWriteMask(e){return e.colorWrite===!0?nC.All:nC.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=As.Always;else{const s=this.backend.parameters.reversedDepthBuffer?uE[e.depthFunc]:e.depthFunc;switch(s){case dm:t=As.Never;break;case pm:t=As.Always;break;case fm:t=As.Less;break;case Qu:t=As.LessEqual;break;case mm:t=As.Equal;break;case gm:t=As.GreaterEqual;break;case ym:t=As.Greater;break;case bm:t=As.NotEqual;break;default:le("WebGPUPipelineUtils: Invalid depth function.",s)}}return t}}class Qq extends s3{constructor(e,t,s=2048){super(s),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const n=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:n,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:n,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,s=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const n=this.device.createCommandEncoder();n.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),n.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,s);const a=n.finish();if(this.device.queue.submit([a]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,s),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const l=new BigUint64Array(this.resultBuffer.getMappedRange(0,s)),u={},h=[];for(const[f,m]of e){const b=f.match(/^(.*):f(\d+)$/),x=parseInt(b[2]);h.includes(x)===!1&&h.push(x),u[x]===void 0&&(u[x]=0);const v=l[m],T=l[m+1],w=Number(T-v)/1e6;this.timestamps.set(f,w),u[x]+=w}const d=u[h[h.length-1]];return this.resultBuffer.unmap(),this.lastValue=d,this.frames=h,d}catch(e){return le("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){le("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){le("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Jq extends t3{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=null,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new jq(this),this.attributeUtils=new Xq(this),this.bindingUtils=new Kq(this),this.pipelineUtils=new Zq(this),this.textureUtils=new Uq(this),this.occludedResolveCache=new Map;const t=typeof navigator>"u"?!0:/Android/.test(navigator.userAgent)===!1;this._compatibility={[uo.TEXTURE_COMPARE]:t}}async init(e){await super.init(e);const t=this.parameters;let s;if(t.device===void 0){const n={powerPreference:t.powerPreference,featureLevel:"compatibility"},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(n):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const l=Object.values(B_),u=[];for(const d of l)a.features.has(d)&&u.push(d);const h={requiredFeatures:u,requiredLimits:t.requiredLimits};s=await a.requestDevice(h)}else s=t.device;this.compatibilityMode=!s.features.has("core-features-and-limits"),this.compatibilityMode&&(e._samples=0),s.lost.then(n=>{if(n.reason==="destroyed")return;const a={api:"WebGPU",message:n.message||"Unknown reason",reason:n.reason||null,originalEvent:n};e.onDeviceLost(a)}),this.device=s,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(B_.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let s=t.context;if(s===void 0){const n=this.parameters;e.isDefaultCanvasTarget===!0&&n.context!==void 0?s=n.context:s=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${yd} webgpu`);const a=n.alpha?"premultiplied":"opaque",l=n.outputType===Cs?"extended":"standard";s.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:a,toneMapping:{mode:l}}),t.context=s}return s}get coordinateSystem(){return pi}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),s=this.get(t),n=e.currentSamples;let a=s.descriptor;if(a===void 0||s.samples!==n){a={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(a.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const u=a.colorAttachments[0];n>0?u.view=this.textureUtils.getColorBuffer().createView():u.resolveTarget=void 0,s.descriptor=a,s.samples=n}const l=a.colorAttachments[0];return n>0?l.resolveTarget=this.context.getCurrentTexture().createView():l.view=this.context.getCurrentTexture().createView(),a}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const s=e.renderTarget,n=this.get(s);let a=n.descriptors;(a===void 0||n.width!==s.width||n.height!==s.height||n.samples!==s.samples)&&(a={},n.descriptors=a);const l=e.getCacheKey();let u=a[l];if(u===void 0){const d=e.textures,f=[];let m;const b=this._isRenderCameraDepthArray(e);for(let x=0;x<d.length;x++){const v=this.get(d[x]),T={label:`colorAttachment_${x}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Fs.TwoD};if(s.isRenderTarget3D)m=e.activeCubeFace,T.baseArrayLayer=0,T.dimension=Fs.ThreeD,T.depthOrArrayLayers=d[x].image.depth;else if(s.isRenderTarget&&d[x].image.depth>1)if(b===!0){const w=e.camera.cameras;for(let N=0;N<w.length;N++){const C={...T,baseArrayLayer:N,arrayLayerCount:1,dimension:Fs.TwoD},R=v.texture.createView(C);f.push({view:R,resolveTarget:void 0,depthSlice:void 0})}}else T.dimension=Fs.TwoDArray,T.depthOrArrayLayers=d[x].image.depth;if(b!==!0){const w=v.texture.createView(T);let N,C;v.msaaTexture!==void 0?(N=v.msaaTexture.createView(),C=w):(N=w,C=void 0),f.push({view:N,resolveTarget:C,depthSlice:m})}}if(u={textureViews:f},e.depth){const x=this.get(e.depthTexture),v={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(v.dimension=Fs.TwoD,v.arrayLayerCount=1,v.baseArrayLayer=e.activeCubeFace),u.depthStencilView=x.texture.createView(v)}a[l]=u,n.width=s.width,n.height=s.height,n.samples=s.samples,n.activeMipmapLevel=e.activeMipmapLevel,n.activeCubeFace=e.activeCubeFace}const h={colorAttachments:[]};for(let d=0;d<u.textureViews.length;d++){const f=u.textureViews[d];let m={r:0,g:0,b:0,a:1};d===0&&t.clearValue&&(m=t.clearValue),h.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:t.loadOp||dt.Load,storeOp:t.storeOp||$s.Store,clearValue:m})}return u.depthStencilView&&(h.depthStencilAttachment={view:u.depthStencilView}),h}beginRender(e){const t=this.get(e),s=this.device,n=e.occlusionQueryCount;let a;n>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,a=s.createQuerySet({type:"occlusion",count:n,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=a,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(n),t.lastOcclusionObject=null);let l;e.textures===null?l=this._getDefaultRenderPassDescriptor():l=this._getRenderPassDescriptor(e,{loadOp:dt.Load}),this.initTimestampQuery(Qi.RENDER,this.getTimestampUID(e),l),l.occlusionQuerySet=a;const u=l.depthStencilAttachment;if(e.textures!==null){const d=l.colorAttachments;for(let f=0;f<d.length;f++){const m=d[f];e.clearColor?(m.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},m.loadOp=dt.Clear):m.loadOp=dt.Load,m.storeOp=$s.Store}}else{const d=l.colorAttachments[0];e.clearColor?(d.clearValue=e.clearColorValue,d.loadOp=dt.Clear):d.loadOp=dt.Load,d.storeOp=$s.Store}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=dt.Clear):u.depthLoadOp=dt.Load,u.depthStoreOp=$s.Store),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=dt.Clear):u.stencilLoadOp=dt.Load,u.stencilStoreOp=$s.Store);const h=s.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const d=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==d.length?this._createDepthLayerDescriptors(e,t,l,d):this._updateDepthLayerDescriptors(e,t,d),t.bundleEncoders=[],t.bundleSets=[];for(let f=0;f<d.length;f++){const m=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+f),b={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(m),t.bundleSets.push(b)}t.currentPass=null}else{const d=h.beginRenderPass(l);t.currentPass=d,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=l,t.encoder=h,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,s,n){const a=s.depthStencilAttachment;t.layerDescriptors=[];const l=this.get(e.depthTexture);l.viewCache||(l.viewCache=[]);for(let u=0;u<n.length;u++){const h={...s,colorAttachments:[{...s.colorAttachments[0],view:s.colorAttachments[u].view}]};if(s.depthStencilAttachment){const d=u;l.viewCache[d]||(l.viewCache[d]=l.texture.createView({dimension:Fs.TwoD,baseArrayLayer:u,arrayLayerCount:1})),h.depthStencilAttachment={view:l.viewCache[d],depthLoadOp:a.depthLoadOp||dt.Clear,depthStoreOp:a.depthStoreOp||$s.Store,depthClearValue:a.depthClearValue||1},e.stencil&&(h.depthStencilAttachment.stencilLoadOp=a.stencilLoadOp,h.depthStencilAttachment.stencilStoreOp=a.stencilStoreOp,h.depthStencilAttachment.stencilClearValue=a.stencilClearValue)}else h.depthStencilAttachment={...a};t.layerDescriptors.push(h)}}_updateDepthLayerDescriptors(e,t,s){for(let n=0;n<s.length;n++){const a=t.layerDescriptors[n];if(a.depthStencilAttachment){const l=a.depthStencilAttachment;e.depth&&(e.clearDepth?(l.depthClearValue=e.clearDepthValue,l.depthLoadOp=dt.Clear):l.depthLoadOp=dt.Load),e.stencil&&(e.clearStencil?(l.stencilClearValue=e.clearStencilValue,l.stencilLoadOp=dt.Clear):l.stencilLoadOp=dt.Load)}}}finishRender(e){const t=this.get(e),s=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),s>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const n=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const a=[];for(let l=0;l<t.bundleEncoders.length;l++){const u=t.bundleEncoders[l];a.push(u.finish())}for(let l=0;l<t.layerDescriptors.length;l++)if(l<a.length){const u=t.layerDescriptors[l],h=n.beginRenderPass(u);if(e.viewport){const{x:d,y:f,width:m,height:b,minDepth:x,maxDepth:v}=e.viewportValue;h.setViewport(d,f,m,b,x,v)}if(e.scissor){const{x:d,y:f,width:m,height:b}=e.scissorValue;h.setScissorRect(d,f,m,b)}h.executeBundles([a[l]]),h.end()}}else t.currentPass&&t.currentPass.end();if(s>0){const a=s*8;let l=this.occludedResolveCache.get(a);l===void 0&&(l=this.device.createBuffer({size:a,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(a,l));const u=this.device.createBuffer({size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,s,l,0),t.encoder.copyBufferToBuffer(l,0,u,0,a),t.occlusionQueryBuffer=u,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const a=e.textures;for(let l=0;l<a.length;l++){const u=a[l];u.generateMipmaps===!0&&this.textureUtils.generateMipmaps(u)}}}isOccluded(e,t){const s=this.get(e);return s.occluded&&s.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:s,currentOcclusionQueryObjects:n}=t;if(s&&n){const a=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await s.mapAsync(GPUMapMode.READ);const l=s.getMappedRange(),u=new BigUint64Array(l);for(let h=0;h<n.length;h++)u[h]===BigInt(0)&&a.add(n[h]);s.destroy(),t.occluded=a}}updateViewport(e){const{currentPass:t}=this.get(e),{x:s,y:n,width:a,height:l,minDepth:u,maxDepth:h}=e.viewportValue;t.setViewport(s,n,a,l,u,h)}updateScissor(e){const{currentPass:t}=this.get(e),{x:s,y:n,width:a,height:l}=e.scissorValue;t.setScissorRect(s,n,a,l)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,s,n=null){const a=this.device,l=this.renderer;let u=[],h,d,f,m;if(e){const v=this.getClearColor();d={r:v.r,g:v.g,b:v.b,a:v.a}}if(n===null){f=l.depth,m=l.stencil;const v=this._getDefaultRenderPassDescriptor();if(e){u=v.colorAttachments;const T=u[0];T.clearValue=d,T.loadOp=dt.Clear,T.storeOp=$s.Store}(f||m)&&(h=v.depthStencilAttachment)}else{f=n.depth,m=n.stencil;const v={loadOp:e?dt.Clear:dt.Load,clearValue:e?d:void 0};f&&(v.depthLoadOp=t?dt.Clear:dt.Load,v.depthClearValue=t?l.getClearDepth():void 0,v.depthStoreOp=$s.Store),m&&(v.stencilLoadOp=s?dt.Clear:dt.Load,v.stencilClearValue=s?l.getClearStencil():void 0,v.stencilStoreOp=$s.Store);const T=this._getRenderPassDescriptor(n,v);u=T.colorAttachments,h=T.depthStencilAttachment}f&&h&&(t?(h.depthLoadOp=dt.Clear,h.depthClearValue=l.getClearDepth(),h.depthStoreOp=$s.Store):(h.depthLoadOp=dt.Load,h.depthStoreOp=$s.Store)),m&&h&&(s?(h.stencilLoadOp=dt.Clear,h.stencilClearValue=l.getClearStencil(),h.stencilStoreOp=$s.Store):(h.stencilLoadOp=dt.Load,h.stencilStoreOp=$s.Store));const b=a.createCommandEncoder({label:"clear"});b.beginRenderPass({colorAttachments:u,depthStencilAttachment:h}).end(),a.queue.submit([b.finish()])}beginCompute(e){const t=this.get(e),s={label:"computeGroup_"+e.id};this.initTimestampQuery(Qi.COMPUTE,this.getTimestampUID(e),s),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(s)}compute(e,t,s,n,a=null){const l=this.get(t),{passEncoderGPU:u}=this.get(e),h=this.get(n).pipeline;this.pipelineUtils.setPipeline(u,h);for(let d=0,f=s.length;d<f;d++){const m=s[d],b=this.get(m);u.setBindGroup(d,b.group)}if(a===null&&(a=t.count),a&&typeof a=="object"&&a.isIndirectStorageBufferAttribute){const d=this.get(a).buffer;u.dispatchWorkgroupsIndirect(d,0);return}if(typeof a=="number"){const d=a;if(l.dispatchSize===void 0||l.count!==d){l.dispatchSize=[0,1,1],l.count=d;const f=t.workgroupSize;let m=f[0];for(let v=1;v<f.length;v++)m*=f[v];const b=Math.ceil(d/m),x=this.device.limits.maxComputeWorkgroupsPerDimension;a=[b,1,1],b>x&&(a[0]=Math.min(b,x),a[1]=Math.ceil(b/x)),l.dispatchSize=a}a=l.dispatchSize}u.dispatchWorkgroups(a[0],a[1]||1,a[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:s,material:n,context:a,pipeline:l}=e,u=e.getBindings(),h=this.get(a),d=this.get(l),f=d.pipeline;if(d.error===!0)return;const m=e.getIndex(),b=m!==null,x=e.getDrawParameters();if(x===null)return;const v=(w,N)=>{this.pipelineUtils.setPipeline(w,f),N.pipeline=f;const C=N.bindingGroups;for(let E=0,k=u.length;E<k;E++){const q=u[E],D=this.get(q);C[q.index]!==q.id&&(w.setBindGroup(q.index,D.group),C[q.index]=q.id)}if(b===!0&&N.index!==m){const E=this.get(m).buffer,k=m.array instanceof Uint16Array?ug.Uint16:ug.Uint32;w.setIndexBuffer(E,k),N.index=m}const R=e.getVertexBuffers();for(let E=0,k=R.length;E<k;E++){const q=R[E];if(N.attributes[E]!==q){const D=this.get(q).buffer;w.setVertexBuffer(E,D),N.attributes[E]=q}}a.stencil===!0&&n.stencilWrite===!0&&h.currentStencilRef!==n.stencilRef&&(w.setStencilReference(n.stencilRef),h.currentStencilRef=n.stencilRef)},T=(w,N)=>{if(v(w,N),s.isBatchedMesh===!0){const C=s._multiDrawStarts,R=s._multiDrawCounts,E=s._multiDrawCount,k=s._multiDrawInstances;k!==null&&ft("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");let q=b===!0?m.array.BYTES_PER_ELEMENT:1;n.wireframe&&(q=s.geometry.attributes.position.count>65535?4:2);for(let D=0;D<E;D++){const I=k?k[D]:1,$=I>1?0:D;b===!0?w.drawIndexed(R[D],I,C[D]/q,0,$):w.draw(R[D],I,C[D],$),t.update(s,R[D],I)}}else if(b===!0){const{vertexCount:C,instanceCount:R,firstVertex:E}=x,k=e.getIndirect();if(k!==null){const q=this.get(k).buffer,D=e.getIndirectOffset(),I=Array.isArray(D)?D:[D];for(let $=0;$<I.length;$++)w.drawIndexedIndirect(q,I[$])}else w.drawIndexed(C,R,E,0,0);t.update(s,C,R)}else{const{vertexCount:C,instanceCount:R,firstVertex:E}=x,k=e.getIndirect();if(k!==null){const q=this.get(k).buffer,D=e.getIndirectOffset(),I=Array.isArray(D)?D:[D];for(let $=0;$<I.length;$++)w.drawIndirect(q,I[$])}else w.draw(C,R,E,0);t.update(s,C,R)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const w=this.get(e.camera),N=e.camera.cameras,C=e.getBindingGroup("cameraIndex");if(w.indexesGPU===void 0||w.indexesGPU.length!==N.length){const E=this.get(C),k=[],q=new Uint32Array([0,0,0,0]);for(let D=0,I=N.length;D<I;D++){q[0]=D;const{layoutGPU:$}=E.layout,ae=this.bindingUtils.createBindGroupIndex(q,$);k.push(ae)}w.indexesGPU=k}const R=this.renderer.getPixelRatio();for(let E=0,k=N.length;E<k;E++){const q=N[E];if(s.layers.test(q.layers)){const D=q.viewport;let I=h.currentPass,$=h.currentSets;if(h.bundleEncoders){const ae=h.bundleEncoders[E],pe=h.bundleSets[E];I=ae,$=pe}D&&I.setViewport(Math.floor(D.x*R),Math.floor(D.y*R),Math.floor(D.width*R),Math.floor(D.height*R),a.viewportValue.minDepth,a.viewportValue.maxDepth),C&&w.indexesGPU&&(I.setBindGroup(C.index,w.indexesGPU[E]),$.bindingGroups[C.index]=C.id),T(I,$)}}}else if(h.currentPass){if(h.occlusionQuerySet!==void 0){const w=h.lastOcclusionObject;w!==s&&(w!==null&&w.occlusionTest===!0&&(h.currentPass.endOcclusionQuery(),h.occlusionQueryIndex++),s.occlusionTest===!0&&(h.currentPass.beginOcclusionQuery(h.occlusionQueryIndex),h.occlusionQueryObjects[h.occlusionQueryIndex]=s),h.lastOcclusionObject=s)}T(h.currentPass,h.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:s,material:n}=e,a=this.utils,l=a.getSampleCountRenderContext(e.context),u=a.getCurrentColorSpace(e.context),h=a.getCurrentColorFormat(e.context),d=a.getCurrentDepthStencilFormat(e.context),f=a.getPrimitiveTopology(s,n);let m=!1;return(t.material!==n||t.materialVersion!==n.version||t.transparent!==n.transparent||t.blending!==n.blending||t.premultipliedAlpha!==n.premultipliedAlpha||t.blendSrc!==n.blendSrc||t.blendDst!==n.blendDst||t.blendEquation!==n.blendEquation||t.blendSrcAlpha!==n.blendSrcAlpha||t.blendDstAlpha!==n.blendDstAlpha||t.blendEquationAlpha!==n.blendEquationAlpha||t.colorWrite!==n.colorWrite||t.depthWrite!==n.depthWrite||t.depthTest!==n.depthTest||t.depthFunc!==n.depthFunc||t.stencilWrite!==n.stencilWrite||t.stencilFunc!==n.stencilFunc||t.stencilFail!==n.stencilFail||t.stencilZFail!==n.stencilZFail||t.stencilZPass!==n.stencilZPass||t.stencilFuncMask!==n.stencilFuncMask||t.stencilWriteMask!==n.stencilWriteMask||t.side!==n.side||t.alphaToCoverage!==n.alphaToCoverage||t.sampleCount!==l||t.colorSpace!==u||t.colorFormat!==h||t.depthStencilFormat!==d||t.primitiveTopology!==f||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=n,t.materialVersion=n.version,t.transparent=n.transparent,t.blending=n.blending,t.premultipliedAlpha=n.premultipliedAlpha,t.blendSrc=n.blendSrc,t.blendDst=n.blendDst,t.blendEquation=n.blendEquation,t.blendSrcAlpha=n.blendSrcAlpha,t.blendDstAlpha=n.blendDstAlpha,t.blendEquationAlpha=n.blendEquationAlpha,t.colorWrite=n.colorWrite,t.depthWrite=n.depthWrite,t.depthTest=n.depthTest,t.depthFunc=n.depthFunc,t.stencilWrite=n.stencilWrite,t.stencilFunc=n.stencilFunc,t.stencilFail=n.stencilFail,t.stencilZFail=n.stencilZFail,t.stencilZPass=n.stencilZPass,t.stencilFuncMask=n.stencilFuncMask,t.stencilWriteMask=n.stencilWriteMask,t.side=n.side,t.alphaToCoverage=n.alphaToCoverage,t.sampleCount=l,t.colorSpace=u,t.colorFormat=h,t.depthStencilFormat=d,t.primitiveTopology=f,t.clippingContextCacheKey=e.clippingContextCacheKey,m=!0),m}getRenderCacheKey(e){const{object:t,material:s}=e,n=this.utils,a=e.context,l=t.isMesh&&t.matrixWorld.determinant()<0;return[s.transparent,s.blending,s.premultipliedAlpha,s.blendSrc,s.blendDst,s.blendEquation,s.blendSrcAlpha,s.blendDstAlpha,s.blendEquationAlpha,s.colorWrite,s.depthWrite,s.depthTest,s.depthFunc,s.stencilWrite,s.stencilFunc,s.stencilFail,s.stencilZFail,s.stencilZPass,s.stencilFuncMask,s.stencilWriteMask,s.side,l,n.getSampleCountRenderContext(a),n.getCurrentColorSpace(a),n.getCurrentColorFormat(a),n.getCurrentDepthStencilFormat(a),n.getPrimitiveTopology(t,s),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,s,n,a,l){return this.textureUtils.copyTextureToBuffer(e,t,s,n,a,l)}initTimestampQuery(e,t,s){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Qq(this.device,e,2048));const n=this.timestampQueryPool[e],a=n.allocateQueriesForContext(t);s.timestampWrites={querySet:n.querySet,beginningOfPassWriteIndex:a,endOfPassWriteIndex:a+1}}createNodeBuilder(e,t){return new Hq(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const s=this.get(e),a=s.currentPass.finish();this.get(t).bundleGPU=a,s.currentSets=s._currentSets,s.currentPass=s._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,s,n){this.bindingUtils.createBindings(e,t,s,n)}updateBindings(e,t,s,n){this.bindingUtils.createBindings(e,t,s,n)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return aC[e]!==void 0&&(e=aC[e]),this.device.features.has(e)}copyTextureToTexture(e,t,s=null,n=null,a=0,l=0){let u=0,h=0,d=0,f=0,m=0,b=0,x=e.image.width,v=e.image.height,T=1;s!==null&&(s.isBox3===!0?(f=s.min.x,m=s.min.y,b=s.min.z,x=s.max.x-s.min.x,v=s.max.y-s.min.y,T=s.max.z-s.min.z):(f=s.min.x,m=s.min.y,x=s.max.x-s.min.x,v=s.max.y-s.min.y,T=1)),n!==null&&(u=n.x,h=n.y,d=n.z||0);const w=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),N=this.get(e).texture,C=this.get(t).texture;w.copyTextureToTexture({texture:N,mipLevel:a,origin:{x:f,y:m,z:b}},{texture:C,mipLevel:l,origin:{x:u,y:h,z:d}},[x,v,T]),this.device.queue.submit([w.finish()]),l===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,s){const n=this.get(t);let a=null;t.renderTarget?e.isDepthTexture?a=this.get(t.depthTexture).texture:a=this.get(t.textures[0]).texture:e.isDepthTexture?a=this.textureUtils.getDepthBuffer(t.depth,t.stencil):a=this.context.getCurrentTexture();const l=this.get(e).texture;if(a.format!==l.format){le("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",a.format,l.format);return}let u;if(n.currentPass?(n.currentPass.end(),u=n.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:a,origin:[s.x,s.y,0]},{texture:l},[s.z,s.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,u),n.currentPass){const{descriptor:h}=n;for(let d=0;d<h.colorAttachments.length;d++)h.colorAttachments[d].loadOp=dt.Load;t.depth&&(h.depthStencilAttachment.depthLoadOp=dt.Load),t.stencil&&(h.depthStencilAttachment.stencilLoadOp=dt.Load),n.currentPass=u.beginRenderPass(h),n.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([u.finish()])}hasCompatibility(e){return this._compatibility[uo.TEXTURE_COMPARE]!==void 0?this._compatibility[uo.TEXTURE_COMPARE]:super.hasCompatibility(e)}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class eH extends rv{constructor(e,t,s,n,a,l){super(e,t,s,n,a,l),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class tH extends rv{constructor(e,t,s,n,a,l){super(e,t,s,n,a,l),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class sH extends WD{constructor(){super(),this.addMaterial(VI,"MeshPhongMaterial"),this.addMaterial(GB,"MeshStandardMaterial"),this.addMaterial(Ck,"MeshPhysicalMaterial"),this.addMaterial(Dk,"MeshToonMaterial"),this.addMaterial(EB,"MeshBasicMaterial"),this.addMaterial(PI,"MeshLambertMaterial"),this.addMaterial(AI,"MeshNormalMaterial"),this.addMaterial(Uk,"MeshMatcapMaterial"),this.addMaterial(SI,"LineBasicMaterial"),this.addMaterial(MI,"LineDashedMaterial"),this.addMaterial(zk,"PointsMaterial"),this.addMaterial(HB,"SpriteMaterial"),this.addMaterial(qk,"ShadowMaterial"),this.addLight(_6,TO),this.addLight(D9,wO),this.addLight(V9,NO),this.addLight(FT,rv),this.addLight(B9,MO),this.addLight(L9,xO),this.addLight(F9,CO),this.addLight(U9,eH),this.addLight(O9,tH),this.addToneMapping(cD,YF),this.addToneMapping(hD,KF),this.addToneMapping(dD,ZF),this.addToneMapping(pD,QF),this.addToneMapping(fD,JF),this.addToneMapping(mD,eP)}}class nH extends rq{constructor(e={}){let t;e.forceWebGL?t=eC:(t=Jq,e.getFallback=()=>(ue("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new eC(e)));const s=new t(e);super(s,e),this.library=new sH,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}_.BRDF_GGX;_.BRDF_Lambert;_.BasicPointShadowFilter;_.BasicShadowFilter;_.Break;_.Const;_.Continue;_.DFGLUT;_.D_GGX;_.Discard;_.EPSILON;_.F_Schlick;_.Fn;_.INFINITY;_.If;_.Loop;_.NodeAccess;_.NodeShaderStage;_.NodeType;_.NodeUpdateType;_.PCFShadowFilter;_.PCFSoftShadowFilter;_.PI;_.PI2;_.TWO_PI;_.HALF_PI;_.PointShadowFilter;_.Return;_.Schlick_to_F0;_.ShaderNode;_.Stack;_.Switch;_.TBNViewMatrix;_.VSMShadowFilter;_.V_GGX_SmithCorrelated;_.Var;_.VarIntent;_.abs;_.acesFilmicToneMapping;_.acos;_.add;_.addMethodChaining;_.addNodeElement;_.agxToneMapping;_.all;_.alphaT;_.and;_.anisotropy;_.anisotropyB;_.anisotropyT;_.any;_.append;_.array;_.arrayBuffer;_.asin;_.assign;_.atan;_.atomicAdd;_.atomicAnd;_.atomicFunc;_.atomicLoad;_.atomicMax;_.atomicMin;_.atomicOr;_.atomicStore;_.atomicSub;_.atomicXor;_.attenuationColor;_.attenuationDistance;_.attribute;_.attributeArray;_.backgroundBlurriness;_.backgroundIntensity;_.backgroundRotation;_.batch;_.bentNormalView;_.billboarding;_.bitAnd;_.bitNot;_.bitOr;_.bitXor;_.bitangentGeometry;_.bitangentLocal;_.bitangentView;_.bitangentWorld;_.bitcast;_.blendBurn;_.blendColor;_.blendDodge;_.blendOverlay;_.blendScreen;_.blur;_.bool;_.buffer;_.bufferAttribute;_.bumpMap;_.builtin;_.builtinAOContext;_.builtinShadowContext;_.bvec2;_.bvec3;_.bvec4;_.bypass;_.cache;_.call;_.cameraFar;_.cameraIndex;_.cameraNear;_.cameraNormalMatrix;_.cameraPosition;_.cameraProjectionMatrix;_.cameraProjectionMatrixInverse;_.cameraViewMatrix;_.cameraViewport;_.cameraWorldMatrix;_.cbrt;_.cdl;_.ceil;_.checker;_.cineonToneMapping;_.clamp;_.clearcoat;_.clearcoatNormalView;_.clearcoatRoughness;_.clipSpace;_.code;const hC=_.color;_.colorSpaceToWorking;_.colorToDirection;_.compute;_.computeKernel;_.computeSkinning;_.context;_.convert;_.convertColorSpace;_.convertToTexture;_.countLeadingZeros;_.countOneBits;_.countTrailingZeros;_.cos;_.cross;_.cubeTexture;_.cubeTextureBase;_.dFdx;_.dFdy;_.dashSize;_.debug;_.decrement;_.decrementBefore;_.defaultBuildStages;_.defaultShaderStages;_.defined;_.degrees;_.deltaTime;_.densityFog;_.densityFogFactor;_.depth;_.depthPass;_.determinant;_.difference;_.diffuseColor;_.directPointLight;_.directionToColor;_.directionToFaceDirection;_.dispersion;_.distance;_.div;_.dot;_.drawIndex;_.dynamicBufferAttribute;_.element;_.emissive;_.equal;_.equirectUV;_.exp;_.exp2;_.exponentialHeightFogFactor;_.expression;_.faceDirection;_.faceForward;_.faceforward;const tm=_.float;_.floatBitsToInt;_.floatBitsToUint;_.floor;_.fog;_.fract;_.frameGroup;_.frameId;_.frontFacing;_.fwidth;_.gain;_.gapSize;_.getConstNodeType;_.getCurrentStack;_.getDirection;_.getDistanceAttenuation;_.getGeometryRoughness;_.getNormalFromDepth;_.interleavedGradientNoise;_.vogelDiskSample;_.getParallaxCorrectNormal;_.getRoughness;_.getScreenPosition;_.getShIrradianceAt;_.getShadowMaterial;_.getShadowRenderObjectFunction;_.getTextureIndex;_.getViewPosition;_.globalId;_.glsl;_.glslFn;_.grayscale;_.greaterThan;_.greaterThanEqual;_.hash;_.highpModelNormalViewMatrix;_.highpModelViewMatrix;_.hue;_.increment;_.incrementBefore;_.instance;_.instanceIndex;_.instancedArray;_.instancedBufferAttribute;_.instancedDynamicBufferAttribute;_.instancedMesh;_.int;_.intBitsToFloat;_.inverse;_.inverseSqrt;_.inversesqrt;_.invocationLocalIndex;_.invocationSubgroupIndex;_.ior;_.iridescence;_.iridescenceIOR;_.iridescenceThickness;_.ivec2;_.ivec3;_.ivec4;_.js;_.label;const iH=_.length;_.lengthSq;_.lessThan;_.lessThanEqual;_.lightPosition;_.lightProjectionUV;_.lightShadowMatrix;_.lightTargetDirection;_.lightTargetPosition;_.lightViewPosition;_.lightingContext;_.lights;_.linearDepth;_.linearToneMapping;_.localId;_.log;_.log2;_.logarithmicDepthToViewZ;_.luminance;_.mat2;_.mat3;_.mat4;_.matcapUV;_.materialAO;_.materialAlphaTest;_.materialAnisotropy;_.materialAnisotropyVector;_.materialAttenuationColor;_.materialAttenuationDistance;_.materialClearcoat;_.materialClearcoatNormal;_.materialClearcoatRoughness;_.materialColor;_.materialDispersion;_.materialEmissive;_.materialEnvIntensity;_.materialEnvRotation;_.materialIOR;_.materialIridescence;_.materialIridescenceIOR;_.materialIridescenceThickness;_.materialLightMap;_.materialLineDashOffset;_.materialLineDashSize;_.materialLineGapSize;_.materialLineScale;_.materialLineWidth;_.materialMetalness;_.materialNormal;_.materialOpacity;_.materialPointSize;_.materialReference;_.materialReflectivity;_.materialRefractionRatio;_.materialRotation;_.materialRoughness;_.materialSheen;_.materialSheenRoughness;_.materialShininess;_.materialSpecular;_.materialSpecularColor;_.materialSpecularIntensity;_.materialSpecularStrength;_.materialThickness;_.materialTransmission;_.max;_.maxMipLevel;_.mediumpModelViewMatrix;_.metalness;_.min;const rH=_.mix;_.mixElement;_.mod;_.modInt;_.modelDirection;_.modelNormalMatrix;_.modelPosition;_.modelRadius;_.modelScale;_.modelViewMatrix;_.modelViewPosition;_.modelViewProjection;_.modelWorldMatrix;_.modelWorldMatrixInverse;_.morphReference;_.mrt;_.mul;_.mx_aastep;_.mx_add;_.mx_atan2;_.mx_cell_noise_float;_.mx_contrast;_.mx_divide;_.mx_fractal_noise_float;_.mx_fractal_noise_vec2;_.mx_fractal_noise_vec3;_.mx_fractal_noise_vec4;_.mx_frame;_.mx_heighttonormal;_.mx_hsvtorgb;_.mx_ifequal;_.mx_ifgreater;_.mx_ifgreatereq;_.mx_invert;_.mx_modulo;_.mx_multiply;_.mx_noise_float;_.mx_noise_vec3;_.mx_noise_vec4;_.mx_place2d;_.mx_power;_.mx_ramp4;_.mx_ramplr;_.mx_ramptb;_.mx_rgbtohsv;_.mx_rotate2d;_.mx_rotate3d;_.mx_safepower;_.mx_separate;_.mx_splitlr;_.mx_splittb;_.mx_srgb_texture_to_lin_rec709;_.mx_subtract;_.mx_timer;_.mx_transform_uv;_.mx_unifiednoise2d;_.mx_unifiednoise3d;_.mx_worley_noise_float;_.mx_worley_noise_vec2;_.mx_worley_noise_vec3;_.negate;_.neutralToneMapping;_.nodeArray;_.nodeImmutable;_.nodeObject;_.nodeObjectIntent;_.nodeObjects;_.nodeProxy;_.nodeProxyIntent;_.normalFlat;_.normalGeometry;_.normalLocal;_.normalMap;_.normalView;_.normalViewGeometry;_.normalWorld;_.normalWorldGeometry;_.normalize;_.not;_.notEqual;_.numWorkgroups;_.objectDirection;_.objectGroup;_.objectPosition;_.objectRadius;_.objectScale;_.objectViewPosition;_.objectWorldMatrix;_.OnBeforeObjectUpdate;_.OnBeforeMaterialUpdate;_.OnObjectUpdate;_.OnMaterialUpdate;_.oneMinus;_.or;_.orthographicDepthToViewZ;_.oscSawtooth;_.oscSine;_.oscSquare;_.oscTriangle;_.output;_.outputStruct;_.overloadingFn;_.packHalf2x16;_.packSnorm2x16;_.packUnorm2x16;_.parabola;_.parallaxDirection;_.parallaxUV;_.parameter;_.pass;_.passTexture;_.pcurve;_.perspectiveDepthToViewZ;_.pmremTexture;_.pointShadow;_.pointUV;_.pointWidth;_.positionGeometry;const dC=_.positionLocal;_.positionPrevious;_.positionView;_.positionViewDirection;_.positionWorld;_.positionWorldDirection;_.posterize;_.pow;_.pow2;_.pow3;_.pow4;_.premultiplyAlpha;_.property;_.radians;_.rand;_.range;_.rangeFog;_.rangeFogFactor;_.reciprocal;_.reference;_.referenceBuffer;_.reflect;_.reflectVector;_.reflectView;_.reflector;_.refract;_.refractVector;_.refractView;_.reinhardToneMapping;_.remap;_.remapClamp;_.renderGroup;_.renderOutput;_.rendererReference;_.replaceDefaultUV;_.rotate;_.rotateUV;_.roughness;_.round;_.rtt;_.sRGBTransferEOTF;_.sRGBTransferOETF;_.sample;_.sampler;_.samplerComparison;_.saturate;_.saturation;_.screen;_.screenCoordinate;_.screenDPR;_.screenSize;_.screenUV;_.select;_.setCurrentStack;_.setName;_.shaderStages;_.shadow;_.shadowPositionWorld;_.shapeCircle;_.sharedUniformGroup;_.sheen;_.sheenRoughness;_.shiftLeft;_.shiftRight;_.shininess;_.sign;const aH=_.sin;_.sinc;_.skinning;_.smoothstep;_.smoothstepElement;_.specularColor;_.specularF90;_.spherizeUV;_.split;_.spritesheetUV;_.sqrt;_.stack;_.step;_.stepElement;_.storage;_.storageBarrier;_.storageTexture;_.string;_.struct;_.sub;_.subgroupAdd;_.subgroupAll;_.subgroupAnd;_.subgroupAny;_.subgroupBallot;_.subgroupBroadcast;_.subgroupBroadcastFirst;_.subBuild;_.subgroupElect;_.subgroupExclusiveAdd;_.subgroupExclusiveMul;_.subgroupInclusiveAdd;_.subgroupInclusiveMul;_.subgroupIndex;_.subgroupMax;_.subgroupMin;_.subgroupMul;_.subgroupOr;_.subgroupShuffle;_.subgroupShuffleDown;_.subgroupShuffleUp;_.subgroupShuffleXor;_.subgroupSize;_.subgroupXor;_.tan;_.tangentGeometry;_.tangentLocal;_.tangentView;_.tangentWorld;_.texture;_.texture3D;_.textureBarrier;_.textureBicubic;_.textureBicubicLevel;_.textureCubeUV;_.textureLoad;_.textureSize;_.textureLevel;_.textureStore;_.thickness;const oH=_.time;_.toneMapping;_.toneMappingExposure;_.toonOutlinePass;_.transformDirection;_.transformNormal;_.transformNormalToView;_.transformedClearcoatNormalView;_.transformedNormalView;_.transformedNormalWorld;_.transmission;_.transpose;_.triNoise3D;_.triplanarTexture;_.triplanarTextures;_.trunc;_.uint;_.uintBitsToFloat;const Ix=_.uniform;_.uniformArray;_.uniformCubeTexture;_.uniformGroup;_.uniformFlow;_.uniformTexture;_.unpackHalf2x16;_.unpackSnorm2x16;_.unpackUnorm2x16;_.unpremultiplyAlpha;_.userData;_.uv;_.uvec2;_.uvec3;_.uvec4;_.varying;_.varyingProperty;_.vec2;const pC=_.vec3;_.vec4;_.vectorComponents;_.velocity;_.vertexColor;_.vertexIndex;_.vertexStage;_.vibrance;_.viewZToLogarithmicDepth;_.viewZToOrthographicDepth;_.viewZToPerspectiveDepth;_.viewZToReversedOrthographicDepth;_.viewZToReversedPerspectiveDepth;_.viewport;_.viewportCoordinate;_.viewportDepthTexture;_.viewportLinearDepth;_.viewportMipTexture;_.viewportOpaqueMipTexture;_.viewportResolution;_.viewportSafeUV;_.viewportSharedTexture;_.viewportSize;_.viewportTexture;_.viewportUV;_.wgsl;_.wgslFn;_.workgroupArray;_.workgroupBarrier;_.workgroupId;_.workingToColorSpace;_.xor;const fC={type:"change"},OT={type:"start"},r3={type:"end"},sm=new mE,mC=new kr,lH=Math.cos(70*Y_.DEG2RAD),ps=new z,ln=2*Math.PI,Nt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},kx=1e-6;class uH extends DO{constructor(e,t=null){super(e,t),this.state=Nt.NONE,this.target=new z,this.cursor=new z,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Iu.ROTATE,MIDDLE:Iu.DOLLY,RIGHT:Iu.PAN},this.touches={ONE:Fu.ROTATE,TWO:Fu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._cursorStyle="auto",this._domElementKeyEvents=null,this._lastPosition=new z,this._lastQuaternion=new sa,this._lastTargetPosition=new z,this._quat=new sa().setFromUnitVectors(e.up,new z(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new kN,this._sphericalDelta=new kN,this._scale=1,this._panOffset=new z,this._rotateStart=new Ue,this._rotateEnd=new Ue,this._rotateDelta=new Ue,this._panStart=new Ue,this._panEnd=new Ue,this._panDelta=new Ue,this._dollyStart=new Ue,this._dollyEnd=new Ue,this._dollyDelta=new Ue,this._dollyDirection=new z,this._mouse=new Ue,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=hH.bind(this),this._onPointerDown=cH.bind(this),this._onPointerUp=dH.bind(this),this._onContextMenu=xH.bind(this),this._onMouseWheel=mH.bind(this),this._onKeyDown=gH.bind(this),this._onTouchStart=yH.bind(this),this._onTouchMove=bH.bind(this),this._onMouseDown=pH.bind(this),this._onMouseMove=fH.bind(this),this._interceptControlDown=_H.bind(this),this._interceptControlUp=vH.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}set cursorStyle(e){this._cursorStyle=e,e==="grab"?this.domElement.style.cursor="grab":this.domElement.style.cursor="auto"}get cursorStyle(){return this._cursorStyle}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(fC),this.update(),this.state=Nt.NONE}pan(e,t){this._pan(e,t),this.update()}dollyIn(e){this._dollyIn(e),this.update()}dollyOut(e){this._dollyOut(e),this.update()}rotateLeft(e){this._rotateLeft(e),this.update()}rotateUp(e){this._rotateUp(e),this.update()}update(e=null){const t=this.object.position;ps.copy(t).sub(this.target),ps.applyQuaternion(this._quat),this._spherical.setFromVector3(ps),this.autoRotate&&this.state===Nt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(s)&&isFinite(n)&&(s<-Math.PI?s+=ln:s>Math.PI&&(s-=ln),n<-Math.PI?n+=ln:n>Math.PI&&(n-=ln),s<=n?this._spherical.theta=Math.max(s,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+n)/2?Math.max(s,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const l=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=l!=this._spherical.radius}if(ps.setFromSpherical(this._spherical),ps.applyQuaternion(this._quatInverse),t.copy(this.target).add(ps),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let l=null;if(this.object.isPerspectiveCamera){const u=ps.length();l=this._clampDistance(u*this._scale);const h=u-l;this.object.position.addScaledVector(this._dollyDirection,h),this.object.updateMatrixWorld(),a=!!h}else if(this.object.isOrthographicCamera){const u=new z(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const h=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=h!==this.object.zoom;const d=new z(this._mouse.x,this._mouse.y,0);d.unproject(this.object),this.object.position.sub(d).add(u),this.object.updateMatrixWorld(),l=ps.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;l!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(l).add(this.object.position):(sm.origin.copy(this.object.position),sm.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(sm.direction))<lH?this.object.lookAt(this.target):(mC.setFromNormalAndCoplanarPoint(this.object.up,this.target),sm.intersectPlane(mC,this.target))))}else if(this.object.isOrthographicCamera){const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),l!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>kx||8*(1-this._lastQuaternion.dot(this.object.quaternion))>kx||this._lastTargetPosition.distanceToSquared(this.target)>kx?(this.dispatchEvent(fC),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ln/60*this.autoRotateSpeed*e:ln/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){ps.setFromMatrixColumn(t,0),ps.multiplyScalar(-e),this._panOffset.add(ps)}_panUp(e,t){this.screenSpacePanning===!0?ps.setFromMatrixColumn(t,1):(ps.setFromMatrixColumn(t,0),ps.crossVectors(this.object.up,ps)),ps.multiplyScalar(e),this._panOffset.add(ps)}_pan(e,t){const s=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;ps.copy(n).sub(this.target);let a=ps.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*a/s.clientHeight,this.object.matrix),this._panUp(2*t*a/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),n=e-s.left,a=t-s.top,l=s.width,u=s.height;this._mouse.x=n/l*2-1,this._mouse.y=-(a/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ln*this._rotateDelta.x/t.clientHeight),this._rotateUp(ln*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ln*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ln*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ln*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ln*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(s,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(s,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,a=Math.sqrt(s*s+n*n);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),a=.5*(e.pageY+s.y);this._rotateEnd.set(n,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ln*this._rotateDelta.x/t.clientHeight),this._rotateUp(ln*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(s,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,a=Math.sqrt(s*s+n*n);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const l=(e.pageX+t.x)*.5,u=(e.pageY+t.y)*.5;this._updateZoomParameters(l,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ue,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function cH(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i),this._cursorStyle==="grab"&&(this.domElement.style.cursor="grabbing")))}function hH(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function dH(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(r3),this.state=Nt.NONE,this._cursorStyle==="grab"&&(this.domElement.style.cursor="grab");break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function pH(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Iu.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=Nt.DOLLY;break;case Iu.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=Nt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=Nt.ROTATE}break;case Iu.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=Nt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=Nt.PAN}break;default:this.state=Nt.NONE}this.state!==Nt.NONE&&this.dispatchEvent(OT)}function fH(i){switch(this.state){case Nt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case Nt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case Nt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function mH(i){this.enabled===!1||this.enableZoom===!1||this.state!==Nt.NONE||(i.preventDefault(),this.dispatchEvent(OT),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(r3))}function gH(i){this.enabled!==!1&&this._handleKeyDown(i)}function yH(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case Fu.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=Nt.TOUCH_ROTATE;break;case Fu.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=Nt.TOUCH_PAN;break;default:this.state=Nt.NONE}break;case 2:switch(this.touches.TWO){case Fu.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=Nt.TOUCH_DOLLY_PAN;break;case Fu.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=Nt.TOUCH_DOLLY_ROTATE;break;default:this.state=Nt.NONE}break;default:this.state=Nt.NONE}this.state!==Nt.NONE&&this.dispatchEvent(OT)}function bH(i){switch(this._trackPointer(i),this.state){case Nt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case Nt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case Nt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case Nt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=Nt.NONE}}function xH(i){this.enabled!==!1&&i.preventDefault()}function _H(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function vH(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Bt(i){return i==null}function VT(i){return i!==null&&typeof i=="object"}function L_(i){return i!==null&&typeof i=="object"}function TH(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function ml(i,e){return Array.from(new Set([...Object.keys(i),...Object.keys(e)])).reduce((s,n)=>{const a=i[n],l=e[n];return L_(a)&&L_(l)?Object.assign(Object.assign({},s),{[n]:ml(a,l)}):Object.assign(Object.assign({},s),{[n]:n in e?l:a})},{})}function zT(i){return VT(i)?"target"in i:!1}const SH={alreadydisposed:()=>"View has been already disposed",invalidparams:i=>`Invalid parameters for '${i.name}'`,nomatchingcontroller:i=>`No matching controller for '${i.key}'`,nomatchingview:i=>`No matching view for '${JSON.stringify(i.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:i=>`Not compatible with  plugin '${i.id}'`,propertynotfound:i=>`Property '${i.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Yt{static alreadyDisposed(){return new Yt({type:"alreadydisposed"})}static notBindable(){return new Yt({type:"notbindable"})}static notCompatible(e,t){return new Yt({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Yt({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Yt({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=SH[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class cg{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const s=this.read();if(!cg.isBindable(s))throw Yt.notBindable();if(!(e in s))throw Yt.propertyNotFound(e);s[e]=t}}class hs{constructor(){this.observers_={}}on(e,t,s){var n;let a=this.observers_[e];return a||(a=this.observers_[e]=[]),a.push({handler:t,key:(n=s?.key)!==null&&n!==void 0?n:t}),this}off(e,t){const s=this.observers_[e];return s&&(this.observers_[e]=s.filter(n=>n.key!==t)),this}emit(e,t){const s=this.observers_[e];s&&s.forEach(n=>{n.handler(t)})}}class wH{constructor(e,t){var s;this.constraint_=t?.constraint,this.equals_=(s=t?.equals)!==null&&s!==void 0?s:((n,a)=>n===a),this.emitter=new hs,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const s=t??{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(e):e,a=this.rawValue_;this.equals_(a,n)&&!s.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:s,previousRawValue:a,rawValue:n,sender:this}))}}class MH{constructor(e){this.emitter=new hs,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const s=t??{forceEmit:!1,last:!0},n=this.value_;n===e&&!s.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:s,previousRawValue:n,rawValue:this.value_,sender:this}))}}class NH{constructor(e){this.emitter=new hs,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function It(i,e){const t=e?.constraint,s=e?.equals;return!t&&!s?new MH(i):new wH(i,e)}function AH(i){return[new NH(i),(e,t)=>{i.setRawValue(e,t)}]}class He{constructor(e){this.emitter=new hs,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((s,n)=>Object.assign(s,{[n]:It(e[n])}),{})}static fromObject(e){const t=this.createCore(e);return new He(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class Ed{constructor(e){this.values=He.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),s=this.values.get("min");return Math.min(Math.max(e,s),t)}}class CH{constructor(e){this.values=He.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),s=this.values.get("min");let n=e;return Bt(s)||(n=Math.max(n,s)),Bt(t)||(n=Math.min(n,t)),n}}class EH{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,s=Math.round((e-t)/this.step);return t+s*this.step}}class RH{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const BH={"**":(i,e)=>Math.pow(i,e),"*":(i,e)=>i*e,"/":(i,e)=>i/e,"%":(i,e)=>i%e,"+":(i,e)=>i+e,"-":(i,e)=>i-e,"<<":(i,e)=>i<<e,">>":(i,e)=>i>>e,">>>":(i,e)=>i>>>e,"&":(i,e)=>i&e,"^":(i,e)=>i^e,"|":(i,e)=>i|e};class DH{constructor(e,t,s){this.left=t,this.operator=e,this.right=s}evaluate(){const e=BH[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const LH={"+":i=>i,"-":i=>-i,"~":i=>~i};class UH{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=LH[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function IT(i){return(e,t)=>{for(let s=0;s<i.length;s++){const n=i[s](e,t);if(n!=="")return n}return""}}function hd(i,e){var t;const s=i.substr(e).match(/^\s+/);return(t=s&&s[0])!==null&&t!==void 0?t:""}function FH(i,e){const t=i.substr(e,1);return t.match(/^[1-9]$/)?t:""}function dd(i,e){var t;const s=i.substr(e).match(/^[0-9]+/);return(t=s&&s[0])!==null&&t!==void 0?t:""}function PH(i,e){const t=dd(i,e);if(t!=="")return t;const s=i.substr(e,1);if(e+=1,s!=="-"&&s!=="+")return"";const n=dd(i,e);return n===""?"":s+n}function kT(i,e){const t=i.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const s=PH(i,e);return s===""?"":t+s}function a3(i,e){const t=i.substr(e,1);if(t==="0")return t;const s=FH(i,e);return e+=s.length,s===""?"":s+dd(i,e)}function OH(i,e){const t=a3(i,e);if(e+=t.length,t==="")return"";const s=i.substr(e,1);if(e+=s.length,s!==".")return"";const n=dd(i,e);return e+=n.length,t+s+n+kT(i,e)}function VH(i,e){const t=i.substr(e,1);if(e+=t.length,t!==".")return"";const s=dd(i,e);return e+=s.length,s===""?"":t+s+kT(i,e)}function zH(i,e){const t=a3(i,e);return e+=t.length,t===""?"":t+kT(i,e)}const IH=IT([OH,VH,zH]);function kH(i,e){var t;const s=i.substr(e).match(/^[01]+/);return(t=s&&s[0])!==null&&t!==void 0?t:""}function GH(i,e){const t=i.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const s=kH(i,e);return s===""?"":t+s}function qH(i,e){var t;const s=i.substr(e).match(/^[0-7]+/);return(t=s&&s[0])!==null&&t!==void 0?t:""}function HH(i,e){const t=i.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const s=qH(i,e);return s===""?"":t+s}function jH(i,e){var t;const s=i.substr(e).match(/^[0-9a-f]+/i);return(t=s&&s[0])!==null&&t!==void 0?t:""}function $H(i,e){const t=i.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const s=jH(i,e);return s===""?"":t+s}const WH=IT([GH,HH,$H]),XH=IT([WH,IH]);function YH(i,e){const t=XH(i,e);return e+=t.length,t===""?null:{evaluable:new RH(t),cursor:e}}function KH(i,e){const t=i.substr(e,1);if(e+=t.length,t!=="(")return null;const s=l3(i,e);if(!s)return null;e=s.cursor,e+=hd(i,e).length;const n=i.substr(e,1);return e+=n.length,n!==")"?null:{evaluable:s.evaluable,cursor:e}}function ZH(i,e){var t;return(t=YH(i,e))!==null&&t!==void 0?t:KH(i,e)}function o3(i,e){const t=ZH(i,e);if(t)return t;const s=i.substr(e,1);if(e+=s.length,s!=="+"&&s!=="-"&&s!=="~")return null;const n=o3(i,e);return n?(e=n.cursor,{cursor:e,evaluable:new UH(s,n.evaluable)}):null}function QH(i,e,t){t+=hd(e,t).length;const s=i.filter(n=>e.startsWith(n,t))[0];return s?(t+=s.length,t+=hd(e,t).length,{cursor:t,operator:s}):null}function JH(i,e){return(t,s)=>{const n=i(t,s);if(!n)return null;s=n.cursor;let a=n.evaluable;for(;;){const l=QH(e,t,s);if(!l)break;s=l.cursor;const u=i(t,s);if(!u)return null;s=u.cursor,a=new DH(l.operator,a,u.evaluable)}return a?{cursor:s,evaluable:a}:null}}const ej=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((i,e)=>JH(i,e),o3);function l3(i,e){return e+=hd(i,e).length,ej(i,e)}function tj(i){const e=l3(i,0);return!e||e.cursor+hd(i,e.cursor).length!==i.length?null:e.evaluable}function aa(i){var e;const t=tj(i);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function u3(i){if(typeof i=="number")return i;if(typeof i=="string"){const e=aa(i);if(!Bt(e))return e}return 0}function sj(i){return String(i)}function yn(i){return e=>e.toFixed(Math.max(Math.min(i,20),0))}function bt(i,e,t,s,n){const a=(i-e)/(t-e);return s+a*(n-s)}function gC(i){return String(i.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ms(i,e,t){return Math.min(Math.max(i,e),t)}function c3(i,e){return(i%e+e)%e}function nj(i,e){return Bt(i.step)?Math.max(gC(e),2):gC(i.step)}function h3(i){var e;return(e=i.step)!==null&&e!==void 0?e:1}function d3(i,e){var t;const s=Math.abs((t=i.step)!==null&&t!==void 0?t:e);return s===0?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function p3(i,e){return Bt(i.step)?null:new EH(i.step,e)}function f3(i){return!Bt(i.max)&&!Bt(i.min)?new Ed({max:i.max,min:i.min}):!Bt(i.max)||!Bt(i.min)?new CH({max:i.max,min:i.min}):null}function m3(i,e){var t,s,n;return{formatter:(t=i.format)!==null&&t!==void 0?t:yn(nj(i,e)),keyScale:(s=i.keyScale)!==null&&s!==void 0?s:h3(i),pointerScale:(n=i.pointerScale)!==null&&n!==void 0?n:d3(i,e)}}function g3(i){return{format:i.optional.function,keyScale:i.optional.number,max:i.optional.number,min:i.optional.number,pointerScale:i.optional.number,step:i.optional.number}}function GT(i){return{constraint:i.constraint,textProps:He.fromObject(m3(i.params,i.initialValue))}}class wl{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class ry{constructor(e){this.target=e}}class Rd extends ry{constructor(e,t,s){super(e),this.value=t,this.last=s??!0}}class ij extends ry{constructor(e,t){super(e),this.expanded=t}}class rj extends ry{constructor(e,t){super(e),this.index=t}}class aj extends ry{constructor(e,t){super(e),this.native=t}}class pd extends wl{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new hs,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Rd(this,t.binding.target.read(),e.options.last))}}class oj{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new hs}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function lj(i){if(!("binding"in i))return!1;const e=i.binding;return zT(e)&&"read"in e&&"write"in e}function uj(i,e){const s=Object.keys(e).reduce((n,a)=>{if(n===void 0)return;const l=e[a],u=l(i[a]);return u.succeeded?Object.assign(Object.assign({},n),{[a]:u.value}):void 0},{});return s}function cj(i,e){return i.reduce((t,s)=>{if(t===void 0)return;const n=e(s);if(!(!n.succeeded||n.value===void 0))return[...t,n.value]},[])}function hj(i){return i===null?!1:typeof i=="object"}function Ir(i){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const s=i(t);return s!==void 0?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function yC(i){return{custom:e=>Ir(e)(i),boolean:Ir(e=>typeof e=="boolean"?e:void 0)(i),number:Ir(e=>typeof e=="number"?e:void 0)(i),string:Ir(e=>typeof e=="string"?e:void 0)(i),function:Ir(e=>typeof e=="function"?e:void 0)(i),constant:e=>Ir(t=>t===e?e:void 0)(i),raw:Ir(e=>e)(i),object:e=>Ir(t=>{if(hj(t))return uj(t,e)})(i),array:e=>Ir(t=>{if(Array.isArray(t))return cj(t,e)})(i)}}const U_={optional:yC(!0),required:yC(!1)};function $t(i,e){const t=e(U_),s=U_.required.object(t)(i);return s.succeeded?s.value:void 0}function Gn(i,e,t,s){if(e&&!e(i))return!1;const n=$t(i,t);return n?s(n):!1}function qn(i,e){var t;return ml((t=i?.())!==null&&t!==void 0?t:{},e)}function dl(i){return"value"in i}function y3(i){if(!VT(i)||!("binding"in i))return!1;const e=i.binding;return zT(e)}const er="http://www.w3.org/2000/svg";function hg(i){i.offsetHeight}function dj(i,e){const t=i.style.transition;i.style.transition="none",e(),i.style.transition=t}function qT(i){return i.ontouchstart!==void 0}function pj(){return globalThis}function fj(){return pj().document}function mj(i){const e=i.ownerDocument.defaultView;return e&&"document"in e?i.getContext("2d",{willReadFrequently:!0}):null}const gj={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ay(i,e){const t=i.createElementNS(er,"svg");return t.innerHTML=gj[e],t}function b3(i,e,t){i.insertBefore(e,i.children[t])}function HT(i){i.parentElement&&i.parentElement.removeChild(i)}function x3(i){for(;i.children.length>0;)i.removeChild(i.children[0])}function yj(i){for(;i.childNodes.length>0;)i.removeChild(i.childNodes[0])}function _3(i){return i.relatedTarget?i.relatedTarget:"explicitOriginalTarget"in i?i.explicitOriginalTarget:null}function ta(i,e){i.emitter.on("change",t=>{e(t.rawValue)}),e(i.rawValue)}function hr(i,e,t){ta(i.value(e),t)}const bj="tp";function ot(i){return(t,s)=>[bj,"-",i,"v",t?`_${t}`:"",s?`-${s}`:""].join("")}const Lh=ot("lbl");function xj(i,e){const t=i.createDocumentFragment();return e.split(`
`).map(n=>i.createTextNode(n)).forEach((n,a)=>{a>0&&t.appendChild(i.createElement("br")),t.appendChild(n)}),t}class v3{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Lh()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(Lh("l")),hr(t.props,"label",a=>{Bt(a)?this.element.classList.add(Lh(void 0,"nol")):(this.element.classList.remove(Lh(void 0,"nol")),yj(s),s.appendChild(xj(e,a)))}),this.element.appendChild(s),this.labelElement=s;const n=e.createElement("div");n.classList.add(Lh("v")),this.element.appendChild(n),this.valueElement=n}}class T3{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new v3(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Gn(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return qn(null,{label:this.props.get("label")})}}function _j(){return["veryfirst","first","last","verylast"]}const bC=ot(""),xC={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class oy{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{_j().forEach(s=>{t.classList.remove(bC(void 0,xC[s]))}),this.blade.get("positions").forEach(s=>{t.classList.add(bC(void 0,xC[s]))})}),this.viewProps.handleDispose(()=>{HT(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Gn(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return qn(null,Object.assign({},this.viewProps.exportState()))}}class gl extends oy{constructor(e,t){if(t.value!==t.valueController.value)throw Yt.shouldNeverHappen();const s=t.valueController.viewProps,n=new T3(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new v3(e,{props:t.props,viewProps:s}),viewProps:s})),this.labelController=n,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return Gn(e,t=>{var s,n,a;return super.importState(t)&&this.labelController.importProps(t)&&((a=(n=(s=this.valueController).importProps)===null||n===void 0?void 0:n.call(s,e))!==null&&a!==void 0?a:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,s;return qn(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(s=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&s!==void 0?s:{}))}}function _C(i){const e=Object.assign({},i);return delete e.value,e}class S3 extends gl{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return Gn(e,t=>super.importState(_C(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return qn(()=>_C(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function vj(i){return dl(i)&&y3(i.value)}class Tj extends S3{importState(e){return Gn(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function Sj(i){return dl(i)&&lj(i.value)}function w3(i,e){for(;i.length<e;)i.push(void 0)}function wj(i){const e=[];return w3(e,i),e}function Mj(i){const e=i.indexOf(void 0);return e<0?i:i.slice(0,e)}function Nj(i,e){const t=[...Mj(i),e];return t.length>i.length?t.splice(0,t.length-i.length):w3(t,i.length),t}class Aj{constructor(e){this.emitter=new hs,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=It(wj(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=Nj(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function Cj(i){if(!("binding"in i))return!1;const e=i.binding;return zT(e)&&"read"in e&&!("write"in e)}class Ej extends S3{exportState(){return qn(()=>super.exportState(),{binding:{readonly:!0}})}}function Rj(i){return dl(i)&&Cj(i.value)}class Bj extends wl{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const s=t.bind(this);return this.controller.buttonController.emitter.on(e,a=>{s(new aj(this,a.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function Dj(i,e,t){t?i.classList.add(e):i.classList.remove(e)}function gc(i,e){return t=>{Dj(i,e,t)}}function jT(i,e){ta(i,t=>{e.textContent=t??""})}const Gx=ot("btn");class Lj{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gx()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("button");s.classList.add(Gx("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const n=e.createElement("div");n.classList.add(Gx("t")),jT(t.props.value("title"),n),this.buttonElement.appendChild(n)}}class Uj{constructor(e,t){this.emitter=new hs,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Lj(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Gn(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return qn(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class vC extends oy{constructor(e,t){const s=new Uj(e,{props:t.buttonProps,viewProps:t.viewProps}),n=new T3(e,{blade:t.blade,props:t.labelProps,valueController:s});super({blade:t.blade,view:n.view,viewProps:t.viewProps}),this.buttonController=s,this.labelController=n}importState(e){return Gn(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return qn(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class M3{constructor(e){const[t,s]=e.split("-"),n=t.split(".");this.major=parseInt(n[0],10),this.minor=parseInt(n[1],10),this.patch=parseInt(n[2],10),this.prerelease=s??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const yc=new M3("2.0.5");function Js(i){return Object.assign({core:yc},i)}const Fj=Js({id:"button",type:"blade",accept(i){const e=$t(i,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(i){return new vC(i.document,{blade:i.blade,buttonProps:He.fromObject({title:i.params.title}),labelProps:He.fromObject({label:i.params.label}),viewProps:i.viewProps})},api(i){return i.controller instanceof vC?new Bj(i.controller):null}});function Pj(i,e){return i.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function Oj(i,e){return i.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function Vj(i,e){return i.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function zj(i){return VT(i)?"refresh"in i&&typeof i.refresh=="function":!1}function Ij(i,e){if(!cg.isBindable(i))throw Yt.notBindable();return new cg(i,e)}class kj{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new hs,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,s){const n=s??{},a=this.controller_.element.ownerDocument,l=this.pool_.createBinding(a,Ij(e,t),n),u=this.pool_.createBindingApi(l);return this.add(u,n.index)}addFolder(e){return Oj(this,e)}addButton(e){return Pj(this,e)}addTab(e){return Vj(this,e)}add(e,t){const s=e.controller;return this.controller_.rack.add(s,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,s=this.pool_.createBlade(t,e),n=this.pool_.createApi(s);return this.add(n,e.index)}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{zj(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,s=this.pool_.createApi(t),n=y3(t.value)?t.value.binding:null;this.emitter_.emit("change",new Rd(s,n?n.target.read():t.value.rawValue,e.options.last))}}class $T extends wl{constructor(e,t){super(e),this.rackApi_=new kj(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class WT extends oy{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Gn(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((s,n)=>s.importState(t.children[n])))}exportState(){return qn(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function F_(i){return"rackController"in i}class Gj{constructor(e){this.emitter=new hs,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Yt.shouldNeverHappen();const s=t!==void 0?t:this.items_.length;this.items_.splice(s,0,e),this.cache_.add(e);const n=this.extract_(e);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach(a=>{this.cache_.add(a)})),this.emitter.emit("add",{index:s,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const s=this.extract_(e);s&&(s.allItems().forEach(n=>{this.cache_.delete(n)}),s.emitter.off("add",this.onSubListAdd_),s.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function qj(i,e){for(let t=0;t<i.length;t++){const s=i[t];if(dl(s)&&s.value===e)return s}return null}function Hj(i){return F_(i)?i.rackController.rack.bcSet_:null}class jj{constructor(e){var t,s;this.emitter=new hs,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(s=this.blade_)===null||s===void 0||s.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new Gj(Hj),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var s;(s=e.parent)===null||s===void 0||s.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const s=e.item;if(s.viewProps.emitter.on("change",this.onChildViewPropsChange_),s.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),s.viewProps.handleDispose(this.onChildDispose_),dl(s))s.value.emitter.on("change",this.onChildValueChange_);else if(F_(s)){const n=s.rackController.rack;if(n){const a=n.emitter;a.on("layout",this.onRackLayout_),a.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const s=e.item;if(dl(s))s.value.emitter.off("change",this.onChildValueChange_);else if(F_(s)){const n=s.rackController.rack;if(n){const a=n.emitter;a.off("layout",this.onRackLayout_),a.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(n=>!n.viewProps.get("hidden")),t=e[0],s=e[e.length-1];this.bcSet_.items.forEach(n=>{const a=[];n===t&&(a.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&a.push("veryfirst")),n===s&&(a.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&a.push("verylast")),n.blade.set("positions",a)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=qj(this.find(dl),e.sender);if(!t)throw Yt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class XT{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new jj({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let s=this.rack.children.length-1;s>=0;s--)this.rack.children[s].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&b3(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&HT(e.bladeController.view.element)}}function bc(){return new He({positions:It([],{equals:TH})})}class Bd extends He{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},s=He.createCore(t);return new Bd(s)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Bt(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const s=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};hr(this,"expanded",s),hr(this,"temporaryExpanded",s)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function $j(i,e){let t=0;return dj(e,()=>{i.set("expandedHeight",null),i.set("temporaryExpanded",!0),hg(e),t=e.clientHeight,i.set("temporaryExpanded",null),hg(e)}),t}function TC(i,e){e.style.height=i.styleHeight}function YT(i,e){i.value("expanded").emitter.on("beforechange",()=>{if(i.set("completed",!1),Bt(i.get("expandedHeight"))){const t=$j(i,e);t>0&&i.set("expandedHeight",t)}i.set("shouldFixHeight",!0),hg(e)}),i.emitter.on("change",()=>{TC(i,e)}),TC(i,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&i.cleanUpTransition()})}class N3 extends $T{constructor(e,t){super(e,t),this.emitter_=new hs,this.controller.foldable.value("expanded").emitter.on("change",s=>{this.emitter_.emit("fold",new ij(this,s.sender.rawValue))}),this.rackApi_.on("change",s=>{this.emitter_.emit("change",s)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,s){return this.rackApi_.addBinding(e,t,s)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const A3=ot("cnt");class Wj{constructor(e,t){var s;this.className_=ot((s=t.viewName)!==null&&s!==void 0?s:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),A3()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),hr(this.foldable_,"completed",gc(this.element,this.className_(void 0,"cpl")));const n=e.createElement("button");n.classList.add(this.className_("b")),hr(t.props,"title",d=>{Bt(d)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const a=e.createElement("div");a.classList.add(this.className_("i")),this.element.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("t")),jT(t.props.value("title"),l),this.buttonElement.appendChild(l),this.titleElement=l;const u=e.createElement("div");u.classList.add(this.className_("m")),this.buttonElement.appendChild(u);const h=e.createElement("div");h.classList.add(this.className_("c")),this.element.appendChild(h),this.containerElement=h}}class P_ extends WT{constructor(e,t){var s;const n=Bd.create((s=t.expanded)!==null&&s!==void 0?s:!0),a=new Wj(e,{foldable:n,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new XT({blade:t.blade,element:a.containerElement,root:t.root,viewProps:t.viewProps}),view:a})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=n,YT(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Gn(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return qn(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Xj=Js({id:"folder",type:"blade",accept(i){const e=$t(i,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(i){return new P_(i.document,{blade:i.blade,expanded:i.params.expanded,props:He.fromObject({title:i.params.title}),viewProps:i.viewProps})},api(i){return i.controller instanceof P_?new N3(i.controller,i.pool):null}}),Yj=ot("");function SC(i,e){return gc(i,Yj(void 0,e))}class da extends He{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=AH(It(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,s,n;const a=e??{};return new da(He.createCore({disabled:(t=a.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(s=a.hidden)!==null&&s!==void 0?s:!1,parent:(n=a.parent)!==null&&n!==void 0?n:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ta(this.globalDisabled_,SC(e,"disabled")),hr(this,"hidden",SC(e,"hidden"))}bindDisabled(e){ta(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ta(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const s=e.previousRawValue;s?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const wC=ot("tbp");class Kj{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wC()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(wC("c")),this.element.appendChild(s),this.containerElement=s}}const Uh=ot("tbi");class Zj{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Uh()),t.viewProps.bindClassModifiers(this.element),hr(t.props,"selected",a=>{a?this.element.classList.add(Uh(void 0,"sel")):this.element.classList.remove(Uh(void 0,"sel"))});const s=e.createElement("button");s.classList.add(Uh("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const n=e.createElement("div");n.classList.add(Uh("t")),jT(t.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}}class Qj{constructor(e,t){this.emitter=new hs,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Zj(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class O_ extends WT{constructor(e,t){const s=new Kj(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new XT({blade:t.blade,element:s.containerElement,viewProps:t.viewProps}),view:s})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Qj(e,{props:t.itemProps,viewProps:da.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,hr(this.props,"selected",n=>{this.itemController.props.set("selected",n),this.viewProps.set("hidden",!n)})}get itemController(){return this.ic_}importState(e){return Gn(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return qn(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Jj extends $T{constructor(e,t){super(e,t),this.emitter_=new hs,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",s=>{this.emitter_.emit("change",s)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,s=new O_(t,{blade:bc(),itemProps:He.fromObject({selected:!1,title:e.title}),props:He.fromObject({selected:!1}),viewProps:da.create()}),n=this.pool_.createApi(s);return this.rackApi_.add(n,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new rj(this,e.rawValue))}}class e7 extends $T{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,s){return this.rackApi_.addBinding(e,t,s)}addBlade(e){return this.rackApi_.addBlade(e)}}const MC=-1;class t7{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=It(!0),this.selectedIndex=It(MC),this.items_=[]}add(e,t){const s=t??this.items_.length;this.items_.splice(s,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=MC,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,s)=>{t.rawValue=s===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,s)=>{t.rawValue=s===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(s=>s===e.sender);this.items_.forEach((s,n)=>{s.rawValue=n===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Fh=ot("tab");class s7{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fh(),A3()),t.viewProps.bindClassModifiers(this.element),ta(t.empty,gc(this.element,Fh(void 0,"nop")));const s=e.createElement("div");s.classList.add(Fh("t")),this.element.appendChild(s),this.itemsElement=s;const n=e.createElement("div");n.classList.add(Fh("i")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(Fh("c")),this.element.appendChild(a),this.contentsElement=a}}class NC extends WT{constructor(e,t){const s=new t7,n=new s7(e,{empty:s.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new XT({blade:t.blade,element:n.contentsElement,viewProps:t.viewProps}),view:n}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const a=this.rackController.rack;a.emitter.on("add",this.onRackAdd_),a.emitter.on("remove",this.onRackRemove_),this.tab=s}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;b3(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;HT(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}const C3=Js({id:"tab",type:"blade",accept(i){const e=$t(i,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(i){const e=new NC(i.document,{blade:i.blade,viewProps:i.viewProps});return i.params.pages.forEach(t=>{const s=new O_(i.document,{blade:bc(),itemProps:He.fromObject({selected:!1,title:t.title}),props:He.fromObject({selected:!1}),viewProps:da.create()});e.add(s)}),e},api(i){return i.controller instanceof NC?new Jj(i.controller,i.pool):i.controller instanceof O_?new e7(i.controller,i.pool):null}});function n7(i,e){const t=i.accept(e.params);if(!t)return null;const s=$t(e.params,n=>({disabled:n.optional.boolean,hidden:n.optional.boolean}));return i.controller({blade:bc(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:s?.disabled,hidden:s?.hidden}),viewProps:da.create({disabled:s?.disabled,hidden:s?.hidden})})}class KT extends pd{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class i7{constructor(){this.disabled=!1,this.emitter=new hs}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class r7{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new hs,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Dd{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,s)=>s.constrain(t),e)}}function dg(i,e){if(i instanceof e)return i;if(i instanceof Dd){const t=i.constraints.reduce((s,n)=>s||(n instanceof e?n:null),null);if(t)return t}return null}class Ld{constructor(e){this.values=He.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(n=>n.value===e).length>0?e:t[0].value}}function Ud(i){var e;const t=U_;if(Array.isArray(i))return(e=$t({items:i},s=>({items:s.required.array(s.required.object({text:s.required.string,value:s.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof i=="object")return t.required.raw(i).value}function ZT(i){if(Array.isArray(i))return i;const e=[];return Object.keys(i).forEach(t=>{e.push({text:t,value:i[t]})}),e}function QT(i){return Bt(i)?null:new Ld(ZT(i))}const qx=ot("lst");class a7{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(qx()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("select");s.classList.add(qx("s")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.selectElement=s;const n=e.createElement("div");n.classList.add(qx("m")),n.appendChild(ay(e,"dropdown")),this.element.appendChild(n),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,hr(this.props_,"options",a=>{x3(this.selectElement),a.forEach(l=>{const u=e.createElement("option");u.textContent=l.text,this.selectElement.appendChild(u)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class xo{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new a7(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Gn(e,null,t=>({options:t.required.custom(Ud)}),t=>(this.props.set("options",ZT(t.options)),!0))}exportProps(){return qn(null,{options:this.props.get("options")})}}const AC=ot("pop");class o7{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(AC()),t.viewProps.bindClassModifiers(this.element),ta(t.shows,gc(this.element,AC(void 0,"v")))}}class E3{constructor(e,t){this.shows=It(!1),this.viewProps=t.viewProps,this.view=new o7(e,{shows:this.shows,viewProps:this.viewProps})}}const CC=ot("txt");class l7{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(CC()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const s=e.createElement("input");s.classList.add(CC("i")),s.type="text",t.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class fd{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new l7(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const s=e.currentTarget.value,n=this.parser_(s);Bt(n)||(this.value.rawValue=n),this.view.refresh()}}function u7(i){return String(i)}function R3(i){return i==="false"?!1:!!i}function EC(i){return u7(i)}function c7(i){return e=>i.reduce((t,s)=>t!==null?t:s(e),null)}const h7=yn(0);function pg(i){return h7(i)+"%"}function B3(i){return String(i)}function V_(i){return i}function xc({primary:i,secondary:e,forward:t,backward:s}){let n=!1;function a(l){n||(n=!0,l(),n=!1)}i.emitter.on("change",l=>{a(()=>{e.setRawValue(t(i.rawValue,e.rawValue),l.options)})}),e.emitter.on("change",l=>{a(()=>{i.setRawValue(s(i.rawValue,e.rawValue),l.options)}),a(()=>{e.setRawValue(t(i.rawValue,e.rawValue),l.options)})}),a(()=>{e.setRawValue(t(i.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function pn(i,e){const t=i*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function md(i){return{altKey:i.altKey,downKey:i.key==="ArrowDown",shiftKey:i.shiftKey,upKey:i.key==="ArrowUp"}}function oa(i){return{altKey:i.altKey,downKey:i.key==="ArrowLeft",shiftKey:i.shiftKey,upKey:i.key==="ArrowRight"}}function d7(i){return i==="ArrowUp"||i==="ArrowDown"}function D3(i){return d7(i)||i==="ArrowLeft"||i==="ArrowRight"}function Hx(i,e){var t,s;const n=e.ownerDocument.defaultView,a=e.getBoundingClientRect();return{x:i.pageX-(((t=n&&n.scrollX)!==null&&t!==void 0?t:0)+a.left),y:i.pageY-(((s=n&&n.scrollY)!==null&&s!==void 0?s:0)+a.top)}}class Ml{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new hs,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const s=this.elem_.ownerDocument;s.addEventListener("mousemove",this.onDocumentMouseMove_),s.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Hx(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Hx(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Hx(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-s.left,y:t.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-s.left,y:t.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const s=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(s?{x:s.clientX-n.left,y:s.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const si=ot("txt");class p7{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(si(),si(void 0,"num")),t.arrayPosition&&this.element.classList.add(si(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("input");s.classList.add(si("i")),s.type="text",t.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(si()),this.inputElement.classList.add(si("i"));const n=e.createElement("div");n.classList.add(si("k")),this.element.appendChild(n),this.knobElement=n;const a=e.createElementNS(er,"svg");a.classList.add(si("g")),this.knobElement.appendChild(a);const l=e.createElementNS(er,"path");l.classList.add(si("gb")),a.appendChild(l),this.guideBodyElem_=l;const u=e.createElementNS(er,"path");u.classList.add(si("gh")),a.appendChild(u),this.guideHeadElem_=u;const h=e.createElement("div");h.classList.add(ot("tt")()),this.knobElement.appendChild(h),this.tooltipElem_=h,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(si(void 0,"drg"));return}this.element.classList.add(si(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),s=t+(t>0?-1:t<0?1:0),n=ms(-s,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${s+n},0 L${s},4 L${s+n},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const a=this.props_.get("formatter");this.tooltipElem_.textContent=a(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Fd{constructor(e,t){var s;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(s=t.sliderProps)!==null&&s!==void 0?s:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=It(null),this.view=new p7(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new Ml(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,s;const n=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),a=(s=this.sliderProps_)===null||s===void 0?void 0:s.get("max");let l=e;return n!==void 0&&(l=Math.max(l,n)),a!==void 0&&(l=Math.min(l,a)),l}onInputChange_(e){const s=e.currentTarget.value,n=this.parser_(s);Bt(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=pn(this.props.get("keyScale"),md(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){pn(this.props.get("keyScale"),md(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const jx=ot("sld");class f7{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(jx()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(jx("t")),t.viewProps.bindTabIndex(s),this.element.appendChild(s),this.trackElement=s;const n=e.createElement("div");n.classList.add(jx("k")),this.trackElement.appendChild(n),this.knobElement=n,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=ms(bt(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class m7{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new f7(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ml(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(bt(ms(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=pn(this.props.get("keyScale"),oa(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){pn(this.props.get("keyScale"),oa(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $x=ot("sldtxt");class g7{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($x());const s=e.createElement("div");s.classList.add($x("s")),this.sliderView_=t.sliderView,s.appendChild(this.sliderView_.element),this.element.appendChild(s);const n=e.createElement("div");n.classList.add($x("t")),this.textView_=t.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}}class fg{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new m7(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Fd(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new g7(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Gn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const s=this.sliderC_.props;return s.set("max",t.max),s.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return qn(null,{max:e.get("max"),min:e.get("min")})}}function L3(i){return{sliderProps:new He({keyScale:i.keyScale,max:i.max,min:i.min}),textProps:new He({formatter:It(i.formatter),keyScale:i.keyScale,pointerScale:It(i.pointerScale)})}}const y7={containerUnitSize:"cnt-usz"};function U3(i){return`--${y7[i]}`}function gd(i){return g3(i)}function ao(i){if(L_(i))return $t(i,gd)}function $r(i,e){if(!i)return;const t=[],s=p3(i,e);s&&t.push(s);const n=f3(i);return n&&t.push(n),new Dd(t)}function b7(i){return i?i.major===yc.major:!1}function F3(i){if(i==="inline"||i==="popup")return i}function Pd(i,e){i.write(e)}const nm=ot("ckb");class x7{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(nm()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("label");s.classList.add(nm("l")),this.element.appendChild(s),this.labelElement=s;const n=e.createElement("input");n.classList.add(nm("i")),n.type="checkbox",this.labelElement.appendChild(n),this.inputElement=n,t.viewProps.bindDisabled(this.inputElement);const a=e.createElement("div");a.classList.add(nm("w")),this.labelElement.appendChild(a);const l=ay(e,"check");a.appendChild(l),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class _7{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new x7(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function v7(i){const e=[],t=QT(i.options);return t&&e.push(t),new Dd(e)}const T7=Js({id:"input-bool",type:"input",accept:(i,e)=>{if(typeof i!="boolean")return null;const t=$t(e,s=>({options:s.optional.custom(Ud),readonly:s.optional.constant(!1)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>R3,constraint:i=>v7(i.params),writer:i=>Pd},controller:i=>{const e=i.document,t=i.value,s=i.constraint,n=s&&dg(s,Ld);return n?new xo(e,{props:new He({options:n.values.value("options")}),value:t,viewProps:i.viewProps}):new _7(e,{value:t,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="boolean"?null:i.controller.valueController instanceof xo?new KT(i.controller):null}}),el=ot("col");class S7{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(el()),t.foldable.bindExpandedClass(this.element,el(void 0,"expanded")),hr(t.foldable,"completed",gc(this.element,el(void 0,"cpl")));const s=e.createElement("div");s.classList.add(el("h")),this.element.appendChild(s);const n=e.createElement("div");n.classList.add(el("s")),s.appendChild(n),this.swatchElement=n;const a=e.createElement("div");if(a.classList.add(el("t")),s.appendChild(a),this.textElement=a,t.pickerLayout==="inline"){const l=e.createElement("div");l.classList.add(el("p")),this.element.appendChild(l),this.pickerElement=l}else this.pickerElement=null}}function w7(i,e,t){const s=ms(i/255,0,1),n=ms(e/255,0,1),a=ms(t/255,0,1),l=Math.max(s,n,a),u=Math.min(s,n,a),h=l-u;let d=0,f=0;const m=(u+l)/2;return h!==0&&(f=h/(1-Math.abs(l+u-1)),s===l?d=(n-a)/h:n===l?d=2+(a-s)/h:d=4+(s-n)/h,d=d/6+(d<0?1:0)),[d*360,f*100,m*100]}function M7(i,e,t){const s=(i%360+360)%360,n=ms(e/100,0,1),a=ms(t/100,0,1),l=(1-Math.abs(2*a-1))*n,u=l*(1-Math.abs(s/60%2-1)),h=a-l/2;let d,f,m;return s>=0&&s<60?[d,f,m]=[l,u,0]:s>=60&&s<120?[d,f,m]=[u,l,0]:s>=120&&s<180?[d,f,m]=[0,l,u]:s>=180&&s<240?[d,f,m]=[0,u,l]:s>=240&&s<300?[d,f,m]=[u,0,l]:[d,f,m]=[l,0,u],[(d+h)*255,(f+h)*255,(m+h)*255]}function N7(i,e,t){const s=ms(i/255,0,1),n=ms(e/255,0,1),a=ms(t/255,0,1),l=Math.max(s,n,a),u=Math.min(s,n,a),h=l-u;let d;h===0?d=0:l===s?d=60*(((n-a)/h%6+6)%6):l===n?d=60*((a-s)/h+2):d=60*((s-n)/h+4);const f=l===0?0:h/l,m=l;return[d,f*100,m*100]}function P3(i,e,t){const s=c3(i,360),n=ms(e/100,0,1),a=ms(t/100,0,1),l=a*n,u=l*(1-Math.abs(s/60%2-1)),h=a-l;let d,f,m;return s>=0&&s<60?[d,f,m]=[l,u,0]:s>=60&&s<120?[d,f,m]=[u,l,0]:s>=120&&s<180?[d,f,m]=[0,l,u]:s>=180&&s<240?[d,f,m]=[0,u,l]:s>=240&&s<300?[d,f,m]=[u,0,l]:[d,f,m]=[l,0,u],[(d+h)*255,(f+h)*255,(m+h)*255]}function A7(i,e,t){const s=t+e*(100-Math.abs(2*t-100))/200;return[i,s!==0?e*(100-Math.abs(2*t-100))/s:0,t+e*(100-Math.abs(2*t-100))/200]}function C7(i,e,t){const s=100-Math.abs(t*(200-e)/100-100);return[i,s!==0?e*t/s:0,t*(200-e)/200]}function dr(i){return[i[0],i[1],i[2]]}function ly(i,e){return[i[0],i[1],i[2],e]}const E7={hsl:{hsl:(i,e,t)=>[i,e,t],hsv:A7,rgb:M7},hsv:{hsl:C7,hsv:(i,e,t)=>[i,e,t],rgb:P3},rgb:{hsl:w7,hsv:N7,rgb:(i,e,t)=>[i,e,t]}};function cc(i,e){return[e==="float"?1:i==="rgb"?255:360,e==="float"?1:i==="rgb"?255:100,e==="float"?1:i==="rgb"?255:100]}function R7(i,e){return i===e?e:c3(i,e)}function O3(i,e,t){var s;const n=cc(e,t);return[e==="rgb"?ms(i[0],0,n[0]):R7(i[0],n[0]),ms(i[1],0,n[1]),ms(i[2],0,n[2]),ms((s=i[3])!==null&&s!==void 0?s:1,0,1)]}function RC(i,e,t,s){const n=cc(e,t),a=cc(e,s);return i.map((l,u)=>l/n[u]*a[u])}function V3(i,e,t){const s=RC(i,e.mode,e.type,"int"),n=E7[e.mode][t.mode](...s);return RC(n,t.mode,"int",t.type)}class ct{static black(){return new ct([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=O3(e,t,this.type)}getComponents(e){return ly(V3(dr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Wa=ot("colp");class B7{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Wa()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(Wa("hsv"));const n=e.createElement("div");n.classList.add(Wa("sv")),this.svPaletteView_=t.svPaletteView,n.appendChild(this.svPaletteView_.element),s.appendChild(n);const a=e.createElement("div");a.classList.add(Wa("h")),this.hPaletteView_=t.hPaletteView,a.appendChild(this.hPaletteView_.element),s.appendChild(a),this.element.appendChild(s);const l=e.createElement("div");if(l.classList.add(Wa("rgb")),this.textsView_=t.textsView,l.appendChild(this.textsView_.element),this.element.appendChild(l),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const u=e.createElement("div");u.classList.add(Wa("a"));const h=e.createElement("div");h.classList.add(Wa("ap")),h.appendChild(this.alphaViews_.palette.element),u.appendChild(h);const d=e.createElement("div");d.classList.add(Wa("at")),d.appendChild(this.alphaViews_.text.element),u.appendChild(d),this.element.appendChild(u)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function D7(i){return i==="int"?"int":i==="float"?"float":void 0}function JT(i){return $t(i,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(D7)}),expanded:e.optional.boolean,picker:e.optional.custom(F3),readonly:e.optional.constant(!1)}))}function yl(i){return i?.1:1}function z3(i){var e;return(e=i.color)===null||e===void 0?void 0:e.type}class eS{constructor(e,t){this.type="float",this.mode=t,this.comps_=O3(e,t,this.type)}getComponents(e){return ly(V3(dr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const L7={int:(i,e)=>new ct(i,e),float:(i,e)=>new eS(i,e)};function tS(i,e,t){return L7[t](i,e)}function U7(i){return i.type==="float"}function F7(i){return i.type==="int"}function P7(i){const e=i.getComponents(),t=cc(i.mode,"int");return new ct([Math.round(bt(e[0],0,1,0,t[0])),Math.round(bt(e[1],0,1,0,t[1])),Math.round(bt(e[2],0,1,0,t[2])),e[3]],i.mode)}function O7(i){const e=i.getComponents(),t=cc(i.mode,"int");return new eS([bt(e[0],0,t[0],0,1),bt(e[1],0,t[1],0,1),bt(e[2],0,t[2],0,1),e[3]],i.mode)}function Qs(i,e){if(i.type===e)return i;if(F7(i)&&e==="float")return O7(i);if(U7(i)&&e==="int")return P7(i);throw Yt.shouldNeverHappen()}function V7(i,e){return i.alpha===e.alpha&&i.mode===e.mode&&i.notation===e.notation&&i.type===e.type}function ci(i,e){const t=i.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(i),e)}const z7={deg:i=>i,grad:i=>i*360/400,rad:i=>i*360/(2*Math.PI),turn:i=>i*360};function I3(i){const e=i.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(i);const t=parseFloat(e[1]),s=e[2];return z7[s](t)}function k3(i){const e=i.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[ci(e[1],255),ci(e[2],255),ci(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function I7(i){const e=k3(i);return e?new ct(e,"rgb"):null}function G3(i){const e=i.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[ci(e[1],255),ci(e[2],255),ci(e[3],255),ci(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function k7(i){const e=G3(i);return e?new ct(e,"rgb"):null}function q3(i){const e=i.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[I3(e[1]),ci(e[2],100),ci(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function G7(i){const e=q3(i);return e?new ct(e,"hsl"):null}function H3(i){const e=i.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[I3(e[1]),ci(e[2],100),ci(e[3],100),ci(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function q7(i){const e=H3(i);return e?new ct(e,"hsl"):null}function j3(i){const e=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=i.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function H7(i){const e=j3(i);return e?new ct(e,"rgb"):null}function $3(i){const e=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),bt(parseInt(e[4]+e[4],16),0,255,0,1)];const t=i.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),bt(parseInt(t[4],16),0,255,0,1)]:null}function j7(i){const e=$3(i);return e?new ct(e,"rgb"):null}function W3(i){const e=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function $7(i){return e=>{const t=W3(e);return t?tS(t,"rgb",i):null}}function X3(i){const e=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function W7(i){return e=>{const t=X3(e);return t?tS(t,"rgb",i):null}}const X7=[{parser:j3,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:$3,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:k3,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:G3,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:q3,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:H3,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:W3,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:X3,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Y7(i){return X7.reduce((e,{parser:t,result:s})=>e||(t(i)?s:null),null)}function K7(i,e="int"){const t=Y7(i);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Od(i){const e=[H7,j7,I7,k7,G7,q7];e.push($7("int"),W7("int"));const t=c7(e);return s=>{const n=t(s);return n?Qs(n,i):null}}function Z7(i){const e=Od("int");if(typeof i!="string")return ct.black();const t=e(i);return t??ct.black()}function Y3(i){const e=ms(Math.floor(i),0,255).toString(16);return e.length===1?`0${e}`:e}function sS(i,e="#"){const t=dr(i.getComponents("rgb")).map(Y3).join("");return`${e}${t}`}function nS(i,e="#"){const t=i.getComponents("rgb"),s=[t[0],t[1],t[2],t[3]*255].map(Y3).join("");return`${e}${s}`}function K3(i){const e=yn(0),t=Qs(i,"int");return`rgb(${dr(t.getComponents("rgb")).map(n=>e(n)).join(", ")})`}function cm(i){const e=yn(2),t=yn(0);return`rgba(${Qs(i,"int").getComponents("rgb").map((a,l)=>(l===3?e:t)(a)).join(", ")})`}function Q7(i){const e=[yn(0),pg,pg],t=Qs(i,"int");return`hsl(${dr(t.getComponents("hsl")).map((n,a)=>e[a](n)).join(", ")})`}function J7(i){const e=[yn(0),pg,pg,yn(2)];return`hsla(${Qs(i,"int").getComponents("hsl").map((n,a)=>e[a](n)).join(", ")})`}function Z3(i,e){const t=yn(e==="float"?2:0),s=["r","g","b"],n=Qs(i,e);return`{${dr(n.getComponents("rgb")).map((l,u)=>`${s[u]}: ${t(l)}`).join(", ")}}`}function e$(i){return e=>Z3(e,i)}function Q3(i,e){const t=yn(2),s=yn(e==="float"?2:0),n=["r","g","b","a"];return`{${Qs(i,e).getComponents("rgb").map((u,h)=>{const d=h===3?t:s;return`${n[h]}: ${d(u)}`}).join(", ")}}`}function t$(i){return e=>Q3(e,i)}const s$=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:sS},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:nS},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:K3},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:cm},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Q7},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:J7},...["int","float"].reduce((i,e)=>[...i,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:e$(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:t$(e)}],[])];function J3(i){return s$.reduce((e,t)=>e||(V7(t.format,i)?t.stringifier:null),null)}const Ph=ot("apl");class n${constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ph()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const s=e.createElement("div");s.classList.add(Ph("b")),this.element.appendChild(s);const n=e.createElement("div");n.classList.add(Ph("c")),s.appendChild(n),this.colorElem_=n;const a=e.createElement("div");a.classList.add(Ph("m")),this.element.appendChild(a),this.markerElem_=a;const l=e.createElement("div");l.classList.add(Ph("p")),this.markerElem_.appendChild(l),this.previewElem_=l,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),s=new ct([t[0],t[1],t[2],0],"rgb"),n=new ct([t[0],t[1],t[2],255],"rgb"),a=["to right",cm(s),cm(n)];this.colorElem_.style.background=`linear-gradient(${a.join(",")})`,this.previewElem_.style.backgroundColor=cm(e);const l=bt(t[3],0,1,0,100);this.markerElem_.style.left=`${l}%`}onValueChange_(){this.update_()}}class i${constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new n$(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ml(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const s=e.point.x/e.bounds.width,n=this.value.rawValue,[a,l,u]=n.getComponents("hsv");this.value.setRawValue(new ct([a,l,u,s],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=pn(yl(!0),oa(e));if(t===0)return;const s=this.value.rawValue,[n,a,l,u]=s.getComponents("hsv");this.value.setRawValue(new ct([n,a,l,u+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){pn(yl(!0),oa(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Bu=ot("coltxt");function r$(i){const e=i.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((s,n)=>{const a=i.createElement("option");return a.textContent=n.text,a.value=n.value,s.appendChild(a),s},i.createDocumentFragment())),e}class a${constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Bu()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(Bu("m")),this.modeElem_=r$(e),this.modeElem_.classList.add(Bu("ms")),s.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const n=e.createElement("div");n.classList.add(Bu("mm")),n.appendChild(ay(e,"dropdown")),s.appendChild(n),this.element.appendChild(s);const a=e.createElement("div");a.classList.add(Bu("w")),this.element.appendChild(a),this.inputsElem_=a,this.inputViews_=t.inputViews,this.applyInputViews_(),ta(t.mode,l=>{this.modeElem_.value=l})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){x3(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const s=e.createElement("div");s.classList.add(Bu("c")),s.appendChild(t.element),this.inputsElem_.appendChild(s)})}}function o$(i){return yn(i==="float"?2:0)}function l$(i,e,t){const s=cc(i,e)[t];return new Ed({min:0,max:s})}function u$(i,e,t){return new Fd(i,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:He.fromObject({formatter:o$(e.colorType),keyScale:yl(!1),pointerScale:e.colorType==="float"?.01:1}),value:It(0,{constraint:l$(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function c$(i,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:aa,viewProps:e.viewProps};return[0,1,2].map(s=>{const n=u$(i,t,s);return xc({primary:e.value,secondary:n.value,forward(a){return Qs(a,e.colorType).getComponents(e.colorMode)[s]},backward(a,l){const u=e.colorMode,d=Qs(a,e.colorType).getComponents(u);d[s]=l;const f=tS(ly(dr(d),d[3]),u,e.colorType);return Qs(f,"int")}}),n})}function h$(i,e){const t=new fd(i,{parser:Od("int"),props:He.fromObject({formatter:sS}),value:It(ct.black()),viewProps:e.viewProps});return xc({primary:e.value,secondary:t.value,forward:s=>new ct(dr(s.getComponents()),s.mode),backward:(s,n)=>new ct(ly(dr(n.getComponents(s.mode)),s.getComponents()[3]),s.mode)}),[t]}function d$(i){return i!=="hex"}class p${constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=It(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new a$(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return d$(t)?c$(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):h$(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(s=>s.view)}}const Wx=ot("hpl");class f${constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Wx()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const s=e.createElement("div");s.classList.add(Wx("c")),this.element.appendChild(s);const n=e.createElement("div");n.classList.add(Wx("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=K3(new ct([t,100,100],"hsv"));const s=bt(t,0,360,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class m${constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new f$(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ml(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const s=bt(ms(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),n=this.value.rawValue,[,a,l,u]=n.getComponents("hsv");this.value.setRawValue(new ct([s,a,l,u],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=pn(yl(!1),oa(e));if(t===0)return;const s=this.value.rawValue,[n,a,l,u]=s.getComponents("hsv");this.value.setRawValue(new ct([n+t,a,l,u],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){pn(yl(!1),oa(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Xx=ot("svp"),BC=64;class g${constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Xx()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const s=e.createElement("canvas");s.height=BC,s.width=BC,s.classList.add(Xx("c")),this.element.appendChild(s),this.canvasElement=s;const n=e.createElement("div");n.classList.add(Xx("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const e=mj(this.canvasElement);if(!e)return;const s=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,a=this.canvasElement.height,l=e.getImageData(0,0,n,a),u=l.data;for(let f=0;f<a;f++)for(let m=0;m<n;m++){const b=bt(m,0,n,0,100),x=bt(f,0,a,100,0),v=P3(s[0],b,x),T=(f*n+m)*4;u[T]=v[0],u[T+1]=v[1],u[T+2]=v[2],u[T+3]=255}e.putImageData(l,0,0);const h=bt(s[1],0,100,0,100);this.markerElem_.style.left=`${h}%`;const d=bt(s[2],0,100,100,0);this.markerElem_.style.top=`${d}%`}onValueChange_(){this.update_()}}class y${constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new g$(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ml(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const s=bt(e.point.x,0,e.bounds.width,0,100),n=bt(e.point.y,0,e.bounds.height,100,0),[a,,,l]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ct([a,s,n,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){D3(e.key)&&e.preventDefault();const[t,s,n,a]=this.value.rawValue.getComponents("hsv"),l=yl(!1),u=pn(l,oa(e)),h=pn(l,md(e));u===0&&h===0||this.value.setRawValue(new ct([t,s+u,n+h,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=yl(!1),s=pn(t,oa(e)),n=pn(t,md(e));s===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class b${constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new m$(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new y$(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new i$(e,{value:this.value,viewProps:this.viewProps}),text:new Fd(e,{parser:aa,props:He.fromObject({pointerScale:.01,keyScale:.1,formatter:yn(2)}),value:It(0,{constraint:new Ed({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&xc({primary:this.value,secondary:this.alphaIcs_.text.value,forward:s=>s.getComponents()[3],backward:(s,n)=>{const a=s.getComponents();return a[3]=n,new ct(a,s.mode)}}),this.textsC_=new p$(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new B7(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const Yx=ot("colsw");class x${constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Yx()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(Yx("sw")),this.element.appendChild(s),this.swatchElem_=s;const n=e.createElement("button");n.classList.add(Yx("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=nS(e)}onValueChange_(){this.update_()}}class _${constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new x$(e,{value:this.value,viewProps:this.viewProps})}}class iS{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Bd.create(t.expanded),this.swatchC_=new _$(e,{value:this.value,viewProps:this.viewProps});const s=this.swatchC_.view.buttonElement;s.addEventListener("blur",this.onButtonBlur_),s.addEventListener("click",this.onButtonClick_),this.textC_=new fd(e,{parser:t.parser,props:He.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new S7(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new E3(e,{viewProps:this.viewProps}):null;const n=new b$(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(a=>{a.addEventListener("blur",this.onPopupChildBlur_),a.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),xc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:a=>a,backward:(a,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),YT(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,s=e.relatedTarget;(!s||!t.contains(s))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,s=_3(e);s&&t.contains(s)||s&&s===this.swatchC_.view.buttonElement&&!qT(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function v$(i){return dr(i.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function T$(i){return i.getComponents("rgb").reduce((e,t,s)=>{const n=Math.floor(s===3?t*255:t)&255;return e<<8|n},0)>>>0}function S$(i){return new ct([i>>16&255,i>>8&255,i&255],"rgb")}function w$(i){return new ct([i>>24&255,i>>16&255,i>>8&255,bt(i&255,0,255,0,1)],"rgb")}function M$(i){return typeof i!="number"?ct.black():S$(i)}function N$(i){return typeof i!="number"?ct.black():w$(i)}function hm(i,e){return typeof i!="object"||Bt(i)?!1:e in i&&typeof i[e]=="number"}function eL(i){return hm(i,"r")&&hm(i,"g")&&hm(i,"b")}function tL(i){return eL(i)&&hm(i,"a")}function sL(i){return eL(i)}function rS(i,e){if(i.mode!==e.mode||i.type!==e.type)return!1;const t=i.getComponents(),s=e.getComponents();for(let n=0;n<t.length;n++)if(t[n]!==s[n])return!1;return!0}function DC(i){return"a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b]}function A$(i){const e=J3(i);return e?(t,s)=>{Pd(t,e(s))}:null}function C$(i){const e=i?T$:v$;return(t,s)=>{Pd(t,e(s))}}function E$(i,e,t){const n=Qs(e,t).toRgbaObject();i.writeProperty("r",n.r),i.writeProperty("g",n.g),i.writeProperty("b",n.b),i.writeProperty("a",n.a)}function R$(i,e,t){const n=Qs(e,t).toRgbaObject();i.writeProperty("r",n.r),i.writeProperty("g",n.g),i.writeProperty("b",n.b)}function B$(i,e){return(t,s)=>{i?E$(t,s,e):R$(t,s,e)}}function D$(i){var e;return!!(!((e=i?.color)===null||e===void 0)&&e.alpha)}function L$(i){return i?e=>nS(e,"0x"):e=>sS(e,"0x")}function U$(i){return"color"in i||i.view==="color"}const F$=Js({id:"input-color-number",type:"input",accept:(i,e)=>{if(typeof i!="number"||!U$(e))return null;const t=JT(e);return t?{initialValue:i,params:Object.assign(Object.assign({},t),{supportsAlpha:D$(e)})}:null},binding:{reader:i=>i.params.supportsAlpha?N$:M$,equals:rS,writer:i=>C$(i.params.supportsAlpha)},controller:i=>{var e,t;return new iS(i.document,{colorType:"int",expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,formatter:L$(i.params.supportsAlpha),parser:Od("int"),pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i.params.supportsAlpha,value:i.value,viewProps:i.viewProps})}});function P$(i,e){if(!sL(i))return Qs(ct.black(),e);if(e==="int"){const t=DC(i);return new ct(t,"rgb")}if(e==="float"){const t=DC(i);return new eS(t,"rgb")}return Qs(ct.black(),"int")}function O$(i){return tL(i)}function V$(i){return e=>{const t=P$(e,i);return Qs(t,"int")}}function z$(i,e){return t=>i?Q3(t,e):Z3(t,e)}const I$=Js({id:"input-color-object",type:"input",accept:(i,e)=>{var t;if(!sL(i))return null;const s=JT(e);return s?{initialValue:i,params:Object.assign(Object.assign({},s),{colorType:(t=z3(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:i=>V$(i.params.colorType),equals:rS,writer:i=>B$(O$(i.initialValue),i.params.colorType)},controller:i=>{var e,t;const s=tL(i.initialValue);return new iS(i.document,{colorType:i.params.colorType,expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,formatter:z$(s,i.params.colorType),parser:Od("int"),pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:s,value:i.value,viewProps:i.viewProps})}}),k$=Js({id:"input-color-string",type:"input",accept:(i,e)=>{if(typeof i!="string"||e.view==="text")return null;const t=K7(i,z3(e));if(!t)return null;const s=J3(t);if(!s)return null;const n=JT(e);return n?{initialValue:i,params:Object.assign(Object.assign({},n),{format:t,stringifier:s})}:null},binding:{reader:()=>Z7,equals:rS,writer:i=>{const e=A$(i.params.format);if(!e)throw Yt.notBindable();return e}},controller:i=>{var e,t;return new iS(i.document,{colorType:i.params.format.type,expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,formatter:i.params.stringifier,parser:Od("int"),pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i.params.format.alpha,value:i.value,viewProps:i.viewProps})}});class aS{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((s,n)=>{var a,l;return(l=(a=this.components[n])===null||a===void 0?void 0:a.constrain(s))!==null&&l!==void 0?l:s});return this.asm_.fromComponents(t)}}const LC=ot("pndtxt");class G${constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(LC()),this.textViews.forEach(s=>{const n=e.createElement("div");n.classList.add(LC("a")),n.appendChild(s.element),this.element.appendChild(n)})}}function q$(i,e,t){return new Fd(i,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:It(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class oS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((s,n)=>q$(e,t,n)),this.acs_.forEach((s,n)=>{xc({primary:this.value,secondary:s.value,forward:a=>t.assembly.toComponents(a)[n],backward:(a,l)=>{const u=t.assembly.toComponents(a);return u[n]=l,t.assembly.fromComponents(u)}})}),this.view=new G$(e,{textViews:this.acs_.map(s=>s.view)})}get textControllers(){return this.acs_}}class H$ extends pd{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function j$(i,e){const t=[],s=p3(i,e);s&&t.push(s);const n=f3(i);n&&t.push(n);const a=QT(i.options);return a&&t.push(a),new Dd(t)}const $$=Js({id:"input-number",type:"input",accept:(i,e)=>{if(typeof i!="number")return null;const t=$t(e,s=>Object.assign(Object.assign({},g3(s)),{options:s.optional.custom(Ud),readonly:s.optional.constant(!1)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>u3,constraint:i=>j$(i.params,i.initialValue),writer:i=>Pd},controller:i=>{const e=i.value,t=i.constraint,s=t&&dg(t,Ld);if(s)return new xo(i.document,{props:new He({options:s.values.value("options")}),value:e,viewProps:i.viewProps});const n=m3(i.params,e.rawValue),a=t&&dg(t,Ed);return a?new fg(i.document,Object.assign(Object.assign({},L3(Object.assign(Object.assign({},n),{keyScale:It(n.keyScale),max:a.values.value("max"),min:a.values.value("min")}))),{parser:aa,value:e,viewProps:i.viewProps})):new Fd(i.document,{parser:aa,props:He.fromObject(n),value:e,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="number"?null:i.controller.valueController instanceof fg?new H$(i.controller):i.controller.valueController instanceof xo?new KT(i.controller):null}});class fo{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Bt(e))return!1;const t=e.x,s=e.y;return!(typeof t!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const nL={toComponents:i=>i.getComponents(),fromComponents:i=>new fo(...i)},Du=ot("p2d");class W${constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Du()),t.viewProps.bindClassModifiers(this.element),ta(t.expanded,gc(this.element,Du(void 0,"expanded")));const s=e.createElement("div");s.classList.add(Du("h")),this.element.appendChild(s);const n=e.createElement("button");n.classList.add(Du("b")),n.appendChild(ay(e,"p2dpad")),t.viewProps.bindDisabled(n),s.appendChild(n),this.buttonElement=n;const a=e.createElement("div");if(a.classList.add(Du("t")),s.appendChild(a),this.textElement=a,t.pickerLayout==="inline"){const l=e.createElement("div");l.classList.add(Du("p")),this.element.appendChild(l),this.pickerElement=l}else this.pickerElement=null}}const Xa=ot("p2dp");class X${constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Xa()),t.layout==="popup"&&this.element.classList.add(Xa(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(Xa("p")),t.viewProps.bindTabIndex(s),this.element.appendChild(s),this.padElement=s;const n=e.createElementNS(er,"svg");n.classList.add(Xa("g")),this.padElement.appendChild(n),this.svgElem_=n;const a=e.createElementNS(er,"line");a.classList.add(Xa("ax")),a.setAttributeNS(null,"x1","0"),a.setAttributeNS(null,"y1","50%"),a.setAttributeNS(null,"x2","100%"),a.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(a);const l=e.createElementNS(er,"line");l.classList.add(Xa("ax")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","0"),l.setAttributeNS(null,"x2","50%"),l.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(l);const u=e.createElementNS(er,"line");u.classList.add(Xa("l")),u.setAttributeNS(null,"x1","50%"),u.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(u),this.lineElem_=u;const h=e.createElement("div");h.classList.add(Xa("m")),this.padElement.appendChild(h),this.markerElem_=h,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),s=this.props_.get("max"),n=bt(e,-s,+s,0,100),a=bt(t,-s,+s,0,100),l=this.props_.get("invertsY")?100-a:a;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${l}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${l}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function UC(i,e,t){return[pn(e[0],oa(i)),pn(e[1],md(i))*(t?1:-1)]}class Y${constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new X$(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ml(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const s=this.props.get("max"),n=bt(e.point.x,0,e.bounds.width,-s,+s),a=bt(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-s,+s);this.value.setRawValue(new fo(n,a),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){D3(e.key)&&e.preventDefault();const[t,s]=UC(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&s===0||this.value.setRawValue(new fo(this.value.rawValue.x+t,this.value.rawValue.y+s),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,s]=UC(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class K${constructor(e,t){var s,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Bd.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new E3(e,{viewProps:this.viewProps}):null;const a=new Y$(e,{layout:t.pickerLayout,props:new He({invertsY:It(t.invertsY),max:It(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});a.view.allFocusableElements.forEach(l=>{l.addEventListener("blur",this.onPopupChildBlur_),l.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=a,this.textC_=new oS(e,{assembly:nL,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new W$(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("blur",this.onPadButtonBlur_),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),xc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:l=>l,backward:(l,u)=>u})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),YT(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,s=e.relatedTarget;(!s||!t.contains(s))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,s=_3(e);s&&t.contains(s)||s&&s===this.view.buttonElement&&!qT(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function Z$(i){return fo.isObject(i)?new fo(i.x,i.y):new fo}function Q$(i,e){i.writeProperty("x",e.x),i.writeProperty("y",e.y)}function J$(i,e){return new aS({assembly:nL,components:[$r(Object.assign(Object.assign({},i),i.x),e.x),$r(Object.assign(Object.assign({},i),i.y),e.y)]})}function FC(i,e){var t,s;if(!Bt(i.min)||!Bt(i.max))return Math.max(Math.abs((t=i.min)!==null&&t!==void 0?t:0),Math.abs((s=i.max)!==null&&s!==void 0?s:0));const n=h3(i);return Math.max(Math.abs(n)*10,Math.abs(e)*10)}function eW(i,e){var t,s;const n=FC(ml(i,(t=i.x)!==null&&t!==void 0?t:{}),e.x),a=FC(ml(i,(s=i.y)!==null&&s!==void 0?s:{}),e.y);return Math.max(n,a)}function tW(i){if(!("y"in i))return!1;const e=i.y;return e&&"inverted"in e?!!e.inverted:!1}const sW=Js({id:"input-point2d",type:"input",accept:(i,e)=>{if(!fo.isObject(i))return null;const t=$t(e,s=>Object.assign(Object.assign({},gd(s)),{expanded:s.optional.boolean,picker:s.optional.custom(F3),readonly:s.optional.constant(!1),x:s.optional.custom(ao),y:s.optional.object(Object.assign(Object.assign({},gd(s)),{inverted:s.optional.boolean}))}));return t?{initialValue:i,params:t}:null},binding:{reader:()=>Z$,constraint:i=>J$(i.params,i.initialValue),equals:fo.equals,writer:()=>Q$},controller:i=>{var e,t;const s=i.document,n=i.value,a=i.constraint,l=[i.params.x,i.params.y];return new K$(s,{axes:n.rawValue.getComponents().map((u,h)=>{var d;return GT({constraint:a.components[h],initialValue:u,params:ml(i.params,(d=l[h])!==null&&d!==void 0?d:{})})}),expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,invertsY:tW(i.params),max:eW(i.params,n.rawValue),parser:aa,pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",value:n,viewProps:i.viewProps})}});class Ku{constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Bt(e))return!1;const t=e.x,s=e.y,n=e.z;return!(typeof t!="number"||typeof s!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const iL={toComponents:i=>i.getComponents(),fromComponents:i=>new Ku(...i)};function nW(i){return Ku.isObject(i)?new Ku(i.x,i.y,i.z):new Ku}function iW(i,e){i.writeProperty("x",e.x),i.writeProperty("y",e.y),i.writeProperty("z",e.z)}function rW(i,e){return new aS({assembly:iL,components:[$r(Object.assign(Object.assign({},i),i.x),e.x),$r(Object.assign(Object.assign({},i),i.y),e.y),$r(Object.assign(Object.assign({},i),i.z),e.z)]})}const aW=Js({id:"input-point3d",type:"input",accept:(i,e)=>{if(!Ku.isObject(i))return null;const t=$t(e,s=>Object.assign(Object.assign({},gd(s)),{readonly:s.optional.constant(!1),x:s.optional.custom(ao),y:s.optional.custom(ao),z:s.optional.custom(ao)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>nW,constraint:i=>rW(i.params,i.initialValue),equals:Ku.equals,writer:i=>iW},controller:i=>{const e=i.value,t=i.constraint,s=[i.params.x,i.params.y,i.params.z];return new oS(i.document,{assembly:iL,axes:e.rawValue.getComponents().map((n,a)=>{var l;return GT({constraint:t.components[a],initialValue:n,params:ml(i.params,(l=s[a])!==null&&l!==void 0?l:{})})}),parser:aa,value:e,viewProps:i.viewProps})}});class Zu{constructor(e=0,t=0,s=0,n=0){this.x=e,this.y=t,this.z=s,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Bt(e))return!1;const t=e.x,s=e.y,n=e.z,a=e.w;return!(typeof t!="number"||typeof s!="number"||typeof n!="number"||typeof a!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const rL={toComponents:i=>i.getComponents(),fromComponents:i=>new Zu(...i)};function oW(i){return Zu.isObject(i)?new Zu(i.x,i.y,i.z,i.w):new Zu}function lW(i,e){i.writeProperty("x",e.x),i.writeProperty("y",e.y),i.writeProperty("z",e.z),i.writeProperty("w",e.w)}function uW(i,e){return new aS({assembly:rL,components:[$r(Object.assign(Object.assign({},i),i.x),e.x),$r(Object.assign(Object.assign({},i),i.y),e.y),$r(Object.assign(Object.assign({},i),i.z),e.z),$r(Object.assign(Object.assign({},i),i.w),e.w)]})}const cW=Js({id:"input-point4d",type:"input",accept:(i,e)=>{if(!Zu.isObject(i))return null;const t=$t(e,s=>Object.assign(Object.assign({},gd(s)),{readonly:s.optional.constant(!1),w:s.optional.custom(ao),x:s.optional.custom(ao),y:s.optional.custom(ao),z:s.optional.custom(ao)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>oW,constraint:i=>uW(i.params,i.initialValue),equals:Zu.equals,writer:i=>lW},controller:i=>{const e=i.value,t=i.constraint,s=[i.params.x,i.params.y,i.params.z,i.params.w];return new oS(i.document,{assembly:rL,axes:e.rawValue.getComponents().map((n,a)=>{var l;return GT({constraint:t.components[a],initialValue:n,params:ml(i.params,(l=s[a])!==null&&l!==void 0?l:{})})}),parser:aa,value:e,viewProps:i.viewProps})}});function hW(i){const e=[],t=QT(i.options);return t&&e.push(t),new Dd(e)}const dW=Js({id:"input-string",type:"input",accept:(i,e)=>{if(typeof i!="string")return null;const t=$t(e,s=>({readonly:s.optional.constant(!1),options:s.optional.custom(Ud)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>B3,constraint:i=>hW(i.params),writer:i=>Pd},controller:i=>{const e=i.document,t=i.value,s=i.constraint,n=s&&dg(s,Ld);return n?new xo(e,{props:new He({options:n.values.value("options")}),value:t,viewProps:i.viewProps}):new fd(e,{parser:a=>a,props:He.fromObject({formatter:V_}),value:t,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="string"?null:i.controller.valueController instanceof xo?new KT(i.controller):null}}),Vd={monitor:{defaultInterval:200,defaultRows:3}},PC=ot("mll");class pW{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(PC()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("textarea");s.classList.add(PC("i")),s.style.height=`calc(var(${U3("containerUnitSize")}) * ${t.rows})`,s.readOnly=!0,t.viewProps.bindDisabled(s),this.element.appendChild(s),this.textareaElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,s=[];this.value.rawValue.forEach(n=>{n!==void 0&&s.push(this.formatter_(n))}),e.textContent=s.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class lS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new pW(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const OC=ot("sgl");class fW{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(OC()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("input");s.classList.add(OC("i")),s.readOnly=!0,s.type="text",t.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class uS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new fW(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const mW=Js({id:"monitor-bool",type:"monitor",accept:(i,e)=>{if(typeof i!="boolean")return null;const t=$t(e,s=>({readonly:s.required.constant(!0),rows:s.optional.number}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>R3},controller:i=>{var e;return i.value.rawValue.length===1?new uS(i.document,{formatter:EC,value:i.value,viewProps:i.viewProps}):new lS(i.document,{formatter:EC,rows:(e=i.params.rows)!==null&&e!==void 0?e:Vd.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}});class gW extends pd{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const Ya=ot("grl");class yW{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ya()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const s=e.createElementNS(er,"svg");s.classList.add(Ya("g")),s.style.height=`calc(var(${U3("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(s),this.svgElem_=s;const n=e.createElementNS(er,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;const a=e.createElement("div");a.classList.add(Ya("t"),ot("tt")()),this.element.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,s=this.value.rawValue.length-1,n=this.props_.get("min"),a=this.props_.get("max"),l=[];this.value.rawValue.forEach((m,b)=>{if(m===void 0)return;const x=bt(b,0,s,0,e),v=bt(m,n,a,t,0);l.push([x,v].join(","))}),this.lineElem_.setAttributeNS(null,"points",l.join(" "));const u=this.tooltipElem_,h=this.value.rawValue[this.cursor_.rawValue];if(h===void 0){u.classList.remove(Ya("t","a"));return}const d=bt(this.cursor_.rawValue,0,s,0,e),f=bt(h,n,a,t,0);u.style.left=`${d}px`,u.style.top=`${f}px`,u.textContent=`${this.formatter_(h)}`,u.classList.contains(Ya("t","a"))||(u.classList.add(Ya("t","a"),Ya("t","in")),hg(u),u.classList.remove(Ya("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class aL{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=It(-1),this.view=new yW(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!qT(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const s=new Ml(this.view.element);s.emitter.on("down",this.onGraphPointerDown_),s.emitter.on("move",this.onGraphPointerMove_),s.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Gn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return qn(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(bt(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(bt(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function z_(i){return Bt(i.format)?yn(2):i.format}function bW(i){var e;return i.value.rawValue.length===1?new uS(i.document,{formatter:z_(i.params),value:i.value,viewProps:i.viewProps}):new lS(i.document,{formatter:z_(i.params),rows:(e=i.params.rows)!==null&&e!==void 0?e:Vd.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}function xW(i){var e,t,s;return new aL(i.document,{formatter:z_(i.params),rows:(e=i.params.rows)!==null&&e!==void 0?e:Vd.monitor.defaultRows,props:He.fromObject({max:(t=i.params.max)!==null&&t!==void 0?t:100,min:(s=i.params.min)!==null&&s!==void 0?s:0}),value:i.value,viewProps:i.viewProps})}function VC(i){return i.view==="graph"}const _W=Js({id:"monitor-number",type:"monitor",accept:(i,e)=>{if(typeof i!="number")return null;const t=$t(e,s=>({format:s.optional.function,max:s.optional.number,min:s.optional.number,readonly:s.required.constant(!0),rows:s.optional.number,view:s.optional.string}));return t?{initialValue:i,params:t}:null},binding:{defaultBufferSize:i=>VC(i)?64:1,reader:i=>u3},controller:i=>VC(i.params)?xW(i):bW(i),api:i=>i.controller.valueController instanceof aL?new gW(i.controller):null}),vW=Js({id:"monitor-string",type:"monitor",accept:(i,e)=>{if(typeof i!="string")return null;const t=$t(e,s=>({multiline:s.optional.boolean,readonly:s.required.constant(!0),rows:s.optional.number}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>B3},controller:i=>{var e;const t=i.value;return t.rawValue.length>1||i.params.multiline?new lS(i.document,{formatter:V_,rows:(e=i.params.rows)!==null&&e!==void 0?e:Vd.monitor.defaultRows,value:t,viewProps:i.viewProps}):new uS(i.document,{formatter:V_,value:t,viewProps:i.viewProps})}});class TW{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class SW{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function wW(i,e){var t;const s=i.accept(e.target.read(),e.params);if(Bt(s))return null;const n={target:e.target,initialValue:s.initialValue,params:s.params},a=$t(e.params,m=>({disabled:m.optional.boolean,hidden:m.optional.boolean,label:m.optional.string,tag:m.optional.string})),l=i.binding.reader(n),u=i.binding.constraint?i.binding.constraint(n):void 0,h=new SW({reader:l,target:e.target,writer:i.binding.writer(n)}),d=new oj(It(l(s.initialValue),{constraint:u,equals:i.binding.equals}),h),f=i.controller({constraint:u,document:e.document,initialValue:s.initialValue,params:s.params,value:d,viewProps:da.create({disabled:a?.disabled,hidden:a?.hidden})});return new Tj(e.document,{blade:bc(),props:He.fromObject({label:"label"in e.params?(t=a?.label)!==null&&t!==void 0?t:null:e.target.key}),tag:a?.tag,value:d,valueController:f})}class MW{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function NW(i,e){return e===0?new i7:new r7(i,e??Vd.monitor.defaultInterval)}function AW(i,e){var t,s,n;const a=i.accept(e.target.read(),e.params);if(Bt(a))return null;const l={target:e.target,initialValue:a.initialValue,params:a.params},u=$t(e.params,b=>({bufferSize:b.optional.number,disabled:b.optional.boolean,hidden:b.optional.boolean,interval:b.optional.number,label:b.optional.string})),h=i.binding.reader(l),d=(s=(t=u?.bufferSize)!==null&&t!==void 0?t:i.binding.defaultBufferSize&&i.binding.defaultBufferSize(a.params))!==null&&s!==void 0?s:1,f=new Aj({binding:new MW({reader:h,target:e.target}),bufferSize:d,ticker:NW(e.document,u?.interval)}),m=i.controller({document:e.document,params:a.params,value:f,viewProps:da.create({disabled:u?.disabled,hidden:u?.hidden})});return m.viewProps.bindDisabled(f.ticker),m.viewProps.handleDispose(()=>{f.ticker.dispose()}),new Ej(e.document,{blade:bc(),props:He.fromObject({label:"label"in e.params?(n=u?.label)!==null&&n!==void 0?n:null:e.target.key}),value:f,valueController:m})}class CW{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!b7(t.core))throw Yt.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,s){return this.pluginsMap_.inputs.reduce((n,a)=>n??wW(a,{document:e,target:t,params:s}),null)}createMonitor_(e,t,s){return this.pluginsMap_.monitors.reduce((n,a)=>n??AW(a,{document:e,params:s,target:t}),null)}createBinding(e,t,s){const n=t.read();if(Bt(n))throw new Yt({context:{key:t.key},type:"nomatchingcontroller"});const a=this.createInput_(e,t,s);if(a)return a;const l=this.createMonitor_(e,t,s);if(l)return l;throw new Yt({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const s=this.pluginsMap_.blades.reduce((n,a)=>n??n7(a,{document:e,params:t}),null);if(!s)throw new Yt({type:"nomatchingview",context:{params:t}});return s}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((s,n)=>{var a,l;return s||((l=(a=n.api)===null||a===void 0?void 0:a.call(n,{controller:e}))!==null&&l!==void 0?l:null)},null);return this.apiCache_.add(e,t??new pd(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((s,n)=>{var a,l;return s||((l=(a=n.api)===null||a===void 0?void 0:a.call(n,{controller:e}))!==null&&l!==void 0?l:null)},null);return this.apiCache_.add(e,t??new pd(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(Sj(e))return this.createInputBindingApi_(e);if(Rj(e))return this.createMonitorBindingApi_(e);throw Yt.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(vj(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((s,n)=>s??n.api({controller:e,pool:this}),null);if(!t)throw Yt.shouldNeverHappen();return this.apiCache_.add(e,t)}}const EW=new TW;function RW(){const i=new CW(EW);return[sW,aW,cW,dW,$$,k$,I$,F$,T7,mW,vW,_W,Fj,Xj,C3].forEach(e=>{i.register("core",e)}),i}class BW extends wl{constructor(e){super(e),this.emitter_=new hs,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Rd(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class DW extends wl{}class LW extends wl{constructor(e){super(e),this.emitter_=new hs,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Rd(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class UW extends wl{constructor(e){super(e),this.emitter_=new hs,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Rd(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const s=t.bind(this);return this.emitter_.on(e,n=>{s(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const FW=(function(){return{id:"list",type:"blade",core:yc,accept(i){const e=$t(i,t=>({options:t.required.custom(Ud),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(i){const e=new Ld(ZT(i.params.options)),t=It(i.params.value,{constraint:e}),s=new xo(i.document,{props:new He({options:e.values.value("options")}),value:t,viewProps:i.viewProps});return new gl(i.document,{blade:i.blade,props:He.fromObject({label:i.params.label}),value:t,valueController:s})},api(i){return!(i.controller instanceof gl)||!(i.controller.valueController instanceof xo)?null:new BW(i.controller)}}})();class PW extends N3{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class OW extends P_{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const zC=ot("spr");class VW{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zC()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("hr");s.classList.add(zC("r")),this.element.appendChild(s)}}class IC extends oy{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new VW(e,{viewProps:t.viewProps})}))}}const zW={id:"separator",type:"blade",core:yc,accept(i){const e=$t(i,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(i){return new IC(i.document,{blade:i.blade,viewProps:i.viewProps})},api(i){return i.controller instanceof IC?new DW(i.controller):null}},IW={id:"slider",type:"blade",core:yc,accept(i){const e=$t(i,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(i){var e,t;const s=(e=i.params.value)!==null&&e!==void 0?e:0,n=new Ed({max:i.params.max,min:i.params.min}),a=It(s,{constraint:n}),l=new fg(i.document,Object.assign(Object.assign({},L3({formatter:(t=i.params.format)!==null&&t!==void 0?t:sj,keyScale:It(1),max:n.values.value("max"),min:n.values.value("min"),pointerScale:d3(i.params,s)})),{parser:aa,value:a,viewProps:i.viewProps}));return new gl(i.document,{blade:i.blade,props:He.fromObject({label:i.params.label}),value:a,valueController:l})},api(i){return!(i.controller instanceof gl)||!(i.controller.valueController instanceof fg)?null:new LW(i.controller)}},kW=(function(){return{id:"text",type:"blade",core:yc,accept(i){const e=$t(i,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(i){var e;const t=It(i.params.value),s=new fd(i.document,{parser:i.params.parse,props:He.fromObject({formatter:(e=i.params.format)!==null&&e!==void 0?e:(n=>String(n))}),value:t,viewProps:i.viewProps});return new gl(i.document,{blade:i.blade,props:He.fromObject({label:i.params.label}),value:t,valueController:s})},api(i){return!(i.controller instanceof gl)||!(i.controller.valueController instanceof fd)?null:new UW(i.controller)}}})();function GW(i){const e=i.createElement("div");return e.classList.add(ot("dfw")()),i.body&&i.body.appendChild(e),e}function qW(i,e,t){if(i.querySelector(`style[data-tp-style=${e}]`))return;const s=i.createElement("style");s.dataset.tpStyle=e,s.textContent=t,i.head.appendChild(s)}class HW extends PW{constructor(e){var t,s;const n=e??{},a=(t=n.document)!==null&&t!==void 0?t:fj(),l=RW(),u=new OW(a,{expanded:n.expanded,blade:bc(),props:He.fromObject({title:n.title}),viewProps:da.create()});super(u,l),this.pool_=l,this.containerElem_=(s=n.container)!==null&&s!==void 0?s:GW(a),this.containerElem_.appendChild(this.element),this.doc_=a,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Yt.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw Yt.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&qW(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(s=>{this.pool_.register(e.id,s)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[FW,zW,IW,C3,kW]})}}new M3("4.0.5");function jW(i){const e=new nH({canvas:i,antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(devicePixelRatio);const t=new Z_;t.background=new it(1118481);const s=new un(60,window.innerWidth/window.innerHeight,.1,1e3);s.position.set(0,12,20),s.lookAt(0,0,0);const n=new uH(s,i);n.enableDamping=!0,n.dampingFactor=.05,n.minDistance=5,n.maxDistance=60;const a=Ix(tm(1)),l=Ix(tm(2)),u=Ix(tm(1)),h=dC.x,d=dC.z,f=iH(pC(h,tm(0),d)),m=aH(f.mul(a).sub(oH.mul(u))).mul(l),b=pC(h,m,d),x=hC(13226),v=hC(65484),T=m.div(l).mul(.5).add(.5),w=rH(x,v,T),N=new EB({wireframe:!1});N.positionNode=b,N.colorNode=w;const C=new Ng(30,30,200,200);C.rotateX(-Math.PI/2);const R=new na(C,N);t.add(R);const E={frequency:a.value,amplitude:l.value,speed:u.value,wireframe:!1},k=new HW({title:"Wave Controls"});k.addBinding(E,"frequency",{min:.01,max:5,step:.01}).on("change",({value:$})=>{a.value=$}),k.addBinding(E,"amplitude",{min:0,max:8,step:.1}).on("change",({value:$})=>{l.value=$}),k.addBinding(E,"speed",{min:0,max:5,step:.1}).on("change",({value:$})=>{u.value=$}),k.addBinding(E,"wireframe").on("change",({value:$})=>{N.wireframe=$});const q=()=>{s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",q);let D;const I=()=>{D=requestAnimationFrame(I),n.update(),e.render(t,s)};return e.init().then(()=>I()),()=>{cancelAnimationFrame(D),window.removeEventListener("resize",q),n.dispose(),k.dispose(),e.dispose(),C.dispose(),N.dispose()}}function $W(){const i=Zx.useRef(null);return Zx.useEffect(()=>i.current?jW(i.current):void 0,[]),Kx.jsx("canvas",{ref:i,style:{width:"100vw",height:"100vh",display:"block"}})}zF.createRoot(document.getElementById("root")).render(Kx.jsx(Zx.StrictMode,{children:Kx.jsx($W,{})}));
